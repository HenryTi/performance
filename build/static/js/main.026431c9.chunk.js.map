{"version":3,"sources":["tonva/index.ts","tonva/components/index.ts","tonva/net/guestApi.ts","tonva/net/caller.ts","tonva/net/index.ts","tonva/net/netToken.ts","tonva/components/fetchErrorView.tsx","tonva/components/reloadPage.tsx","tonva/components/nav.tsx","tonva/tool/cacheIds.ts","tonva/tool/local.ts","tonva/tool/index.ts","tonva/components/page/pageHeader.tsx","tonva/components/page/page.tsx","tonva/net/appBridge.ts","tonva/uq/caller.ts","tonva/uq/entity.ts","tonva/net/httpChannel.ts","tonva/net/httpChannelUI.ts","tonva/net/uqApi.ts","tonva/components/edit/itemEdit.tsx","tonva/net/wsChannel.ts","tonva/res/res.ts","tonva/vm/controller.tsx","tonva/vm/view.tsx","tonva/vm/vpage.tsx","tonva/vm/index.ts","tonva/uq/query.ts","tonva/tool/uid.ts","tonva/components/image.tsx","tonva/tool/user.ts","tonva/net/host.ts","tonva/uq/action.ts","tonva/components/simple/LMR.tsx","tonva/components/simple/Badge.tsx","tonva/components/simple/FA.tsx","tonva/components/simple/Muted.tsx","tonva/components/simple/IconText.tsx","tonva/components/simple/index.ts","tonva/uq/tuid/idCache.ts","tonva/uq/tuid/tuid.ts","tonva/tool/localDb.ts","tonva/uq/tuid/reactBoxId.tsx","tonva/components/page/scrollView.tsx","tonva/components/loading.tsx","tonva/tool/env.ts","tonva/uq/tuid/index.ts","tonva/net/apiBase.ts","tonva/components/edit/imageItemEdit.tsx","tonva/res/formRes.ts","tonva/res/listRes.ts","tonva/res/entry/login.ts","tonva/res/entry/register.ts","tonva/res/index.ts","tonva/tool/pageItems.ts","tonva/components/page/tabs.tsx","tonva/components/resUploader.tsx","tonva/uq/index.ts","tonva/uq/uqMan.ts","tonva/uq/sheet.ts","tonva/uq/book.ts","tonva/uq/history.ts","tonva/uq/map.ts","tonva/uq/pending.ts","tonva/uq/tag/tagView.tsx","tonva/uq/tag/tag.ts","tonva/components/page/index.ts","tonva/components/schema/index.ts","tonva/components/rules/index.ts","tonva/components/dropDownActions/index.tsx","tonva/components/easyDate/index.tsx","tonva/components/media.tsx","tonva/components/searchBox.tsx","tonva/components/userIcon.tsx","tonva/uq/tuid/tuidsCache.ts","tonva/uq/uqsMan.ts","tonva/components/form/rules/index.ts","tonva/components/form/widgets/widget.tsx","tonva/components/form/widgets/textWidget.tsx","tonva/components/form/widgets/textareaWidget.tsx","tonva/components/form/widgets/passwordWidget.tsx","tonva/components/form/widgets/numberWidget.tsx","tonva/components/form/widgets/updownWidget.tsx","tonva/components/form/widgets/dateWidget.tsx","tonva/components/form/widgets/checkBoxWidget.tsx","tonva/components/form/widgets/selectWidget.tsx","tonva/components/form/widgets/radioWidget.tsx","tonva/components/form/widgets/rangeWidget.tsx","tonva/components/form/widgets/idWidget.tsx","tonva/components/form/widgets/unknown.tsx","tonva/components/form/widgets/buttonWidget.tsx","tonva/components/form/context.tsx","tonva/components/form/widgets/arrComponent.tsx","tonva/components/form/widgets/imageWidget.tsx","tonva/components/form/widgets/tagWidget.tsx","tonva/components/form/widgets/factory.tsx","tonva/components/form/form.tsx","tonva/components/form/field.tsx","tonva/components/form/index.ts","tonva/components/edit/stringItemEdit.tsx","tonva/components/edit/radioItemEdit.tsx","tonva/components/edit/selectItemEdit.tsx","tonva/components/edit/idItemEdit.tsx","tonva/components/edit/tagItemEdit.tsx","tonva/components/edit/edit.tsx","tonva/components/edit/index.tsx","tonva/app/centerApi.ts","tonva/app/vMain.tsx","tonva/app/CAppBase.ts","tonva/app/start.ts","tonva/app/CBase.ts","tonva/app/index.ts","tonva/components/list/base.tsx","tonva/components/list/clickable.tsx","tonva/components/list/static.tsx","tonva/components/list/selectable.tsx","tonva/components/list/index.tsx","tonva/components/propGrid/row.tsx","tonva/components/propGrid/propView.tsx","tonva/components/propGrid/PropGrid.tsx","tonva/entry/meInfo.tsx","tapp/uqs.ts","tapp/appConfig.ts","tapp/CBase.ts","tapp/main.tsx","parser/token.ts","me/VMe.tsx","me/CMe.tsx","home/VMain.tsx","home/VTest.tsx","parser/char.ts","parser/tokenStream.ts","parser/atom.ts","parser/expression.ts","parser/test.ts","home/CHome.ts","tools/state.tsx","group/VMain.tsx","group/VGroup.tsx","group/VGroupDetail.tsx","group/NoteItem/NoteItem.tsx","group/NoteItem/NoteText.tsx","tools/parseTodo.ts","group/NoteItem/NoteAssign.tsx","group/NoteItem/NoteTaskTodo.tsx","group/NoteItem/index.ts","group/CGroup.ts","job/VJob.tsx","job/CJob.ts","task/VMyTasks.tsx","task/VTodoList.tsx","task/VTodoEdit.tsx","task/VTask.tsx","task/VTaskDone.tsx","task/VTaskCheck.tsx","task/VTaskRate.tsx","task/CTask.ts","assign/VMyAssigns.tsx","assign/VAssignItems.tsx","assign/VAssignEdit.tsx","assign/VAssignNew.tsx","assign/VAssign.tsx","assign/CAssign.ts","member/VMemberDetail.tsx","member/VMemberList.tsx","member/CMember.ts","tapp/CApp.tsx","App.tsx","serviceWorker.ts","index.tsx"],"names":["guestApi","this","get","ret","decodeGuestToken","guest","token","unitName","unit","CenterApiBase","undefined","Caller","params","waiting","_params","method","netToken","userId","setCenterToken","WSChannel","FetchErrorView","reApi","a","props","clearError","channel","url","options","resolve","reject","refetchApi","close","errContent","error","err","i","push","key","style","wordWrap","className","type","onClick","React","SystemNotifyPage","message","header","ReloadPage","timerHandler","reload","clearInterval","nav","seconds","state","setInterval","setState","title","msg","ConfirmReloadPage","back","confirm","logMark","isMobile","RegExp","test","navigator","userAgent","logs","stackKey","NavView","stack","htmlTitle","waitCount","waitTimeHandler","upgradeUq","start","isHistoryBack","navBack","tick","Date","now","console","log","length","len","window","self","top","postMessage","confirmClose","pop","fetchError","wait","addEventListener","set","env","setTimeout","clearTimeout","unauthorized","showLogin","uq","version","show","view","disposer","clear","removeCeased","history","pushState","ceased","refresh","item","dispose","level","p","backLevel","popAndDispose","find","v","elWait","elError","testing","left","zIndex","name","map","index","visibility","position","ws","wsHost","local","LocalData","navSettings","language","culture","resUrl","hashParam","centerHost","arrs","windowOnError","event","source","lineno","colno","windowOnUnhandledRejection","ev","reason","windowOnClick","windowOnMouseMove","x","y","windowOnScroll","showPrivacyPage","privacy","getPrivacyContent","privacyPage","getPrivacy","html","content","__html","marked","dangerouslySetInnerHTML","Promise","race","serviceWorker","ready","registration","unregister","document","location","resetAll","ok","showReloadPage","localStorage","lang","resOptions","district","handler","onWsReceiveAny","handlerId","endWsReceive","receive","unitJsonPath","fetch","unitRes","json","res","remove","el","getElementById","loadUnitJson","innerHTML","JSON","parse","envUnit","process","REACT_APP_UNIT","Number","isDevelopment","id","getPredefinedUnitName","unitFromName","unitId","settings","origin","pathname","toLowerCase","endsWith","substr","onerror","onunhandledrejection","onselectstart","oncontextmenu","host","hash","pos","getExHashPos","substring","startWait","resHost","resUrlFromHost","setCenterUrl","setGuest","exHash","getExHash","appInFrame","setAppInFrame","parent","wsBridge","loadPredefinedUnit","predefinedUnit","user","notLogined","logined","endWait","onLogined","userApi","me","icon","nick","callback","logoutApis","stringify","saveLocalUser","showAppView","connect","defaultTop","loginTop","headers","Headers","indexOf","http","text","withBack","lv","loginView","default","footer","logout","logoutClear","cp","ChangePasswordPage","onError","showUpgradeUq","replace","topKey","popTo","ceaseTop","regConfirmClose","confirmBox","apiId","sheetType","sheetId","sheet","includes","uh","appUrl","src","String","open","date","getTime","toTimeString","step","href","r","parser","DOMParser","htmlDoc","parseFromString","elHtml","getElementsByTagName","newVersion","getAttribute","g","oem","observable","maxCount","arr","ids","dict","loadId","shift","delete","_loadIds","items","_loadId","setItem","e","Map","localDb","child","_user","_guest","_unit","forEach","d","PageHeader","afterBack","logoutClick","showLogout","debugLogout","b","right","center","ex","role","rightView","Page","observer","tabsView","tabsProps","TabsView","headerClassName","elFooter","onScroll","onScrollTop","onScrollBottom","children","renderHeader","renderFooter","uqTokens","logoutUqTokens","appsInFrame","page","param","val","isBridged","subFrameStarted","evt","data","subWin","setSubAppWindow","hidden","hideFrameBack","_","clone","initSubWin","onReceiveAppApiMessage","apiName","db","parts","split","uqOwner","uqName","appOwner","appName","uqTokenApi","onAppApiReturn","urlTest","action","uqTokenActions","Error","realUrl","getUrlOrTest","appHash","slice","lastIndexOf","u","uid","getUnit","realUnit","onReceive","callCenterApiFromMessage","bridgeCenterApiReturn","startsWith","buildAppUq","uqToken","centerToken","at","opener","appUq","brideCenterApis","bridgeCenterApi","body","callId","from","callCenterapi","directCall","result","bca","EntityCaller","entity","tries","_entity","loadSchema","innerRequest","uqApi","xcall","innerCall","jsonResult","$uq","$modify","pullModify","xresult","retry","schema","rebuildSchema","buildEntities","setSchema","ver","uqVersion","en","ActionCaller","QueryQueryCaller","unpackReturns","buildParams","QueryPageCaller","pageStart","pageSize","Entity","typeId","jName","sys","cache","fields","arrFields","returns","face","fieldMaps","localMap","f","loadEntitySchema","buildFieldsTuid","loadValues","setJName","buildFieldTuid","buildArrFieldsTuid","value","fieldName","arrName","entities","fn","getTuid","an","fieldArr","tuid","buildFieldsParams","arrResult","pa","rowResult","field","buildDateTimeParam","_tuid","getIdFromObj","dt","Math","floor","toISOString","packRow","packArr","join","row","charCodeAt","escape","values","boxId","ln","unpackRow","unpackArr","ch0","ch","c","fLen","to","n","isNaN","vals","methodsWithBody","HttpChannel","hostUrl","apiToken","ui","timeout","showError","post","urlPrefix","caller","buildOptions","path","h","append","encodeURI","innerFetch","keys","Object","k","innerFetchResult","buildError","retErr","that","timeOutHandler","statusText","ct","then","retJson","Array","isArray","retError","catch","buildHeaders","CenterHttpChannel","UqHttpChannel","HttpChannelNavUI","channelUIs","channelNoUIs","channels","UqApi","basePath","access","showWaiting","channelUI","init","acc","ApiBase","UnitxApi","buildChannel","centerAppApi","CenterAppApi","unitxUq","centerChannel","centerChannelUI","loginedUserId","t","un","localCache","nowTick","appUqParams","call","loadAppUqs","uqs","decodeUserToken","account","verify","password","prop","ItemEdit","itemSchema","uiItem","label","_itemSchema","_uiItem","newValue","internalStart","internalEnd","divValue","labelHide","templet","Templet","widget","list","rules","nv","verifyRule","rule","subAppWindow","win","WsBase","wsBaseId","handlerSeed","anyHandlers","msgHandlers","seed","$type","wsBaseSeed","WebSocket","onopen","onmessage","wsMessage","onclose","netThis","send","$lang","$district","resLang","merge","l","languages","toUpperCase","setResOptions","resGlobal","setRes","target","str","setGlobalRes","Controller","_t","isDev","receiveHandlerId","unregisterReceiveHandler","onDispose","onMessageReceive","onMessage","_resolve_$","internalT","vp","render","onEvent","alert","openPage","registerReceiveHandler","beforeStart","afterStart","onClosePage","caption","yes","no","classNames","closePage","buttons","View","controller","vm","vCall","returnCall","replacePage","backPage","ceasePage","VPage","retOnClosePage","_onClosePage","openPageElement","renderPage","onPageScroll","scroller","onPageScrollTop","onPageScrollBottom","QueryPager","query","firstSize","itemObservable","$page","idFieldName","appendPosition","sortOrder","order","_items","startIndex","getPageId","load","splice","newItem","newId","oldItem","oldId","PageItems","Query","more","startField","isPaged","size","array","deep","pageCaller","request","queryCaller","table","obj","ALPHABET","rtn","charAt","random","Image","altImage","alt","currentTarget","jwtDecode","hosts","centerhost","reshost","uqhost","unitxhost","httpArr","urlFromHost","isAbsoluteUrl","centerUrlFromHost","centerWsFromHost","fetchOptions","mode","tryLocal","getCenterHost","getResHost","promises","hostArr","findIndex","fetchUrl","debugHostUrl","localCheck","all","results","j","hostValue","debugHost","getUrlOrDebug","urlDebug","fetchLocalCheck","Action","ActionSubmitCaller","SubmitReturnsCaller","SubmitConvertCaller","pack","LMR","badge","color","badgeAlign","badgeVertical","cn","cursor","FA","spin","fixWidth","border","pull","pulse","rotate","flip","inverse","Muted","IdCache","tuidLocal","queue","loading","localArr","waitingIds","tuidInner","divName","initLocalArr","defer","isNumber","has","cacheTuids","moveToHead","removeItem","_id","getValue","useId","loadIds","tuidValues","cacheIdValues","tuids","unpackTuidIds","tuidValue","cacheValue","cacheTuidFieldValues","loadTuidIdsOrLocal","localedValues","filter","getItem","netIds","loadTuidIds","netRet","IdDivCache","div","Tuid","noCache","typeName","idName","cached","unique","isImport","TuidBox","id1","id2","equ","TuidInner","divs","cacheFields","idCache","removeAll","tuidDiv","TuidDiv","createBoxId","resetCache","assureObj","cacheIds","modifyIds","IdsCaller","valueFromId","GetCaller","cacheFieldsInValue","arrValues","mainFields","unpackTuidIdsOfFields","SaveCaller","SavePropCaller","AllCaller","searchArr","owner","SearchCaller","LoadArrCaller","SaveArrCaller","ArrPosCaller","TuidCaller","$id","transParams","arrParams","arrValue","buildDateParam","bid","$order","TuidImport","assureBox","loadMain","save","saveProp","search","loadArr","saveArr","posArr","hasDiv","ownerField","TuidBoxDiv","__ls","LocalCache","removeLocal","Local","caches","locals","keyForGet","keyForSet","sk","LocalArr","LocalMap","keyForRemove","ks","unshift","saveIndex","max","ls","TuidContent","tuidName","s","uqStringify","ReactBoxId","isUndefined","boxName","Tv","nullUI","ttv","divObj","bi","logContent","boxIdContent","tv","Scroller","scrollTo","scrollTop","offsetHeight","ScrollView","bottomTime","topTime","refDiv","onResize","removeEventListener","sh","scrollHeight","direct","Children","_$scroll","toString","eachChild","ref","data-a","Component","Loading","testingTags","pn","isTesting","tag","ms","args","global","handle","getHttpChannel","callFetch","put","ImageItemEdit","resId","onSaved","formRes","required","number","integer","min","zh","listRes","none","loginRes","registerRes","isFirst","pageItemAction","itemConverter","scrollToTop","scrollIntoView","topDiv","scrollToBottom","bottomDiv","changing","divId","loadResults","pageList","beforeLoad","loaded","allLoaded","reset","isAsc","endItem","scrollToEnd","pushItem","endIndex","startId","pid","sum","setLoaded","onLoad","setPageStart","onLoaded","reverse","sortedIndexBy","computed","Tab","contentBuilder","notify","onShown","_content","selected","TabCaptionComponent","tabBg","sep","tabClick","tab","selectedTab","tabArr","shown","tabs","bsCur","bsTab","tabPosition","borderColor","borderStyle","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","notifyCircle","num","displayNone","pageHeader","pageFooter","tabBack","isSelected","display","Tabs","ResUploader","fileInput","upload","formData","buildFormData","onFilesChange","files","names","fileName","maxSize","FormData","file","multiple","onChange","formatSize","pointLength","units","toFixed","ImageUploader","imgBaseSize","suffix","resUploader","onFileChange","fileError","uploaded","enableUploadButton","imageTypes","reader","FileReader","readAsDataURL","onload","srcImage","setSize","compress","img","width","height","srcImgWidth","srcImgHeight","w","scale","desImgWidth","round","desImgHeight","canvas","createElement","ctx","getContext","anw","createAttribute","nodeValue","anh","setAttributeNode","drawImage","base64","toDataURL","blob","convertBase64UrlToBlob","desImgSize","desImage","isChanged","showOrgImage","maxWidth","urlData","mime","match","bstr","atob","u8arr","Uint8Array","Blob","defaultChecked","disabled","levelDiv","padding","AudioUploader","audioTypes","fileSize","uploading","UqMan","uqData","tvs","actions","sheets","queries","books","maps","histories","pendings","tags","tuidsCache","localAccess","localModifyMax","createBoxIdFromTVs","tuidArr","actionArr","sheetArr","queryArr","bookArr","mapArr","historyArr","pendingArr","tagArr","clearTuids","trim","TuidsCache","accesses","loadAccess","buildTuids","buildAccess","newTuid","entityName","fromType","fromObj","book","Book","Tag","History","pending","Pending","Sheet","newAction","newQuery","newBook","newMap","newHistory","newSheet","newPending","newTag","buildSheet","build","buildTuidBox","buildTuidDivBox","modifyMax","states","ops","op","discription","app","flow","brief","unpackSheet","flows","GetSheetCaller","getArchive","unpack","SheetArchiveCaller","SheetArchivesCaller","StateSheetsCaller","PageStateItems","StateSheetCountCaller","UserSheetsCaller","MySheetsCaller","SheetCaller","count","getStateSheets","queryApiName","BookQueryCaller","schemaFrom","actionSchema","querySchema","AddCaller","DelCaller","PageCaller","qc","QueryCaller","MapCaller","getCaller","MapAddCaller","add","MapDelCaller","MapAllCaller","MapPageCaller","MapQueryCaller","radioStyle","TagView","nameFromId","namesFromIds","renderRadio","renderView","checked","renderCheck","wrapClassName","inputs","inputName","onInputChange","input","coll","_view","lines","line","ext","mobileRegex","emailRegex","timeRes","md","month","ymd","year","yesterday","today","tomorrow","$zh","$en","tt","renderDate","vDate","withTime","nDate","_date","hm","nowYear","hour","getHours","minute","getMinutes","getDate","getMonth","getFullYear","EasyTime","allowEmptySearch","onSubmit","preventDefault","initKey","onSearch","inputSize","inputClassName","onFocus","placeholder","buttonText","maxLength","defaultValue","userCache","loader","UserIcon","noneImage","UserView","idProp","useUser","use","cacheTimer","clearCacheTimer","tuidCached","innerPullModify","tuidLists","queueModify","group","modify","UQsMan","tonvaAppName","collection","localData","buildTVs","uqTVs","lj","uqsData","promiseInits","uqFullName","lower","retErrors","loadEntities","uqMan","Proxy","receiver","showReload","setInner","tuidImport","fromName","iName","setFrom","Rule","RuleCustom","func","defy","RulePredefined","RuleRequired","RuleNum","minMsg","maxMsg","template","checkMore","RuleInt","isInteger","Widget","context","fieldProps","_ui","readOnly","isChanging","changeValue","container","visible","form","inNode","requiredFlag","FieldContainer","renderBody","getUiItem","errors","contextErrors","buildRules","check","removeErrorWidget","addErrorWidget","initData","fromElement","onChanging","onChanged","prev","allowChange","setDataValue","setElementValue","elDiscription","hasError","discriptionClassName","errorList","fieldClass","FieldClass","uiLabel","TextWidget","inputType","onKeyDown","internalOnKeyDown","keyCode","onEnter","blur","setError","onBlur","checkRules","checkContextRules","hasFocus","clearErrors","renderTemplet","renderErrors","TextAreaWidget","setValue","rows","PasswordWidget","UrlWidget","EmailWidget","NumberWidget","UpdownWidget","returnValue","isValidKey","DateWidget","DateTimeWidget","TimeWidget","MonthWidget","CheckBoxWidget","trueValue","falseValue","SelectWidget","select","option","RadioWidget","rowKey","isRow","RangeWidget","IdWidget","pickId","clearContextError","Unknown","dataType","uiType","dataTypes","ButtonWidget","submit","observerRender","widgetType","button","ButtonClass","Context","uiSchema","subContexts","widgets","arrRowContexts","itemName","getDisabled","setDisabled","getReadOnly","setReadOnly","getVisible","setVisible","buttonName","errorWidgets","ew","onButtonClick","checkFieldRules","rowContext","setContextError","clearWidgetsErrors","clearContextErrors","checkHasError","rowKeySeed","RowContext","parentContext","arrSchema","uiArr","itemSchemas","FormContext","ContextContainer","ArrComponent","selectable","deletable","restorable","getArrRowContexts","arrLabel","ArrContainer","RowContainer","RowSeperator","formSelectable","formDeletable","formRestorable","arrSelectable","arrDeletable","arrRestorable","ac","rc","rs","first","rowContent","typeofTemplet","factory","selectCheck","deleteIcon","$isSelected","$source","isDeleted","$isDeleted","editContainer","Provider","ImageWidget","edit","imageSrc","end","TagWidget","widgetsFactory","textarea","datetime","time","email","updown","checkbox","image","checkboxes","radio","tagSingle","valuesView","renderRadios","tagMulti","defaultArr","def","renderChecks","range","typeWidget","getItemSchema","getTypeWidget","WidgetClass","Form","formContext","Container","watch","calcSelectOrDelete","DefaultContainer","DefaultFieldContainer","fieldLabelSize","labelView","fieldCol","DefaultFieldClass","DefaultButtonClass","DefaultRes","autorun","dv","initDataItem","arrItem","arrItems","arrDict","arrItemOperated","formArrVal","beforeShow","renderContent","contextType","StringItemEdit","preValue","verifyValue","element","RadioItemEdit","SelectItemEdit","IdItemEdit","TagItemEdit","renderInputs","TagSingleItemEdit","TagMultiItemEdit","Edit","defaultSepClassName","defaultRowContainerClassName","topBorder","bottomBorder","rowContainerClassName","rowClick","itemEdit","onItemChanged","onItemClick","stopEdit","topBorderClassName","bottomBorderClassName","sepClassName","divLabel","ie","createItemEdit","requireFlag","centerApi","VUnsupportedUnit","userName","uqsMan","VUnitSelect","renderRow","onRowClick","appUnits","VErrorsPage","VStartError","CAppBase","config","_uqs","elements","userAppUnits","showUnsupport","appUnit","openVPage","userFromId","uqAppData","setTuidImportsLocal","buildUQs","CApp","appConfig","cApp","CBase","_cApp","CSub","_owner","ListBase","pageItems","Clickable","Static","Selectable","inputItems","buildItems","itemsArray","selectedItems","compare","comp","selectItem","retItems","si","labelId","obItem","onSelect","flex","marginBottom","htmlFor","listenArraySplice","isObservableArray","observe","change","removedCount","added","_added","on","checkAll","anySelected","some","List","listBase","buildBase","selectAll","unselectAll","before","waitingMore","tabIndex","isLoading","staticRow","PropRow","PropBorder","borderTop","PropGap","LabeledPropRow","gridProps","_prop","col","labelFixLeft","bk","renderLabel","renderProp","align","vAlign","alignValue","renderPropBody","renderPropContent","StringPropRow","NumberPropRow","ListPropRow","borderBottom","ComponentPropRow","component","full","PropView","buildRows","isGap","setValues","propView","userSetProp","EnumNoteType","EnumTaskState","EnumTaskStep","CUqBase","CUqApp","stateText","act","todo","done","pass","fail","rated","archive","Token","VMain","cGroup","cJob","cHome","cMe","faceTabs","VMe","CMe","itemStyle","onEditItemChanged","renderListItem","tagTest1","tagTest2","testParser","actionTestExpression","VTest","name1","name2","chars","lowercase","uppercase","Char","NULL","TAB","_R","ENTER","SPACE","PLUS","MINUS","STAR","BACKSLASH","SLASH","PERCENT","LParenthese","RParenthese","LBrace","RBrace","LBracket","RBracket","DOT","COMMA","SEMICOLON","COLON","TOPANGLE","EQU","LS","GT","AND","OR","Apostrophe","QUOT","UNDERLINE","QUESTION","ZERO","NINE","DOLLAR","AT","SHARP","m","o","q","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","USPACE","TokenStream","bracket","buffer","cur","dec","_var","varBrace","lowerVar","LastP","prevLine","prevAt","startLine","startAt","PrevToken","advance","sourceAt","getSourceNearby","errorAt","tokens","expectToken","VAR","expect","prevToken","lastP","lastLineNum","lastChatAt","lineNum","readToken","_FINISHED","ADD","ADDEQU","SUBEQU","readLineRemark","SUB","MUL","readVar","DOLLARVAR","readRemark","readInlineCode","DIV","MOD","LPARENTHESE","RPARENTHESE","LBRACE","RBRACE","XOR","GE","LE","NE","LT","BITWISEAND","BITWISEOR","LBRACKET","readSquareVar","RBRACKET","readString","readNumber","CODE","firstDigit","NUM","rate","HEX","fromCharCode","quote","STRING","loop","Atom","OpOr","or","OpAnd","and","OpNot","not","OpLE","le","OpLT","lt","OpEQ","eq","OpNE","ne","OpGT","gt","OpGE","ge","OpAdd","OpSub","sub","OpMul","mul","OpDiv","OpMod","mod","OpBitwiseAnd","bitAnd","OpBitwiseOr","bitOr","OpNeg","neg","OpBrace","TextOperand","NumberOperand","HexOperand","hex","VarOperand","dotFirst","OpFunction","paramCount","dollarVars","OpDollarVar","dollarVar","Expression","ts","sourceStart","atoms","getSourceAt","atom","_parse","entry","isKeyword","NOT","expValue","bitWise","isValid","predefinedFunc","funcs","readFuncParameters","ReadFixCountFunc","ReadVariableParameters","concat","concat_ws","unix_timestamp","ValueExpression","exp","run","stateDefs","CHome","rev","performance","TestExpression","submitConvert","test1","test2","renderGroup","unread","vCount","bg","fontSize","bottom","onClickGroup","showGroup","onClickSend","buttonClick","onFormSubmit","saveGroup","onClickAdd","keyGroup","groupsPager","cMember","showList","VGroup","renderNote","noteItem","vNote","renderAsNote","renderTime","inputRef","getComputedStyle","addTextNote","inputed","divBottom","refDivBottom","divButtom","showCommands","commandsShown","taskTodo","showNewTask","onListFocus","onDetail","showGroupDetail","lastNoteItem","$create","groupNotesPager","Header","currentGroup","Footer","cnFooter","cnInputRow","borderRadius","bottomMark","VGroupDetail","groupMembersPager","saveGroupProp","onMember","memberId","showMemberDetail","renderMember","member","onSubmitAddMember","fromKey","groupAddMember","setGroup","onAddMember","listRemoveMember","renderRemoveButton","onRemoveMemberList","renderRemoveMemberItem","members","groupRemoveMembers","onSelectRemoveMember","onRemoveMember","renderMemberAction","renderMembers","divMembers","NoteItem","NoteText","isMe","cnDiv","bgStyle","stateIcons","parseTodo","pArr","isSepChar","plen","pSep","parseHour","seps","parseNum","isDot","isColon","hasNum","NoteAssign","assignId","showAssign","renderInternal","NoteTaskTodo","taskId","showTask","dataToNoteItem","note","queryResults","Text","buildNoteText","Assign","noteAssign","assign","assigns","buildNoteAssign","Task","annItem","tasks","buildNoteTaskTodo","createNoteText","createNoteAssign","CGroup","noteItemConverter","resetTick","PushNote","retNoteId","nts","afterAddNote","saveTaskProp","currentTask","publishAssign","PublishAssign","groupId","showNewAssign","saveTodo","todoContent","task","Todo","taskAct","toState","TaskAct","revokeTask","RemoveTask","GroupsPager","GetMyGroups","GetGroupNotes","setItemConverter","setReverse","SaveGroup","retGroupId","groupBoxId","Group","SaveGroupProp","attach","GetGroupMembers","setEachPageItem","AddGroupMember","RemoveGroupMember","pageId","VJob","keyDoing","doing","onClickDoing","renderDoing","worker","renderIcon","renderNick","renderState","showCatProject","catProject","bgIcon","catAssigns","showMyAssigns","catTasks","showMyTasks","renderCat","cat","onTest","testText","myDoingsPager","pointer","CJob","myArchiveTodosPager","TestText","tIn","GetMyTasks","VMyTasks","renderTaskItem","stepText","myTaskItem","stepDate","stepComment","onTaskClick","cnTabSelected","myTasksPager","loadTaskArchive","keyFunc","ti","itemIndex","VTodoList","allowEdit","renderTodo","assignInputItem","observableTodo","assignItem","removed","cnIcon","textDecoration","onTodoClick","assignInputItems","VTodoEdit","onTrashTodo","onUndoTodo","textColor","dotColor","vDisp","dotIcon","actionIcon","hourText","todoItems","$update","onSave","todos","onDel","spanUpdate","renderTodoList","VTask","vTodoList","onCmdDone","cmd","showTaskDone","cmdDone","onCmdDo","onCmdCheck","showTaskCheck","onCmdRate","showTaskRate","onCmdEditTodos","refreshTodos","onCmdComment","renderCommands","divCmds","renderCmdDone","renderCmdCheck","renderCmdRate","gap","renderCmdEditTodos","renderCmdComment","VTaskDone","onDone","doneTask","renderUser","VTaskCheck","onPass","passTask","onFail","failTask","VTaskRate","onRate","rateTask","CTask","publishAssignCallback","showTodoEdit","GetMyTaskArchive","GetTask","retTask","mergeWith","meTask","TaskDone","refreshJob","pushTaskNote","TaskPass","TaskFail","TaskRate","VMyAssigns","archived","myAssignsPager","renderItem","renderAssignTasks","onAssignClick","showMyAssignsArchived","VAssignItems","onNewTodo","isInputing","timeoutHandler","refInput","onInputBlur","onInput","onRemove","inputValue","saveAssignItem","lowerValue","todoItem","focus","VAssignEdit","vAssignItems","onDiscriptionChanged","saveAssignProp","onPublishTask","Content","VAssignNew","onNewAssign","newAssign","VAssign","onTakeAssign","takeAssign","renderItems","renderTasks","CAssign","TakeAssign","NewAssign","AssignItem","GetMyAssigns","showMyAssignsInternal","publishTaskCallback","GetAssign","retAssign","assignObj","loadAssign","findItem","refreshItems","VMemberDetail","VMemberList","renderMemberItem","memberItem","onMemberItem","myMembersPager","CMember","showDetail","GetMyMembers","gaps","cAssign","cTask","gapIndex","callTick","$Poked","poke","newC","showMain","initTabName","aId","innerText","hello","bId","cId","ReactDOM","hookElements","onfocus","retAfterTaskAction","setSettings","App","Boolean","hostname","elRoot"],"mappings":"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","file":"static/js/main.026431c9.chunk.js","sourcesContent":["export * from './tool';\r\nexport * from './net';\r\nexport * from './components';\r\nexport * from './entry';\r\nexport * from './uq';\r\n//export * from './CApp';\r\nexport * from './app';\r\nexport * from './vm';\r\n","export * from './nav';\r\nexport * from './page';\r\nexport * from './schema';\r\nexport * from './form';\r\nexport * from './edit';\r\nexport * from '../res/res';\r\nexport * from './loading';\r\nexport * from './image';\r\nexport * from './resUploader';\r\nexport * from './rules';\r\nexport * from './list';\r\nexport * from './dropDownActions';\r\nexport * from './easyDate';\r\nexport * from './propGrid';\r\nexport * from './simple';\r\nexport * from './media';\r\nexport * from './searchBox';\r\nexport * from './userIcon';\r\n\r\n","import { decodeGuestToken } from '../tool/user';\r\nimport { CenterApiBase } from './uqApi';\r\n\r\nexport class GuestApi extends CenterApiBase {\r\n    async guest(): Promise<any> {\r\n        //let guest = nav.local.guest.get();\r\n        let ret = await this.get('', {});\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeGuestToken(ret);\r\n            case 'object':\r\n                let guest = decodeGuestToken(ret.token);\r\n                return guest;\r\n        }\r\n    }\r\n\r\n    async unitFromName(unitName:string): Promise<number> {\r\n        let ret = await this.get(unitName);\r\n        return ret && ret.unit;\r\n    }\r\n}\r\n\r\nexport const guestApi = new GuestApi('tv/guest/', undefined);\r\n","export abstract class Caller<T> {\r\n    protected readonly _params: T;\r\n    constructor(params: T, waiting: boolean) {\r\n        this._params = params;\r\n        this.waiting = waiting;\r\n    }\r\n    protected get params():any {return this._params;}\r\n    buildParams():any {return this.params;}\r\n    method: string  = 'POST';\r\n    abstract get path(): string;\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    waiting: boolean;\r\n}\r\n","export {WSChannel, wsBridge, postWsToTop} from './wsChannel';\r\nexport * from './apiBase';\r\nexport * from './guestApi';\r\nexport * from './caller';\r\nexport * from './uqApi';\r\nexport {appInFrame, isBridged, getExHash} from './appBridge';\r\nexport * from './host';\r\n//export {userApi} from './userApi';","\r\nimport {setCenterToken} from './uqApi';\r\nimport {WSChannel} from './wsChannel';\r\n\r\nexport const netToken = {\r\n    set(userId:number, token:string) {\r\n        setCenterToken(userId, token);\r\n        WSChannel.setCenterToken(token);\r\n    },\r\n    clear() {\r\n        setCenterToken(0, undefined);\r\n        WSChannel.setCenterToken(undefined);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport {FetchError} from '../net/fetchError';\r\nimport { refetchApi } from '../net';\r\nimport { Page } from './page/page';\r\n\r\nexport interface FetchErrorProps extends FetchError {\r\n    clearError: ()=>void\r\n}\r\n\r\nexport default class FetchErrorView extends React.Component<FetchErrorProps, null> {\r\n    private reApi = async () => {\r\n        this.props.clearError();\r\n        const {channel, url, options, resolve, reject} = this.props;\r\n        await refetchApi(channel, url, options, resolve, reject);\r\n    }\r\n    private close = async () => {\r\n        this.props.clearError();\r\n    }\r\n    render() {\r\n        let {error, url} = this.props;\r\n        let errContent:any;\r\n        if (typeof error === 'object') {\r\n            let err = [];\r\n            for (let i in error) {\r\n                err.push(<li key={i}><label>{i}</label><div style={{wordWrap:\"break-word\"}}>{error[i]}</div></li>);\r\n            }\r\n            errContent = <ul>{err}</ul>;\r\n        }\r\n        else {\r\n            errContent = <div>{error}</div>;\r\n        }\r\n        return <div>\r\n            <article>\r\n\t\t\t\t<main className=\"va-error\">\r\n\t\t\t\t\t<div>网络出现问题</div>\r\n\t\t\t\t\t<div>点击重新访问</div>\r\n\t\t\t\t\t<div style={{wordWrap:\"break-word\"}}>url: {url}</div>\r\n\t\t\t\t\t{errContent}\r\n\t\t\t\t\t<div className=\"p-3\">\r\n\t\t\t\t\t\t<button type='button' onClick={this.reApi}>重新API</button>\r\n\t\t\t\t\t\t<button type='button' onClick={this.close}>关闭</button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</main>\r\n            </article>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport const SystemNotifyPage = ({message}:{message:string}):JSX.Element => {\r\n    return <Page header=\"系统提醒\">\r\n        <div className=\"px-3\">{message}</div>\r\n    </Page>;\r\n}","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Page } from './page/page';\r\n\r\ninterface Props {\r\n    message: string,\r\n    seconds: number\r\n}\r\n\r\ninterface State {\r\n    seconds: number\r\n}\r\n\r\nexport class ReloadPage extends React.Component<Props, State> {\r\n    private timerHandler:any;\r\n    constructor(props:Props) {\r\n\t\tsuper(props);\r\n\t\tlet {seconds} = props;\r\n\t\tif (seconds===undefined) return;\r\n        this.state = {seconds};\r\n\t\tif (seconds <= 0) return;\r\n        this.timerHandler = setInterval(() => {\r\n\t\t\tlet {seconds} = this.state;\r\n            seconds--;\r\n            if (seconds <= 0) {\r\n                this.reload();\r\n            }\r\n            else {\r\n                this.setState({seconds: seconds});\r\n            }\r\n        }, 1000);\r\n    }\r\n    private reload = () => {\r\n        clearInterval(this.timerHandler);\r\n        nav.reload();\r\n    }\r\n    render() {\r\n\t\tlet {seconds} = this.state;\r\n\t\tlet title:string, msg:string;\t\t\r\n\t\tif (seconds > 0) {\r\n\t\t\ttitle = '程序升级中...';\r\n\t\t\tmsg = this.state.seconds + '秒钟之后自动重启动';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttitle = '程序需要升级';\r\n\t\t\tmsg = '请点击下面按钮重启';\r\n\t\t}\r\n        return <Page header={false}>\r\n            <div className=\"text-center p-5\">\r\n                <div className=\"text-info py-5\">\r\n\t\t\t\t\t<span className=\"text-danger\">{title}</span>\r\n\t\t\t\t\t<br/>\r\n\t\t\t\t\t{msg}\r\n                    <br/>\r\n                    <span className=\"small text-muted\">{this.props.message}</span>\r\n                </div>\r\n                <button className=\"btn btn-danger\" onClick={this.reload}>立刻重启</button>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface ConfirmReloadPageProps {\r\n    confirm: (ok: boolean)=>Promise<void>;\r\n}\r\nexport const ConfirmReloadPage = (props: ConfirmReloadPageProps):JSX.Element => {\r\n    return <Page header=\"升级软件\" back=\"close\">\r\n        <div className=\"py-5 px-3 my-5 mx-2 border bg-white rounded\">\r\n            <div className=\"text-center text-info\">\r\n                升级将清除所有本机缓冲区内容，并从服务器重新安装程序！\r\n            </div>\r\n            <div className=\"text-center mt-5\">\r\n                <button className=\"btn btn-danger mr-3\" onClick={()=>props.confirm(true)}>确认升级</button>\r\n            </div>\r\n        </div>\r\n    </Page>;\r\n    // <button className=\"btn btn-outline-danger\" onClick={()=>props.confirm(false)}>暂不</button>\r\n}\r\n","import * as React from 'react';\r\nimport {observable} from 'mobx';\r\nimport marked from 'marked';\r\nimport {User, Guest/*, UserInNav*/} from '../tool/user';\r\nimport {Page} from './page/page';\r\nimport {netToken} from '../net/netToken';\r\nimport FetchErrorView, { SystemNotifyPage } from './fetchErrorView';\r\nimport {FetchError} from '../net/fetchError';\r\nimport {appUrl, setAppInFrame, getExHash, getExHashPos} from '../net/appBridge';\r\nimport {LocalData, env} from '../tool';\r\nimport {guestApi, logoutApis, setCenterUrl, setCenterToken, WSChannel, appInFrame, host, resUrlFromHost} from '../net';\r\nimport { WsBase, wsBridge } from '../net/wsChannel';\r\nimport { resOptions } from '../res/res';\r\nimport { Loading } from './loading';\r\n\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport '../css/va-form.css';\r\nimport '../css/va.css';\r\nimport '../css/animation.css';\r\nimport { FA } from './simple';\r\nimport { userApi } from '../net';\r\nimport { ReloadPage, ConfirmReloadPage } from './reloadPage';\r\n\r\nconst regEx = new RegExp('Android|webOS|iPhone|iPad|' +\r\n    'BlackBerry|Windows Phone|'  +\r\n    'Opera Mini|IEMobile|Mobile' , \r\n    'i');\r\nconst isMobile = regEx.test(navigator.userAgent);\r\n\r\n/*\r\nexport const mobileHeaderStyle = isMobile? {\r\n    minHeight:  '3em'\r\n} : undefined;\r\n*/\r\n//const logo = require('../img/logo.svg');\r\nlet logMark: number;\r\nconst logs:string[] = [];\r\n\r\nexport interface Props //extends React.Props<Nav>\r\n{\r\n    //view: JSX.Element | (()=>JSX.Element);\r\n    //start?: ()=>Promise<void>;\r\n    onLogined: ()=>Promise<void>;\r\n    notLogined?: ()=>Promise<void>;\r\n};\r\nlet stackKey = 1;\r\nexport interface StackItem {\r\n    key: number;\r\n    view: JSX.Element;\r\n    ceased: boolean;\r\n    confirmClose?: ()=>Promise<boolean>;\r\n    disposer?: ()=>void;\r\n}\r\nexport interface NavViewState {\r\n    stack: StackItem[];\r\n    wait: 0|1|2;\r\n    fetchError: FetchError\r\n}\r\n\r\nexport class NavView extends React.Component<Props, NavViewState> {\r\n    private stack: StackItem[];\r\n    private htmlTitle: string;\r\n    private waitCount: number = 0;\r\n    private waitTimeHandler?: NodeJS.Timer;\r\n\r\n    constructor(props:Props) {\r\n        super(props);\r\n        //this.back = this.back.bind(this);\r\n        //this.navBack = this.navBack.bind(this);\r\n        this.stack = [];\r\n        this.state = {\r\n            stack: this.stack,\r\n            wait: 0,\r\n            fetchError: undefined\r\n        };\r\n    }\r\n    async componentDidMount()\r\n    {\r\n        window.addEventListener('popstate', this.navBack);\r\n        nav.set(this);\r\n        await nav.start();\r\n    }\r\n\r\n    get level(): number {\r\n        return this.stack.length;\r\n    }\r\n\r\n    startWait() {\r\n        if (this.waitCount === 0) {\r\n            this.setState({wait: 1});\r\n            this.waitTimeHandler = env.setTimeout(\r\n                'NavView.startWait',\r\n                () => {\r\n                    this.waitTimeHandler = undefined;\r\n                    this.setState({wait: 2});\r\n                },\r\n                1000) as NodeJS.Timer;\r\n        }\r\n        ++this.waitCount;\r\n        this.setState({\r\n            fetchError: undefined,\r\n        });\r\n    }\r\n\r\n    endWait() {\r\n        env.setTimeout(\r\n            undefined, //'NavView.endWait',\r\n            () => {\r\n            /*\r\n            this.setState({\r\n                fetchError: undefined,\r\n            });*/\r\n            --this.waitCount;\r\n            if (this.waitCount === 0) {\r\n                if (this.waitTimeHandler !== undefined) {\r\n                    env.clearTimeout(this.waitTimeHandler);\r\n                    this.waitTimeHandler = undefined;\r\n                }\r\n                this.setState({wait: 0});\r\n            }\r\n        },100);\r\n    }\r\n\r\n    async onError(fetchError: FetchError)\r\n    {\r\n        let err = fetchError.error;\r\n        if (err !== undefined) {\r\n            if (err.unauthorized === true) {\r\n                await nav.showLogin(undefined);\r\n                return;\r\n            }\r\n            switch (err.type) {\r\n                case 'unauthorized':\r\n                    await nav.showLogin(undefined);\r\n                    return;\r\n                case 'sheet-processing':\r\n                    nav.push(<SystemNotifyPage message=\"单据正在处理中。请重新操作！\" />);\r\n                    return;\r\n            }\r\n        }\r\n        this.setState({\r\n            fetchError: fetchError,\r\n        });\r\n    }\r\n\r\n    private upgradeUq = () => {\r\n        nav.start();\r\n    }\r\n\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        this.show(<Page header={false}>\r\n            <div>\r\n                UQ升级了，请点击按钮升级 <br />\r\n                <small className=\"text-muted\">{uq} ver-{version}</small>\r\n                <button className=\"btn btn-primary\" onClick={this.upgradeUq}>升级</button>\r\n            </div>\r\n        </Page>)\r\n    }\r\n\r\n    show(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.clear();\r\n        return this.push(view, disposer);\r\n    }\r\n\r\n    push(view: JSX.Element, disposer?: ()=>void): number {\r\n        this.removeCeased();\r\n        if (this.stack.length > 0) {\r\n            window.history.pushState('forward', null, null);\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key,\r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        this.refresh();\r\n        //console.log('push: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    replace(view: JSX.Element, disposer?: ()=>void): number {\r\n        let item:StackItem = undefined;\r\n        let stack = this.stack;\r\n        if (stack.length > 0) {\r\n            item = stack.pop();\r\n            //this.popAndDispose();\r\n        }\r\n        let key = stackKey++;\r\n        this.stack.push({\r\n            key: key, \r\n            view: view, \r\n            ceased: false,\r\n            disposer: disposer\r\n        });\r\n        if (item !== undefined) this.dispose(item.disposer);\r\n        this.refresh();\r\n        //console.log('replace: %s pages', this.stack.length);\r\n        return key;\r\n    }\r\n\r\n    ceaseTop(level:number = 1) {\r\n        let p = this.stack.length - 1;\r\n        for (let i=0; i<level; i++, p--) {\r\n            if (p < 0) break;\r\n            let item = this.stack[p];\r\n            item.ceased = true;\r\n        }\r\n    }\r\n\r\n    pop(level:number = 1) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        //console.log('pop start: %s pages level=%s', len, level);\r\n        if (level <= 0 || len <= 1) return;\r\n        if (len < level) level = len;\r\n        let backLevel = 0;\r\n        for (let i = 0; i < level; i++) {\r\n            if (stack.length === 0) break;\r\n            //stack.pop();\r\n            this.popAndDispose();\r\n            ++backLevel;\r\n        }\r\n        if (backLevel >= len) backLevel--;\r\n        this.refresh();\r\n        if (this.isHistoryBack !== true) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(backLevel);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n        //console.log('pop: %s pages', stack.length);\r\n    }\r\n\r\n    popTo(key: number) {\r\n        if (key === undefined) return;\r\n        if (this.stack.find(v => v.key === key) === undefined) return;\r\n        while (this.stack.length >0) {\r\n            let len = this.stack.length;\r\n            let top = this.stack[len-1];\r\n            if (top.key === key) break;\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    topKey():number {\r\n        let len = this.stack.length;\r\n        if (len === 0) return undefined;\r\n        return this.stack[len-1].key;\r\n    }\r\n\r\n    removeCeased() {\r\n        for (;;) {\r\n            let p=this.stack.length-1;\r\n            if (p < 0) break;\r\n            let top = this.stack[p];\r\n            if (top.ceased === false) break;\r\n            let item = this.stack.pop();\r\n            let {disposer} = item;\r\n            this.dispose(disposer);\r\n        }\r\n        this.refresh();\r\n    }\r\n\r\n    private popAndDispose() {\r\n        this.removeCeased();\r\n        let item = this.stack.pop();\r\n        if (item === undefined) return;\r\n        let {disposer} = item;\r\n        this.dispose(disposer);\r\n        this.removeCeased();\r\n        return item;\r\n    }\r\n\r\n    private dispose(disposer:()=>void) {\r\n        if (disposer === undefined) return;\r\n        let item = this.stack.find(v => v.disposer === disposer);\r\n        if (item === undefined) disposer();\r\n    }\r\n\r\n    clear() {\r\n        let len = this.stack.length;\r\n        while (this.stack.length > 0) this.popAndDispose();\r\n        //this.refresh();\r\n        if (len > 1) {\r\n            //window.removeEventListener('popstate', this.navBack);\r\n            //window.history.back(len-1);\r\n            //window.addEventListener('popstate', this.navBack);\r\n        }\r\n    }\r\n\r\n    regConfirmClose(confirmClose:()=>Promise<boolean>) {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        let top = stack[len-1];\r\n        top.confirmClose = confirmClose;\r\n    }\r\n\r\n    private isHistoryBack:boolean = false;\r\n    navBack = () => {\r\n        //nav.log('backbutton pressed - nav level: ' + this.stack.length);\r\n        let tick = Date.now();\r\n        this.isHistoryBack = true;\r\n        this.back(true);\r\n        this.isHistoryBack = false;\r\n        console.log(`///\\\\\\\\ ${Date.now()-tick}ms backbutton pressed - nav level: ${this.stack.length}`);\r\n    }\r\n\r\n    back = async (confirm:boolean = true) => {\r\n        let stack = this.stack;\r\n        let len = stack.length;\r\n        if (len === 0) return;\r\n        if (len === 1) {\r\n            if (window.self !== window.top) {\r\n                window.top.postMessage({type:'pop-app'}, '*');\r\n            }\r\n            return;\r\n        }\r\n        let top = stack[len-1];\r\n        if (confirm===true && top.confirmClose) {\r\n            if (await top.confirmClose()===true) this.pop();\r\n        }\r\n        else {\r\n            this.pop();\r\n        }\r\n    }\r\n\r\n    confirmBox(message?:string): boolean {\r\n        return window.confirm(message);\r\n    }\r\n    clearError = () => {\r\n        this.setState({fetchError: undefined});\r\n    }\r\n    render() {\r\n        const {wait, fetchError} = this.state;\r\n        let stack = this.state.stack;\r\n        let top = stack.length - 1;\r\n        let elWait = null, elError = null;\r\n        switch (wait) {\r\n            case 1:\r\n                elWait = <div className=\"va-wait va-wait1\">\r\n                </div>;\r\n                break;\r\n            case 2:\r\n                elWait = <div className=\"va-wait va-wait2\">\r\n                    <Loading />\r\n                </div>;\r\n                break;\r\n        }\r\n        if (fetchError)\r\n            elError = <FetchErrorView clearError={this.clearError} {...fetchError} />;\r\n        let test = nav.testing===true && \r\n\t\t\t<span className=\"cursor-pointer position-fixed\" style={{top:0,left:'0.2rem',zIndex:90001}}>\r\n                <FA className=\"text-warning\" name=\"info-circle\" />\r\n            </span>;\r\n        return <>\r\n\t\t\t{stack.map((item, index) => {\r\n\t\t\t\tlet {key, view} = item;\r\n\t\t\t\treturn <div key={key} style={index<top? {visibility: 'hidden', position: 'absolute'}:undefined}>\r\n\t\t\t\t\t{view}\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t\t{elWait}\r\n\t\t\t{elError}\r\n\t\t\t{test}\r\n        </>;\r\n    }\r\n\r\n    private refresh() {\r\n        this.setState({stack: this.stack });\r\n    }\r\n}\r\n\r\nexport interface NavSettings {\r\n    oem?: string;\r\n    loginTop?: JSX.Element;\r\n    privacy?: string;\r\n}\r\n\r\nexport class Nav {\r\n    private nav:NavView;\r\n    private ws: WsBase;\r\n    private wsHost: string;\r\n    private local: LocalData = new LocalData();\r\n    private navSettings: NavSettings;\r\n    @observable user: User/*InNav*/ = undefined;\r\n    testing: boolean;\r\n    language: string;\r\n    culture: string;\r\n    resUrl: string;\r\n\r\n    constructor() {\r\n        let {lang, district} = resOptions;\r\n        this.language = lang;\r\n        this.culture = district;\r\n        this.testing = false;\r\n    }\r\n\r\n    get guest(): number {\r\n        let guest = this.local.guest;\r\n        if (guest === undefined) return 0;\r\n        let g = guest.get();\r\n        if (g === undefined) return 0;\r\n        return g.guest;\r\n    }\r\n\r\n    set(nav:NavView) {\r\n        //this.logo = logo;\r\n        this.nav = nav;\r\n    }\r\n\r\n    registerReceiveHandler(handler: (message:any)=>Promise<void>):number {\r\n        if (this.ws === undefined) return;\r\n        return this.ws.onWsReceiveAny(handler);\r\n    }\r\n\r\n    unregisterReceiveHandler(handlerId:number) {\r\n        if (this.ws === undefined) return;\r\n        if (handlerId === undefined) return;\r\n        this.ws.endWsReceive(handlerId);\r\n    }\r\n\r\n    async onReceive(msg:any) {\r\n        if (this.ws === undefined) return;\r\n        await this.ws.receive(msg);\r\n    }\r\n\r\n\tprivate async loadUnitJson() {\r\n\t\ttry {\r\n\t\t\tlet unitJsonPath = this.unitJsonPath();\r\n\t\t\tlet unitRes = await fetch(unitJsonPath, {});\r\n\t\t\tlet res = await unitRes.json();\r\n\t\t\treturn res.unit;\r\n\t\t}\r\n\t\tcatch (err1) {\r\n\t\t\tthis.local.unit.remove();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n    private async getPredefinedUnitName() {\r\n\t\tlet el = document.getElementById('unit.json');\r\n\t\tif (!el) {\r\n\t\t\treturn await this.loadUnitJson();\r\n\t\t}\r\n\t\ttry {\r\n            let json = el.innerHTML;\r\n            let res = JSON.parse(json);\r\n            return res.unit;\r\n        }\r\n        catch (err) {\r\n\t\t\treturn await this.loadUnitJson();\r\n        }\r\n    }\r\n\r\n    private async loadPredefinedUnit() {\r\n        let envUnit = process.env.REACT_APP_UNIT;\r\n        if (envUnit !== undefined) {\r\n            return Number(envUnit);\r\n        }\r\n        let unitName:string;\r\n        let unit = this.local.unit.get();\r\n        if (unit !== undefined) {\r\n            if (env.isDevelopment !== true) return unit.id;\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n            if (unit.name === unitName) return unit.id;\r\n        }\r\n        else {\r\n            unitName = await this.getPredefinedUnitName();\r\n            if (unitName === undefined) return;\r\n        }\r\n        let unitId = await guestApi.unitFromName(unitName);\r\n        if (unitId !== undefined) {\r\n            this.local.unit.set({id: unitId, name: unitName});\r\n        }\r\n        return unitId;\r\n    }\r\n\r\n    setSettings(settings?: NavSettings) {\r\n        this.navSettings = settings;\r\n    }\r\n\r\n    get oem():string {\r\n        return this.navSettings && this.navSettings.oem;\r\n    }\r\n\r\n    hashParam: string;\r\n    private centerHost: string;\r\n    private arrs = ['/test', '/test/'];\r\n    private unitJsonPath():string {\r\n        let {origin, pathname} = document.location;\r\n        //href = href.toLowerCase();\r\n        pathname = pathname.toLowerCase();\r\n        for (let item of this.arrs) {\r\n            if (pathname.endsWith(item) === true) {\r\n                pathname = pathname.substr(0, pathname.length - item.length);\r\n                break;\r\n            }\r\n        }\r\n        if (pathname.endsWith('/') === true || pathname.endsWith('\\\\') === true) {\r\n            pathname = pathname.substr(0, pathname.length-1);\r\n        }\r\n        return origin + pathname + '/unit.json';\r\n    }\r\n    private windowOnError = (event: Event | string, source?: string, lineno?: number, colno?: number, error?: Error) => {\r\n        console.error('windowOnError');\r\n        console.error(error);\r\n    }\r\n    private windowOnUnhandledRejection = (ev: PromiseRejectionEvent) => {\r\n        console.error('windowOnUnhandledRejection');\r\n        console.error(ev.reason);\r\n    }\r\n    private windowOnClick = (ev: MouseEvent) => {\r\n        console.error('windowOnClick');\r\n    }\r\n    private windowOnMouseMove = (ev: MouseEvent) => {\r\n        console.log('navigator.userAgent: ' + navigator.userAgent);\r\n        console.log('mouse move (%s, %s)', ev.x, ev.y);\r\n    }\r\n    private windowOnScroll = (ev: Event) => {\r\n        console.log('scroll event');\r\n    }\r\n    async start() {\r\n        try {\r\n            window.onerror = this.windowOnError;\r\n            window.onunhandledrejection = this.windowOnUnhandledRejection;\r\n            //window.addEventListener('click', this.windowOnClick);\r\n            //window.addEventListener('mousemove', this.windowOnMouseMove);\r\n            //window.addEventListener('touchmove', this.windowOnMouseMove);\r\n            //window.addEventListener('scroll', this.windowOnScroll);\r\n            if (isMobile === true) {\r\n                document.onselectstart = function() {return false;}\r\n                document.oncontextmenu = function() {return false;}\r\n            }\r\n            //window.setInterval(()=>console.error('tick every 5 seconds'), 5000);\r\n            this.testing = env.testing;\r\n            await host.start(this.testing);\r\n            let hash = document.location.hash;\r\n            if (hash !== undefined && hash.length > 0) {\r\n                let pos = getExHashPos();\r\n                if (pos < 0) pos = undefined;\r\n                this.hashParam = hash.substring(1, pos);\r\n            }\r\n            nav.clear();\r\n            this.startWait();\r\n            let {url, ws, resHost} = host;\r\n            this.centerHost = url;\r\n            this.resUrl = resUrlFromHost( resHost);\r\n            this.wsHost = ws;\r\n            setCenterUrl(url);\r\n            \r\n            let guest:Guest = this.local.guest.get();\r\n            if (guest === undefined) {\r\n                guest = await guestApi.guest();\r\n            }\r\n            nav.setGuest(guest);\r\n\r\n            let exHash = getExHash();\r\n            let appInFrame = setAppInFrame(exHash);\r\n            if (exHash !== undefined && window !== window.parent) {\r\n                // is in frame\r\n                if (appInFrame !== undefined) {\r\n                    this.ws = wsBridge;\r\n                    console.log('this.ws = wsBridge in sub frame');\r\n                    //nav.user = {id:0} as User;\r\n                    if (window.self !== window.parent) {\r\n                        window.parent.postMessage({type:'sub-frame-started', hash: appInFrame.hash}, '*');\r\n                    }\r\n                    // 下面这一句，已经移到 appBridge.ts 里面的 initSubWin，也就是响应从main frame获得user之后开始。\r\n                    //await this.showAppView();\r\n                    return;\r\n                }\r\n            }\r\n\r\n            let predefinedUnit = await this.loadPredefinedUnit();\r\n            appInFrame.predefinedUnit = predefinedUnit;\r\n\r\n            let user: User = this.local.user.get();\r\n            if (user === undefined) {\r\n                let {notLogined} = this.nav.props;\r\n                if (notLogined !== undefined) {\r\n                    await notLogined();\r\n                }\r\n                else {\r\n                    await nav.showLogin(undefined);\r\n                }\r\n                return;\r\n            }\r\n\r\n            await nav.logined(user);\r\n        }\r\n        catch (err) {\r\n        }\r\n        finally {\r\n            this.endWait();\r\n        }\r\n    }\r\n\r\n    async showAppView() {\r\n        let {onLogined} = this.nav.props;\r\n        if (onLogined === undefined) {\r\n            nav.push(<div>NavView has no prop onLogined</div>);\r\n            return;\r\n        }\r\n        nav.clear();\r\n        await onLogined();\r\n        //console.log('logined: AppView shown');\r\n    }\r\n\r\n    setGuest(guest: Guest) {\r\n        this.local.guest.set(guest);\r\n        netToken.set(0, guest.token);\r\n    }\r\n\r\n    saveLocalUser() {\r\n        this.local.user.set(this.user);\r\n    }\r\n\r\n    async loadMe() {\r\n        let me = await userApi.me();\r\n        this.user.icon = me.icon;\r\n        this.user.nick = me.nick;\r\n    }\r\n\r\n    async logined(user: User, callback?: (user:User)=>Promise<void>) {\r\n        logoutApis();\r\n        console.log(\"logined: %s\", JSON.stringify(user));\r\n        this.user = user;\r\n        this.saveLocalUser();\r\n        netToken.set(user.id, user.token);\r\n        if (callback !== undefined) //this.loginCallbacks.has)\r\n            callback(user);\r\n            //this.loginCallbacks.call(user);\r\n        else {\r\n            await this.showAppView();\r\n        }\r\n    }\r\n\r\n    wsConnect() {\r\n        let ws:WSChannel = this.ws = new WSChannel(this.wsHost, this.user.token);\r\n        ws.connect();\r\n    }\r\n\r\n    loginTop(defaultTop:JSX.Element) {\r\n        return (this.navSettings && this.navSettings.loginTop) || defaultTop;\r\n    }\r\n\r\n    privacyEntry() {\r\n        if (!this.getPrivacyContent()) return;\r\n        return <div className=\"text-center\">\r\n            <button className=\"btn btn-sm btn-link\"\r\n                onClick={this.showPrivacyPage}>\r\n                <small className=\"text-muted\">隐私政策</small>\r\n            </button>\r\n        </div>;\r\n    }\r\n\r\n    private getPrivacyContent():string {\r\n        if (!this.navSettings) return;\r\n        let {privacy} = this.navSettings;\r\n        return privacy;\r\n    }\r\n\r\n    showPrivacyPage = () => {\r\n        let privacy = this.getPrivacyContent();\r\n        if (privacy) {\r\n            this.privacyPage(privacy);\r\n        }\r\n        else {\r\n            nav.push(<Page header=\"隐私政策\">\r\n                <div className=\"p-3\">AppConfig 中没有定义 privacy。可以定义为字符串，或者url。markdown格式</div>\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    private privacyPage = async (privacy:string) => {\r\n        let html = await this.getPrivacy(privacy);\r\n        let content = {__html: marked(html)};\r\n        nav.push(<Page header=\"隐私政策\">\r\n            <div className=\"p-3\" dangerouslySetInnerHTML={content} />\r\n        </Page>);\r\n    }\r\n\r\n    private async getPrivacy(privacy:string):Promise<string> {\r\n        const headers = new  Headers({\r\n            \"Content-Type\":'text/plain'\r\n       })\r\n        let pos = privacy.indexOf('://');\r\n        if (pos > 0) {\r\n            let http = privacy.substring(0, pos).toLowerCase();\r\n            if (http === 'http' || http === 'https') {\r\n                try {\r\n                    let res = await fetch(privacy, {\r\n                        method:'GET',\r\n                        headers: headers,\r\n                    });\r\n                    let text = await res.text();\r\n                    return text;\r\n                }\r\n                catch (err) {\r\n                    return err.message;\r\n                }\r\n            }\r\n        }\r\n        return privacy;\r\n    }\r\n\r\n    async showLogin(callback?: (user:User)=>Promise<void>, withBack?:boolean) {\r\n        let lv = await import('../entry/login');\r\n        let loginView = <lv.default \r\n            withBack={withBack} \r\n            callback={callback} />;\r\n        if (withBack !== true) {\r\n            this.nav.clear();\r\n            this.pop();\r\n        }\r\n        this.nav.push(loginView);\r\n    }\r\n\r\n    async showLogout(callback?: ()=>Promise<void>) {\r\n        let footer = <div className=\"text-center justify-content-center\">\r\n            <button className=\"btn btn-outline-danger\" onClick={this.resetAll}>升级软件</button>\r\n        </div>;\r\n        nav.push(<Page header=\"安全退出\" back=\"close\" footer={footer}>\r\n            <div className=\"my-5 mx-1 border border-info bg-white rounded p-3 text-center\">\r\n                <div>退出当前账号不会删除任何历史数据，下次登录依然可以使用本账号</div>\r\n                <div className=\"mt-3 text-center\">\r\n                        <button className=\"btn btn-danger\" onClick={()=>this.logout(callback)}>安全退出</button>\r\n                </div>\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    async logout(callback?:()=>Promise<void>) { //notShowLogin?:boolean) {\r\n        appInFrame.unit = undefined;\r\n        this.local.logoutClear();\r\n        this.user = undefined; //{} as User;\r\n        logoutApis();\r\n        let guest = this.local.guest.get();\r\n        setCenterToken(0, guest && guest.token);\r\n        this.ws = undefined;\r\n        /*\r\n        if (this.loginCallbacks.has)\r\n            this.logoutCallbacks.call();\r\n        else {\r\n            if (notShowLogin === true) return;\r\n        }\r\n        await nav.start();\r\n        */\r\n        if (callback === undefined)\r\n            await nav.start();\r\n        else\r\n            await callback();\r\n    }\r\n\r\n    async changePassword() {\r\n        let cp = await import('../entry/changePassword');\r\n        nav.push(<cp.ChangePasswordPage />);\r\n    }\r\n\r\n    get level(): number {\r\n        return this.nav.level;\r\n    }\r\n    startWait() {\r\n        this.nav.startWait();\r\n    }\r\n    endWait() {\r\n        this.nav.endWait();\r\n    }\r\n    async onError(error: FetchError) {\r\n        await this.nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await this.nav.showUpgradeUq(uq, version);\r\n    }\r\n\r\n    show (view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.show(view, disposer);\r\n    }\r\n    push(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.push(view, disposer);\r\n    }\r\n    replace(view: JSX.Element, disposer?: ()=>void): void {\r\n        this.nav.replace(view, disposer);\r\n    }\r\n    pop(level:number = 1) {\r\n        this.nav.pop(level);\r\n    }\r\n    topKey():number {\r\n        return this.nav.topKey();\r\n    }\r\n    popTo(key:number) {\r\n        this.nav.popTo(key);\r\n    }\r\n    clear() {\r\n        this.nav.clear();\r\n    }\r\n    navBack() {\r\n        this.nav.navBack();\r\n    }\r\n    ceaseTop(level?:number) {\r\n        this.nav.ceaseTop(level);\r\n    }\r\n    removeCeased() {\r\n        this.nav.removeCeased();\r\n    }\r\n    async back(confirm:boolean = true) {\r\n        await this.nav.back(confirm);\r\n    }\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.nav.regConfirmClose(confirmClose);\r\n    }\r\n    confirmBox(message?:string): boolean {\r\n        return this.nav.confirmBox(message);\r\n    }\r\n    async navToApp(url: string, unitId: number, apiId?:number, sheetType?:number, sheetId?:number):Promise<void> {\r\n        return new Promise<void>((resolve, reject) => {\r\n            let sheet = this.centerHost.includes('http://localhost:') === true? 'sheet_debug':'sheet'\r\n            let uh = sheetId === undefined?\r\n                    appUrl(url, unitId) :\r\n                    appUrl(url, unitId, sheet, [apiId, sheetType, sheetId]);\r\n            console.log('navToApp: %s', JSON.stringify(uh));\r\n            nav.push(<article className='app-container'>\r\n                <span id={uh.hash} onClick={()=>this.back()} /*style={mobileHeaderStyle}*/>\r\n                    <i className=\"fa fa-arrow-left\" />\r\n                </span>\r\n                {\r\n                    // eslint-disable-next-line \r\n                    <iframe src={uh.url} title={String(sheetId)} />\r\n                }\r\n            </article>, \r\n            ()=> {\r\n                resolve();\r\n            });\r\n        });\r\n    }\r\n\r\n    navToSite(url: string) {\r\n        // show in new window\r\n        window.open(url);\r\n    }\r\n\r\n    get logs() {return logs};\r\n    log(msg:string) {\r\n        logs.push(msg);\r\n    }\r\n    logMark() {\r\n        let date = new Date();\r\n        logMark = date.getTime();\r\n        logs.push('log-mark: ' + date.toTimeString());\r\n    }\r\n    logStep(step:string) {\r\n        logs.push(step + ': ' + (new Date().getTime() - logMark));\r\n    }\r\n\r\n    showReloadPage(msg: string) {\r\n        let seconds = -1;\r\n\t\tthis.push(<ReloadPage message={msg} seconds={seconds} />);\r\n\t\t/*\r\n\t\tif (seconds > 0) {\r\n\t\t\tenv.setTimeout(undefined, this.reload, seconds*1000);\r\n\t\t}\r\n\t\t*/\r\n    }\r\n\r\n    reload = async () => {\r\n        let waiting:Promise<void> = new Promise<void>((resolve, reject) => {\r\n            setTimeout(resolve, 100);\r\n        });\r\n\r\n        if ('serviceWorker' in navigator) {\r\n            let registration =await Promise.race([waiting, navigator.serviceWorker.ready]);\r\n            if (registration) registration.unregister();\r\n        }\r\n        window.document.location.reload();\r\n    }\r\n\r\n    resetAll = () => {\r\n        this.push(<ConfirmReloadPage confirm={(ok:boolean):Promise<void> => {\r\n            if (ok === true) {\r\n                this.showReloadPage('彻底升级');\r\n\t\t\t\tlocalStorage.clear();\r\n\t\t\t\t/*\r\n                this.local.readToMemory();\r\n                env.localDb.removeAll();\r\n\t\t\t\tthis.local.saveToLocalStorage();\r\n\t\t\t\t*/\r\n            }\r\n            else {\r\n                this.pop();\r\n            }\r\n            return;\r\n        }} />);\r\n    }\r\n\r\n    async checkVersion():Promise<string> {\r\n        let {href} = document.location;\r\n        href += (href.indexOf('?')>=0? '&':'?') + '_t_t_=' + new Date().getTime();\r\n        let ret = await fetch(href);\r\n        let r = await ret.text();\r\n        let parser = new DOMParser();\r\n        let htmlDoc = parser.parseFromString(r, 'text/html');\r\n        let elHtml = htmlDoc.getElementsByTagName('html');\r\n        let newVersion = elHtml[0].getAttribute('data-version');\r\n        return newVersion;\r\n    }\r\n}\r\nexport const nav: Nav = new Nav();\r\n","import {observable} from 'mobx';\r\n\r\nexport interface Id {\r\n    id: number;\r\n}\r\n\r\nexport abstract class CacheIds<T extends Id> {\r\n    constructor(maxCount:number = 100) {\r\n        this.maxCount = maxCount;\r\n    }\r\n    private maxCount:number;\r\n    private arr:T[] = [];\r\n    @observable dict = new Map<number, T>();\r\n\r\n    loadIds(ids:number[]) {\r\n        let arr:number[] = [];\r\n        for (let id of ids) {\r\n            if (id === null) continue;\r\n            let item = this.dict.get(id);\r\n            if (item === undefined) {\r\n                arr.push(id);\r\n                item = {id:id} as T;\r\n                this.dict.set(id, item);\r\n            }\r\n        }                \r\n        this.loadId(arr);\r\n    }\r\n\r\n    get(id:number):T {\r\n        if (id === undefined || id === null) return null;\r\n        let item = this.dict.get(id);\r\n        if (item === undefined) {\r\n            this.dict.set(id, {id:id} as T);\r\n            this.loadId([id]);\r\n            item = this.dict.get(id);\r\n        }\r\n        return item;\r\n    }\r\n    private setItem(id:number, item:T) {\r\n        if (item === undefined) {\r\n            this.dict.set(id, null);\r\n            this.arr.push({id: id} as T);\r\n        }\r\n        else {\r\n            this.dict.set(id, item);\r\n            this.arr.push(item);\r\n        }\r\n        if (this.arr.length > this.maxCount) {\r\n            item = this.arr.shift();\r\n            this.dict.delete(item.id);\r\n        }\r\n    }\r\n    private async loadId(ids:number[]) {\r\n        let items = await this._loadIds(ids);\r\n        if (items === undefined) {\r\n            for (let id of ids) {\r\n                if (id === null) continue;\r\n                let item = await this._loadId(id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n        else {\r\n            for (let id of ids) {\r\n                let item = items.find(v => v.id === id);\r\n                this.setItem(id, item);\r\n            }\r\n        }\r\n    }\r\n\r\n    protected abstract async _loadIds(ids:number[]):Promise<T[]>;\r\n    protected abstract async _loadId(id:number):Promise<T>;\r\n}\r\n","import { env } from './env';\r\n\r\nexport class LocalData {\r\n    user = env.localDb.child('user');\r\n    guest = env.localDb.child('guest');\r\n    unit = env.localDb.child('unit');\r\n\r\n    private _user:string;\r\n    private _guest:string;\r\n    private _unit:string;\r\n    readToMemory() {\r\n        this._user = this.user.get();\r\n        this._guest = this.guest.get();\r\n        this._unit = this.unit.get();\r\n    }\r\n    saveToLocalStorage() {\r\n        this.user.set(this._user);\r\n        this.guest.set(this._guest);\r\n        this.unit.set(this._unit);\r\n    }\r\n\r\n    logoutClear() {\r\n        [\r\n            this.user,\r\n            this.unit,\r\n        ].forEach(d => d.remove());\r\n    }\r\n}\r\n","export {left0} from './left0';\r\nexport * from './user';\r\nexport * from './uid';\r\nexport {PageItems} from './pageItems';\r\nexport {CacheIds} from './cacheIds';\r\nexport {LocalMap, LocalArr, LocalCache} from './localDb';\r\nexport {LocalData} from './local';\r\nexport {env} from './env';","import * as React from 'react';\r\nimport {nav} from '../nav';\r\n\r\nexport interface PageHeaderProps {\r\n    back?: 'back' | 'close' | 'none';\r\n    center: string | JSX.Element;\r\n    right?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n    className?: string;\r\n\tafterBack?: () => void;\r\n\tex?: JSX.Element;\r\n}\r\n\r\nexport class PageHeader extends React.Component<PageHeaderProps> {\r\n    private back = async () => {\r\n        await nav.back(); // 这个才会显示confirm box，在dataForm里面，如果输入了数据的话\r\n\t\tlet {afterBack} = this.props;\r\n\t\tif (afterBack) afterBack();\r\n    }\r\n    openWindow() {\r\n        window.open(document.location.href);\r\n    }\r\n    private logoutClick = () => {\r\n        nav.showLogout(this.logout);\r\n    }\r\n    private logout = async () => {\r\n        let {logout} = this.props;\r\n        if (typeof logout === 'function') {\r\n            await logout(); \r\n        }\r\n        await nav.logout(undefined);\r\n    }\r\n    render() {\r\n        let b = nav.level > 1 || window.self !== window.top;\r\n        let {right, center, logout, className, ex} = this.props;\r\n        let back:any, debugLogout:any;\r\n        if (logout !== undefined && window.self === window.top) {\r\n            if ((typeof logout === 'boolean' && logout === true)\r\n                || typeof logout === 'function')\r\n            {\r\n                let {user} = nav;\r\n                if (user !== undefined) {\r\n                    let {nick, name} = user;\r\n                    debugLogout = <div className=\"d-flex align-items-center\">\r\n                        <small className=\"text-light\">{nick || name}</small>\r\n                        {\r\n                            // eslint-disable-next-line\r\n                            <div className=\"ml-2 py-2 px-3 cursor-pointer\"\r\n                                role=\"button\"\r\n                                onClick={this.logoutClick}>\r\n                                <i className=\"fa fa-sign-out fa-lg\" />\r\n                            </div>\r\n                        }\r\n                    </div>;\r\n                }\r\n            }\r\n        }\r\n        if (b) {\r\n            switch (this.props.back) {\r\n                case 'none':\r\n                    back = undefined;\r\n                    break;\r\n                default:\r\n                case 'back':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-angle-left\" /></nav>;\r\n                    break;\r\n                case 'close':\r\n                    back = <nav onClick={this.back}><i className=\"fa fa-close\" /></nav>;\r\n                    break;\r\n            }\r\n        }\r\n        if (window.self !== window.top) {\r\n            console.log(document.location.href);\r\n            // pop = <header onClick={this.openWindow} className=\"mx-1\"><FA name=\"external-link\" /></header>;\r\n        }\r\n        if (back === undefined && typeof center === 'string') {\r\n            center = <div className=\"px-3\">{center}</div>;\r\n        }\r\n\t\tlet rightView = (right || debugLogout) && <aside>{right} {debugLogout}</aside>;\r\n\t\tlet header = <header className={className}>\r\n\t\t\t<nav>\r\n\t\t\t\t{back}\r\n\t\t\t\t{/*pop 弹出window暂时停止作用 */}\r\n\t\t\t\t<div>{center}</div>\r\n\t\t\t\t{rightView}\r\n\t\t\t</nav>\r\n\t\t\t{ex}\r\n\t\t</header>;\r\n        return <>\r\n\t\t\t<section className=\"tv-page-header\">{header}</section>\r\n\t\t\t{header}\r\n\t\t</>;\r\n\t\t/*\r\n\t\t\t<header className={className}>\r\n\t\t\t<section>\r\n\t\t\t\t<header>\r\n\t\t\t\t\t{back}\r\n\t\t\t\t\t<div>{center}</div>\r\n\t\t\t\t\t{rightView}\r\n\t\t\t\t</header>\r\n\t\t\t</section>\r\n            {back}\r\n            <div>{center}</div>\r\n            {rightView}\r\n        </header>;*/\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport {PageHeader} from './pageHeader';\r\nimport { TabsProps, TabsView } from './tabs';\r\nimport { ScrollProps, ScrollView } from './scrollView';\r\n\r\nexport interface IVPage {\r\n\tcontent():JSX.Element;\r\n\theader():JSX.Element;\r\n\tfooter():JSX.Element;\r\n}\r\n\r\n\r\nexport interface PageProps extends ScrollProps {\r\n    back?: 'close' | 'back' | 'none';\r\n    header?: boolean | string | JSX.Element;\r\n    right?: JSX.Element;\r\n    footer?: JSX.Element;\r\n    logout?: boolean | (()=>Promise<void>);\r\n\theaderClassName?: string;\r\n\tclassName?: string;\r\n\tafterBack?: () => void;\r\n\ttabsProps?: TabsProps;\r\n}\r\n\r\n@observer\r\nexport class Page extends React.Component<PageProps> {\r\n\tprivate tabsView: TabsView;\r\n    constructor(props: PageProps) {\r\n\t\tsuper(props);\r\n\t\tlet {tabsProps} = props;\r\n\t\tif (tabsProps) {\r\n\t\t\tthis.tabsView = new TabsView(tabsProps);\r\n\t\t}\r\n\t}\r\n\r\n\tprivate renderHeader() {\r\n\t\tconst {back, header, right, headerClassName, afterBack} = this.props;\r\n\t\tlet pageHeader = header !== false && <PageHeader \r\n\t\t\tback={back} \r\n\t\t\tcenter={header as any}\r\n\t\t\tright={right}\r\n\t\t\tlogout={this.props.logout}\r\n\t\t\tclassName={headerClassName}\r\n\t\t\tafterBack={afterBack}\r\n\t\t\t/>;\r\n\t\treturn pageHeader;\r\n\t}\r\n\r\n\tprivate renderFooter() {\r\n\t\tconst {footer} = this.props;\r\n\t\tif (footer) {\r\n\t\t\tlet elFooter = <footer>{footer}</footer>;\r\n\t\t\treturn <>\r\n\t\t\t\t<section className=\"tv-page-footer\">{elFooter}</section>\r\n\t\t\t\t{elFooter}\r\n\t\t\t</>;\r\n\t\t}\r\n\t}\r\n\r\n    render() {\r\n\t\tif (this.tabsView) {\r\n\t\t\treturn React.createElement(this.tabsView.content);\r\n\t\t}\r\n\t\tconst {onScroll, onScrollTop, onScrollBottom, children, className} = this.props;\r\n\t\treturn <ScrollView\r\n\t\t\tonScroll={onScroll}\r\n\t\t\tonScrollTop={onScrollTop}\r\n\t\t\tonScrollBottom={onScrollBottom}\r\n\t\t\tclassName={className}\r\n\t\t>\r\n\t\t\t{this.renderHeader()}\r\n\t\t\t<main>{children}</main>\r\n\t\t\t{this.renderFooter()}\r\n\t\t</ScrollView>;\r\n\t}\r\n}\r\n","import _ from 'lodash';\r\nimport {nav} from '../components';\r\nimport {uid} from '../tool/uid';\r\nimport {uqTokenApi, callCenterapi, centerToken, setCenterToken} from './uqApi';\r\nimport {setSubAppWindow} from './wsChannel';\r\nimport { host } from './host';\r\n\r\nexport interface UqToken {\r\n    name: string;\r\n    db: string;\r\n    url: string;\r\n    token: string;\r\n}\r\nconst uqTokens:{[uqName:string]: UqToken}  = {};\r\nexport function logoutUqTokens() {\r\n    for (let i in uqTokens) {\r\n        uqTokens[i] = undefined;\r\n    }\r\n}\r\n\r\nexport interface AppInFrame {\r\n    hash: string;\r\n    unit: number;       // unit id\r\n    page?: string;\r\n    param?: string[];\r\n    predefinedUnit?: number;  // 比如像Cart这样的应用，直接让用户访问的，就需要在unit.json里面定义unitName\r\n}\r\nconst appsInFrame:{[key:string]:AppInFrame} = {};\r\n\r\nclass AppInFrameClass implements AppInFrame {\r\n    hash: string;\r\n    private _unit: number;\r\n    get unit(): number {return this._unit;}       // unit id\r\n    set unit(val:number) { this._unit=val;}\r\n    page?: string;\r\n    param?: string[];\r\n}\r\n\r\nexport let appInFrame:AppInFrame = new AppInFrameClass();\r\n/* {\r\n    hash: undefined,\r\n    get unit():number {return } undefined, //debugUnitId,\r\n    page: undefined;\r\n    param: undefined,\r\n}*/\r\n\r\nexport function isBridged():boolean {\r\n    return window.self !== window.parent;\r\n}\r\n\r\nwindow.addEventListener('message', async function(evt) {\r\n    var message = evt.data;\r\n    switch (message.type) {\r\n        case 'sub-frame-started':\r\n            subFrameStarted(evt);\r\n            break;\r\n        case 'ws':\r\n            //wsBridge.receive(message.msg);\r\n            await nav.onReceive(message.msg);\r\n            break;\r\n        case 'init-sub-win':\r\n            await initSubWin(message);\r\n            break;\r\n        case 'pop-app':\r\n            this.console.log('///\\\\\\\\\\\\ pop-app');\r\n            nav.navBack();\r\n            break;\r\n        case 'center-api':\r\n            await callCenterApiFromMessage(evt.source as Window, message);\r\n            break;\r\n        case 'center-api-return':\r\n            bridgeCenterApiReturn(message);\r\n            break;\r\n        case 'app-api':\r\n            let ret = await onReceiveAppApiMessage(message.hash, message.apiName);\r\n            (evt.source as Window).postMessage({\r\n                type: 'app-api-return', \r\n                apiName: message.apiName,\r\n                db: ret.db,\r\n                url: ret.url,\r\n                token: ret.token} as any, \"*\");\r\n            break;\r\n        case 'app-api-return':\r\n            console.log(\"app-api-return: %s\", JSON.stringify(message));\r\n            console.log('await onAppApiReturn(message);');\r\n            await onAppApiReturn(message);\r\n            break;\r\n        default:\r\n\t\t\tif ((message.source as string)?.startsWith('react-devtools') === true) break;\r\n            this.console.log('message: %s', JSON.stringify(message));\r\n            break;\r\n    }\r\n});\r\n\r\nfunction subFrameStarted(evt:any) {\r\n    var message = evt.data;\r\n    let subWin = evt.source as Window;\r\n    setSubAppWindow(subWin);\r\n    hideFrameBack(message.hash);\r\n    let msg:any = _.clone(nav.user);\r\n    msg.type = 'init-sub-win';\r\n    subWin.postMessage(msg, '*');\r\n}\r\nfunction hideFrameBack(hash:string) {\r\n    let el = document.getElementById(hash);\r\n    if (el !== undefined) el.hidden = true;\r\n}\r\nasync function initSubWin(message:any) {\r\n    console.log('initSubWin: set nav.user', message);\r\n    let user = nav.user = message; // message.user;\r\n    setCenterToken(user.id, user.token);\r\n    await nav.showAppView();\r\n}\r\nasync function onReceiveAppApiMessage(hash: string, apiName: string): Promise<UqToken> {\r\n    let appInFrame = appsInFrame[hash];\r\n    if (appInFrame === undefined) return {name:apiName, db:undefined, url:undefined, token:undefined};\r\n    //let unit = getUnit();\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    unit = unit || predefinedUnit;\r\n    if (!unit) {\r\n        console.error('no unit defined in unit.json or not logined in', unit);\r\n    }\r\n    let parts = apiName.split('/');\r\n    let param = {unit: unit, uqOwner: parts[0], uqName: parts[1], appOwner: parts[2], appName:parts[3]};\r\n    console.log('uqTokenApi.uq onReceiveAppApiMessage', param);\r\n    let ret = await uqTokenApi.uq(param);\r\n    let {db, url, token} = ret;\r\n    return {name: apiName, db:db, url: url, token: token};\r\n}\r\n\r\nasync function onAppApiReturn(message:any) {\r\n    let {apiName, db, url, urlTest, token} = message;\r\n    let action = uqTokenActions[apiName];\r\n    if (action === undefined) {\r\n        throw new Error('error app api return');\r\n        //return;\r\n    }\r\n    let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n    console.log('onAppApiReturn(message:any): url=' + url + ', real=' + realUrl);\r\n    //action.url = realUrl;\r\n    //action.token = token;\r\n    action.resolve({\r\n        name: apiName,\r\n        db: db,\r\n        url: realUrl,\r\n        token: token,\r\n    } as UqToken);\r\n}\r\n\r\nexport function setAppInFrame(appHash: string):AppInFrame {\r\n    if (appHash) {\r\n        let parts = appHash.split('-');\r\n        let len = parts.length;\r\n        if (len > 0) {\r\n            let p = 1;\r\n            appInFrame.hash = parts[p++];\r\n            if (len>0) appInFrame.unit = Number(parts[p++]);\r\n            if (len>1) appInFrame.page = parts[p++];\r\n            if (len>2) appInFrame.param = parts.slice(p++);\r\n        }\r\n    }\r\n    return appInFrame;\r\n}\r\n\r\nexport function getExHashPos():number {\r\n    let hash = document.location.hash;\r\n    if (hash !== undefined && hash.length > 0) {\r\n        let pos = hash.lastIndexOf('#tv-');\r\n        if (pos < 0) pos = hash.lastIndexOf('#tvdebug-');\r\n        return pos;\r\n    }\r\n    return -1;\r\n}\r\n\r\nexport function getExHash():string {\r\n    let pos = getExHashPos();\r\n    if (pos < 0) return undefined;\r\n    return document.location.hash.substring(pos);\r\n}\r\n\r\nexport function appUrl(url: string, unitId: number, page?:string, param?:any[]):{url:string; hash:string} {\r\n    let u:string;\r\n    for (;;) {\r\n        u = uid();\r\n        let a = appsInFrame[u];\r\n        if (a === undefined) {\r\n            appsInFrame[u] = {hash:u, unit:unitId};\r\n            break;\r\n        }\r\n    }\r\n    url += '#tv-' + u + '-' + unitId;\r\n    if (page !== undefined) {\r\n        url += '-' + page;\r\n        if (param !== undefined) {\r\n            for (let i=0; i<param.length; i++) {\r\n                url += '-' + param[i];\r\n            }\r\n        }\r\n    }\r\n    return {url: url, hash: u};\r\n}\r\n\r\nfunction getUnit():number {\r\n    let {unit, predefinedUnit} = appInFrame;\r\n    let realUnit = unit || predefinedUnit;\r\n    if (realUnit === undefined) {\r\n        throw new Error('no unit defined in unit.json or not logined in');\r\n    }\r\n    return realUnit;\r\n}\r\n\r\ninterface UqTokenAction {\r\n    resolve: (value?: UqToken | PromiseLike<UqToken>) => void;\r\n    reject: (reason?: any) => void;\r\n}\r\nconst uqTokenActions:{[uq:string]: UqTokenAction} = {};\r\nexport async function buildAppUq(uq:string, uqOwner:string, uqName:string, appOwner:string, appName:string):Promise<void> {\r\n    if (!isBridged()) {\r\n        let unit = getUnit();\r\n        let uqToken = await uqTokenApi.uq({unit:unit,  uqOwner:uqOwner, uqName:uqName, appOwner:appOwner, appName:appName});\r\n        if (uqToken.token === undefined) uqToken.token = centerToken;\r\n        let {db, url, urlTest} = uqToken;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        console.log('realUrl: %s', realUrl);\r\n        uqToken.url = realUrl;\r\n        uqTokens[uq] = uqToken;\r\n        return uqToken;\r\n    }\r\n    console.log(\"**** before buildAppUq ****\", appInFrame);\r\n    let bp = uqTokenActions[uq];\r\n    if (bp !== undefined) return;\r\n    return new Promise<void>((resolve, reject) => {\r\n        uqTokenActions[uq] = {\r\n            resolve: async (at:any) => {\r\n                let {db, url, token} = await at;\r\n                uqTokens[uq] = {\r\n                    name: uq,\r\n                    db: db,\r\n                    url: url,\r\n                    token: token,\r\n                };\r\n                uqTokenActions[uq] = undefined;\r\n                console.log(\"**** after buildAppUq ****\", appInFrame);\r\n                resolve();\r\n            },\r\n            reject: reject,\r\n        };\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'app-api',\r\n            apiName: uq,\r\n            hash: appInFrame.hash,\r\n        }, \"*\");\r\n    });\r\n}\r\n\r\nexport function appUq(uq:string):UqToken {\r\n    let uts = uqTokens;\r\n    return uts[uq];\r\n}\r\n\r\ninterface BridgeCenterApi {\r\n    id: string;\r\n    resolve: (value?:any)=>any;\r\n    reject: (reason?:any)=>void;\r\n}\r\nconst brideCenterApis:{[id:string]: BridgeCenterApi} = {};\r\nexport async function bridgeCenterApi(url:string, method:string, body:any):Promise<any> {\r\n    console.log('bridgeCenterApi: url=%s, method=%s', url, method);\r\n    return await new Promise<any>(async (resolve, reject) => {\r\n        let callId:string;\r\n        for (;;) {\r\n            callId = uid();\r\n            let bca = brideCenterApis[callId];\r\n            if (bca === undefined) {\r\n                brideCenterApis[callId] = {\r\n                    id: callId,\r\n                    resolve: resolve,\r\n                    reject: reject,\r\n                }\r\n                break;\r\n            }\r\n        }\r\n        (window.opener || window.parent).postMessage({\r\n            type: 'center-api',\r\n            callId: callId,\r\n            url: url,\r\n            method: method,\r\n            body: body\r\n        }, '*');\r\n    });\r\n}\r\n\r\nasync function callCenterApiFromMessage(from:Window, message:any):Promise<void> {\r\n    let {callId, url, method, body} = message;\r\n    let result = await callCenterapi.directCall(url, method, body);\r\n    from.postMessage({\r\n        type: 'center-api-return',\r\n        callId: callId,\r\n        result: result,\r\n    }, '*');\r\n}\r\n\r\nfunction bridgeCenterApiReturn(message:any) {\r\n    let {callId, result} = message;\r\n    let bca = brideCenterApis[callId];\r\n    if (bca === undefined) return;\r\n    brideCenterApis[callId] = undefined;\r\n    bca.resolve(result);\r\n}\r\n","//import _ from 'lodash';\r\nimport { Caller } from '../net';\r\nimport { Entity } from './entity';\r\nimport { Action } from './action';\r\nimport { Query } from './query';\r\n\r\ninterface UqResponseSchema {\r\n    uq: any;\r\n    entity: any;\r\n}\r\n\r\nexport abstract class EntityCaller<T> extends Caller<T> {\r\n    private tries: number;\r\n    protected _entity: Entity;\r\n\r\n    constructor(entity: Entity, params:T, waiting: boolean = true) {\r\n        super(params, waiting);\r\n        this.tries = 0;\r\n        this._entity = entity;\r\n    }\r\n\r\n    protected get entity(): Entity {return this._entity;}\r\n\r\n    //大多的entityCaller都不需要这个\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n    \r\n    async request(): Promise<any> {\r\n        await this.entity.loadSchema();\r\n        let ret = await this.innerRequest();\r\n        return ret;\r\n    }\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        return await this.entity.uqApi.xcall(this);\r\n    }\r\n\r\n    async innerRequest(): Promise<any> {\r\n        let jsonResult = await this.innerCall();\r\n        let {$uq, $modify, res} = jsonResult;\r\n        this.entity.uq.pullModify($modify);\r\n        if ($uq === undefined) {\r\n            //if (res === undefined) debugger;\r\n            let ret = this.xresult(res);\r\n            //if (ret === undefined) debugger;\r\n            return ret;\r\n        }\r\n        return await this.retry($uq);\r\n    }\r\n\r\n    xresult(res:any):any {return res}\r\n\r\n    get headers(): {[header:string]: string} {\r\n        let {ver, uq} = this.entity;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }\r\n\r\n    private async retry(schema: UqResponseSchema) {\r\n        ++this.tries;\r\n        if (this.tries > 5) throw new Error('can not get right uq response schema, 5 tries');\r\n        this.rebuildSchema(schema);\r\n        return await this.innerRequest();\r\n    }\r\n\r\n    private rebuildSchema(schema: UqResponseSchema) {\r\n        let {uq, entity} = schema;\r\n        if (uq !== undefined) this.entity.uq.buildEntities(uq);\r\n        if (entity !== undefined) {\r\n\t\t\tthis.entity.setSchema(entity);\r\n\t\t}\r\n    }\r\n}\r\n\r\nexport abstract class ActionCaller extends EntityCaller<any> {\r\n    protected get entity(): Action {return this._entity as Action;}\r\n}\r\n\r\nexport class QueryQueryCaller extends EntityCaller<any> {\r\n    protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `query/${this.entity.name}`;}\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nexport class QueryPageCaller extends EntityCaller<any> {\r\n    protected get params(): {pageStart:any; pageSize:number, params:any} {return this._params};\r\n\tprotected get entity(): Query {return this._entity as Query};\r\n\t//results: {[name:string]:any[]};\r\n\tget path():string {return `query-page/${this.entity.name}`;}\t\r\n    buildParams() {\r\n        let {pageStart, pageSize, params} = this.params;\r\n        let p:any;\r\n        if (params === undefined) {\r\n            p = {key: ''};\r\n        }\r\n        else {\r\n            p = this.entity.buildParams(params);\r\n        }\r\n        /*\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        */\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return p;\r\n    };\r\n    xresult(res:any): {[name:string]:any[]} {\r\n        let ret = this.entity.unpackReturns(res);\r\n\t\t//return this.results.$page;// as any[];\r\n\t\treturn ret;\r\n    }\r\n}\r\n","import { UqApi } from '../net';\r\nimport { LocalCache } from '../tool';\r\nimport { UqMan, Field, ArrFields, FieldMap } from './uqMan';\r\nimport { Tuid } from './tuid';\r\n//import { EntityCache } from './caches';\r\n\r\nconst tab = '\\t';\r\nconst ln = '\\n';\r\n\r\nexport abstract class Entity {\r\n    private jName: string;\r\n    schema: any;\r\n    ver: number = 0;\r\n    sys?: boolean;\r\n    readonly uq: UqMan;\r\n    readonly name: string;\r\n    readonly typeId: number;\r\n    readonly cache: LocalCache;\r\n    readonly uqApi: UqApi;\r\n    abstract get typeName(): string;\r\n    get sName():string {return this.jName || this.name}\r\n    fields: Field[];\r\n    arrFields: ArrFields[];\r\n    returns: ArrFields[];\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        this.uq = uq;\r\n        this.name = name;\r\n        this.typeId = typeId;\r\n        this.sys = this.name.indexOf('$') >= 0;\r\n        this.cache = this.uq.localMap.item(this.name); // new EntityCache(this);\r\n        this.uqApi = this.uq.uqApi;\r\n    }\r\n\r\n    public face: any;           // 对应字段的label, placeHolder等等的中文，或者语言的翻译\r\n\r\n    //getApiFrom() {return this.entities.uqApi;}\r\n\r\n    private fieldMaps: {[arr:string]: FieldMap} = {};\r\n    fieldMap(arr?:string): FieldMap {\r\n        if (arr === undefined) arr = '$';\r\n        let ret = this.fieldMaps[arr];\r\n        if (ret === undefined) {\r\n            let fields:Field[];\r\n            if (arr === '$') fields = this.fields;\r\n            else if (this.arrFields !== undefined) {\r\n                let arrFields = this.arrFields.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            else if (this.returns !== undefined) {\r\n                let arrFields = this.returns.find(v => v.name === arr);\r\n                if (arrFields !== undefined) fields = arrFields.fields;\r\n            }\r\n            if (fields === undefined) return {};\r\n            ret = {};\r\n            for (let f of fields) ret[f.name] = f;\r\n            this.fieldMaps[arr] = ret;\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    public async loadSchema():Promise<void> {\r\n        if (this.schema !== undefined) return;\r\n        let schema = this.cache.get();\r\n        if (!schema) {\r\n            schema = await this.uq.loadEntitySchema(this.name);\r\n        }\r\n        this.setSchema(schema);\r\n\t\tthis.buildFieldsTuid();\r\n\t\tawait this.loadValues();\r\n\t}\r\n\t\r\n\tprotected async loadValues():Promise<any> {}\r\n\r\n    // 如果要在setSchema里面保存cache，必须先调用clearSchema\r\n    public clearSchema() {\r\n        this.schema = undefined;\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        if (schema === undefined) return;\r\n        let {name, version} = schema;\r\n        this.ver = version || 0;\r\n\t\tthis.setJName(name);\r\n        this.cache.set(schema);\r\n\t\tthis.schema = schema;\r\n\t\tthis.buildFieldsTuid();\r\n\t}\r\n\t\r\n\tprotected setJName(name:string) {\r\n        if (name !== this.name) this.jName = name;\r\n\t}\r\n\r\n    public buildFieldsTuid() {\r\n        let {fields, arrs, returns} = this.schema;\r\n        this.uq.buildFieldTuid(this.fields = fields);\r\n        this.uq.buildArrFieldsTuid(this.arrFields = arrs, fields);\r\n        this.uq.buildArrFieldsTuid(this.returns = returns, fields);\r\n    }\r\n\r\n    schemaStringify():string {\r\n        return JSON.stringify(this.schema, (key:string, value:any) => {\r\n            if (key === '_tuid') return undefined;\r\n            return value;\r\n        }, 4);\r\n    }\r\n\r\n    tuidFromName(fieldName:string, arrName?:string):Tuid {\r\n        if (this.schema === undefined) return;\r\n        let {fields, arrs} = this.schema;\r\n        let entities = this.uq;\r\n        function getTuid(fn:string, fieldArr:Field[]) {\r\n            if (fieldArr === undefined) return;\r\n            let f = fieldArr.find(v => v.name === fn);\r\n            if (f === undefined) return;\r\n            return entities.getTuid(f.tuid);\r\n        }\r\n        let fn = fieldName.toLowerCase();\r\n        if (arrName === undefined) return getTuid(fn, fields);\r\n        if (arrs === undefined) return;\r\n        let an = arrName.toLowerCase();\r\n        let arr = (arrs as ArrFields[]).find(v => v.name === an);\r\n        if (arr === undefined) return;\r\n        return getTuid(fn, arr.fields);\r\n    }\r\n\r\n    buildParams(params:any):any {\r\n        let result:any = {};\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.buildFieldsParams(result, fields, params);\r\n        let arrs = this.arrFields;\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let {name, fields} = arr;\r\n                let paramsArr:any[] = params[name];\r\n                if (paramsArr === undefined) continue;\r\n                let arrResult:any[] = [];\r\n                result[name] = arrResult;\r\n                for (let pa of params) {\r\n                    let rowResult = {};\r\n                    this.buildFieldsParams(rowResult, fields, pa);\r\n                    arrResult.push(rowResult);\r\n                }\r\n            }\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private buildFieldsParams(result:any, fields:Field[], params:any) {\r\n        for (let field of fields) {\r\n            let {name, type} = field;            \r\n            let d = params[name];\r\n            let val:any;\r\n            if (type === 'datetime') {\r\n                val = this.buildDateTimeParam(d);\r\n            }\r\n            else {\r\n                switch (typeof d) {\r\n                    default: val = d; break;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) val = d.id;\r\n                        else val = tuid.getIdFromObj(d);\r\n                        break;\r\n                }\r\n            }\r\n            result[name] = val;\r\n        }\r\n    }\r\n\r\n    buildDateTimeParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'object': dt = (val as Date); break;\r\n            case 'string':\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        return Math.floor(dt.getTime()/1000);\r\n    }\r\n\r\n    buildDateParam(val:any) {\r\n        let dt: Date;\r\n        switch (typeof val) {\r\n            default: debugger; throw new Error('escape datetime field in pack data error: value=' + val);\r\n            case 'undefined': return '';\r\n            case 'string': return val;\r\n            case 'object': dt = (val as Date); break;\r\n            case 'number': dt = new Date(val); break;\r\n        }\r\n        let ret = dt.toISOString();\r\n        let p = ret.indexOf('T');\r\n        return p>0? ret.substr(0, p) : ret;\r\n    }\r\n\r\n    pack(data:any):string {\r\n        let ret:string[] = [];\r\n        let fields = this.fields;\r\n        if (fields !== undefined) this.packRow(ret, fields, data);\r\n        let arrs = this.arrFields; \r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                this.packArr(ret, arr.fields, data[arr.name]);\r\n            }\r\n        }\r\n        return ret.join('');\r\n    }\r\n\r\n    private escape(row:any, field:Field):any {\r\n        let d = row[field.name];\r\n        switch (field.type) {\r\n            case 'datetime':\r\n                return this.buildDateTimeParam(d);\r\n            default:\r\n                switch (typeof d) {\r\n                    default: return d;\r\n                    case 'object':\r\n                        let tuid = field._tuid;\r\n                        if (tuid === undefined) return d.id;\r\n                        return tuid.getIdFromObj(d);\r\n                    case 'string':\r\n                        let len = d.length;\r\n                        let r = '', p = 0;\r\n                        for (let i=0;i<len;i++) {\r\n                            let c:number = d.charCodeAt(i);\r\n                            switch(c) {\r\n                                case 9: r += d.substring(p, i) + '\\\\t'; p = i+1; break;\r\n\t\t\t\t\t\t\t\tcase 10: r += d.substring(p, i) + '\\\\n'; p = i+1; break;\r\n\t\t\t\t\t\t\t\tcase 92: r += d.substring(p, i) + '\\\\\\\\'; p = i+1; break;\r\n                            }\r\n                        }\r\n                        return r + d.substring(p);\r\n                    case 'undefined': return '';\r\n                }\r\n        }\r\n    }\r\n\r\n    private packRow(result:string[], fields:Field[], data:any) {\r\n        let len = fields.length;\r\n        if (len === 0) return;\r\n        let ret = '';\r\n        ret += this.escape(data, fields[0]);\r\n        for (let i=1;i<len;i++) {\r\n            let f = fields[i];\r\n            ret += tab + this.escape(data, f);\r\n        }\r\n        result.push(ret + ln);\r\n    }\r\n\r\n    private packArr(result:string[], fields:Field[], data:any[]) {\r\n        if (data !== undefined) {\r\n            for (let row of data) {\r\n                this.packRow(result, fields, row);\r\n            }\r\n        }\r\n        result.push(ln);\r\n    }\r\n    protected cacheFieldsInValue(values:any, fields:Field[]) {\r\n        for (let f of fields as Field[]) {\r\n            let {name, _tuid} = f;\r\n            if (_tuid === undefined) continue;\r\n            let id = values[name];\r\n            //_tuid.useId(id);\r\n            values[name] = _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    protected unpackTuidIdsOfFields(values:string[], fields: Field[]):any[] {\r\n        if (fields === undefined) return values as any[];\r\n        //if (this.fields === undefined) return values as any[];\r\n        let ret:any[] = []\r\n        for (let ln of values) {\r\n            if (!ln) continue;\r\n            let len = ln.length;\r\n            let p = 0;\r\n            while (p<len) {\r\n                let ch = ln.charCodeAt(p);\r\n                if (ch === 10) {\r\n                    ++p;\r\n                    break;\r\n                }\r\n                let row = {};\r\n                p = this.unpackRow(row, fields, ln, p);\r\n                ret.push(row);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackSheet(data:string):any {\r\n        let ret = {} as any; //new this.newMain();\r\n        //if (schema === undefined || data === undefined) return;\r\n        let fields = this.fields;\r\n        let p = 0;\r\n        if (fields !== undefined) p = this.unpackRow(ret, fields, data, p);\r\n        let arrs = this.arrFields; //schema['arrs'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    unpackReturns(data:string):{[name:string]:any[]} {\r\n        if (data === undefined) debugger;\r\n        let ret = {} as any;\r\n        //if (schema === undefined || data === undefined) return;\r\n        //let fields = schema.fields;\r\n        let p = 0;\r\n        //if (fields !== undefined) p = unpackRow(ret, schema.fields, data, p);\r\n        let arrs = this.returns; //schema['returns'];\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                //let creater = this.newRet[arr.name];\r\n                p = this.unpackArr(ret, arr, data, p);\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    protected unpackRow(ret:any, fields:Field[], data:string, p:number):number {\r\n        let ch0 = 0, ch = 0, c = p, i = 0, len = data.length, fLen = fields.length;\r\n        for (;p<len;p++) {\r\n            ch0 = ch;\r\n            ch = data.charCodeAt(p);\r\n            if (ch === 9) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                c = p+1;\r\n                ++i;\r\n                if (i>=fLen) {\r\n                    p = data.indexOf('\\n', c);\r\n                    if (p >= 0) ++p;\r\n                    else p = len;\r\n                    return p;\r\n                }\r\n            }\r\n            else if (ch === 10) {\r\n                let f = fields[i];\r\n                let {name} = f;\r\n                if (ch0 !== 8) {\r\n                    if (p>c) {\r\n                        let v = data.substring(c, p);\r\n                        ret[name] = this.to(ret, v, f);\r\n                    }\r\n                }\r\n                else {\r\n                    ret[name] = null;\r\n                }\r\n                ++p;\r\n                ++i;\r\n                return p;\r\n            }\r\n        }\r\n        let f = fields[i];\r\n        let {name} = f;\r\n        if (ch0 !== 8) {\r\n            let v = data.substring(c);\r\n            ret[name] = this.to(ret, v, f);\r\n        }\r\n        return len;\r\n    }\r\n\r\n    private to(ret:any, v:string, f:Field):any {\r\n        switch (f.type) {\r\n            default: return v;\r\n            case 'datetime':\r\n            case 'time':\r\n\t\t\tcase 'timestamp':\r\n                let n = Number(v);\r\n                let date = isNaN(n) === true? new Date(v) : new Date(n*1000);\r\n                return date;\r\n            case 'date':\r\n                let parts = v.split('-');\r\n                return new Date(Number(parts[0]), Number(parts[1])-1, Number(parts[2]));\r\n            case 'tinyint':\r\n            case 'smallint':\r\n            case 'int':\r\n            case 'bigint':\r\n            case 'dec':\r\n                return Number(v);\r\n            case 'id':\r\n                let id = Number(v);\r\n                let {_tuid} = f;\r\n                if (_tuid === undefined) return id;\r\n                return _tuid.boxId(id);\r\n        }\r\n    }\r\n\r\n    private unpackArr(ret:any, arr:ArrFields, data:string, p:number):number {\r\n        let vals:any[] = [], len = data.length;\r\n        let {name, fields} = arr;\r\n        while (p<len) {\r\n            let ch = data.charCodeAt(p);\r\n            if (ch === 10) {\r\n                ++p;\r\n                break;\r\n            }\r\n            let val = {} as any; //new creater();\r\n            vals.push(val);\r\n            p = this.unpackRow(val, fields, data, p);\r\n        }\r\n        ret[name] = vals;\r\n        return p;\r\n    }\r\n}\r\n","import {bridgeCenterApi, isBridged} from './appBridge';\r\nimport {FetchError} from './fetchError';\r\nimport {HttpChannelUI} from './httpChannelUI';\r\nimport {nav} from '../components/nav';\r\nimport { Caller } from './caller';\r\nimport { env } from '../tool';\r\n\r\n/*\r\nexport async function httpGet(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.get('', params);\r\n    return ret;\r\n}\r\n\r\nexport async function httpPost(url:string, params?:any):Promise<any> {\r\n    let channel = new HttpChannel(false, url, undefined, undefined);\r\n    let ret = await channel.post('', params);\r\n    return ret;\r\n}\r\n*/\r\n\r\nconst methodsWithBody = ['POST', 'PUT'];\r\n\r\nexport abstract class HttpChannel {\r\n    private timeout: number;\r\n    protected ui?: HttpChannelUI;\r\n    protected hostUrl: string;\r\n    protected apiToken: string;\r\n\r\n    constructor(hostUrl: string, apiToken:string, ui?: HttpChannelUI) {\r\n        this.hostUrl = hostUrl;\r\n        this.apiToken = apiToken;\r\n        this.ui = ui;\r\n        this.timeout = env.isDevelopment === true? 500000:50000;\r\n    }\r\n\r\n    private startWait = (waiting: boolean) => {\r\n        if (waiting === true) {\r\n            if (this.ui !== undefined) this.ui.startWait();\r\n        }\r\n    }\r\n\r\n    private endWait = (url?:string, reject?:(reason?:any)=>void) => {\r\n        if (this.ui !== undefined) this.ui.endWait();\r\n        if (reject !== undefined) reject('访问webapi超时 ' + url);\r\n    }\r\n\r\n    private showError = async (error:FetchError) => {\r\n        if (this.ui !== undefined) await this.ui.showError(error);\r\n    }\r\n\r\n    used() {\r\n        this.post('', {});\r\n    }\r\n\r\n    async xcall(urlPrefix:string, caller:Caller<any>): Promise<void> {\r\n        let options = this.buildOptions();\r\n        let {headers, path, method} = caller;\r\n        if (headers !== undefined) {\r\n            let h = options.headers;\r\n            for (let i in headers) {\r\n                h.append(i, encodeURI(headers[i]));\r\n            }\r\n        }\r\n        options.method = method;\r\n        let p = caller.buildParams();\r\n        if (methodsWithBody.indexOf(method) >= 0 && p !== undefined) {\r\n            options.body = JSON.stringify(p)\r\n        }\r\n        return await this.innerFetch(urlPrefix + path, options, caller.waiting);\r\n    }\r\n\r\n    private async innerFetchResult(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let ret = await this.innerFetch(url, options, waiting);\r\n        return ret.res;\r\n    }\r\n\r\n    async get(url: string, params: any = undefined, waiting?: boolean): Promise<any> {\r\n        if (params) {\r\n            let keys = Object.keys(params);\r\n            if (keys.length > 0) {\r\n                let c = '?';\r\n                for (let k of keys) {\r\n                    let v = params[k];\r\n                    if (v === undefined) continue;\r\n                    url += c + k + '=' + params[k];\r\n                    c = '&';\r\n                }\r\n            }\r\n        }\r\n        let options = this.buildOptions();\r\n        options.method = 'GET';\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async post(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'POST';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async put(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'PUT';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n\r\n    async delete(url: string, params: any, waiting?: boolean): Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = 'DELETE';\r\n        options.body = JSON.stringify(params);\r\n        return await this.innerFetchResult(url, options, waiting);\r\n    }\r\n    async fetch(url: string, options: any, waiting: boolean, resolve:(value?:any)=>any, reject:(reason?:any)=>void):Promise<void> {\r\n        let that = this;\r\n        this.startWait(waiting);\r\n        let path = url;\r\n        function buildError(err: any, ex?: string) {\r\n            switch (typeof err) {\r\n                case 'string':\r\n                    if (ex !== undefined) err += ' ' + ex;\r\n                    break;\r\n                case 'object':\r\n                    let keys = Object.keys(err);\r\n                    let retErr:any = {\r\n                        ex: ex,\r\n                    };\r\n                    for (let key of keys) {\r\n                        retErr[key] = err[key];\r\n                    }\r\n                    err = retErr;\r\n                    break;\r\n            }\r\n            return {\r\n                channel: that,\r\n                url: path,\r\n                options: options,\r\n                resolve: resolve,\r\n                reject: reject,\r\n                error: err,\r\n            }\r\n        }\r\n        try {\r\n            console.log('%s-%s %s', options.method, path, options.body || '');\r\n            let now = Date.now();\r\n            let timeOutHandler = env.setTimeout(\r\n                undefined, //'httpChannel.fetch',\r\n                () => {\r\n                    that.endWait(url + ' timeout endWait: ' + (Date.now() - now) + 'ms', reject);\r\n                },\r\n                this.timeout);\r\n            let res = await fetch(encodeURI(path), options);\r\n            if (res.ok === false) {\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('ok false endWait');       \r\n                that.endWait();\r\n                console.log('call error %s', res.statusText);\r\n                throw res.statusText;\r\n            }\r\n            let ct = res.headers.get('content-type');\r\n            if (ct && ct.indexOf('json')>=0) {\r\n                return res.json().then(async retJson => {\r\n                    env.clearTimeout(timeOutHandler);\r\n                    that.endWait();\r\n                    if (retJson.ok === true) {\r\n                        if (typeof retJson !== 'object') {\r\n                            debugger;\r\n                        }\r\n                        else if (Array.isArray(retJson) === true) {\r\n                            debugger;\r\n                        }\r\n                        return resolve(retJson);\r\n                    }\r\n                    let retError = retJson.error;\r\n                    if (retError === undefined) {\r\n                        await that.showError(buildError('not valid tonva json'));\r\n                    }\r\n                    else {\r\n                        await that.showError(buildError(retError, 'retJson.error'));\r\n                        reject(retError);\r\n                    }\r\n                }).catch(async error => {\r\n                    await that.showError(buildError(error, 'catch res.json()'));\r\n                });\r\n            }\r\n            else {\r\n                let text = await res.text();\r\n                env.clearTimeout(timeOutHandler);\r\n                console.log('text endWait');\r\n                that.endWait();\r\n                resolve(text);\r\n            }\r\n        }\r\n        catch(error) {\r\n            this.endWait(url, reject);\r\n            if (typeof error === 'string') {\r\n                let err = error.toLowerCase();\r\n                if (err.startsWith('unauthorized') === true) {\r\n                    nav.logout();\r\n                    return;\r\n                }\r\n            }\r\n            console.error('fecth error (no nav.showError): ' + url);\r\n            // await this.showError(buildError(error, 'catch outmost'));\r\n        };\r\n    }\r\n\r\n    protected abstract async innerFetch(url: string, options: any, waiting: boolean): Promise<any>;\r\n\r\n    async callFetch(url:string, method:string, body:any):Promise<any> {\r\n        let options = this.buildOptions();\r\n        options.method = method;\r\n        options.body = body;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(url, options, true, resolve, reject);\r\n        });\r\n    }\r\n\r\n    private buildOptions(): {method:string; headers:Headers; body:any} {\r\n        let headers = this.buildHeaders();\r\n        let options = {\r\n            headers: headers,\r\n            method: undefined as any,\r\n            body: undefined as any,\r\n            // cache: 'no-cache',\r\n        };\r\n        return options;\r\n    }\r\n\r\n    protected buildHeaders():Headers {\r\n        let {language, culture} = nav;\r\n        let headers = new Headers();\r\n        //headers.append('Access-Control-Allow-Origin', '*');\r\n        headers.append('Content-Type', 'application/json;charset=UTF-8');\r\n        let lang = language;\r\n        if (culture) lang += '-' + culture;\r\n        headers.append('Accept-Language', lang);\r\n        if (this.apiToken) { \r\n            headers.append('Authorization', this.apiToken); \r\n        }\r\n        return headers;\r\n    }\r\n}\r\n\r\nexport class CenterHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        if (this.apiToken === undefined && isBridged())\r\n            return await bridgeCenterApi(u, options.method, options.body);\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n\r\nexport class UqHttpChannel extends HttpChannel {\r\n    protected async innerFetch(url: string, options: any, waiting: boolean): Promise<any> {\r\n        let u = this.hostUrl + url;\r\n        return await new Promise<any>(async (resolve, reject) => {\r\n            await this.fetch(u, options, waiting, resolve, reject);\r\n        });\r\n    }\r\n}\r\n","import {nav} from '../components/nav';\r\nimport {FetchError} from './fetchError';\r\n\r\nexport interface HttpChannelUI {\r\n    startWait():void;\r\n    endWait():void;\r\n    showError(error:FetchError):Promise<void>;\r\n    showUpgradeUq(uq:string, version:number):Promise<void>;\r\n}\r\n\r\nexport class HttpChannelNavUI implements HttpChannelUI {\r\n    startWait() {\r\n        nav.startWait();\r\n    }\r\n    endWait() {\r\n        nav.endWait();\r\n    }\r\n    async showError(error:FetchError):Promise<void> {\r\n        nav.endWait();\r\n        /*\r\n        if (error.name === 'SyntaxError') {\r\n            error = {\r\n                name: error.name,\r\n                message: error.message,\r\n            }\r\n        }*/\r\n        await nav.onError(error);\r\n    }\r\n    async showUpgradeUq(uq:string, version:number):Promise<void> {\r\n        await nav.showUpgradeUq(uq, version);\r\n    }\r\n}\r\n\r\n","import _ from 'lodash';\r\nimport {HttpChannel, CenterHttpChannel, UqHttpChannel} from './httpChannel';\r\nimport {HttpChannelNavUI} from './httpChannelUI';\r\nimport {appUq, logoutUqTokens, buildAppUq} from './appBridge';\r\nimport {ApiBase} from './apiBase';\r\nimport { host } from './host';\r\nimport { LocalMap, env } from '../tool';\r\nimport {decodeUserToken} from '../tool/user';\r\n\r\nlet channelUIs:{[name:string]: HttpChannel} = {};\r\nlet channelNoUIs:{[name:string]: HttpChannel} = {};\r\n\r\nexport function logoutApis() {\r\n    channelUIs = {};\r\n    channelNoUIs = {};\r\n    logoutUnitxApis();\r\n    logoutUqTokens();\r\n}\r\n\r\ninterface UqLocal {\r\n    user: number;\r\n    unit: number;\r\n    value: any;\r\n    tick?: number;\r\n    isNet?: boolean;\r\n}\r\ninterface UqLocals {\r\n    user: number;\r\n    unit: number;\r\n    uqs: {[uq:string]: UqLocal};\r\n}\r\n/*\r\nconst uqLocalEntities = 'uqLocalEntities';\r\nclass CacheUqLocals {\r\n    private local:UqLocals;\r\n\r\n    async loadAccess(uqApi: UqApi):Promise<any> {\r\n        try {\r\n            let {uqOwner, uqName} = uqApi;\r\n            if (this.local === undefined) {\r\n                let ls = null; // localStorage.getItem(uqLocalEntities);\r\n                if (ls !== null) {\r\n                    this.local = JSON.parse(ls);\r\n                }\r\n            }\r\n            if (this.local !== undefined) {\r\n                let {user, uqs} = this.local;\r\n                if (user !== loginedUserId || uqs === undefined) {\r\n                    this.local = undefined;\r\n                }\r\n                else {\r\n                    for (let i in uqs) {\r\n                        let ul = uqs[i];\r\n                        ul.isNet = undefined;\r\n                    }\r\n                }\r\n            }\r\n            if (this.local === undefined) {\r\n                this.local = {\r\n                    user: loginedUserId,\r\n                    unit: undefined,\r\n                    uqs: {}\r\n                };\r\n            }\r\n\r\n            let ret: any;\r\n            let un = uqOwner+'/'+uqName;\r\n            let uq = this.local.uqs[un];\r\n            if (uq !== undefined) {\r\n                let {value} = uq;\r\n                ret = value;\r\n            }\r\n            if (ret === undefined) {\r\n                ret = await uqApi.__loadAccess();\r\n                //this.saveLocal(un, ret);\r\n            }\r\n            return _.cloneDeep(ret);\r\n        }\r\n        catch (err) {\r\n            this.local = undefined;\r\n            localStorage.removeItem(uqLocalEntities);\r\n            throw err;\r\n        }\r\n    }\r\n\r\n    private saveLocal(uqName:string, accessValue: any) {\r\n        this.local.uqs[uqName] = {\r\n            value: accessValue,\r\n            isNet: true,\r\n        }\r\n        let str = JSON.stringify(this.local);\r\n        localStorage.setItem(uqLocalEntities, str);\r\n    }\r\n\r\n    async checkAccess(uqApi: UqApi):Promise<boolean> {\r\n        if (this.local === undefined) return false;\r\n        let {uqOwner, uqName} = uqApi;\r\n        let un = uqOwner+'/'+uqName;\r\n        let uq = this.local.uqs[un];\r\n        if (uq === undefined) return false;\r\n        let {isNet, value} = uq;\r\n        if (isNet === true) return true;\r\n        let ret = await uqApi.__loadAccess();\r\n        let isMatch = _.isMatch(value, ret);\r\n        if (isMatch === false) {\r\n            this.saveLocal(un, ret);\r\n            return false;\r\n        }\r\n        uq.isNet = true;\r\n        return true;\r\n    }\r\n}\r\n\r\nconst localUqs = new CacheUqLocals;\r\n*/\r\nexport class UqApi extends ApiBase {\r\n    private access:string[];\r\n    appOwner:string;\r\n    appName:string;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    uq: string;\r\n\r\n    constructor(basePath:string, appOwner:string, appName:string, uqOwner:string, uqName:string, access:string[], showWaiting?: boolean) {\r\n        super(basePath, showWaiting);\r\n        this.appOwner = appOwner;\r\n        this.appName = appName;\r\n        if (uqName) {\r\n            this.uqOwner = uqOwner;\r\n            this.uqName = uqName;\r\n            this.uq = uqOwner + '/' + uqName;\r\n        }\r\n        this.access = access;\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    //setUqVersion(uqVersion:number) {this.uqVersion = undefined}\r\n\r\n    async init() {\r\n        await buildAppUq(this.uq, this.uqOwner, this.uqName, this.appOwner, this.appName);\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channels: {[name:string]: HttpChannel};\r\n        let channelUI: HttpChannelNavUI;\r\n        if (this.showWaiting === true || this.showWaiting === undefined) {\r\n            channels = channelUIs;\r\n            channelUI = new HttpChannelNavUI();\r\n        }\r\n        else {\r\n            channels = channelNoUIs;\r\n        }\r\n        let channel = channels[this.uq];\r\n        if (channel !== undefined) return channel;\r\n        let uqToken = appUq(this.uq); //, this.uqOwner, this.uqName);\r\n        if (!uqToken) {\r\n            //debugger;\r\n            await this.init();\r\n            uqToken = appUq(this.uq);\r\n        }\r\n        let {url, token} = uqToken;\r\n        this.token = token;\r\n        channel = new UqHttpChannel(url, token, channelUI);\r\n        return channels[this.uq] = channel;\r\n    }\r\n\r\n    /*async update():Promise<string> {\r\n        return await this.get('update');\r\n    }*/\r\n\r\n    /*\r\n    async __loadAccess():Promise<any> {\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n    */\r\n    async loadAccess():Promise<any> {\r\n        //return await localUqs.loadAccess(this);\r\n        let acc = this.access === undefined?\r\n            '' :\r\n            this.access.join('|');\r\n        let ret = await this.get('access', {acc:acc});\r\n        return ret;\r\n    }\r\n\r\n    /*async loadEntities():Promise<any> {\r\n        return await this.get('entities');\r\n    }*/\r\n\r\n    /*\r\n    async checkAccess():Promise<boolean> {\r\n        return await localUqs.checkAccess(this);\r\n    }\r\n    */\r\n\r\n    async schema(name:string):Promise<any> {\r\n        return await this.get('schema/' + name);\r\n    }\r\n\r\n    async queueModify(start:number, page:number, entities:string) {\r\n        return await this.post('queue-modify', {start:start, page:page, entities:entities});\r\n    }\r\n\r\n    /*async schemas(names:string[]):Promise<any[]> {\r\n        return await this.post('schema', names);\r\n    }*/\r\n\r\n    /*\r\n    async tuidGet(name:string, id:number):Promise<any> {\r\n        return await this.get('tuid/' + name + '/' + id);\r\n    }\r\n\r\n    async tuidGetAll(name:string):Promise<any[]> {\r\n        return await this.get('tuid-all/' + name + '/');\r\n    }\r\n\r\n    async tuidSave(name:string, params:any):Promise<any> {\r\n        return await this.post('tuid/' + name, params);\r\n    }\r\n\r\n    async tuidSearch(name:string, arr:string, owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        let ret = await this.post('tuids/' + name, {\r\n            arr: arr,\r\n            owner: owner,\r\n            key: key,\r\n            pageStart: pageStart,\r\n            pageSize: pageSize\r\n        });\r\n        return ret;\r\n    }\r\n    async tuidArrGet(name:string, arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.get('tuid-arr/' + name + '/' + owner + '/' + arr + '/' + id);\r\n    }\r\n    async tuidArrGetAll(name:string, arr:string, owner:number):Promise<any[]> {\r\n        return await this.get('tuid-arr-all/' + name + '/' + owner + '/' + arr + '/');\r\n    }\r\n    async tuidArrSave(name:string, arr:string, owner:number, params:any):Promise<any> {\r\n        return await this.post('tuid-arr/' + name + '/' + owner + '/' + arr + '/', params);\r\n    }\r\n    async tuidArrPos(name:string, arr:string, owner:number, id:number, order:number):Promise<any> {\r\n        return await this.post('tuid-arr-pos/' + name + '/' + owner + '/' + arr + '/', {\r\n            id: id,\r\n            $order: order\r\n        });\r\n    }\r\n\r\n    async tuidIds(name:string, arr:string, ids:number[]):Promise<any[]> {\r\n        try {\r\n            let url = 'tuidids/' + name + '/';\r\n            if (arr !== undefined) url += arr;\r\n            else url += '$';\r\n            let ret = await this.post(url, ids);\r\n            return ret;\r\n        }\r\n        catch (e) {\r\n            console.error(e);\r\n        }\r\n    }\r\n    */\r\n    /*async sheetSave(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async sheetAction(name:string, data:object) {\r\n        return await this.put('sheet/' + name, data);\r\n    }*/\r\n\r\n    /*async stateSheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/states', data);\r\n    }*/\r\n\r\n    /*async stateSheetCount(name:string):Promise<any> {\r\n        return await this.get('sheet/' + name + '/statecount');\r\n    }*/\r\n\r\n    /*async mySheets(name:string, data:object) {\r\n        return await this.post('sheet/' + name + '/my-sheets', data);\r\n    }*/\r\n\r\n    /*async getSheet(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/get/' + id);\r\n    }*/\r\n\r\n    /*async sheetArchives(name:string, data:object):Promise<any> {\r\n        return await this.post('sheet/' + name + '/archives', data);\r\n    }\r\n\r\n    async sheetArchive(name:string, id:number):Promise<any> {\r\n        return await this.get('sheet/' + name + '/archive/' + id);\r\n    }*/\r\n\r\n    /*async action(name:string, data:object):Promise<any> {\r\n        return await this.post('action/' + name, data);\r\n    }\r\n\r\n    async actionReturns(name:string, data:object):Promise<any[][]> {\r\n        return await this.post('action/' + name + '/returns', data);\r\n    }\r\n\r\n    async page(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p:any;\r\n        switch (typeof params) {\r\n            case 'undefined': p = {key: ''}; break;\r\n            default: p = _.clone(params); break;\r\n        }\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        return await this.post('query-page/' + name, p);\r\n    }\r\n\r\n    async query(name:string, params:any):Promise<any> {\r\n        let ret = await this.post('query/' + name, params);\r\n        return ret;\r\n    }\r\n    */\r\n/*\r\n    async history(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n\r\n    async book(name:string, pageStart:any, pageSize:number, params:any):Promise<string> {\r\n        let p = _.clone(params);\r\n        p['$pageStart'] = pageStart;\r\n        p['$pageSize'] = pageSize;\r\n        let ret = await this.post('history/' + name, p);\r\n        return ret;\r\n    }\r\n*/\r\n    /*async user():Promise<any> {\r\n        return await this.get('user');\r\n    }*/\r\n}\r\n\r\nlet channels:{[unitId:number]: HttpChannel} = {};\r\n\r\nexport function logoutUnitxApis() {\r\n    channels = {};\r\n}\r\n\r\nexport class UnitxApi extends UqApi {\r\n    private unitId:number;\r\n    constructor(unitId:number) {\r\n        super('tv/', undefined, undefined, undefined, undefined, undefined, true);\r\n        this.unitId = unitId;\r\n    }\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        let channel = channels[this.unitId];\r\n        if (channel !== undefined) return channel;\r\n        return channels[this.unitId] = await this.buildChannel();\r\n    }\r\n\r\n    private async buildChannel():Promise<HttpChannel> {\r\n        let channelUI = new HttpChannelNavUI();\r\n        let centerAppApi = new CenterAppApi('tv/', undefined);\r\n        let ret = await centerAppApi.unitxUq(this.unitId);\r\n        let {token, db, url, urlTest} = ret;\r\n        let realUrl = host.getUrlOrTest(db, url, urlTest);\r\n        this.token = token;\r\n        return new UqHttpChannel(realUrl, token, channelUI);\r\n    }\r\n}\r\n\r\nlet centerHost:string;\r\n\r\nexport function setCenterUrl(url:string) {\r\n    console.log('setCenterUrl %s', url);\r\n    centerHost = url;\r\n    centerToken = undefined;\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nexport let centerToken:string|undefined = undefined;\r\n\r\nlet loginedUserId:number = 0;\r\nexport function setCenterToken(userId:number, t?:string) {\r\n    loginedUserId = userId;\r\n    centerToken = t;\r\n    console.log('setCenterToken %s', t);\r\n    centerChannel = undefined;\r\n    centerChannelUI = undefined;\r\n}\r\n\r\nlet centerChannelUI:HttpChannel;\r\nlet centerChannel:HttpChannel;\r\nfunction getCenterChannelUI():HttpChannel {\r\n    if (centerChannelUI !== undefined) return centerChannelUI;\r\n    return centerChannelUI = new CenterHttpChannel(centerHost, centerToken, new HttpChannelNavUI());\r\n}\r\nfunction getCenterChannel():HttpChannel {\r\n    if (centerChannel !== undefined) return centerChannel;\r\n    return centerChannel = new CenterHttpChannel(centerHost, centerToken);\r\n}\r\n\r\nexport abstract class CenterApiBase extends ApiBase {\r\n    /*\r\n    constructor(path: string, showWaiting?: boolean) {\r\n        super(path, showWaiting);\r\n    }*/\r\n\r\n    protected async getHttpChannel(): Promise<HttpChannel> {\r\n        return (this.showWaiting === true || this.showWaiting === undefined)?\r\n            getCenterChannelUI():\r\n            getCenterChannel();\r\n    }\r\n}\r\n\r\nconst uqTokensName = 'uqTokens';\r\nexport class UqTokenApi extends CenterApiBase {\r\n    private localMap: LocalMap = env.localDb.map(uqTokensName);\r\n\r\n    async uq(params: {unit:number, uqOwner:string, uqName:string, appOwner:string, appName:string}):Promise<any> {\r\n        let {uqOwner, uqName} = params;\r\n        let un = uqOwner+'/'+uqName;\r\n        let localCache = this.localMap.child(un);\r\n        try {\r\n            let uqToken:UqLocal = localCache.get();\r\n            if (uqToken !== undefined) {\r\n                let {unit, user} = uqToken;\r\n                if (unit !== params.unit || user !== loginedUserId) {\r\n                    localCache.remove();\r\n                    uqToken = undefined;\r\n                }\r\n            }\r\n            let nowTick = Math.floor(Date.now() / 1000);\r\n            if (uqToken !== undefined) {\r\n                let {tick, value} = uqToken;\r\n                if (value !== undefined && (nowTick - tick) < 24*3600) {\r\n                    return _.clone(value);\r\n                }\r\n            }\r\n            let appUqParams:any = _.clone(params);\r\n            appUqParams.testing = host.testing;\r\n            let ret = await this.get('app-uq', appUqParams);\r\n            if (ret === undefined) {\r\n                let {unit, uqOwner, uqName} = params;\r\n                let err = `center get app-uq(unit=${unit}, '${uqOwner}/${uqName}') - not exists or no unit-service`;\r\n                throw err;\r\n            }\r\n\r\n            uqToken = {\r\n                unit: params.unit,\r\n                user: loginedUserId,\r\n                tick: nowTick,\r\n                value: ret,\r\n            }\r\n            localCache.set(uqToken);\r\n            return _.clone(ret);\r\n        }\r\n        catch (err) {\r\n            localCache.remove();\r\n            throw err;\r\n        }\r\n    }\r\n}\r\n\r\nexport const uqTokenApi = new UqTokenApi('tv/tie/', undefined);\r\n\r\nexport class CallCenterApi extends CenterApiBase {\r\n    directCall(url:string, method:string, body:any):Promise<any> {\r\n        return this.call(url, method, body);\r\n    }\r\n}\r\nexport const callCenterapi = new CallCenterApi('', undefined);\r\n\r\nexport interface UqAppData {\r\n    appName: string;\r\n    appOwner: string;\r\n    id: number;\r\n    version: string;        // AppUI version\r\n    uqs: UqData[];\r\n}\r\n\r\nexport interface UqData {\r\n    id: number;\r\n    uqOwner: string;\r\n    uqName: string;\r\n    access: string;\r\n    newVersion: boolean;\r\n}\r\n\r\nexport interface UqServiceData {\r\n    id: number;\r\n    db: string;\r\n    url: string;\r\n    urlTest: string;\r\n    token: string;\r\n}\r\n\r\n//const appUqsName = 'appUqs';\r\n\r\nexport class CenterAppApi extends CenterApiBase {\r\n    //private local: LocalCache = env.localDb.item(appUqsName);\r\n    //private cachedUqs: UqAppData;\r\n    async uqs(appOwner:string, appName:string):Promise<UqAppData> {\r\n        let ret:UqAppData = await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n        return ret;\r\n        /*\r\n        let ret:UqAppData;\r\n        let appUqs = this.local.get();\r\n        if (appUqs) {\r\n            let {appOwner:rAppOwner, appName:rAppName} = appUqs;\r\n            if (appOwner === rAppOwner && appName === rAppName) ret = appUqs;\r\n        }\r\n        if (ret === undefined) {\r\n            ret = await this.uqsPure(appOwner, appName);\r\n            ret.appName = appName;\r\n            ret.appOwner = appOwner;\r\n            //localStorage.setItem(JSON.stringify(obj));\r\n            this.local.set(ret);\r\n        }\r\n        //return this.cachedUqs = _.cloneDeep(ret);\r\n        return ret;\r\n        */\r\n    }\r\n    private async uqsPure(appOwner:string, appName:string):Promise<UqAppData> {\r\n        return await this.get('tie/app-uqs', {appOwner:appOwner, appName:appName});\r\n    }\r\n    /*\r\n    private async isOkCheckUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.uqsPure(appOwner, appName);\r\n        let {id:cachedId, uqs:cachedUqs} = this.local.get(); //.cachedUqs;\r\n        let {id:retId, uqs:retUqs} = ret;\r\n        if (cachedId !== retId) return false;\r\n        if (cachedUqs.length !== retUqs.length) return false;\r\n        let len = cachedUqs.length;\r\n        for (let i=0; i<len; i++) {\r\n            if (_.isMatch(cachedUqs[i], retUqs[i]) === false) return false;\r\n        }\r\n        return true;\r\n    }\r\n    async checkUqs(appOwner:string, appName:string):Promise<boolean> {\r\n        let ret = await this.isOkCheckUqs(appOwner, appName);\r\n        if (ret === false) {\r\n            this.local.remove();\r\n            nav.start();\r\n        }\r\n        return ret;\r\n    }\r\n    */\r\n    async unitxUq(unit:number):Promise<UqServiceData> {\r\n        return await this.get('tie/unitx-uq', {unit:unit});\r\n    }\r\n    async changePassword(param: {orgPassword:string, newPassword:string}) {\r\n        return await this.post('tie/change-password', param);\r\n    }\r\n}\r\n\r\nexport async function loadAppUqs(appOwner:string, appName:string): Promise<UqAppData> {\r\n    let centerAppApi = new CenterAppApi('tv/', undefined);\r\n    //let unit = meInFrame.unit;\r\n    let ret = await centerAppApi.uqs(appOwner, appName);\r\n    //await centerAppApi.checkUqs(appOwner, appName);\r\n    /*\r\n    .then(v => {\r\n        if (v === false) {\r\n            localStorage.removeItem(appUqs);\r\n            nav.start();\r\n        }\r\n    });\r\n    */\r\n    return ret;\r\n}\r\n\r\n//import { nav } from '../ui';\r\n\r\nexport interface RegisterParameter {\r\n    nick:string, \r\n    user:string, \r\n    pwd:string,\r\n    country:number, \r\n    mobile:number, \r\n    mobileCountry:number,\r\n    email:string,\r\n    verify:string,\r\n};\r\n\r\nexport class UserApi extends CenterApiBase {\r\n    async login(params: {user: string, pwd: string, guest: number}): Promise<any> {\r\n        //(params as any).device = nav.local.device.get();\r\n        let ret = await this.get('user/login', params);\r\n        switch (typeof ret) {\r\n            default: return;\r\n            case 'string': return decodeUserToken(ret);\r\n            case 'object':\r\n                let token = ret.token;\r\n                let user = decodeUserToken(token);\r\n                let {nick, icon} = ret;\r\n                if (nick) user.nick = nick;\r\n                if (icon) user.icon = icon;\r\n                return user;\r\n        }\r\n        // !== undefined) return decodeToken(token);\r\n    }\r\n    async register(params: RegisterParameter): Promise<any>\r\n    {\r\n        return await this.post('user/register', params);\r\n    }\r\n\r\n    async sendVerify(account:string, type:'mobile'|'email', oem:string) {\r\n        return await this.post('user/set-verify', {account:account, type:type, oem:oem});\r\n    }\r\n\r\n    async checkVerify(account:string, verify:string) {\r\n        return await this.post('user/check-verify', {account:account, verify:verify});\r\n    }\r\n\r\n    async isExists(account:string) {\r\n        return await this.get('user/is-exists', {account:account});\r\n    }\r\n\r\n    async resetPassword(account:string, password:string, verify:string, type:'mobile'|'email'):Promise<any[]> {\r\n        return await this.post('user/reset-password', {account:account, password, verify, type});\r\n    }\r\n    \r\n    async userSetProp(prop:string, value:any) {\r\n        await this.post('tie/user-set-prop', {prop:prop, value:value});\r\n    }\r\n\r\n    async me():Promise<any> {\r\n        return await this.get('tie/me');\r\n    }\r\n\r\n    async user(id:number): Promise<any> {\r\n        return await this.get('tie/user', {id:id});\r\n\t}\r\n\t\r\n\tasync fromKey(key:string): Promise<{id:number, name:string, nick:string, icon:string}> {\r\n\t\treturn await this.get('tie/user-from-key', {key});\r\n\t}\r\n}\r\n\r\nexport const userApi = new UserApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { ItemSchema, UiItem, UiSelectBase } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { observable } from 'mobx';\r\nimport { FieldRule } from '../form/rules';\r\nimport { Image } from '../image';\r\n\r\nexport abstract class ItemEdit {\r\n\tprotected name: string;\r\n\tprotected _itemSchema: ItemSchema;\r\n    get itemSchema(): ItemSchema {return this._itemSchema}\r\n    protected _uiItem:UiItem;\r\n    get uiItem():UiItem {return this._uiItem}\r\n    value: any;\r\n    label: string;\r\n\r\n    @observable protected error: string;\r\n    @observable protected isChanged: boolean = false;\r\n    protected newValue: any;\r\n\r\n    constructor(itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) {\r\n        this._itemSchema = itemSchema;\r\n        this._uiItem = uiItem\r\n        this.value = value;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this.label = label;\r\n\t}\r\n\t\r\n\tinit() {\t\t\r\n\t}\r\n\r\n    async start():Promise<any> {\r\n        return await this.internalStart();\r\n    }\r\n\r\n    protected abstract internalStart():Promise<any>;\r\n\r\n    async end():Promise<any> {\r\n        await this.internalEnd()\r\n    }\r\n\r\n\trenderContent() {\t\t\r\n        let {name, type} = this._itemSchema;\r\n        let divValue:any;\r\n        let uiItem = this._uiItem;\r\n        let label:string, labelHide:boolean;\r\n        if (uiItem === undefined) {\r\n            label = name;\r\n        }\r\n        else {\r\n\t\t\tlabel = uiItem.label;\r\n\t\t\tlabelHide = uiItem.labelHide;\r\n            let templet = uiItem.Templet;\r\n            if (templet !== undefined) {\r\n                if (typeof templet === 'function') {\r\n\t\t\t\t\tif (this.value !== undefined) divValue = templet(this.value);\r\n\t\t\t\t}\r\n                else {\r\n\t\t\t\t\tdivValue = {templet};\r\n\t\t\t\t}\r\n            }\r\n            else if (this.value !== undefined) {\r\n                switch (uiItem.widget) {\r\n                    case 'radio':\r\n                    case 'select':\r\n                        let {list} = uiItem as UiSelectBase;\r\n                        divValue = <b>{list.find(v => v.value === this.value).title}</b>;\r\n                        break;\r\n                    case 'id':\r\n                        divValue = <b>no templet for {name}={this.value}</b>\r\n                        break;\r\n                }\r\n            }\r\n        }\r\n        if (divValue === undefined) {\r\n            switch (type) {\r\n                default:\r\n                    divValue = this.value? \r\n\t\t\t\t\t\t<b>{this.value}</b> \r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<small className=\"text-muted\">[{labelHide===true? label:'无'}]</small>;\r\n                    break;\r\n                case 'image':\r\n                    divValue = <Image className=\"w-4c h-4c\" src={this.value} />;\r\n                    break;\r\n            }\r\n\t\t}\r\n\t\treturn divValue;\r\n\t}\r\n\r\n    protected async internalEnd():Promise<void> {nav.pop()}\r\n\r\n    protected verifyValue() {\r\n        if (this.uiItem === undefined) return;\r\n        let {rules} = this.uiItem;\r\n        if (rules === undefined) return;\r\n        let nv = this.newValue;\r\n        function verifyRule(rule:FieldRule, value: any):string {\r\n            let error = rule(nv);\r\n            if (error !== undefined) {\r\n                if (typeof error !== 'object')\r\n                    return error;\r\n                else\r\n                    return JSON.stringify(error);\r\n            }\r\n        }\r\n        if (Array.isArray(rules)) {\r\n            for (let rule of rules) {\r\n                let error = verifyRule(rule as FieldRule, nv);\r\n                if (error !== undefined) {\r\n                    this.error = error;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.error = verifyRule(rules as FieldRule, nv);\r\n        }\r\n    }\r\n}\r\n","\r\nlet subAppWindow:Window;\r\nfunction postWsToSubApp(msg:any) {\r\n    if (subAppWindow === undefined) return;\r\n    subAppWindow.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport function setSubAppWindow(win:Window) {\r\n    subAppWindow = win;\r\n}\r\n\r\nexport function postWsToTop(msg:any) {\r\n    window.top.postMessage({\r\n        type: 'ws',\r\n        msg: msg\r\n    }, '*');\r\n}\r\n\r\nexport abstract class WsBase {\r\n    wsBaseId:string;\r\n    private handlerSeed = 1;\r\n    private anyHandlers:{[id:number]:(msg:any)=>Promise<void>} = {};\r\n    private msgHandlers:{[id:number]:{type:string, handler:(msg:any)=>Promise<void>}} = {};\r\n    onWsReceiveAny(handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.anyHandlers[seed] = handler;\r\n        return seed;\r\n    }\r\n    onWsReceive(type:string, handler:(msg:any)=>Promise<void>):number {\r\n        let seed = this.handlerSeed++;\r\n        this.msgHandlers[seed] = {type:type, handler: handler};\r\n        return seed;\r\n    }\r\n    endWsReceive(handlerId:number) {\r\n        delete this.anyHandlers[handlerId];\r\n        delete this.msgHandlers[handlerId];\r\n    }\r\n    async receive(msg:any) {\r\n        let {$type} = msg;\r\n        for (let i in this.anyHandlers) {\r\n            await this.anyHandlers[i](msg);\r\n        }\r\n        for (let i in this.msgHandlers) {\r\n            let {type, handler} = this.msgHandlers[i];\r\n            if (type !== $type) continue;\r\n            await handler(msg);\r\n        }\r\n    }\r\n}\r\n\r\nlet wsBaseSeed = 1;\r\nexport class WsBridge extends WsBase {\r\n    wsBaseId:string = 'WsBridge seed ' + wsBaseSeed++;\r\n}\r\n\r\nexport const wsBridge = new WsBridge();\r\n\r\nexport class WSChannel extends WsBase {\r\n    wsBaseId:string = 'WSChannel seed ' + wsBaseSeed++;\r\n    static centerToken:string;\r\n    private wsHost: string;\r\n    private token: string;\r\n    private ws: WebSocket;\r\n\r\n    constructor(wsHost: string, token: string) {\r\n        super();\r\n        this.wsHost = wsHost;\r\n        this.token = token;\r\n    }\r\n\r\n    static setCenterToken(token?: string) {\r\n        WSChannel.centerToken = token;\r\n    }\r\n    \r\n    connect():Promise<void> {\r\n        //this.wsHost = wsHost;\r\n        //this.token = token || WSChannel.centerToken;\r\n        if (this.ws !== undefined) return;\r\n        let that = this;\r\n        return new Promise((resolve, reject) => {\r\n            let ws = new WebSocket(this.wsHost, this.token || WSChannel.centerToken);\r\n            console.log('connect webSocket %s', this.wsHost);\r\n            ws.onopen = (ev) => {\r\n                console.log('webSocket connected %s', this.wsHost);\r\n                that.ws = ws;\r\n                resolve();\r\n            };\r\n            ws.onerror = (ev) => {\r\n                reject('webSocket can\\'t open!');\r\n            };\r\n            ws.onmessage = async (msg) => await that.wsMessage(msg);\r\n            ws.onclose = (ev) => {\r\n                that.ws = undefined;\r\n                console.log('webSocket closed!');\r\n            }\r\n        });\r\n    }\r\n    close() {\r\n        if (this.ws !== undefined) {\r\n            this.ws.close();\r\n            this.ws = undefined;\r\n        }\r\n    }\r\n    private async wsMessage(event:any):Promise<void> {\r\n        try {\r\n            console.log('websocket message: %s', event.data);\r\n            let msg = JSON.parse(event.data);\r\n            postWsToSubApp(msg);\r\n            await this.receive(msg);\r\n        }\r\n        catch (err) {\r\n            console.log('ws msg error: ', err);\r\n        }\r\n    }\r\n    sendWs(msg:any) {\r\n        let netThis = this;\r\n        this.connect().then(() => {\r\n            netThis.ws.send(msg);\r\n        });\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nexport interface KeyValueRes {\r\n    [key:string]: any;\r\n}\r\n\r\nexport interface Res<T extends KeyValueRes> {\r\n    [lang:string]: T | {[district:string]: T};\r\n}\r\n\r\nexport const resOptions:{\r\n\tlang: string;\r\n\t$lang: string;\r\n\tdistrict: string;\r\n\t$district: string;\r\n} = {\r\n\tlang: undefined,\r\n\t$lang: undefined,\r\n\tdistrict: undefined,\r\n\t$district: undefined,\r\n}\r\n\r\nexport function setResOptions(lang:string, district:string) {\r\n\tresOptions.lang = lang;\r\n\tresOptions.$lang = '$' + lang;\r\n    resOptions.district = district;\r\n    resOptions.$district = '$' + district;\r\n}\r\n\r\n(function() {\r\n    let lang: string, district: string;\r\n    let language = (navigator.languages && navigator.languages[0])  // Chrome / Firefox\r\n        || navigator.language; // ||   // All browsers\r\n    //navigator.userLanguage; // IE <= 10\r\n    if (!language) {\r\n        lang = 'zh';\r\n        district = 'CN';\r\n    }\r\n    else {\r\n        let parts = language.split('-');\r\n        lang = parts[0];\r\n        if (parts.length > 1) district = parts[1].toUpperCase();\r\n    }\r\n    setResOptions(lang, district);\r\n}());\r\n\r\nexport function resLang<T extends KeyValueRes>(res:Res<T>):T {\r\n    let {lang, district} = resOptions;\r\n    let ret:T = {} as T;\r\n    if (res === undefined) return ret;\r\n    _.merge(ret, res._);\r\n    let l = res[lang];\r\n    if (l === undefined) return ret;\r\n    _.merge(ret, l._);\r\n    let d = l[district];\r\n    if (d === undefined) return ret;\r\n    _.merge(ret, d);\r\n    let {entity} = ret;\r\n    if (entity !== undefined) {\r\n        for (let i in entity) {\r\n            entity[i.toLowerCase()] = entity[i];\r\n        }\r\n    }\r\n    return ret;\r\n}\r\n\r\nconst resGlobal:any = {};\r\nexport function setRes(target: any, res: any):(str:string)=>any {\r\n\tif (res === undefined) return;\r\n\tlet {$lang, $district} = resOptions;\r\n\t_.merge(target, res);\r\n\tif ($lang !== undefined) {\r\n\t\tlet l = res[$lang];\r\n\t\tif (l !== undefined) {\r\n\t\t\t_.merge(target, l);\r\n\t\t\tlet d = l[$district];\r\n\t\t\tif (d !== undefined) {\r\n\t\t\t\t_.merge(target, d);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn function(str:string) {\r\n\t\treturn target[str] || str;\r\n\t}\r\n}\r\nexport function setGlobalRes(res: any) {\r\n\tsetRes(resGlobal, res);\r\n}\r\nexport function t(str:string):any {\r\n\treturn resGlobal[str] || str;\r\n}\r\n","import * as React from 'react';\r\nimport _ from 'lodash';\r\nimport {nav, Page, resOptions} from '../components';\r\nimport { User, env } from '../tool';\r\nimport { VPage } from './vpage';\r\nimport { View } from './view';\r\n\r\nexport interface ConfirmOptions {\r\n    caption?: string;\r\n    message: string | JSX.Element;\r\n    classNames?: string;\r\n    ok?: string;\r\n    yes?: string;\r\n    no?: string;\r\n}\r\n\r\nexport abstract class Controller {\r\n    readonly res: any;\r\n\treadonly x: any;\r\n\tprivate _t: any = {};\r\n\treadonly t: (str:string)=>any;\r\n    icon: string|JSX.Element;\r\n    label:string;\r\n    readonly isDev:boolean = env.isDevelopment;\r\n    get user():User {return nav.user}\r\n    get isLogined():boolean {\r\n        let {user} = nav;\r\n        if (user === undefined) return false;\r\n        return user.id > 0;\r\n    }\r\n    constructor(res:any) {\r\n        this.res = res || {};\r\n\t\tthis.x = this.res.x || {};\r\n\t\tthis.t = (str:string):any => this.internalT(str) || str;\r\n\t}\r\n\r\n\tinit() {}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn this._t[str];\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tif (res === undefined) return;\r\n\t\tlet {$lang, $district} = resOptions;\r\n\t\t_.merge(this._t, res);\r\n\t\tif ($lang !== undefined) {\r\n\t\t\tlet l = res[$lang];\r\n\t\t\tif (l !== undefined) {\r\n\t\t\t\t_.merge(this._t, l);\r\n\t\t\t\tlet d = l[$district];\r\n\t\t\t\tif (d !== undefined) {\r\n\t\t\t\t\t_.merge(this._t, d);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\t\t\r\n\t}\r\n\r\n    private receiveHandlerId:number;\r\n    private disposer:()=>void;\r\n\r\n    private dispose = () => {\r\n        // message listener的清理\r\n        nav.unregisterReceiveHandler(this.receiveHandlerId);\r\n        this.onDispose();\r\n    }\r\n\r\n    protected onDispose() {\r\n    }\r\n\r\n    protected async openVPage<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:(ret:any)=>void):Promise<void> {\r\n        await (new vp((this as any) as C)).open(param, afterBack);\r\n    }\r\n\r\n    protected renderView<C extends Controller>(view: new (controller: C)=>View<C>, param?:any) {\r\n        return (new view((this as any) as C)).render(param);\r\n    }\r\n\r\n    async event(type:string, value:any) {\r\n        await this.onEvent(type, value);\r\n    }\r\n\r\n    protected async onEvent(type:string, value:any) {\r\n    }\r\n\r\n    protected msg(text:string) {\r\n        alert(text);\r\n    }\r\n    protected errorPage(header:string, err:any) {\r\n        this.openPage(<Page header=\"App error!\">\r\n            <pre>\r\n                {typeof err === 'string'? err : err.message}\r\n            </pre>\r\n        </Page>);\r\n    }\r\n\r\n    protected onMessage(message:any):Promise<void> {\r\n        return;\r\n    }\r\n\r\n    private onMessageReceive = async (message:any):Promise<void> => {\r\n        await this.onMessage(message);\r\n    }\r\n\r\n    protected async beforeStart():Promise<boolean> {\r\n        /*\r\n        console.log('this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);');\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n        console.log('return true');\r\n        */\r\n        return true;\r\n\t}\r\n\tprotected async afterStart():Promise<void> {\r\n\t}\r\n    protected registerReceiveHandler() {\r\n        this.receiveHandlerId = nav.registerReceiveHandler(this.onMessageReceive);\r\n    }\r\n\r\n    protected abstract internalStart(param?:any, ...params:any[]):Promise<void>;\r\n    async start(param?:any, ...params:any[]):Promise<void> {\r\n        this.disposer = this.dispose;\r\n        this.registerReceiveHandler();\r\n        let ret = await this.beforeStart();\r\n        if (ret === false) return;\r\n\t\tawait this.internalStart(param, ...params);\r\n\t\tawait this.afterStart();\r\n    }\r\n\r\n    get isCalling():boolean {return this._resolve_$ !== undefined}\r\n\r\n    private _resolve_$:((value:any) => void)[];\r\n    async call<T>(param?:any, ...params:any[]):Promise<T> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<T> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await this.start(param, ...params);\r\n        });\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        if (this._resolve_$ === undefined) this._resolve_$ = [];\r\n        return new Promise<any> (async (resolve, reject) => {\r\n            this._resolve_$.push(resolve);\r\n            await (new vp(this as any)).open(param);\r\n        });\r\n    }\r\n\r\n    returnCall(value:any) {\r\n        if (this._resolve_$ === undefined) return;\r\n        let resolve = this._resolve_$.pop();\r\n        if (resolve === undefined) {\r\n            alert('the Controller call already returned, or not called');\r\n            return;\r\n        }\r\n        resolve(value);\r\n    }\r\n\r\n    openPage(page:JSX.Element, onClosePage?: ()=>void) {\r\n\t\tlet disposer: ()=>void;\r\n\t\tif (onClosePage !== undefined) {\r\n\t\t\tdisposer = () => {\r\n\t\t\t\tif (this.disposer) this.disposer();\r\n\t\t\t\tonClosePage();\r\n\t\t\t}\r\n\t\t}\r\n\r\n        nav.push(page, disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    replacePage(page:JSX.Element) {\r\n        nav.replace(page, this.disposer);\r\n        this.disposer = undefined;\r\n    }\r\n\r\n    backPage() {\r\n        nav.back();\r\n    }\r\n\r\n    closePage(level?:number) {\r\n        nav.pop(level);\r\n    }\r\n\r\n    ceasePage(level?:number) {\r\n        nav.ceaseTop(level);\r\n    }\r\n\r\n    removeCeased() {\r\n        nav.removeCeased();\r\n    }\r\n\r\n    regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        nav.regConfirmClose(confirmClose);\r\n    }\r\n\r\n    async confirm(options: ConfirmOptions): Promise<'ok'|'yes'|'no'|undefined> {\r\n        return new Promise<'ok'|'yes'|'no'|undefined> (async (resolve, reject) => {\r\n            let {caption, message, ok, yes, no, classNames} = options;\r\n            let close = (res:'ok'|'yes'|'no'|undefined) => {\r\n                this.closePage();\r\n                resolve(res);\r\n            }\r\n            let buttons:any[] = [];\r\n            if (ok !== undefined) {\r\n                buttons.push(<button key=\"ok\" className=\"btn btn-primary mr-3\" onClick={()=>close('ok')}>{ok}</button>);\r\n            }\r\n            if (yes !== undefined) {\r\n                buttons.push(<button key=\"yes\" className=\"btn btn-success mr-3\" onClick={()=>close('yes')}>{yes}</button>);\r\n            }\r\n            if (no !== undefined) {\r\n                buttons.push(<button key=\"no\" className=\"btn btn-outline-danger mr-3\" onClick={()=>close('no')}>{no}</button>);\r\n            }\r\n            this.openPage(<Page header={caption || '请确认'} back=\"close\">\r\n                <div className={classNames || \"rounded bg-white m-5 p-3 border\"}>\r\n                    <div className=\"d-flex align-items-center justify-content-center\">\r\n                        {message}\r\n                    </div>\r\n                    <div className=\"mt-3 d-flex align-items-center justify-content-center\">\r\n                        {buttons}\r\n                    </div>\r\n                </div>\r\n            </Page>);\r\n            nav.regConfirmClose(async ():Promise<boolean> => {\r\n                resolve(undefined);\r\n                return true;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page } from '../components';\r\nimport { env } from '../tool';\r\nimport { Controller } from './controller';\r\nimport { VPage } from './vpage';\r\n\r\nexport abstract class View<C extends Controller> {\r\n    protected controller: C;\r\n    protected readonly res: any;\r\n\tprotected readonly x: any;\r\n\tprotected readonly t: (str:string)=>any;\r\n\r\n    constructor(controller: C) {\r\n        this.controller = controller;\r\n        this.res = controller.res;\r\n\t\tthis.x = controller.x;\r\n\t\tthis.t = controller.t;\r\n    }\r\n\r\n    protected get isDev() {return  env.isDevelopment}\r\n\r\n    abstract render(param?:any): JSX.Element;\r\n\r\n    protected renderVm(vm: new (controller: C)=>View<C>, param?:any) {\r\n        return (new vm(this.controller)).render(param);\r\n    }\r\n\r\n    protected async openVPage(vp: new (controller: C)=>VPage<C>, param?:any, afterBack?:()=>Promise<void>):Promise<void> {\r\n        await (new vp(this.controller)).open(param, afterBack);\r\n    }\r\n\r\n    protected async event(type:string, value?:any) {\r\n        /*\r\n        if (this._resolve_$_ !== undefined) {\r\n            await this._resolve_$_({type:type, value:value});\r\n            return;\r\n        }*/\r\n        await this.controller.event(type, value);\r\n    }\r\n\r\n    async vCall<C extends Controller>(vp: new (controller: C)=>VPage<C>, param?:any):Promise<any> {\r\n        return await this.controller.vCall(vp, param);\r\n    }\r\n\r\n    protected returnCall(value:any) {\r\n        this.controller.returnCall(value);\r\n    }\r\n\r\n    protected openPage(view: React.StatelessComponent<any>, param?:any) {\r\n        let type = typeof param;\r\n        if (type === 'object' || type === 'undefined') {\r\n            this.controller.openPage(React.createElement(view, param));\r\n        }\r\n        else {\r\n            this.controller.openPage(<Page header=\"param type error\">\r\n                View.openPage param must be object, but here is {type}\r\n            </Page>);\r\n        }\r\n    }\r\n\r\n    protected replacePage(view: React.StatelessComponent<any>, param?:any) {\r\n        this.controller.replacePage(React.createElement(view, param));\r\n    }\r\n\r\n    protected openPageElement(page: JSX.Element, onClosePage?: ()=>void) {\r\n        this.controller.openPage(page, onClosePage);\r\n    }\r\n\r\n    protected replacePageElement(page: JSX.Element) {\r\n        this.controller.replacePage(page);\r\n    }\r\n\r\n    protected backPage() {\r\n        this.controller.backPage();\r\n    }\r\n\r\n    protected closePage(level?:number) {\r\n        this.controller.closePage(level);\r\n    }\r\n\r\n    protected ceasePage(level?:number) {\r\n        this.controller.ceasePage(level);\r\n    }\r\n\r\n    protected removeCeased() {\r\n        this.controller.removeCeased();\r\n    }\r\n\r\n    protected regConfirmClose(confirmClose: ()=>Promise<boolean>) {\r\n        this.controller.regConfirmClose(confirmClose);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Page, Scroller, TabsProps } from \"../components\";\r\nimport { View } from \"./view\";\r\nimport { Controller } from \"./controller\";\r\n\r\nexport abstract class VPage<C extends Controller> extends View<C> {\r\n\t// private onClosePage:(ret:any)=>void;\r\n\tprotected retOnClosePage: any;\r\n\r\n    open(param?:any, onClosePage?:(ret:any)=>void):Promise<void> {\r\n\t\t//this.onClosePage = onClosePage;\r\n\t\tthis.init(param);\r\n\t\tlet _onClosePage: ()=>void;\r\n\t\tif (onClosePage !== undefined) _onClosePage = () => onClosePage(this.retOnClosePage);\r\n\t\tthis.openPageElement(this.renderPage(), _onClosePage);\r\n\t\treturn;\r\n\t}\r\n\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\t//return this.content();\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\tinit(param?:any):void {return;}\r\n\r\n\theader():string|boolean|JSX.Element {return null;}\r\n\tright():JSX.Element {return null;}\r\n\tcontent():JSX.Element {return null;}\r\n\tfooter():JSX.Element {return null;}\r\n\tlogout(): boolean | (()=>Promise<void>) {return false;}\r\n\tprotected renderPage():JSX.Element {\r\n\t\tlet header = this.header();\r\n\t\tif (!header) header = false;\r\n\t\treturn <Page\r\n\t\t\theader={header} right={this.right()} footer={this.footer()}\r\n\t\t\tonScroll={(e:any)=>this.onPageScroll(e)}\r\n\t\t\tonScrollTop={(scroller: Scroller) => this.onPageScrollTop(scroller)}\r\n\t\t\tonScrollBottom={(scroller: Scroller) => this.onPageScrollBottom(scroller)}\r\n\t\t\tback={this.back}\r\n\t\t\theaderClassName={this.headerClassName}\r\n\t\t\tclassName={this.className}\r\n\t\t\tafterBack={()=>this.afterBack()}\r\n\t\t\ttabsProps={this.tabsProps}\r\n\t\t\tlogout={this.logout()}\r\n\t\t>\r\n\t\t\t{this.content()}\r\n\t\t</Page>;\r\n\t}\r\n\r\n\tprotected onPageScroll(e:any) {}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected async onPageScrollBottom(scroller: Scroller): Promise<boolean> {return false;}\r\n\tprotected afterBack():void {}\r\n\tprotected get back(): 'close' | 'back' | 'none' {return 'back'}\r\n\tprotected get headerClassName(): string {return null;}\r\n\tprotected get className(): string {return null;}\r\n\tprotected get tabsProps(): TabsProps {return null;}\r\n}\r\n","export * from './controller';\r\nexport * from './view';\r\nexport * from './vpage';","import _ from 'lodash';\r\nimport {observable, IObservableArray} from 'mobx';\r\nimport { PageItems } from '../tool';\r\nimport {Field, ArrFields} from './uqMan';\r\nimport {Entity} from './entity';\r\nimport { QueryQueryCaller, QueryPageCaller } from './caller';\r\n\r\nexport type QueryPageApi = (name:string, pageStart:any, pageSize:number, params:any) => Promise<string>;\r\n\r\nexport class QueryPager<T extends any> extends PageItems<T> {\r\n\tprivate query: Query;\r\n\tprivate $page: any;\r\n\tprotected idFieldName: any;\r\n    constructor(query: Query, pageSize?: number, firstSize?: number, itemObservable?:boolean) {\r\n        super(itemObservable);\r\n        this.query = query;\r\n        if (pageSize !== undefined) this.pageSize = pageSize;\r\n\t\tif (firstSize !== undefined) this.firstSize = firstSize;\r\n\t}\r\n\r\n\tsetReverse() {\r\n\t\tthis.appendPosition = 'head';\r\n\t}\r\n\r\n    protected async onLoad() {\r\n        let {schema} = this.query;\r\n        if (schema !== undefined) return;\r\n\t\tawait this.query.loadSchema();\r\n\t\tschema = this.query.schema;\r\n\t\tif (schema === undefined) return;\r\n\t\tlet $page = this.$page = (schema.returns as any[]).find(v => v.name === '$page');\r\n\t\tif ($page === undefined) return;\r\n\t\tthis.sortOrder = $page.order;\r\n\t\tlet fields = $page.fields;\r\n\t\tif (fields !== undefined) {\r\n\t\t\tlet field = fields[0];\r\n\t\t\tif (field) this.idFieldName = field.name;\r\n\t\t}\r\n    }\r\n\r\n    protected async loadResults(param:any, pageStart:number, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.query.page(param, pageStart, pageSize);\r\n\t\treturn ret;\r\n\t}\r\n\tprotected getPageId(item:T) {\r\n\t\tif (item === undefined) return;\r\n\t\tlet start = item[this.idFieldName];\r\n\t\tif (start === null) return;\r\n\t\tif (start === undefined) return;\r\n\t\tif (typeof start === 'object') {\r\n\t\t\tlet id = start.id;\r\n\t\t\tif (id !== undefined) return id;\r\n\t\t}\r\n\t\treturn start;\r\n\t}\r\n\tasync refreshItems(item:T) {\r\n\t\tlet index = this._items.indexOf(item);\r\n\t\tif (index < 0) return;\r\n\t\tlet startIndex:number;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\tstartIndex = index - 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tstartIndex = index + 1;\r\n\t\t}\r\n\t\tlet pageStart = this.getPageId(this._items[startIndex]);\r\n\t\tlet pageSize = 1;\r\n        let ret = await this.load(\r\n\t\t\tthis.param, \r\n\t\t\tpageStart,\r\n\t\t\tpageSize);\r\n\t\tlet len = ret.length;\r\n\t\tif (len === 0) {\r\n\t\t\tthis._items.splice(index, 1);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet newItem = ret[i];\r\n\t\t\tif (!newItem) continue;\r\n\t\t\tlet newId = newItem[this.idFieldName];\r\n\t\t\tif (newId === undefined || newId === null) continue;\r\n\t\t\tif (typeof newId === 'object') newId = newId.id;\r\n\t\t\tlet oldItem = this._items.find(v => {\r\n\t\t\t\tlet oldId = v[this.idFieldName];\r\n\t\t\t\tif (oldId === undefined || oldId === null) return false;\r\n\t\t\t\tif (typeof oldId === 'object') oldId = oldId.id;\r\n\t\t\t\treturn oldId = newId;\r\n\t\t\t});\r\n\t\t\tif (oldItem) {\r\n\t\t\t\t_.merge(oldItem, newItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport class Query extends Entity {\r\n    get typeName(): string { return 'query';}\r\n    private pageStart: any;\r\n    private pageSize:number;\r\n    private params:any;\r\n    private more: boolean;\r\n    private startField: Field;\r\n    @observable list:IObservableArray; // = observable.array([], {deep: false});\r\n    returns: ArrFields[];\r\n    isPaged: boolean;\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {returns} = schema;\r\n        //this.returns = returns;\r\n        this.isPaged = returns && (returns as any[]).find(v => v.name === '$page') !== undefined;\r\n    }\r\n\r\n    resetPage(size:number, params:any) {\r\n        this.pageStart = undefined;\r\n        this.pageSize = size;\r\n        this.params = params;\r\n        this.more = false;\r\n        this.list = undefined;\r\n    }\r\n    get hasMore() {return this.more;}\r\n    async loadPage():Promise<void> {\r\n        if (this.pageSize === undefined) {\r\n            throw new Error('call resetPage(size:number, params:any) first');\r\n        }\r\n        let pageStart:any;\r\n        if (this.pageStart !== undefined) {\r\n            switch (this.startField.type) {\r\n                default: pageStart = this.pageStart; break;\r\n                case 'date':\r\n                case 'time':\r\n                case 'datetime': pageStart = (this.pageStart as Date).getTime(); break;\r\n            }\r\n        }\r\n\t\tlet ret = await this.page(this.params, pageStart, this.pageSize+1);\r\n\t\tlet page = ret.$page;\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.tvApi.page(this.name, pageStart, this.pageSize+1, this.params);\r\n        let data = await this.unpackReturns(res);\r\n        let page = data['$page'] as any[];\r\n        */\r\n        this.list = observable.array([], {deep: false});\r\n        if (page !== undefined) {\r\n            if (page.length > this.pageSize) {\r\n                this.more = true;\r\n                page.pop();\r\n                let ret = this.returns.find(r => r.name === '$page');\r\n                this.startField = ret.fields[0];\r\n                this.pageStart = page[page.length-1][this.startField.name];\r\n            }\r\n            else {\r\n                this.more = false;\r\n            }\r\n            this.list.push(...page);\r\n        }\r\n        //this.loaded = true;\r\n    }\r\n\r\n    protected pageCaller(params: any, showWaiting: boolean = true): QueryPageCaller {\r\n        return new QueryPageCaller(this, params, showWaiting);\r\n    }\r\n\r\n    async page(params:any, pageStart:any, pageSize:number, showWaiting: boolean = true):Promise<{[name:string]:any[]}> {\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.uqApi.page(this.name, pageStart, pageSize+1, this.buildParams(params));\r\n        */\r\n        let p = {pageStart:pageStart, pageSize:pageSize, params:params};\r\n        let res = await this.pageCaller(p, showWaiting).request();\r\n        //let data = this.unpackReturns(res);\r\n        //return data.$page;// as any[];\r\n        return res;\r\n    }\r\n    protected queryCaller(params: any, showWaiting: boolean = true): QueryQueryCaller {\r\n        return new QueryQueryCaller(this, params, showWaiting);\r\n    }\r\n    async query(params:any, showWaiting:boolean = true):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let res = await this.uqApi.query(this.name, this.buildParams(params));\r\n        */\r\n        let res = await this.queryCaller(params, showWaiting).request();\r\n        //let data = this.unpackReturns(res);\r\n        //return data;\r\n        return res;\r\n    }\r\n    async table(params:any, showWaiting:boolean = true): Promise<any[]> {\r\n        let ret = await this.query(params, showWaiting);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.table(params, showWaiting);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any, showWaiting:boolean = true):Promise<any> {\r\n        let ret = await this.obj(params, showWaiting);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n","const ALPHABET = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\nconst ID_LENGTH = 8;\r\n\r\nexport function uid():string {\r\n    let len = ALPHABET.length;\r\n    let rtn = '';\r\n    for (let i = 0; i < ID_LENGTH; i++) {\r\n        rtn += ALPHABET.charAt(Math.floor(Math.random() * len));\r\n    }\r\n    return rtn;\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\n\r\nexport interface ImageProps {\r\n    src: string;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n}\r\n\r\nexport function Image(props: ImageProps) {\r\n    let {className, style, src, altImage} = props;\r\n    if (!src) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (src.startsWith(':') === true) {\r\n        src = nav.resUrl + src.substr(1);\r\n    }\r\n    return <img src={src} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n}\r\n","import jwtDecode from 'jwt-decode';\r\n\r\nexport interface Unit {\r\n    id: number;\r\n    name: string;\r\n}\r\n\r\nexport interface Guest {\r\n    id: number;             // id = 0\r\n    guest: number;\r\n    token: string;\r\n}\r\n\r\nexport interface User extends Guest {\r\n    id: number;\r\n    name: string;\r\n    nick?: string;\r\n    icon?: string;\r\n}\r\n\r\nexport function decodeUserToken(token: string): User {\r\n    let ret:any = jwtDecode(token);\r\n    let user: User = {\r\n        id: ret.id,\r\n        name: ret.name,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return user;\r\n}\r\n\r\nexport function decodeGuestToken(token: string): Guest {\r\n    let ret:any = jwtDecode(token);\r\n    let guest: Guest = {\r\n        id: 0,\r\n        guest: ret.guest,\r\n        token: token,\r\n    };\r\n    return guest;\r\n}\r\n","import { env } from '../tool';\r\n\r\nconst centerHost = process.env['REACT_APP_CENTER_HOST'];\r\nconst centerDebugHost = 'localhost:3000'; //'192.168.86.64';\r\nconst resHost = process.env['REACT_APP_RES_HOST'] || centerHost;\r\nconst resDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugHost = 'localhost:3015'; //'192.168.86.63';\r\nconst uqDebugBuilderHost = 'localhost:3009';\r\ninterface HostValue {\r\n    value: string;\r\n    local: boolean;\r\n}\r\nconst hosts:{[name:string]:HostValue} = {\r\n    centerhost: {\r\n        value: process.env['REACT_APP_CENTER_DEBUG_HOST'] || centerDebugHost, \r\n        local: false\r\n    },\r\n    reshost: {\r\n        value: process.env['REACT_APP_RES_DEBUG_HOST'] || resDebugHost,\r\n        local: false\r\n    },\r\n    uqhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n        local: false\r\n    },\r\n    unitxhost: {\r\n        value: process.env['REACT_APP_UQ_DEBUG_HOST'] || uqDebugHost, \r\n        local: false\r\n    },\r\n    \"uq-build\": {\r\n        value: process.env['REACT_APP_UQ_DEBUG_BUILDER_HOST'] || uqDebugBuilderHost, \r\n        local: false\r\n    }\r\n}\r\n\r\nconst httpArr = ['https://', 'http://'];\r\nfunction isAbsoluteUrl(url:string):boolean {\r\n    for (let str of httpArr) {\r\n        if (url.startsWith(str) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nfunction urlFromHost(host:string):string {\r\n    if (isAbsoluteUrl(host) === true) {\r\n        if (host.endsWith('/')) return host;\r\n        return host + '/';\r\n    }\r\n    return `http://${host}/`;\r\n}\r\n\r\nfunction centerUrlFromHost(host:string):string {\r\n    return urlFromHost(host);\r\n}\r\nfunction centerWsFromHost(host:string) {\r\n    let https = 'https://';\r\n    if (host.startsWith(https) === true) {\r\n        host = host.substr(https.length);\r\n        if (host.endsWith('/') === true) host = host.substr(0, host.length-1);\r\n        return 'wss://' + host + '/tv/';\r\n    }\r\n    return `ws://${host}/tv/`\r\n}\r\nexport function resUrlFromHost(host:string) {\r\n    let url = urlFromHost(host);\r\n    return url + 'res/';\r\n}\r\n\r\nconst fetchOptions = {\r\n    method: \"GET\",\r\n    mode: \"no-cors\", // no-cors, cors, *same-origin\r\n    headers: {\r\n        \"Content-Type\": \"text/plain\"\r\n    },\r\n};\r\n\r\nclass Host {\r\n    testing: boolean;\r\n    url: string;\r\n    ws: string;\r\n    resHost: string;\r\n\r\n    async start(testing:boolean) {\r\n        this.testing = testing;\r\n        if (env.isDevelopment === true) {\r\n            await this.tryLocal();\r\n        }\r\n        let host = this.getCenterHost();\r\n        this.url = centerUrlFromHost(host);\r\n        this.ws = centerWsFromHost(host);\r\n        this.resHost = this.getResHost();\r\n    }\r\n\r\n    private debugHostUrl(host:string) {return `http://${host}/hello`}\r\n    private async tryLocal() {\r\n        let promises:PromiseLike<any>[] = [];\r\n        let hostArr:string[] = [];\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            let {value} = hostValue;\r\n            if (hostArr.findIndex(v => v === value) < 0) hostArr.push(value);\r\n        }\r\n\r\n        for (let host of hostArr) {\r\n            let fetchUrl = this.debugHostUrl(host);\r\n            promises.push(localCheck(fetchUrl));\r\n        }\r\n        let results = await Promise.all(promises);\r\n        let len = hostArr.length;\r\n        for (let i=0; i<len; i++) {\r\n            let local = results[i];\r\n            let host = hostArr[i];\r\n            for (let j in hosts) {\r\n                let hostValue = hosts[j];\r\n                if (hostValue.value === host) {\r\n                    hostValue.local = local;\r\n                }\r\n            }\r\n        }\r\n        /*\r\n        let p = 0;\r\n        for (let i in hosts) {\r\n            let hostValue = hosts[i];\r\n            hostValue.local = results[p];\r\n            ++p;\r\n        }\r\n        */\r\n    }\r\n\r\n    private getCenterHost():string {\r\n        let {value, local} = hosts.centerhost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return centerHost;\r\n    }\r\n\r\n    private getResHost():string {\r\n        let {value, local} = hosts.reshost;\r\n        let hash = document.location.hash;\r\n        if (hash.includes('sheet_debug') === true) {\r\n            return value;\r\n        }\r\n        if (env.isDevelopment === true) {\r\n            if (local === true) return value;\r\n        }\r\n        return resHost;\r\n    }\r\n\r\n    getUrlOrDebug(url:string, debugHost:string = 'uqhost'):string {\r\n        if (env.isDevelopment === false) return url;\r\n        let host = hosts[debugHost];\r\n        if (host === undefined) return url;\r\n        let {value, local} = host;\r\n        if (local === false) return url;\r\n        return `http://${value}/`;\r\n    }\r\n    getUrlOrTest(db:string, url:string, urlTest:string):string {\r\n        let path:string;\r\n        if (this.testing === true) {\r\n            if (urlTest !== '-') url = urlTest;\r\n            path = 'uq/test/' + db + '/';\r\n        }\r\n        else {\r\n            path = 'uq/prod/' + db + '/';\r\n        }\r\n        url = this.getUrlOrDebug(url);\r\n        return url + path;\r\n    }\r\n\r\n    async localCheck(urlDebug: string):Promise<boolean> {\r\n        return await localCheck(urlDebug);\r\n    }\r\n}\r\n\r\nexport const host:Host = new Host();\r\n\r\n// 因为测试的都是局域网服务器，甚至本机服务器，所以一秒足够了\r\n// 网上找了上面的fetch timeout代码。\r\n// 尽管timeout了，fetch仍然继续，没有cancel\r\n\r\n// 实际上，一秒钟不够。web服务器会自动停。重启的时候，可能会比较长时间。也许两秒甚至更多。\r\n//const timeout = 2000;\r\nconst timeout = 200;\r\n\r\nfunction fetchLocalCheck(url:string):Promise<any> {\r\n    return new Promise((resolve, reject) => {\r\n      fetch(url, fetchOptions as any)\r\n      .then(v => {\r\n          v.text().then(resolve).catch(reject);\r\n      })\r\n      .catch(reject);\r\n      const e = new Error(\"Connection timed out\");\r\n      env.setTimeout('fetchLocalCheck', reject, timeout, e);\r\n    });\r\n}\r\n\r\nasync function localCheck(url:string):Promise<boolean> {\r\n    try {\r\n        await fetchLocalCheck(url);\r\n        return true;\r\n    }\r\n    catch (err) {\r\n        return false;\r\n    }\r\n}\r\n\r\n/*\r\nexport interface IUqForChannel {\r\n    uq: string;\r\n    uqVersion: number;\r\n}\r\n*/","import { Entity } from './entity';\r\nimport { ActionCaller } from './caller';\r\n\r\nexport class Action extends Entity {\r\n    get typeName(): string { return 'action';}\r\n    async submit(data:object) {\r\n\t\tlet caller = new ActionSubmitCaller(this, data)\r\n\t\tlet ret = await caller.request();\r\n\t\treturn ret;\r\n    }\r\n    async submitReturns(data:object):Promise<{[ret:string]:any[]}> {\r\n       return await new SubmitReturnsCaller(this, data).request();\r\n    }\r\n    async submitConvert(data:object) {\r\n        return await new SubmitConvertCaller(this, data).request();\r\n    }\r\n}\r\n\r\nexport class ActionSubmitCaller extends ActionCaller {\r\n    get path():string {return 'action/' + this.entity.name;}\r\n    buildParams():any {return {data: this.entity.pack(this.params)}}\r\n}\r\n\r\nclass SubmitReturnsCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action/' + this.entity.name + '/returns';}\r\n    xresult(res:any):any {\r\n        let {returns} = this.entity;\r\n        let len = returns.length;\r\n        let ret:{[r:string]:any[]} = {};\r\n        for (let i=0; i<len; i++) {\r\n            let retSchema = returns[i];\r\n            ret[retSchema.name] = res[i];\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nclass SubmitConvertCaller extends ActionSubmitCaller {\r\n    get path():string {return 'action-convert/' + this.entity.name;}\r\n    buildParams():any {\r\n        return {\r\n            data: this.params\r\n        };\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-lmr.css';\r\n\r\nexport interface LMRProps {\r\n    className?: string | string[];\r\n    left?: string|JSX.Element;\r\n    right?: string|JSX.Element;\r\n    onClick?: ()=>void;\r\n}\r\n\r\n@observer\r\nexport class LMR extends React.Component<LMRProps> {\r\n    render() {\r\n        let {className, left, children, right, onClick} = this.props;\r\n        let l, r;\r\n        if (left !== undefined) l = <header>{left}</header>;\r\n        if (right !== undefined) r = <footer>{right}</footer>;\r\n        let cursor;\r\n        if (onClick !== undefined) cursor = 'cursor-pointer';\r\n        return <div className={classNames('va-lmr', className, cursor)} onClick={onClick}>\r\n            {l}\r\n            <div>{children}</div>\r\n            {r}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport '../../css/va-badge.css';\r\n\r\nexport interface BadgeProps {\r\n    className?: string;\r\n    badge?: string|number;\r\n    size?: 'xs' | 'sm' | 'lg';\r\n    color?: 'secondary'|'success'|'danger'|'primary'|'info'|'warning';\r\n    badgeAlign?: 'left'|'center'|'right';\r\n    badgeVertical?: 'top'|'middle'|'bottom';\r\n}\r\n\r\n@observer\r\nexport class Badge extends React.Component<BadgeProps> {\r\n    render() {\r\n        let {className, badge, size, color, badgeAlign, badgeVertical, children} = this.props;\r\n        let cn = classNames(\r\n            className,\r\n            'va-badge',\r\n            size && 'va-badge-'+size,\r\n            'va-badge-' + (color||'secondary'),\r\n            badgeAlign && 'va-badg-'+badgeAlign,\r\n            badgeVertical && 'va-badg-'+badgeVertical,\r\n        );\r\n        let b;\r\n        if (badge) b = <b>{badge}</b>;\r\n        return <div className={cn}>\r\n            {children}\r\n            {b}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface FAProps {\r\n    name: string;\r\n    className?: string;\r\n    size?: 'lg'|'2x'|'3x'|'4x'|'5x';\r\n    spin?: boolean;\r\n    fixWidth?: boolean;\r\n    border?: boolean;\r\n    pull?: 'left'|'right';\r\n    pulse?: boolean;\r\n    rotate?: 90|180|270;\r\n    flip?: 'horizontal'|'vertical';\r\n    inverse?: boolean;\r\n}\r\n\r\nexport class FA extends React.Component<FAProps> {\r\n    render() {\r\n        let {name, className, size, spin, fixWidth, border, pull, pulse, rotate, flip, inverse} = this.props;\r\n        let cn = classNames(className, 'fa',\r\n            name && ('fa-' + name),\r\n            size && 'fa-'+size,\r\n            fixWidth && 'fa-fw',\r\n            border && 'fa-border',\r\n            pull && 'fa-pull-' + pull,\r\n            spin && 'fa-spin',\r\n            pulse && 'fa-pulse',\r\n            rotate && 'fa-rotate-' + rotate,\r\n            flip && 'fa-flip-' + flip,\r\n            inverse && 'fa-inverse',\r\n        );\r\n        return <i className={cn} />\r\n    }\r\n}\r\n\r\nexport interface StackedFAProps {\r\n    className?: string;\r\n    size?: 'lg',\r\n}\r\nexport class StackedFA extends React.Component<StackedFAProps> {\r\n    render() {\r\n        let {className, size, children} = this.props;\r\n        let cn = classNames(\r\n            'fa-stack',\r\n            className,\r\n            size && 'fa-' + size);\r\n        return <span className={cn}>\r\n            {children}\r\n        </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport const Muted = (props:any) => \r\n<small className={classNames('text-muted', props.className)} style={props.style}>\r\n    {props.children}\r\n</small>;\r\n","import * as React from 'react';\r\nimport {FA} from './FA';\r\n\r\nexport interface IconTextProps {\r\n    icon: string;\r\n    iconClass?: string;\r\n    text: string;\r\n    textClass?: string;\r\n}\r\n\r\nexport class IconText extends React.Component<IconTextProps> {\r\n    render() {\r\n        let {icon, iconClass, text, textClass} = this.props;\r\n        return <div className=\"py-2\">\r\n            <FA className={iconClass} name={icon} fixWidth={true} />\r\n            <span className={textClass}>{text}</span>\r\n        </div>;\r\n    }\r\n}\r\n","export * from './Badge';\r\nexport * from './LMR';\r\nexport * from './FA';\r\nexport * from './IconText';\r\nexport * from './Muted';\r\n","import { observable } from 'mobx';\r\nimport { isNumber } from 'util';\r\nimport _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { BoxId } from './boxId';\r\nimport { TuidInner, TuidDiv } from './tuid';\r\n\r\nconst maxCacheSize = 1000;\r\n\r\nexport class IdCache {\r\n    private queue: number[] = [];               // 每次使用，都排到队头\r\n\tprivate cache = observable.map({}, {deep: false});    // 已经缓冲的\r\n\tprivate loading:boolean = false;\r\n\r\n    protected localArr:LocalArr;\r\n    protected waitingIds: number[] = [];          // 等待loading的\r\n    protected tuidInner: TuidInner;\r\n\r\n    constructor(tuidLocal: TuidInner) {\r\n        this.tuidInner = tuidLocal;\r\n        this.initLocalArr();\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    useId(id:number, defer?:boolean) {\r\n        if (!id) return;\r\n        if (isNumber(id) === false) return;\r\n        if (this.cache.has(id) === true) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n        this.tuidInner.cacheTuids(defer===true?70:20);\r\n        this.cache.set(id, id);\r\n        if (this.waitingIds.findIndex(v => v === id) >= 0) {\r\n            this.moveToHead(id);\r\n            return;\r\n        }\r\n\r\n        if (this.queue.length >= maxCacheSize) {\r\n            // 缓冲已满，先去掉最不常用的\r\n            let r = this.queue.shift();\r\n            if (r === id) {\r\n                // 如果移除的，正好是现在用的，则插入\r\n                this.queue.push(r);\r\n                return;\r\n            }\r\n\r\n            //let rKey = String(r);\r\n            if (this.cache.has(r) === true) {\r\n                // 如果移除r已经缓存\r\n                this.cache.delete(r);\r\n            }\r\n            else {\r\n                // 如果移除r还没有缓存\r\n                let index = this.waitingIds.findIndex(v => v === r);\r\n                this.waitingIds.splice(index, 1);\r\n            }\r\n        }\r\n        this.waitingIds.push(id);\r\n        this.queue.push(id);\r\n        return;\r\n    }\r\n\r\n    private moveToHead(id:number) {\r\n        let index = this.queue.findIndex(v => v === id);\r\n        this.queue.splice(index, 1);\r\n        this.queue.push(id);\r\n    }\r\n\r\n    getValue(id:number) {\r\n        return this.cache.get(id);\r\n    }\r\n\r\n    remove(id:number) {\r\n        this.cache.delete(id);\r\n        let index = this.queue.findIndex(v => v === id);\r\n\t\tthis.queue.splice(index, 1);\r\n\t\tthis.localArr.removeItem(id);\r\n    }\r\n\r\n    valueFromId(id:number|BoxId):any {\r\n        let _id:number;\r\n        switch (typeof id) {\r\n            case 'object': _id = (id as BoxId).id; break;\r\n            case 'number': _id = id as number; break;\r\n            default: return;\r\n        }\r\n        return this.getValue(_id);\r\n    }\r\n\r\n    resetCache(id:number) {\r\n        this.remove(id);\r\n        this.useId(id);\r\n    }\r\n\r\n    cacheValue(val:any):boolean {\r\n        if (val === undefined) return false;\r\n        let id = this.getIdFromObj(val);\r\n        if (id === undefined) return false;\r\n        let index = this.waitingIds.findIndex(v => v === id);\r\n        if (index>=0) this.waitingIds.splice(index, 1);\r\n        this.cache.set(id, val);\r\n        return true;\r\n    }\r\n    protected getIdFromObj(val:any) {return this.tuidInner.getIdFromObj(val)}\r\n\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n\t\tlet tuidValues = await this.loadIds();\r\n\t\tif (tuidValues === undefined) return;\r\n        this.cacheIdValues(tuidValues);\r\n    }\r\n\r\n    private cacheIdValues(tuidValues: any[]) {\r\n        if (tuidValues === undefined) return;\r\n        let tuids = this.unpackTuidIds(tuidValues);\r\n        for (let tuidValue of tuids) {\r\n            if (this.cacheValue(tuidValue) === false) continue;\r\n            this.cacheTuidFieldValues(tuidValue);\r\n        }\r\n    }\r\n    async modifyIds(ids:any[]):Promise<void> {\r\n        let tuidValues:string[] = await this.loadTuidIdsOrLocal(ids);\r\n        let localedValues = tuidValues.filter(v => {\r\n            let p = v.indexOf('\\t');\r\n            if (p<0) p = v.length;\r\n            let id = Number(v.substr(0, p));\r\n            let val = this.localArr.getItem(id);\r\n            return (val !== undefined);\r\n        });\r\n        if (localedValues.length === 0) return;\r\n        this.cacheIdValues(localedValues);\r\n    }\r\n    protected divName:string = undefined;\r\n    protected async loadIds(): Promise<any[]> {\r\n\t\tif (this.loading === true) return;\r\n\t\tthis.loading = true;\r\n\t\tlet ret = await this.loadTuidIdsOrLocal(this.waitingIds);\r\n\t\tthis.loading = false;\r\n        return ret;\r\n    }\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.tuidInner.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.tuidInner.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    async assureObj(id:number):Promise<void> {\r\n        let val = this.cache.get(id);\r\n        switch (typeof val) {\r\n            case 'object': return val;\r\n            case 'number': this.cache.set(id, id); break;\r\n        }\r\n        //let ret = await this.tuidInner.loadTuidIds(this.divName, [id]);\r\n        let ret = await this.loadTuidIdsOrLocal([id]);\r\n        await this.cacheIdValues(ret);\r\n    }\r\n\r\n    private async loadTuidIdsOrLocal(ids:number[]):Promise<string[]> {\r\n        let ret:string[] = [];        \r\n        let netIds:number[] = [];\r\n        for (let id of ids) {\r\n            let value = this.localArr.getItem(id);\r\n            //if (value === undefined)\r\n            // 值不存在或者是空字符串，重新获取\r\n            if (!value)\r\n                netIds.push(id);\r\n            else\r\n                ret.push(value);\r\n        }\r\n        let len = netIds.length;\r\n        if (len > 0) {\r\n            let netRet = await this.tuidInner.loadTuidIds(this.divName, netIds);\r\n            for (let i=0; i<len; i++) {\r\n                //有些id可能没有内容，不会返回\r\n                //let id = netIds[i]; \r\n                let row:string = netRet[i];\r\n                if (!row) continue;\r\n                let p = row.indexOf('\\t');\r\n                if (p < 0) p = row.length;\r\n                let id = Number(row.substr(0, p));\r\n                _.remove(netIds, v => v === id);\r\n                ret.push(row);\r\n                this.localArr.setItem(id, row);\r\n            }\r\n            len = netIds.length;\r\n            for (let i=0; i<len; i++) {\r\n                this.localArr.setItem(netIds[i], '');\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n}\r\n\r\nexport class IdDivCache extends IdCache {\r\n    private div: TuidDiv;\r\n    protected divName:string;\r\n\r\n    constructor(tuidLocal:TuidInner, div: TuidDiv) {\r\n        super(tuidLocal);\r\n        this.div = div;\r\n        this.divName = div.name;\r\n        this.localArr = tuidLocal.cache.arr(tuidLocal.name + '.ids.' + this.divName);\r\n    }\r\n\r\n    protected initLocalArr() {\r\n        // 这个不需要，必须去掉\r\n        // this.localArr = this.tuidInner.cache.arr(this.tuidInner.name + '.ids');\r\n    }\r\n\r\n    protected getIdFromObj(val:any) {return this.div.getIdFromObj(val)}\r\n    protected unpackTuidIds(values:string[]):any[] {\r\n        return this.div.unpackTuidIds(values);\r\n    }\r\n    protected cacheTuidFieldValues(tuidValue: any) {\r\n        this.div.cacheTuidFieldValues(tuidValue);\r\n    }\r\n\r\n    /*\r\n    async cacheIds():Promise<void> {\r\n        if (this.waitingIds.length === 0) return;\r\n        let tuidValues = await this.loadIds();\r\n        if (tuidValues !== undefined) {\r\n            let tuids = this.tuidLocal.unpackTuidIds(tuidValues);\r\n            for (let tuidValue of tuids) {\r\n                if (this.cacheValue(tuidValue) === false) continue;\r\n                this.tuidLocal.cacheTuidFieldValues(tuidValue);\r\n                this.afterCacheValue(tuidValue);\r\n            }\r\n        }\r\n    }\r\n    */\r\n}\r\n","import _ from 'lodash';\r\nimport { LocalArr } from '../../tool';\r\nimport { Entity } from '../entity';\r\nimport { UqMan, ArrFields, Field, SchemaFrom } from '../uqMan';\r\nimport { EntityCaller } from '../caller';\r\nimport { BoxId } from './boxId';\r\nimport { IdCache, IdDivCache } from './idCache';\r\n\r\nexport interface TuidSaveResult {\r\n    id: number;\r\n    inId: number;\r\n}\r\n\r\nexport abstract class Tuid extends Entity {\r\n    protected noCache: boolean;\r\n    readonly typeName:string = 'tuid';\r\n    protected idName: string;\r\n    cached: boolean;\r\n    unique: string[];\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {id} = schema;\r\n        this.idName = id;\r\n    }\r\n\r\n    buildTuidBox(): TuidBox {\r\n        return new TuidBox(this);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    stopCache():void {this.noCache = true}\r\n    abstract useId(id:number):void;\r\n    abstract boxId(id:number):BoxId;\r\n    abstract valueFromId(id:number):any;\r\n\tabstract resetCache(id:number|BoxId):void;\r\n    abstract async assureBox<T> (id:number): Promise<T>;\r\n    static equ(id1:BoxId|number, id2:BoxId|number): boolean {\r\n        if (id1 === undefined) return false;\r\n        if (id2 === undefined) return false;\r\n        if (typeof id1 === 'object') {\r\n            return id1.equ(id2);\r\n        }\r\n        if (typeof id2 === 'object') {\r\n            return id2.equ(id1);\r\n        }\r\n        return id1 === id2;\r\n    }\r\n    cacheIds() {}\r\n    async modifyIds(ids:any[]) {}\r\n    isImport = false;\r\n    abstract get hasDiv():boolean;// {return this.divs!==undefined}\r\n    abstract div(name:string):TuidDiv;\r\n    abstract async loadMain(id:number|BoxId):Promise<any>;\r\n\tabstract async load(id:number|BoxId):Promise<any>;\r\n    abstract async all():Promise<any[]>;\r\n\tabstract async save(id:number, props:any):Promise<TuidSaveResult>;\r\n\tabstract saveProp(id:number, prop:string, value:any):Promise<void>;\r\n    abstract async search(key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any>;\r\n    abstract async loadArr(arr:string, owner:number, id:number):Promise<any>;\r\n    abstract async saveArr(arr:string, owner:number, id:number, props:any):Promise<void>;\r\n    abstract async posArr(arr:string, owner:number, id:number, order:number):Promise<void>;\r\n}\r\n\r\nexport class TuidInner extends Tuid {\r\n    private divs: {[div:string]: TuidDiv};\r\n    protected cacheFields: Field[];\r\n    protected idCache: IdCache;\r\n    protected localArr:LocalArr;\r\n    constructor(uq:UqMan, name:string, typeId:number) {\r\n        super(uq, name, typeId);\r\n        this.idCache = new IdCache(this);\r\n        this.localArr = this.cache.arr(this.name + '.whole');\r\n        if (uq.newVersion === true) this.localArr.removeAll();\r\n    }\r\n\r\n    public setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        let {arrs} = schema;\r\n        if (arrs !== undefined) {\r\n            this.divs = {};\r\n            for (let arr of arrs) {\r\n                let {name} = arr;\r\n                let tuidDiv = new TuidDiv(this.uq, this, name);\r\n                this.divs[name] = tuidDiv;\r\n                tuidDiv.setSchema(arr);\r\n                tuidDiv.buildFieldsTuid();\r\n            }\r\n        }\r\n    }\r\n    \r\n    useId(id:number, defer?:boolean) {\r\n        if (this.noCache === true) return;\r\n        if (!id) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n    boxId(id:number):BoxId {\r\n        if (!id) return;\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        let {createBoxId} = this.uq;\r\n        if (!createBoxId) return {id: id} as BoxId;\r\n        return createBoxId(this, id);\r\n    }\r\n    valueFromId(id:number) {return this.idCache.getValue(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tthis.idCache.resetCache(id);\r\n\t}\r\n    async assureBox<T> (id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    cacheIds() {\r\n        this.idCache.cacheIds();\r\n        if (this.divs === undefined) return;\r\n        for (let i in this.divs) this.divs[i].cacheIds();\r\n    }\r\n    async modifyIds(ids:any[]) {\r\n        await this.idCache.modifyIds(ids);\r\n    }\r\n    cacheTuids(defer:number) {this.uq.cacheTuids(defer)}\r\n    get hasDiv():boolean {return this.divs!==undefined}\r\n    div(name:string):TuidDiv {\r\n        return this.divs && this.divs[name];\r\n    }\r\n    async loadTuidIds(divName:string, ids:number[]):Promise<any[]> {\r\n        let ret:any[] = await new IdsCaller(this, {divName:divName, ids:ids}, false).request();\r\n        if (ret.length > 0) this.cached = true;\r\n        return ret;\r\n    }\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        if (typeof id === 'object') id = id.id;\r\n        await this.idCache.assureObj(id);\r\n        return this.idCache.valueFromId(id);\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let cacheValue = this.idCache.valueFromId(id); \r\n        //if (typeof cacheValue === 'object') return cacheValue;\r\n        if (typeof id === 'object') id = id.id;\r\n        let valuesText = undefined; //this.localArr.getItem(id);\r\n        let values: any;\r\n        if (valuesText) {\r\n            values = JSON.parse(valuesText);\r\n        }\r\n        else {\r\n            values = await new GetCaller(this, id).request();\r\n            if (values !== undefined) {\r\n                // this.localArr.setItem(id, JSON.stringify(values));\r\n            }\r\n        }\r\n        if (values === undefined) return;\r\n        for (let f of this.schema.fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.uq.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            let n = f.name;\r\n            values[n] = t.boxId(values[n]);\r\n        }\r\n        this.idCache.cacheValue(values);\r\n        this.cacheTuidFieldValues(values);\r\n        return values;\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let {fields, arrs} = this.schema;\r\n        this.cacheFieldsInValue(values, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs as ArrFields[]) {\r\n                let {name, fields} = arr;\r\n                let arrValues = values[name];\r\n                if (arrValues === undefined) continue;\r\n                let tuidDiv = this.div(name);\r\n                for (let row of arrValues) {\r\n                    //row._$tuid = tuidDiv;\r\n                    //row.$owner = this.boxId(row.owner);\r\n                    tuidDiv.cacheValue(row);\r\n                    this.cacheFieldsInValue(row, fields);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    public buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields || this.fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        let ret = new SaveCaller(this, {id:id, props:props}).request();\r\n        if (id !== undefined) {\r\n            this.idCache.remove(id);\r\n            this.localArr.removeItem(id);\r\n        }\r\n        return ret;\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tnew SavePropCaller(this, {id, prop, value}).request();\r\n\t\tthis.idCache.remove(id);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        let ret: any[] = await new AllCaller(this, {}).request();\r\n        return ret;\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any[]> {\r\n        let ret:any[] = await this.searchArr(undefined, key, pageStart, pageSize);\r\n        return ret;\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        //let api = this.uqApi;\r\n        //let ret = await api.tuidSearch(this.name, undefined, owner, key, pageStart, pageSize);\r\n        let params:any = {arr:undefined, owner:owner, key:key, pageStart:pageStart, pageSize:pageSize};\r\n        let ret = await new SearchCaller(this, params).request();\r\n        let {fields} = this.schema;\r\n        for (let row of ret) {\r\n            this.cacheFieldsInValue(row, fields);\r\n        }\r\n        return ret;\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        if (id === undefined || id === 0) return;\r\n        //let api = this.uqApi;\r\n        //return await api.tuidArrGet(this.name, arr, owner, id);\r\n        return await new LoadArrCaller(this, {arr:arr, owner:owner, id:id}).request();\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any) {\r\n        //let params = _.clone(props);\r\n        //params[\"$id\"] = id;\r\n        //return await this.uqApi.tuidArrSave(this.name, arr, owner, params);\r\n        return await new SaveArrCaller(this, {arr:arr, owner:owner, id:id, props:props}).request();\r\n    }\r\n\r\n    async posArr(arr:string, owner:number, id:number, order:number) {\r\n        //return await this.uqApi.tuidArrPos(this.name, arr, owner, id, order);\r\n        return await new ArrPosCaller(this, {arr:arr, owner:owner, id:id, order:order}).request();\r\n    }\r\n}\r\n\r\nabstract class TuidCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Tuid {return this._entity as Tuid};\r\n}\r\n\r\n// 包含main字段的load id\r\n// 当前为了兼容，先调用的包含所有字段的内容\r\nclass GetCaller extends TuidCaller<number> {\r\n    method = 'GET';\r\n    get path():string {return `tuid/${this.entity.name}/${this.params}`}\r\n}\r\n\r\nclass IdsCaller extends TuidCaller<{divName:string, ids:number[]}> {\r\n    get path():string {\r\n        let {divName} = this.params;\r\n        return `tuidids/${this.entity.name}/${divName !== undefined?divName:'$'}`;\r\n    }\r\n    buildParams():any {return this.params.ids}\r\n    xresult(res:any):any {\r\n        return (res as string).split('\\n');\r\n    }\r\n}\r\n\r\n\r\nclass SaveCaller extends TuidCaller<{id:number, props:any}> {\r\n    get path():string {return `tuid/${this.entity.name}`}\r\n    buildParams():any {\r\n        let {fields, arrs} = this.entity.schema;\r\n        let {id, props} = this.params;\r\n        let params:any = {$id: id};\r\n        this.transParams(params, props, fields);\r\n        if (arrs !== undefined) {\r\n            for (let arr of arrs) {\r\n                let arrName = arr.name;\r\n                let arrParams = [];\r\n                let arrFields = arr.fields;\r\n                let arrValues = props[arrName];\r\n                if (arrValues !== undefined) {\r\n                    for (let arrValue of arrValues) {\r\n                        let row = {};\r\n                        this.transParams(row, arrValue, arrFields);\r\n                        arrParams.push(row);\r\n                    }\r\n                }\r\n                params[arrName] = arrParams;\r\n            }\r\n        }\r\n        return params;\r\n    }\r\n    private transParams(values:any, params:any, fields:Field[]) {\r\n        if (params === undefined) return;\r\n        for (let field of fields) {\r\n            let {name, tuid, type} = field;\r\n            let val = params[name];\r\n            if (tuid !== undefined) {\r\n                if (typeof val === 'object') {\r\n                    if (val !== null) val = val.id;\r\n                }\r\n            }\r\n            else {\r\n                switch (type) {\r\n                    case 'date':\r\n                        val = this.entity.buildDateParam(val); \r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                    case 'datetime':\r\n                        val = this.entity.buildDateTimeParam(val);\r\n                        //val = new Date(val).toISOString();\r\n                        //val = (val as string).replace('T', ' ');\r\n                        //val = (val as string).replace('Z', '');\r\n                        break;\r\n                }\r\n            }\r\n            values[name] = val;\r\n        }\r\n    }\r\n}\r\n\r\nclass SearchCaller extends TuidCaller<{arr:string, owner:number, key:string, pageStart:string|number, pageSize:number}> {\r\n    get path():string {return `tuids/${this.entity.name}`}\r\n}\r\n\r\nclass AllCaller extends TuidCaller<{}> {\r\n    method = 'GET';\r\n    get path():string {return `tuid-all/${this.entity.name}`}\r\n}\r\n\r\nclass LoadArrCaller extends TuidCaller<{arr:string, owner:number, id:number}> {\r\n    method = 'GET';\r\n    get path():string {\r\n        let {arr, owner, id} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/${id}`;\r\n    }\r\n}\r\nclass SavePropCaller extends TuidCaller<{id:number, prop:string, value:any}> {\r\n    get path():string {return `tuid-prop/${this.entity.name}/`;}\r\n}\r\nclass SaveArrCaller extends TuidCaller<{arr:string, owner:number, id:number, props:any}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, props} = this.params;\r\n        let params = _.clone(props);\r\n        params['$id'] = id;\r\n        return params;\r\n    }\r\n}\r\n\r\nclass ArrPosCaller extends TuidCaller<{arr:string, owner:number, id:number, order:number}> {\r\n    get path():string {\r\n        let {arr, owner} = this.params;\r\n        return `tuid-arr-pos/${this.entity.name}/${owner}/${arr}/`;\r\n    }\r\n    buildParams():any {\r\n        let {id, order} = this.params;\r\n        return { bid: id, $order: order}\r\n    }\r\n}\r\n\r\nexport class TuidImport extends Tuid {\r\n    private tuidLocal: TuidInner;\r\n\r\n    constructor(uq:UqMan, name:string, typeId:number, from: SchemaFrom) {\r\n        super(uq, name, typeId);\r\n        this.from = from;\r\n    }\r\n\r\n    setFrom(tuidLocal: TuidInner) {this.tuidLocal = tuidLocal}\r\n    \r\n    readonly from: SchemaFrom;\r\n    isImport = true;\r\n\r\n    useId(id:number) {this.tuidLocal.useId(id);}\r\n    boxId(id:number):BoxId {return this.tuidLocal.boxId(id);}\r\n    valueFromId(id:number) {return this.tuidLocal.valueFromId(id)}\r\n\tresetCache(id:number|BoxId):void {\r\n\t\tthis.tuidLocal.resetCache(id);\r\n\t}\r\n    async assureBox<T>(id:number):Promise<T> {\r\n        await this.tuidLocal.assureBox(id);\r\n\t\treturn this.tuidLocal.valueFromId(id);\r\n    }\r\n    get hasDiv():boolean {return this.tuidLocal.hasDiv}\r\n    div(name:string):TuidDiv {return this.tuidLocal.div(name)}\r\n    async loadMain(id:number|BoxId):Promise<any> {\r\n        let ret = await this.tuidLocal.loadMain(id);\r\n        return ret;\r\n    }\r\n    async load(id:number|BoxId):Promise<any> {\r\n        return await this.tuidLocal.load(id);\r\n    }\r\n    async save(id:number, props:any):Promise<TuidSaveResult> {\r\n        return await this.tuidLocal.save(id, props);\r\n\t}\r\n\tasync saveProp(id:number, prop:string, value:any):Promise<void> {\r\n\t\tawait this.tuidLocal.saveProp(id, prop, value);\r\n\t}\r\n    async all():Promise<any[]> {\r\n        return await this.tuidLocal.all();\r\n    }\r\n    async search(key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.search(key, pageStart, pageSize);\r\n    }\r\n    async searchArr(owner:number, key:string, pageStart:string|number, pageSize:number):Promise<any> {\r\n        return await this.tuidLocal.searchArr(owner, key, pageStart, pageSize);\r\n    }\r\n    async loadArr(arr:string, owner:number, id:number):Promise<any> {\r\n        return await this.tuidLocal.loadArr(arr, owner, id);\r\n    }\r\n    async saveArr(arr:string, owner:number, id:number, props:any):Promise<void> {\r\n        await this.tuidLocal.saveArr(arr, owner, id, props);\r\n    }\r\n    async posArr(arr:string, owner:number, id:number, order:number):Promise<void> {\r\n        await this.tuidLocal.posArr(arr, owner, id, order);\r\n    }\r\n}\r\n\r\n// field._tuid 用这个接口\r\n// Tuid, TuidDiv 实现这个接口\r\nexport class TuidBox {\r\n    tuid: Tuid;\r\n    ownerField:Field = undefined;\r\n    constructor(tuid: Tuid) {\r\n        this.tuid = tuid;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.tuid.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.tuid.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.tuid.useId(id);\r\n    }\r\n    async showInfo() {\r\n        alert('showInfo not implemented');\r\n    }\r\n}\r\n\r\n\r\nexport class TuidDiv extends TuidInner /* Entity*/ {\r\n    readonly typeName:string = 'div';\r\n    protected cacheFields: Field[];\r\n    protected tuid: TuidInner;\r\n    protected idName: string;\r\n    protected idCache: IdDivCache;\r\n\r\n    //ui: React.StatelessComponent<any>;\r\n    //res: any;\r\n\r\n    constructor(uq: UqMan, tuid: TuidInner, name: string) {\r\n        super(uq, name, 0);\r\n        this.tuid = tuid;\r\n        this.idName = 'id';\r\n        this.idCache = new IdDivCache(tuid, this);\r\n    }\r\n\r\n    get owner() {return this.tuid}\r\n\r\n    /*\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.buildFieldsTuid();\r\n    }*/\r\n\r\n    /*\r\n    setUIRes(ui:any, res:any) {\r\n        this.ui = ui && ui.content;\r\n        this.res = res;\r\n    }\r\n    */\r\n\r\n    buildFieldsTuid() {\r\n        super.buildFieldsTuid();\r\n        let {mainFields} = this.schema;\r\n        if (mainFields === undefined) debugger;\r\n        this.uq.buildFieldTuid(this.cacheFields = mainFields);\r\n    }\r\n\r\n    buildTuidDivBox(ownerField: Field): TuidBoxDiv {\r\n        return new TuidBoxDiv(this.tuid, this, ownerField);\r\n    }\r\n\r\n    getIdFromObj(obj:any):number {return obj[this.idName]}\r\n    cacheValue(value:any):void {\r\n        this.idCache.cacheValue(value);\r\n    }\r\n\r\n    useId(id:number, defer?:boolean):void {\r\n        if (this.noCache === true) return;\r\n        this.idCache.useId(id, defer);\r\n    }\r\n\r\n    /*\r\n    boxId(id:number):BoxId {\r\n        if (typeof id === 'object') return id;\r\n        this.useId(id);\r\n        //return new BoxDivId(this.tuid, this, id);\r\n        return this.tuid.boxDivId(this, id);\r\n    }\r\n    */\r\n    valueFromId(id:number):any {\r\n        return this.idCache.getValue(id)\r\n    }\r\n\r\n    async assureBox<T>(id:number):Promise<T> {\r\n\t\tawait this.idCache.assureObj(id);\r\n\t\treturn this.idCache.getValue(id);\r\n    }\r\n\r\n    async cacheIds() {\r\n        await this.idCache.cacheIds();\r\n    }\r\n\r\n    cacheTuidFieldValues(values:any) {\r\n        let fields = this.schema.fields;\r\n        this.cacheFieldsInValue(values, fields);\r\n    }\r\n\r\n    unpackTuidIds(values:string[]):any[] {\r\n        return this.unpackTuidIdsOfFields(values, this.cacheFields);\r\n    }\r\n}\r\n\r\nexport class TuidBoxDiv extends TuidBox {\r\n    ownerField: Field;\r\n    private div: TuidDiv;\r\n    constructor(tuid: Tuid, div: TuidDiv, ownerField: Field) {\r\n        super(tuid);\r\n        this.div = div;\r\n        this.ownerField = ownerField;\r\n    }\r\n\r\n    boxId(id:number):BoxId {\r\n        return this.div.boxId(id);\r\n    }\r\n    getIdFromObj(obj:any):number {\r\n        return this.div.getIdFromObj(obj);\r\n    }\r\n    useId(id:number):void {\r\n        return this.div.useId(id);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\n\r\nclass _LocalStorage {\r\n    getItem(key:string) {\r\n        return localStorage.getItem(key)\r\n    }\r\n    setItem(key:string, value:string) {\r\n        localStorage.setItem(key, value);\r\n    }\r\n    removeItem(key:string) {\r\n        localStorage.removeItem(key);\r\n    }\r\n}\r\n\r\nconst __ls = new _LocalStorage(); // new Ls;\r\n\r\nexport class LocalCache {\r\n    private readonly local: Local;\r\n    //private value: T;\r\n    readonly key: string|number;\r\n\r\n    constructor(local:Local, key:string|number) {\r\n        this.local = local;\r\n        this.key = key;\r\n    }\r\n    get():any {\r\n        try {\r\n            // 下面缓冲的内容不能有，可能会被修改，造成circular引用\r\n            //if (this.value !== undefined) return this.value;\r\n            let text = this.local.getItem(this.key);\r\n            if (text === null) return;\r\n            if (text === undefined) return undefined;\r\n            //return this.value = \r\n            return JSON.parse(text);\r\n        }\r\n        catch (err) {\r\n            this.local.removeItem(this.key);\r\n            return;\r\n        }\r\n    }\r\n    set(value:any) {\r\n\t\tlet t = JSON.stringify(value, (key, value) => {\r\n\t\t\tif (key !== '_tuid') return value;\r\n\t\t});\r\n\t\tthis.local.setItem(this.key, t);\r\n    }\r\n    remove(local?:Local) {\r\n        if (local === undefined) {\r\n            this.local.removeItem(this.key);\r\n        }\r\n        else {\r\n            this.local.removeLocal(local);\r\n        }\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        return this.local.child(key);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        return this.local.arr(key);\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        return this.local.map(key);\r\n    }\r\n}\r\n\r\nabstract class Local {\r\n    private readonly caches: {[key:string]:LocalCache};\r\n    private readonly locals: {[key:string]:Local};\r\n    protected readonly name: string;\r\n    constructor(name: string) {\r\n        this.name = name;\r\n        this.caches = {};\r\n        this.locals = {};\r\n    }\r\n\r\n    protected abstract keyForGet(key:string|number):string;\r\n    protected abstract keyForSet(key:string|number):string;\r\n    protected abstract keyForRemove(key:string|number):string;\r\n    abstract removeAll():void;\r\n    getItem(key:string|number):string {\r\n        let k = this.keyForGet(key);\r\n        if (k === undefined) return;\r\n        return __ls.getItem(k);\r\n    }\r\n    setItem(key:string|number, value: string):void {\r\n        let k = this.keyForSet(key);\r\n        __ls.setItem(k, value);\r\n    }\r\n    removeItem(key:string|number):void {\r\n        let k = this.keyForSet(key);\r\n        if (k === undefined) return;\r\n        localStorage.removeItem(k);\r\n    }\r\n    arr(key:string|number):LocalArr {\r\n        let sk = String(key);\r\n        let arr = this.locals[sk] as LocalArr;\r\n        if (arr === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = arr = new LocalArr(k);\r\n        }\r\n        return arr;\r\n    }\r\n    map(key:string|number):LocalMap {\r\n        let sk = String(key);\r\n        let map = this.locals[sk] as LocalMap;\r\n        if (map === undefined) {\r\n            let k = this.keyForSet(key);\r\n            this.locals[sk] = map = new LocalMap(k);\r\n        }\r\n        return map;\r\n    }\r\n    removeLocal(local:Local) {\r\n        let sk = local.name;\r\n        let k = this.keyForRemove(sk);\r\n        if (k === undefined) return;\r\n        let arr = this.locals[sk];\r\n        if (arr === undefined) arr = new LocalArr(k);\r\n        else this.locals[sk] = undefined;\r\n        arr.removeAll();\r\n    }\r\n    child(key:string|number):LocalCache {\r\n        let ks = String(key);\r\n        let ret = this.caches[ks];\r\n        if (ret !== undefined) return ret;\r\n        return this.caches[ks] =ret = new LocalCache(this, key);\r\n    }\r\n}\r\n\r\nconst maxArrSize = 500;\r\nexport class LocalArr extends Local {\r\n    private readonly index: number[];\r\n    constructor(name: string) {\r\n        super(name);\r\n        let index = __ls.getItem(this.name);\r\n        this.index = index === null? [] : index.split('\\n').map(v => Number(v));\r\n    }\r\n    private saveIndex() {\r\n        __ls.setItem(this.name, this.index.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i < 0) return undefined;\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) {\r\n            this.index.unshift(key);\r\n            if (this.index.length > maxArrSize) this.index.pop();\r\n        }\r\n        else {\r\n            this.index.splice(i, 1);\r\n            this.index.unshift(key)\r\n        }\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    protected keyForRemove(key:number):string {\r\n        let i = _.indexOf(this.index, key);\r\n        if (i<0) return;\r\n        this.index.splice(i, 1);\r\n        this.saveIndex();\r\n        return `${this.name}.${key}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i of this.index) {\r\n            __ls.removeItem(`${this.name}.${i}`);\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.index.splice(0);\r\n    }\r\n    item(index:number):LocalCache {\r\n        return this.child(index);\r\n    }\r\n}\r\n\r\nexport class LocalMap extends Local {\r\n    private readonly index: {[key:string]:number};\r\n    private max: number;\r\n    constructor(name: string) {\r\n        super(name);\r\n        this.max = 0;\r\n        this.index = {};\r\n        let index = __ls.getItem(this.name);\r\n        if (index !== null) {\r\n            let ls = index.split('\\n');\r\n            ls.forEach(l => {\r\n                let p = l.indexOf('\\t');\r\n                if (p<0) return;\r\n                let key = l.substr(0, p);\r\n                let i = Number(l.substr(p+1));\r\n                if (isNaN(i) === true) return;\r\n                this.index[key] = i;\r\n                if (i>this.max) this.max = i;\r\n            });\r\n        }\r\n    }\r\n    private saveIndex() {\r\n        let ls:string[] = [];\r\n        for (let k in this.index) {\r\n            let v = this.index[k];\r\n            if (v === undefined) continue;\r\n            ls.push(`${k}\\t${v}`);\r\n        }\r\n        __ls.setItem(this.name, ls.join('\\n'));\r\n    }\r\n    protected keyForGet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) return undefined;\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForSet(key:number):string {\r\n        let i = this.index[key];\r\n        if (i === undefined) {\r\n            ++this.max;\r\n            i = this.max;\r\n            this.index[key] = i;\r\n            this.saveIndex();\r\n        }\r\n        return `${this.name}.${i}`;\r\n    }\r\n    protected keyForRemove(key:string|number):string {\r\n        let i = this.index[key];\r\n        if (i===undefined) return;\r\n        this.index[key] = undefined;\r\n        this.saveIndex();\r\n        return `${this.name}.${i}`;\r\n    }\r\n    removeAll():void {\r\n        for (let i in this.index) {\r\n            __ls.removeItem(`${this.name}.${this.index[i]}`);\r\n            this.index[i] = undefined;\r\n        }\r\n        __ls.removeItem(this.name);\r\n        this.max = 0;\r\n    }\r\n    item(key:string):LocalCache {\r\n        return this.child(key);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { BoxId } from './boxId';\r\nimport { Tuid } from './tuid';\r\nimport { observer } from 'mobx-react';\r\n\r\nconst TuidContent = (tuidName:string, values:any, x?:any) => {\r\n    return <>{tuidName}: {uqStringify(values)}</>;\r\n};\r\n\r\nexport function uqStringify(values: any): string {\r\n    let s = '{';\r\n    if (values === undefined) return 'undefined';\r\n    for (let i in values) {\r\n        let v = values[i];\r\n        s += i + ': ';\r\n        if (v === undefined) {\r\n            s += 'undefined';\r\n        }\r\n        else if (v === null) {\r\n            s += 'null';\r\n        }\r\n        else {\r\n            switch (typeof v) {\r\n                default:\r\n                    s += v;\r\n                    break;\r\n                case 'function':\r\n                    s += 'function';\r\n                    break;\r\n                case 'object':\r\n                    s += '{obj}';\r\n                    break;\r\n            }\r\n        }\r\n        s += ', ';\r\n    }\r\n    return s + '}';\r\n}\r\n\r\nexport class ReactBoxId implements BoxId {\r\n    readonly id: number;\r\n    protected tuid: Tuid;\r\n    protected ui: (values:any) => JSX.Element;\r\n    readonly isUndefined:boolean;\r\n    constructor(id: number, tuid: Tuid, ui: (values:any) => JSX.Element) {\r\n        this.id = Number(id);\r\n        this.tuid = tuid;\r\n        this.ui = ui;\r\n        this.isUndefined = (this.tuid === undefined);\r\n    }\r\n\r\n    get obj():any {\r\n        return this.tuid.valueFromId(this.id);\r\n    }\r\n\r\n    equ(id:BoxId|number): boolean {\r\n        if (id === undefined || id === null) return false;\r\n        if (typeof id === 'object') return this.id === id.id;\r\n        return this.id === id;\r\n    }\r\n\r\n    render(ui:TvTemplet, x:any):JSX.Element {\r\n        if (this.id === undefined || this.id === null || isNaN(this.id) === true) return;\r\n        let boxName = this.boxName; // this.tuid.name;\r\n        let val = this.obj; // this.tuid.valueFromId(this.id);\r\n        if (this.isUndefined === true) {\r\n            if (ui !== undefined) return ui(val, x);\r\n            return TuidContent(boxName, val, x);\r\n        }\r\n        switch (typeof val) {\r\n            case 'undefined':\r\n                return <span className=\"text-black-50\">{boxName} undefined</span>;\r\n            case 'number':\r\n                return <span className=\"text-light\">{boxName} {this.id}</span>;\r\n        }\r\n        if (ui === undefined) {\r\n            ui = this.ui;\r\n        }\r\n        if (ui !== undefined) {\r\n            if (typeof ui !== 'function') {\r\n                ui = (ui as any).content;\r\n            }\r\n            if (ui !== undefined) {\r\n                let ret = ui(val/*, this.tuidUR.res*/);\r\n                if (ret !== undefined) return ret;\r\n                return <span className=\"text-danger\">{boxName} {this.id}</span>;\r\n            }\r\n        }\r\n\r\n        return TuidContent(boxName, val);\r\n    }\r\n\r\n    get boxName():string {return this.tuid.name}\r\n    // ui(): TvTemplet {return this.tuid.ui}\r\n    // res(): any {return this.tuid.res}\r\n\r\n    async assure(): Promise<BoxId> {\r\n        await this.tuid.assureBox(this.id);\r\n        return this;\r\n    }\r\n}\r\n\r\nfunction boxIdContent(bi: number|BoxId, ui:TvTemplet, x:any) {\r\n    let logContent:any;\r\n    let boxId:ReactBoxId = bi as ReactBoxId;\r\n    switch(typeof bi) {\r\n        case 'undefined': logContent = <>boxId undefined</>; break;\r\n        case 'number': logContent = <>id:{bi}</>; break;\r\n        default:\r\n            if (typeof boxId.render !== 'function') {\r\n                if (ui === undefined) {\r\n                    logContent = TuidContent(boxId.boxName, bi, x);\r\n                }\r\n                else {\r\n                    return ui(bi, x);\r\n                }\r\n            }\r\n            break;\r\n    }\r\n    if (logContent !== undefined) {\r\n        return <del className=\"text-danger\">{logContent}</del>;\r\n    }\r\n    return boxId.render(ui, x);\r\n}\r\n\r\nexport type TvTemplet = (values?:any, x?:any) => JSX.Element;\r\n\r\ninterface Props {\r\n    tuidValue: number|BoxId, \r\n    ui?: TvTemplet,\r\n    x?: any,\r\n    nullUI?: ()=>JSX.Element\r\n}\r\n\r\nconst Tv = observer(({tuidValue, ui, x, nullUI}:Props) => {\r\n    if (tuidValue === undefined) {\r\n        if (nullUI === undefined) return <small className=\"text-muted\">[无]</small>;\r\n        return nullUI();\r\n    }\r\n    if (tuidValue === null) {\r\n        if (nullUI === undefined) return <>[null]</>;\r\n        return nullUI();\r\n    }\r\n    let ttv = typeof tuidValue;\r\n    switch (ttv) {\r\n        default:\r\n            if (ui === undefined)\r\n                return <>{ttv}-{tuidValue}</>;\r\n            else {\r\n                let ret = ui(tuidValue, x);\r\n                if (ret !== undefined) return ret;\r\n                return <>{tuidValue}</>;\r\n            }\r\n        case 'object':\r\n            let divObj = boxIdContent(tuidValue, ui, x);\r\n            if (divObj !== undefined) return divObj;\r\n            return nullUI === undefined? <>id null</>: nullUI();\r\n        case 'number':\r\n            return <>id...{tuidValue}</>;\r\n    }\r\n});\r\n\r\nexport const tv = (tuidValue:number|BoxId, ui?:TvTemplet, x?:any, nullUI?:()=>JSX.Element):JSX.Element => {\r\n    return <Tv tuidValue={tuidValue} ui={ui} x={x} nullUI={nullUI} />;\r\n};\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nconst scrollAfter = 20; // 20ms之后，scroll执行\r\nexport class Scroller {\r\n    private el: HTMLBaseElement;\r\n    constructor(el: HTMLBaseElement) {\r\n        this.el = el;\r\n    }\r\n\r\n    scrollToTop():void {\r\n        setTimeout(() => this.el.scrollTo(0, 0), scrollAfter);\r\n    }\r\n    scrollToBottom():void {\r\n        setTimeout(() => this.el.scrollTo(0, this.el.scrollTop + this.el.offsetHeight), scrollAfter);\r\n    }\r\n}\r\n\r\nexport interface ScrollProps {\r\n    onScroll?: (e:any) => void;\r\n    onScrollTop?: (scroller: Scroller) => Promise<boolean>;\r\n\tonScrollBottom?: (scroller: Scroller) => Promise<boolean>;\r\n\tclassName?: string;\r\n}\r\ninterface ScrollViewProps extends ScrollProps {\r\n\tclassName?: string;\r\n\tstyle?: React.CSSProperties;\r\n}\r\nconst scrollTimeGap = 100;\r\nexport class ScrollView extends React.Component<ScrollViewProps, null> {\r\n    private bottomTime:number = 0;\r\n\tprivate topTime:number = 0;\r\n\tprivate div: HTMLDivElement;\r\n\r\n\tprivate refDiv = (div:HTMLDivElement) => {\r\n\t\tif (!div) {\r\n\t\t\tif (this.div) {\r\n\t\t\t\tthis.div.removeEventListener('resize', this.onResize)\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.div = div;\r\n\t\tthis.div.addEventListener('resize', this.onResize);\r\n\t}\r\n\r\n\tprivate onResize = (ev:UIEvent) => {\r\n\t\tconsole.error('div resize');\r\n\t};\r\n\r\n    private onScroll = async (e:any) => {\r\n        let {onScroll, onScrollTop, onScrollBottom} = this.props;\r\n        if (onScroll) this.props.onScroll(e);\r\n        let el = e.target as HTMLBaseElement;\r\n        let scroller = new Scroller(el);\r\n        if (el.scrollTop < 30) {\r\n            if (onScrollTop !== undefined) {\r\n                let topTime = new Date().getTime();\r\n                if (topTime-this.topTime > scrollTimeGap) {\r\n                    this.topTime = topTime;\r\n\t\t\t\t\tonScrollTop(scroller).then(ret => {\r\n\t\t\t\t\t\t // has more\r\n\t\t\t\t\t\tif (ret === true) {\r\n\t\t\t\t\t\t\tlet sh = el.scrollHeight;\r\n\t\t\t\t\t\t\tlet top = 200;\r\n\t\t\t\t\t\t\tif (top > sh) top = sh;\r\n\t\t\t\t\t\t\tel.scrollTop = top;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n                }\r\n            }\r\n        }\r\n        if (el.scrollTop + el.offsetHeight > el.scrollHeight - 30) {\r\n            //this.eachChild(this, 'bottom');\r\n            if (onScrollBottom !== undefined) {\r\n                let bottomTime = new Date().getTime();\r\n                if (bottomTime - this.bottomTime > scrollTimeGap) {\r\n                    this.bottomTime = bottomTime;\r\n                    onScrollBottom(scroller);\r\n                }\r\n            }\r\n        }\r\n    }\r\n    private eachChild(c:any, direct:'top'|'bottom') {\r\n        let { props } = c;\r\n        if (props === undefined)\r\n            return;\r\n        let { children } = props;\r\n        if (children === undefined)\r\n            return;\r\n        React.Children.forEach(children, (child, index) => {\r\n            let {_$scroll} = child as any;\r\n            if (_$scroll) _$scroll(direct);\r\n            console.log(child.toString());\r\n            this.eachChild(child, direct);\r\n        });\r\n\t}\r\n\t\r\n    render() {\r\n\t\tlet {className, style} = this.props;\r\n\t\treturn <div ref={this.refDiv} className={classNames('tv-page')}\r\n\t\t\tonScroll={this.onScroll} style={style}>\r\n\t\t\t<article data-a='tab' className={className}>\r\n\t\t\t\t{this.props.children}\r\n\t\t\t</article>\r\n\t\t</div>;\r\n    }\r\n}\r\n\r\n","import * as React from 'react';\r\n\r\nexport function Loading() {\r\n    return <div className=\"d-flex h-100 align-items-center justify-content-center\">\r\n        <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />\r\n    </div>;\r\n}\r\n","import { LocalMap } from './localDb';\r\n\r\nconst testingTags:string[] = ['/test', '/test/', '-test', '-test/'];\r\nfunction isTesting():boolean {\r\n    let {pathname} = document.location;\r\n    let pn = pathname.toLowerCase();\r\n    for (let item of testingTags) {\r\n        if (pn.endsWith(item) === true) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nexport const env = (function () {\r\n    let testing = isTesting();\r\n    let localDb = new LocalMap(testing===true? '$$':'$');\r\n    return {\r\n        testing: testing,\r\n        isDevelopment: process.env.NODE_ENV === 'development',\r\n        localDb: localDb,\r\n        setTimeout: (tag:string, callback: (...args: any[]) => void, ms: number, ...args: any[]):NodeJS.Timer => {\r\n            //if (tag !== undefined) console.log('setTimeout ' + tag);\r\n            return global.setTimeout(callback, ms, ...args);\r\n        },\r\n        clearTimeout: (handle:NodeJS.Timer):void => {\r\n            global.clearTimeout(handle);\r\n        },\r\n        setInterval: (callback: (...args: any[]) => void, ms: number, ...args: any[]): NodeJS.Timer => {\r\n            return global.setInterval(callback, ms, ...args);\r\n        },\r\n        clearInterval: (handle:NodeJS.Timer):void => {\r\n            global.clearInterval(handle);\r\n        }\r\n    }\r\n}());\r\n","\r\nexport * from './boxId';\r\nexport { Tuid, TuidImport, TuidInner, TuidDiv, TuidBox } from './tuid';\r\nexport { TuidsCache } from './tuidsCache';\r\nexport { tv, ReactBoxId, uqStringify } from './reactBoxId';","import {HttpChannel} from './httpChannel';\r\nimport { Caller } from './caller';\r\n\r\nexport async function refetchApi(channel:HttpChannel, url:string, options:any, \r\n    resolve:(values:any)=>any, reject:(reason:any)=>void)\r\n{\r\n    await channel.fetch(url, options, false, resolve, reject);\r\n}\r\n\r\nexport abstract class ApiBase {\r\n    protected token: string;\r\n    protected path: string;\r\n    protected showWaiting: boolean;\r\n\r\n    constructor(path: string, showWaiting: boolean) {\r\n        this.path = path || '';\r\n        this.showWaiting = showWaiting;\r\n    }\r\n\r\n    protected abstract async getHttpChannel(): Promise<HttpChannel>;\r\n\r\n    async xcall(caller:Caller<any>):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.xcall(this.path, caller);\r\n    }\r\n\r\n    public async call(url:string, method:string, body:any):Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.callFetch(url, method, body);\r\n    }\r\n\r\n    public async get(path:string, params:any=undefined): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.get(this.path + path, params);\r\n    }\r\n\r\n    public async post(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.post(this.path + path, params);\r\n    }\r\n\r\n    public async put(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.put(this.path + path, params);\r\n    }\r\n\r\n    public async delete(path:string, params:any): Promise<any> {\r\n        let channel = await this.getHttpChannel();\r\n        return await channel.delete(this.path + path, params);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { UiImageItem } from '../schema';\r\nimport { ImageUploader } from '../resUploader';\r\nimport { nav } from '../nav';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class ImageItemEdit extends ItemEdit {\r\n    get uiItem(): UiImageItem {return this._uiItem as UiImageItem}\r\n    @observable private resId: string;\r\n\r\n    protected async internalStart():Promise<any> {\r\n        this.resId = this.value;\r\n        return new Promise<any>((resolve, reject) => {\r\n            nav.push(React.createElement(this.page, {resolve:resolve, reject:reject}), ()=>reject());\r\n        });\r\n    }\r\n\r\n    /*\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let ret = await this.resUploader.upload();\r\n        if (ret === null) {\r\n            this.overSize = true;\r\n            env.setTimeout('imageItemEdit upload', () => this.overSize = false, 3000);\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.value);\r\n    }\r\n    */\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let size:any = this.uiItem && this.uiItem.size;\r\n\r\n        /*\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>resolve(this.resId)}>保存</button>;\r\n        let overSize:any;\r\n        if (this.overSize === true) {\r\n            overSize = <div className=\"text-danger\">\r\n                <i className=\"fa fa-times-circle\" /> 图片文件大小超过2M，无法上传\r\n            </div>;\r\n        }\r\n        */\r\n        return <ImageUploader \r\n            label={'更改' + this.label}\r\n            id={this.resId}\r\n            size={size}\r\n            onSaved={(resId):Promise<void>=>{resolve(resId); return;}} />;\r\n        /*\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div>上传图片：</div>\r\n                    <div className=\"my-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} multiple={false} maxSize={2048} />\r\n                    </div>\r\n                    <div>\r\n                        <button className=\"btn btn-primary\" onClick={this.upload}>上传</button>\r\n                    </div>\r\n                </div>\r\n                {overSize}\r\n                <div className=\"small muted my-4\">支持JPG、GIF、PNG格式图片，不超过2M。</div>\r\n                <div className=\"d-flex\">\r\n                    <div className=\"w-12c h-12c mr-4\"\r\n                        style={{border: '1px dotted gray', padding: '8px'}}>\r\n                        <Image className=\"w-100 h-100\" src={this.resId} />\r\n                    </div>\r\n                    <div>\r\n                        <div className=\"small\">图片预览</div>\r\n                        <Image className=\"w-4c h-4c mt-3\" src={this.resId} />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n        */\r\n    })\r\n}\r\n","//import _ from 'lodash';\r\nimport { KeyValueRes, Res } from './res';\r\n\r\nexport interface FormRes extends KeyValueRes {\r\n    required: string;\r\n    number: string;\r\n    integer: string;\r\n    min: string;\r\n    max: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const formRes:Res<FormRes> = {\r\n    _: {\r\n        required: 'required',\r\n        number: 'not valid number',\r\n        integer: 'not valid integer',\r\n        min: 'min value is ${min}',\r\n        max: 'max value is ${max}',\r\n    },\r\n    zh: {\r\n        _: {\r\n            required: '必须填',\r\n            number: '需要数字',\r\n            integer: '需要整数',\r\n            min: '不能小于${min}',\r\n            max: '不能大于${max}',\r\n        }\r\n    },\r\n}\r\n","import { KeyValueRes, Res } from './res';\r\n\r\nexport interface ListRes extends KeyValueRes {\r\n    none: string;\r\n}\r\n\r\n/*eslint no-template-curly-in-string: 0*/\r\nexport const listRes:Res<ListRes> = {\r\n    _: {\r\n        none: '[none]',\r\n    },\r\n    zh: {\r\n        _: {\r\n            none: '[无]',\r\n        }\r\n    },\r\n}\r\n","import { Res } from '../res';\r\n\r\nexport interface LoginRes {\r\n    a: string;\r\n}\r\n\r\nexport const loginRes: Res<LoginRes> = {\r\n    _: {\r\n        a: 'd',\r\n    }\r\n}\r\n","import { Res } from '../res';\r\n\r\nexport interface RegisterRes {\r\n    a: string;\r\n}\r\n\r\nexport const registerRes: Res<RegisterRes> = {\r\n    _: {\r\n        a: 'd',\r\n    }\r\n}\r\n","export * from './res';\r\nexport * from './formRes';\r\nexport * from './listRes';\r\nexport * from './entry';\r\n\r\n/*\r\nexport const res = {\r\n    _: {\r\n        form: {\r\n            required: 'required',\r\n            number: 'not valid number',\r\n            integer: 'not valid integer',\r\n            min: 'min value is ',\r\n            max: 'max value is ',\r\n        },\r\n        entry: {\r\n            \r\n        }\r\n    },\r\n    zh: {\r\n        _: {\r\n            form: {\r\n                required: '必须填',\r\n                number: '需要数字',\r\n                integer: '需要整数',\r\n                min: '不能小于',\r\n                max: '不能大于',\r\n            },\r\n            entry: {\r\n\r\n            }\r\n        }\r\n    }\r\n}\r\n*/","import _ from 'lodash';\r\nimport {observable, IObservableArray, computed} from 'mobx';\r\n\r\nexport abstract class PageItems<T> {\r\n    constructor(itemObservable:boolean = false) {\r\n        this._items = observable.array<T>([], {deep:itemObservable});\r\n    }\r\n\tprivate isFirst: boolean = true;\r\n\tprivate pageItemAction: (item:T, results:{[name:string]:any[]}) => void;\r\n\tprivate itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T;\r\n    @observable loading: boolean = false;\r\n    @observable private beforeLoad: boolean = true;\r\n    @observable protected loaded: boolean = false;\r\n    protected _items:IObservableArray<T>;\r\n    @observable allLoaded: boolean = false;\r\n    @computed get items():IObservableArray<T> {\r\n        if (this.beforeLoad === true) return null;\r\n        if (this.loaded === false) return undefined;\r\n        return this._items;\r\n\t}\r\n\t\r\n\tsetEachPageItem(pageItemAction: (item:T, results:{[name:string]:any[]}) => void) {\r\n\t\tthis.pageItemAction = pageItemAction;\r\n\t}\r\n\r\n\tsetItemConverter(itemConverter: (item:any, queryResults:{[name:string]:any[]}) => T) {\r\n\t\tthis.itemConverter = itemConverter;\r\n\t}\r\n\r\n    @observable topDiv:string = '$$top';\r\n    @observable bottomDiv:string = '$$bottom';\r\n    scrollToTop = () => {\r\n\t\tthis.scrollIntoView(this.topDiv);\r\n\t\t//let id = '$$top'+uid();\r\n\t\t//this.topDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.topDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n    }\r\n    scrollToBottom = () => {\r\n\t\tthis.scrollIntoView(this.bottomDiv);\r\n\t\t//let id = '$$bottom'+uid();\r\n\t\t//this.bottomDiv = id;\r\n\t\t/*\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(this.bottomDiv);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t\t*/\r\n\t}\r\n\tprivate scrollIntoView(divId:string) {\r\n\t\tsetTimeout(() => {\r\n\t\t\tlet div = document.getElementById(divId);\r\n\t\t\tdiv?.scrollIntoView();\r\n\t\t}, 20);\r\n\t}\r\n\r\n    protected param: any;\r\n    protected firstSize = 100;\r\n    protected pageStart:any = undefined;\r\n    protected pageSize = 30;\r\n    protected appendPosition:'head'|'tail' = 'tail';\r\n\r\n\tprotected sortOrder:'asc'|'desc';\r\n\tprotected abstract async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}>;\r\n\tprotected getPageId(item:T):any {return;}\r\n\tprotected setPageStart(item:T) {\r\n\t\tthis.pageStart = this.getPageId(item);\r\n\t}\r\n\t\r\n\tprotected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n\t\tlet results = await this.loadResults(param, pageStart, pageSize);\r\n\t\tlet pageList = results.$page;\r\n\t\tif (this.itemConverter) {\r\n\t\t\tlet ret:T[] = [];\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = this.itemConverter(pageList[i], results);\r\n\t\t\t\tret.push(item);\r\n\t\t\t}\r\n\t\t\treturn ret;\r\n\t\t}\r\n\t\tif (this.pageItemAction !== undefined) {\r\n\t\t\tlet len = pageList.length;\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tthis.pageItemAction(pageList[i], results);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn pageList;\r\n\t}\r\n\r\n    reset() {\r\n        this.isFirst = true;\r\n        this.beforeLoad = true;\r\n        this.loaded = false;\r\n        this.param = undefined;\r\n\t\tthis.allLoaded = false;\r\n\t\tthis.pageStart = undefined;\r\n        this._items.clear();\r\n        //this.setPageStart(undefined);\r\n    }\r\n\r\n    append(item:T) {\r\n        if (this.appendPosition === 'tail')\r\n            this._items.unshift(item);\r\n        else\r\n            this._items.push(item);\r\n    }\r\n\r\n    async first(param:any):Promise<void> {\r\n        this.reset();\r\n        this.beforeLoad = false;\r\n        this.param = param;\r\n        await this.more();\r\n\t}\r\n\r\n\tprivate changing = false;\r\n\tasync attach(): Promise<void> {\r\n\t\tif (this.sortOrder === undefined) {\r\n\t\t\tconsole.error('没有定义增减序，无法attach');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet items = this._items;\r\n\t\tlet isAsc = this.sortOrder === 'asc';\r\n\t\t//let isTail:boolean, \r\n\t\tlet endItem:T;\r\n\t\tlet scrollToEnd:() => void;\r\n\t\tlet pushItem:(item:T) => void;\r\n\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t//isTail = true;\r\n\t\t\tendItem = items[0];\r\n\t\t\tscrollToEnd = this.scrollToTop;\r\n\t\t\tpushItem = (item:T) => items.unshift(item);\r\n\r\n\t\t}\r\n\t\telse {\r\n\t\t\t//isTail = false;\r\n\t\t\tlet endIndex = items.length;\r\n\t\t\tendItem = items[endIndex-1];\r\n\t\t\tscrollToEnd = this.scrollToBottom;\r\n\t\t\tpushItem = (item:T) => items.splice(endIndex, 0, item);\r\n\t\t}\r\n\t\tlet startId = this.getPageId(endItem);\r\n\t\tlet pid = undefined;\r\n\t\tlet sum = 0, max = 50;\r\n\t\tfor (;sum < max;) {\r\n\t\t\tlet ret = await this.load(this.param, pid, 3);\r\n\t\t\tlet len = ret.length;\r\n\t\t\tif (len === 0) break;\r\n\r\n\t\t\tfor (let i=0; i<len; i++) {\r\n\t\t\t\tlet item = ret[i];\r\n\t\t\t\tpid = this.getPageId(item);\r\n\t\t\t\tif (isAsc === true) {\r\n\t\t\t\t\tif (pid >= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pid <= startId) {\r\n\t\t\t\t\t\tmax = 0;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushItem(item);\r\n\t\t\t\t/*\r\n\t\t\t\tif (isTail === true) {\r\n\t\t\t\t\tthis._items.unshift(item);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis._items.push(item);\r\n\t\t\t\t}\r\n\t\t\t\t*/\r\n\t\t\t\t++sum;\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.changing = false;\r\n\t\tif (sum > 0) {\r\n\t\t\tscrollToEnd();\r\n\t\t\t/*\r\n\t\t\tif (isTail === true) this.scrollToTop();\r\n\t\t\telse this.scrollToBottom();\r\n\t\t\t*/\r\n\t\t}\r\n\t}\r\n\r\n\tasync refresh(): Promise<void> {\r\n\t\tif (this.changing === true) return;\r\n\t\tthis.changing = true;\r\n\t\tlet ret = await this.load(this.param, undefined, this.firstSize>this.pageSize? this.firstSize:this.pageSize);\r\n\t\tthis._items.clear();\r\n\t\tthis.setLoaded(ret);\r\n\t\t/*\r\n\t\tfor (let i=0; i<len; i++) {\r\n\t\t\tlet item = ret[i];\r\n\t\t\tlet pid = this.getRefreshPageId(item);\r\n\t\t\tlet index = this._items.findIndex(v => this.getRefreshPageId(v) === pid);\r\n\t\t\t//let index = _.sortedIndexBy(this._items, item, v=>this.getRefreshPageId(v));\r\n\t\t\t//let oldItem = this._items[index];\r\n\t\t\t//let oid = this.getRefreshPageId(oldItem);\r\n\t\t\tif (index >= 0) {\r\n\t\t\t\t_.merge(this._items[index], item);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.splice(0, 0, item);\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.changing = false;\r\n\t}\r\n\r\n\tprotected getRefreshPageId(item:T) {\r\n\t\treturn this.getPageId(item);\r\n\t}\r\n\r\n    protected async onLoad(): Promise<void> {}\r\n    protected async onLoaded(): Promise<void> {}\r\n\r\n    async more():Promise<boolean> {\r\n        if (this.allLoaded === true) return false;\r\n\t\tif (this.loading === true) return true;\r\n\t\tif (this.changing === true) return true;\r\n\t\tthis.loading = true;\r\n\t\tthis.changing = true;\r\n        await this.onLoad();\r\n        if (this.pageStart === undefined) this.setPageStart(undefined);\r\n        let pageSize = this.pageSize + 1;\r\n        if (this.isFirst === true) {\r\n            if (this.firstSize > this.pageSize) pageSize = this.firstSize+1;\r\n        }\r\n        let ret = await this.load(\r\n                this.param, \r\n                this.pageStart,\r\n\t\t\t\tpageSize);\r\n        this.loaded = true;\r\n\t\tlet len = ret.length;\r\n        if ((this.isFirst===true && len>this.firstSize) ||\r\n            (this.isFirst===false && len>this.pageSize))\r\n        {\r\n            this.allLoaded = false;\r\n            --len;\r\n            ret.splice(len, 1);\r\n        }\r\n        else {\r\n            this.allLoaded = true;\r\n\t\t}\r\n\t\t/*\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(ret[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...ret);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...ret.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t\t*/\r\n\t\tthis.setLoaded(ret);\r\n\t\tthis.isFirst = false;\r\n\t\tthis.onLoaded();\r\n\t\tthis.changing = false;\r\n\t\tthis.loading = false;\r\n\t\treturn !this.allLoaded;\r\n\t}\r\n\t\r\n\tprivate setLoaded(data:any[]) {\r\n\t\tlet len = data.length;\r\n        if (len === 0) {\r\n\t\t\tthis.setPageStart(undefined);\r\n            this._items.clear();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.setPageStart(data[len-1]);\r\n\t\t\tif (this.appendPosition === 'tail') {\r\n\t\t\t\tthis._items.push(...data);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._items.unshift(...data.reverse());\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfindItem(item:any):T {\r\n\t\tlet pid = this.getPageId(item);\r\n\t\tlet index = _.sortedIndexBy(this._items, pid, v => this.getPageId(v));\r\n\t\tlet oldItem = this._items[index];\r\n\t\tlet oid = this.getPageId(oldItem);\r\n\t\tif (pid === oid) return oldItem;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\nimport classNames from 'classnames';\r\nimport { IVPage } from './page';\r\nimport { IObservableValue } from 'mobx/lib/internal';\r\nimport '../../css/va-tab.css';\r\nimport { ScrollView } from './scrollView';\r\n\r\nexport type TabCaption = (selected:boolean) => JSX.Element;\r\n\r\nexport interface TabProp {\r\n    name: string;\r\n    caption: TabCaption;\r\n\tcontent?: () => JSX.Element;\r\n\tpage?: IVPage;\r\n    notify?: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tisSelected?: boolean;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<boolean>;\r\n\tclassName?: string;\r\n}\r\n\r\nexport interface TabsProps {\r\n    tabs: TabProp[];\r\n    tabPosition?: 'top' | 'bottom';\r\n    size?: 'sm' | 'lg' | 'md';\r\n    tabBg?: string;\r\n    contentBg?: string;\r\n    sep?: string;\r\n    selected?: string;\r\n    borderColor?: string;\r\n    borderWidth?: string;\r\n}\r\n\r\nclass Tab {\r\n\t@observable private loaded: boolean = false;\r\n    name: string;\r\n    @observable selected: boolean;\r\n    caption: TabCaption;\r\n\tcontentBuilder: ()=>JSX.Element;\r\n\tpage: IVPage;\r\n    notify: IObservableValue<number>;\r\n    load?: () => Promise<void>;\r\n\tonShown?: () => Promise<void>;\r\n\tonScroll?: () => void;\r\n\tonScrollTop?: () => Promise<boolean>;\r\n\tonScrollBottom?: () => Promise<boolean>;\r\n\tclassName?: string;\r\n\r\n    private _content: JSX.Element;\r\n    \r\n    get content(): JSX.Element {\r\n\t\tif (this.load && this.loaded === false) return null;\r\n\t\tif (this.selected === false) return this._content;\r\n\t\tif (!this._content) {\r\n\t\t\tif (this.contentBuilder !== undefined) {\r\n\t\t\t\tthis._content = this.contentBuilder();\r\n\t\t\t}\r\n\t\t\telse if (this.page !== undefined) {\r\n\t\t\t\tthis._content = this.page.content();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis._content = <div className=\"p-5\">tab 应该定义content或者page</div>;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._content;\r\n    }\r\n\r\n    async shown() {\r\n        if (this.onShown !== undefined) {\r\n            await this.onShown();\r\n        }\r\n        if (this.load !== undefined) {\r\n\t\t\tif (this.loaded === false) {\r\n\t\t\t\tawait this.load();\r\n\t\t\t\tthis.loaded = true;\r\n\t\t\t}\r\n        }\r\n    }\r\n}\r\n\r\nexport const TabCaptionComponent = (label:string, icon:string, color:string) => <div \r\n    className={'d-flex justify-content-center align-items-center flex-column cursor-pointer ' + color}>\r\n    <div><i className={'fa fa-lg fa-' + icon} /></div>\r\n    <small>{label}</small>\r\n</div>;\r\n\r\nexport const TabCaption = TabCaptionComponent;\r\n\r\nexport class TabsView {\r\n\tprivate props: TabsProps;\r\n    private size: string;\r\n    private tabBg: string;\r\n    //private contentBg: string;\r\n    private sep: string;\r\n    @observable private selectedTab: Tab;\r\n    @observable private tabArr: Tab[];\r\n\r\n    constructor(props: TabsProps) {\r\n\t\tthis.props = props;\r\n\t\tlet {size, tabs, tabBg: tabBack, sep, selected} = props;\r\n\t\tthis.size = size || 'md';\r\n        this.tabArr = tabs.map(v => {\r\n            let tab = new Tab();\r\n            let {name, caption, content, page, notify, load, onShown, isSelected, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\ttab.name = name;\r\n\t\t\tif (isSelected === true || name === selected) {\r\n\t\t\t\tthis.selectedTab = tab;\r\n\t\t\t}\r\n\t\t\ttab.selected = false;\r\n\t\t\ttab.caption = caption;\r\n\t\t\tif (content !== undefined) {\r\n\t\t\t\ttab.contentBuilder = content;\r\n\t\t\t}\r\n\t\t\telse if (page !== undefined) {\r\n\t\t\t\ttab.page = page;\r\n\t\t\t\t//contentBuilder = () => {return page.content()};\r\n\t\t\t}\r\n            tab.notify = notify;\r\n            tab.load = load;\r\n\t\t\ttab.onShown = onShown;\r\n\t\t\ttab.onScroll = onScroll;\r\n\t\t\ttab.onScrollTop = onScrollTop;\r\n\t\t\ttab.onScrollBottom = onScrollBottom;\r\n\t\t\ttab.className = className;\r\n            return tab;\r\n        });\r\n        this.tabBg = tabBack;\r\n        //this.contentBg = contentBack;\r\n        this.sep = sep;\r\n        if (this.selectedTab === undefined) {\r\n\t\t\tthis.selectedTab = this.tabArr[0];\r\n\t\t}\r\n        this.selectedTab.selected = true;\r\n    }\r\n\r\n    tabClick = async (tab:Tab) => {\r\n\t\tif (!tab) {\r\n\t\t\ttab = this.selectedTab;\r\n\t\t\tif (tab === undefined) {\r\n\t\t\t\tif (this.tabArr === undefined) return;\r\n\t\t\t\tif (this.tabArr.length === 0) return;\r\n\t\t\t\ttab = this.tabArr[0];\r\n\t\t\t}\r\n\t\t}\r\n\r\n        this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n\t\tthis.selectedTab = tab;\r\n\t\t\r\n\t\tawait tab.shown();\r\n    }\r\n\r\n\t/*\r\n    showTab(tabName: string) {\r\n        let tab = this.tabs.find(v => v.name === tabName);\r\n        if (tab === undefined) return;\r\n        if (this.selectedTab !== undefined) this.selectedTab.selected = false;\r\n        tab.selected = true;\r\n        this.selectedTab = tab;\r\n\t}\r\n\t*/\r\n\r\n\tprivate tabs = observer(() => {\r\n        let {tabPosition, borderColor} = this.props;\r\n        let bsCur:React.CSSProperties, bsTab:React.CSSProperties\r\n        if (borderColor) {\r\n            bsCur = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderLeftWidth: 1,\r\n                borderRightWidth: 1,\r\n                borderBottomWidth: 1,\r\n            }\r\n            bsTab = {\r\n                borderColor: borderColor,\r\n                borderStyle: 'solid',\r\n                borderTopWidth: 1,\r\n                borderBottomWidth: 1,\r\n                borderLeftWidth: 0,\r\n                borderRightWidth: 0,\r\n            }\r\n            if (tabPosition === 'top') {\r\n                bsCur.borderBottomWidth = 0;\r\n                bsCur.borderTopLeftRadius = 10;\r\n                bsCur.borderTopRightRadius = 10;\r\n                bsTab.borderTopWidth = 0;\r\n            }\r\n            else {\r\n                bsCur.borderTopWidth = 0;\r\n                bsCur.borderBottomLeftRadius = 10;\r\n                bsCur.borderBottomRightRadius = 10;\r\n                bsTab.borderBottomWidth = 0;\r\n            }\r\n        }\r\n\t\tlet cn = classNames('tv-tabs', this.tabBg, this.sep, 'tv-tabs-' + this.size);\r\n\t\tlet tabs = <div className={cn}>\r\n            {this.tabArr.map((v,index) => {\r\n                let {selected, caption, notify} = v;\r\n                let notifyCircle:any;\r\n                if (notify !== undefined) {\r\n                    let num = notify.get();\r\n                    if (num !== undefined) {\r\n                        if (num > 0) notifyCircle = <u>{num>99?'99+':num}</u>;\r\n                        else if (num < 0) notifyCircle = <u className=\"dot\" />;\r\n                    }\r\n                }\r\n                return <div key={index} onClick={()=>this.tabClick(v)} style={selected===true? bsCur:bsTab}>\r\n\t\t\t\t\t<div>\r\n\t\t\t\t\t{notifyCircle}\r\n\t\t\t\t\t{caption(selected)}\r\n\t\t\t\t\t</div>\r\n                </div>\r\n            })}\r\n\t\t</div>;\r\n\t\treturn tabs;\r\n\t});\r\n\r\n\tcontent = observer(() => {\r\n\t\tlet displayNone:React.CSSProperties = {visibility: 'hidden'};\r\n\t\treturn <>\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet {tabPosition} = this.props;\r\n\t\t\t\tlet {content, page, onScroll, onScrollTop, onScrollBottom, className} = v;\r\n\t\t\t\tlet tabs = React.createElement(this.tabs);\r\n\t\t\t\tlet pageHeader:any, pageFooter:any;\r\n\t\t\t\tif (page !== undefined) {\r\n\t\t\t\t\tpageHeader = page.header();\r\n\t\t\t\t\tpageFooter = page.footer();\r\n\t\t\t\t}\r\n\t\t\t\tlet header:any, footer:any;\r\n\t\t\t\tlet visibility:React.CSSProperties = {visibility:'hidden'};\r\n\t\t\t\tif (tabPosition === 'top') {\r\n\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t<section className=\"tv-page-header\">\r\n\t\t\t\t\t\t\t<header>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t<header style={visibility}>{tabs}{pageHeader}</header>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t\tif (pageFooter !== undefined) {\r\n\t\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t\t<footer style={visibility}>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t<section className=\"tv-page-footer\">\r\n\t\t\t\t\t\t\t\t<footer>{pageFooter}</footer>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (pageHeader !== undefined) {\r\n\t\t\t\t\t\theader = <>\r\n\t\t\t\t\t\t\t<section className='tv-page-header'>\r\n\t\t\t\t\t\t\t\t<header>{pageHeader}</header>\r\n\t\t\t\t\t\t\t</section>\r\n\t\t\t\t\t\t\t<header style={visibility}>{pageHeader}</header>\r\n\t\t\t\t\t\t</>;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfooter = <>\r\n\t\t\t\t\t\t<footer style={visibility}>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t<section className='tv-page-footer'>\r\n\t\t\t\t\t\t\t<footer>{pageFooter}{tabs}</footer>\r\n\t\t\t\t\t\t</section>\r\n\t\t\t\t\t</>;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = displayNone;\r\n\t\t\t\treturn <ScrollView key={index} className={className}\r\n\t\t\t\t\tstyle={style}\r\n\t\t\t\t\tonScroll={onScroll} onScrollTop={onScrollTop} onScrollBottom={onScrollBottom}>\r\n\t\t\t\t\t{header}\r\n\t\t\t\t\t{content}\r\n\t\t\t\t\t{footer}\r\n\t\t\t\t</ScrollView>;\r\n\t\t\t})}\r\n\t\t</>;\r\n\t});\r\n\r\n    render() {\r\n\t\tlet {tabPosition} = this.props;\r\n\t\tlet tabs = <this.tabs />;\r\n\t\tlet header:any, footer:any;\r\n\t\tlet visibility:React.CSSProperties = {display:'none'};\r\n\t\tif (tabPosition === 'top') {\r\n\t\t\theader = <header>{tabs}</header>;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tfooter = <footer>{tabs}</footer>;\r\n\t\t}\r\n\t\treturn <>\r\n\t\t\t{header}\r\n\t\t\t{this.tabArr.map((v,index) => {\r\n\t\t\t\tlet style:React.CSSProperties;\r\n\t\t\t\tif (v.selected===false) style = visibility;\r\n\t\t\t\treturn <div key={index} className={classNames(v.className)} style={style}>\r\n\t\t\t\t\t{v.content}\r\n\t\t\t\t</div>;\r\n\t\t\t})}\r\n\t\t\t{footer}\r\n\t\t</>;\r\n    }\r\n};\r\n\r\n@observer export class Tabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn this.tabsView.render();\r\n    }\r\n};\r\n\r\n@observer export class RootTabs extends React.Component<TabsProps> {\r\n\tprivate readonly tabsView: TabsView;\r\n    constructor(props: TabsProps) {\r\n\t\tsuper(props);\r\n\t\tthis.tabsView = new TabsView(props);\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.tabsView.tabClick(undefined);\r\n\t\t}, 100);\r\n    }\r\n\r\n    render() {\r\n\t\treturn React.createElement(this.tabsView.content);\r\n    }\r\n};\r\n","import * as React from 'react';\r\nimport { nav } from './nav';\r\nimport { Loading } from './loading';\r\nimport { Image as ImageControl } from './image';\r\nimport { Page } from './page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { LMR } from './simple';\r\n\r\nexport interface ResUploaderProps {\r\n    className?: string;\r\n    label?: string;\r\n    multiple?: boolean;\r\n    maxSize?: number;\r\n    onFilesChange?: (evt: React.ChangeEvent<HTMLInputElement>) => void;\r\n}\r\n\r\n@observer\r\nexport class ResUploader extends React.Component<ResUploaderProps> {\r\n    private fileInput: HTMLInputElement;\r\n    @observable private fileName: string;\r\n\r\n    buildFormData():FormData {\r\n        let {maxSize} = this.props;\r\n        if (maxSize === undefined || maxSize <= 0) \r\n            maxSize = 100000000000;\r\n        else\r\n            maxSize = maxSize * 1024;\r\n        var files:FileList = this.fileInput.files;\r\n        var data = new FormData();\r\n        let len = files.length;\r\n        for (let i=0; i<len; i++) {\r\n            let file = files[i];\r\n            if (file.size > maxSize) return null;\r\n            data.append('files[]', file, file.name);\r\n        }\r\n    }\r\n\r\n    getFile0(): File {\r\n        return this.fileInput.files[0];\r\n    }\r\n\r\n    upload = async (formData?: FormData):Promise<string|{error:any}> => {\r\n        let resUrl = nav.resUrl + 'upload';\r\n        if (!formData) formData = this.buildFormData();\r\n        try {\r\n            nav.startWait();\r\n            let headers = new Headers();\r\n            headers.append('Access-Control-Allow-Origin', '*');\r\n            //2019-12-18：因为 vivo按oppo某些版本不支持，暂时先不要 \r\n            //let abortController = new AbortController();\r\n            let res = await fetch(resUrl, {\r\n                method: \"POST\",\r\n                body: formData,\r\n                headers: headers,\r\n                //signal: abortController.signal,\r\n            });\r\n            let json = await res.json();\r\n            return ':' + json.res.id;\r\n        }\r\n        catch (err) {\r\n            console.error('%s %s', resUrl, err);\r\n            return {error:err};\r\n        }\r\n        finally {\r\n            nav.endWait();\r\n        }\r\n    }\r\n\r\n    private onFilesChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let {onFilesChange} = this.props;\r\n        if (onFilesChange) onFilesChange(evt);\r\n        let files = evt.target.files;\r\n        let len = files.length;\r\n        let names:string[] = [];\r\n        for (let i=0; i<len; i++) {\r\n            names.push(files.item(i).name);\r\n        }\r\n        this.fileName = names.join(', ');\r\n    }\r\n\r\n    render() {\r\n        let {className, multiple, label} = this.props;\r\n        return <div>\r\n                <label className=\"btn btn-outline-success\">\r\n                    {label || '选择文件'} \r\n                    <input \r\n                        className={className}\r\n                        ref={t=>this.fileInput=t} \r\n                        onChange={this.onFilesChange}\r\n                        type='file' name='file' \r\n                        multiple={multiple} style={{display:'none'}} />\r\n                </label>\r\n                &nbsp;\r\n                {this.fileName}\r\n            </div>\r\n    }\r\n}\r\n\r\nfunction formatSize(size:number, pointLength:number=2, units?:string[]) {\r\n    var unit;\r\n    units = units || [ 'B', 'K', 'M', 'G', 'TB' ];\r\n    while ( (unit = units.shift()) && size > 1024 ) {\r\n        size = size / 1024;\r\n    }\r\n    return (unit === 'B' ? size : size.toFixed( pointLength === undefined ? 2 : pointLength)) + unit;\r\n}\r\n\r\ninterface ImageUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\nconst largeSize = 800;\r\nconst mediumSize = 400;\r\nconst smallSize = 180;\r\n\r\n@observer\r\nexport class ImageUploader extends React.Component<ImageUploaderProps> {\r\n\tprivate static imageTypes = ['gif', 'jpg', 'jpeg', 'png'];\r\n    private imgBaseSize: number;\r\n    private suffix: string;\r\n    private resUploader: ResUploader;\r\n    @observable private file: File;    \r\n    @observable private desImgWidth: number;\r\n    @observable private desImgHeight: number;\r\n    @observable private desImgSize: number;\r\n    @observable private srcImgWidth: number;\r\n    @observable private srcImgHeight: number;\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private srcImage: string;\r\n    @observable private desImage: string;\r\n    @observable private fileError: string;\r\n    @observable private uploaded: boolean = false;\r\n\r\n    constructor(props: ImageUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(ImageUploader.imageTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `图片类型必须是 ${ImageUploader.imageTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n                this.srcImage = reader.result as string;\r\n                await this.setSize(this.props.size);\r\n            };\r\n        }\r\n    }\r\n\r\n    private async setSize(size?: 'sm' | 'md' | 'lg') {\r\n        switch (size) {\r\n            default:\r\n            case 'sm':\r\n                this.imgBaseSize = smallSize; break;\r\n            case 'md':\r\n                this.imgBaseSize = mediumSize; break;\r\n            case 'lg':\r\n                this.imgBaseSize = largeSize; break;\r\n        }\r\n        this.desImage = await this.compress();\r\n    }\r\n\r\n    private compress = ():Promise<string> => {\r\n        return new Promise<string>((resolve, reject) => {\r\n            var img = new Image();\r\n            img.src = this.srcImage;\r\n            img.onload = () => {\r\n                //var that = this;\r\n                // 默认按比例压缩\r\n                let {width, height} = img;\r\n                this.srcImgWidth = width;\r\n                this.srcImgHeight = height;\r\n                let scale = width / height;\r\n                let w:number, h:number;\r\n                if (width <= this.imgBaseSize && height <= this.imgBaseSize) {\r\n                    w = width;\r\n                    h = height;\r\n                }\r\n                else if (scale < 0) {\r\n                    w = this.imgBaseSize;\r\n                    h = w / scale;\r\n                }\r\n                else {\r\n                    h = this.imgBaseSize;\r\n                    w = h * scale;\r\n                }\r\n                this.desImgWidth = Math.round(w);\r\n                this.desImgHeight = Math.round(h);\r\n                var quality = 0.7;  // 默认图片质量为0.7\r\n                //生成canvas\r\n                var canvas = document.createElement('canvas');\r\n                var ctx = canvas.getContext('2d');\r\n                // 创建属性节点\r\n                var anw = document.createAttribute(\"width\");\r\n                anw.nodeValue = String(w);\r\n                var anh = document.createAttribute(\"height\");\r\n                anh.nodeValue = String(h);\r\n                canvas.setAttributeNode(anw);\r\n                canvas.setAttributeNode(anh);\r\n                ctx.drawImage(img, 0, 0, w, h);\r\n                let base64 = canvas.toDataURL('image/' + this.suffix , quality);\r\n                let blob = this.convertBase64UrlToBlob(base64);\r\n                this.desImgSize = blob.size;\r\n                if (this.desImgSize > 5000000) {\r\n                    this.fileError = \"图片大于4M，无法上传\";\r\n                    this.enableUploadButton = false;\r\n                }\r\n                resolve(base64);\r\n            }\r\n        });\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n        if (!this.resUploader) return;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.desImage);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    private showOrgImage = () => {\r\n        nav.push(<Page header=\"原图\">\r\n            <div className=\"p-3 text-center\">\r\n                <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.srcImage} />\r\n            </div>\r\n        </Page>);\r\n    }\r\n\r\n    private levelDiv() {\r\n        if (this.props.size) return;\r\n        let arr = [{caption:'小图', size:'sm'}];\r\n        if (this.srcImgHeight > mediumSize || this.srcImgWidth > mediumSize) {\r\n            arr.push({caption:'中图', size:'md'});\r\n        }\r\n        if (this.srcImgHeight > largeSize || this.srcImgWidth > largeSize) {\r\n            arr.push({caption:'大图', size:'lg'});\r\n        }\r\n        if (arr.length < 2) return;\r\n        return <div>{arr.map((v, index) => {\r\n            let {caption, size} = v;\r\n            return <label key={index} className=\"mr-3\"><input type=\"radio\" name=\"size\" \r\n                onChange={()=>this.setSize(size as any)}\r\n                defaultChecked={index===0} /> {caption}</label>;\r\n        })}</div>\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改图片'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择图片文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {ImageUploader.imageTypes.join(', ')} 格式图片。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                    <LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n                            :\r\n                            this.file && this.desImgSize > 0 && <div className=\"mb-3 d-flex align-items-end\">\r\n                                <div className=\"mr-5\">\r\n                                    {this.levelDiv()}\r\n                                    <div>分辨率：{this.desImgWidth} x {this.desImgHeight}\r\n                                    &nbsp; &nbsp;\r\n                                    文件大小：{formatSize(this.desImgSize)}\r\n                                    </div>\r\n                                </div>\r\n                                <button className=\"btn btn-primary\" \r\n                                    disabled={!this.enableUploadButton}\r\n                                    onClick={this.upload}>上传</button>\r\n                            </div>\r\n                    }\r\n                    right={this.desImage && \r\n                        <button className=\"btn btn-link btn-sm text-right mb-3\" onClick={this.showOrgImage}>\r\n                            原图大小: {formatSize(this.file.size)}<br/>\r\n                            分辨率：{this.srcImgWidth} x {this.srcImgHeight}\r\n                        </button>\r\n                    }\r\n                    ></LMR>\r\n                </div>\r\n                <div className=\"text-center\" \r\n                    style={{\r\n                        border: (this.uploaded===true? '2px solid green' : '1px dotted gray'),\r\n                        padding: '8px'\r\n                    }}>\r\n                    <ImageControl className=\"h-min-4c\" style={{maxWidth:'100%'}} src={this.desImage} />\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\ninterface AudioUploaderProps {\r\n    id?: string;\r\n    label?: string;\r\n    onSaved?: (imageId:string) => Promise<void>;\r\n}\r\n\r\n@observer\r\nexport class AudioUploader extends React.Component<AudioUploaderProps> {\r\n\tprivate static audioTypes = ['mp3', 'wav'];\r\n\r\n    private suffix: string;\r\n\tprivate resUploader: ResUploader;\r\n\t@observable private content: string;\r\n\t@observable private file: File;    \r\n\t@observable private fileSize: number;\r\n\r\n    @observable private isChanged: boolean = false;\r\n    @observable private resId: string;\r\n    @observable private enableUploadButton: boolean = false;\r\n    @observable private fileError: string;\r\n\t@observable private uploaded: boolean = false;\r\n\t@observable private uploading: boolean = false;\r\n\r\n    constructor(props: AudioUploaderProps) {\r\n        super(props);\r\n        this.resId = props.id;\r\n    }\r\n\r\n    private onFileChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.fileError = undefined;\r\n        this.uploaded = false;\r\n        this.enableUploadButton = evt.target.files.length > 0;\r\n        if (this.enableUploadButton) {\r\n            this.file = evt.target.files[0];\r\n            let pos = this.file.name.lastIndexOf('.');\r\n            if (pos >= 0) this.suffix = this.file.name.substr(pos+1).toLowerCase();\r\n            if(AudioUploader.audioTypes.indexOf(this.suffix) < 0){\r\n                this.fileError = `音频类型必须是 ${AudioUploader.audioTypes.join(', ')} 中的一种`;\r\n                return;\r\n            }\r\n            let reader = new FileReader();\r\n            reader.readAsDataURL(this.file);\r\n            reader.onload = async () => {\r\n\t\t\t\tthis.content = reader.result as string;\r\n\t\t\t\tthis.fileSize = this.content.length;\r\n            };\r\n        }\r\n    }\r\n\r\n    private convertBase64UrlToBlob(urlData: string):Blob {\r\n        let arr = urlData.split(',');\r\n        let mime = arr[0].match(/:(.*?);/)[1];\r\n        let bstr = atob(arr[1]);\r\n        let n = bstr.length;\r\n        let u8arr = new Uint8Array(n);\r\n        while(n--){\r\n            u8arr[n] = bstr.charCodeAt(n);\r\n        }\r\n        return new Blob([u8arr], {type:mime});\r\n    }\r\n\r\n    private upload = async () => {\r\n\t\tif (!this.resUploader) return;\r\n\t\tthis.uploading = true;\r\n        let formData = new FormData();\r\n        let blob = this.convertBase64UrlToBlob(this.content);\r\n        formData.append('image', blob, this.file.name);\r\n        let ret = await this.resUploader.upload(formData);\r\n        if (typeof ret === 'object') {\r\n            let {error} = ret;\r\n            let type = typeof error;\r\n            let err:string;\r\n            switch (type) {\r\n                case 'undefined': err = 'error: undefined'; break;\r\n                case 'string': err = error; break;\r\n                case 'object': err = error.message; break;\r\n                default: err = String(err); break;\r\n            }\r\n            this.fileError = 'error: ' + type + ' - ' + err;\r\n            return;\r\n        }\r\n        this.resId = ret;\r\n        this.isChanged = (this.resId !== this.props.id);\r\n        this.uploaded = true;\r\n    }\r\n\r\n    private onSaved = (): Promise<void> => {\r\n        let {onSaved} = this.props;\r\n        onSaved && onSaved(this.resId);\r\n        return;\r\n    }\r\n\r\n    render() {\r\n        let {label} = this.props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center mr-2\"\r\n            disabled={!this.isChanged}\r\n            onClick={this.onSaved}>保存</button>;\r\n        return <Page header={label || '更改文件'} right={right}>\r\n            <div className=\"my-3 px-3 py-3 bg-white\">\r\n                <div>\r\n                    <div className=\"mb-3\">\r\n                        <ResUploader ref={v=>this.resUploader=v} \r\n                            multiple={false} maxSize={2048} \r\n                            label=\"选择音频文件\"\r\n                            onFilesChange={this.onFileChange} />\r\n                        <div className=\"small text-muted\">支持 {AudioUploader.audioTypes.join(', ')} 格式。</div>\r\n                        {this.fileError && <div className=\"text-danger\">{this.fileError}</div>}\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\t\t\t<LMR left=\r\n                    {\r\n                        this.uploaded === true? \r\n                            <div className=\"text-success p-2\">上传成功！</div>\r\n\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\tthis.uploading === true?\r\n\t\t\t\t\t\t\t\t<div className=\"m-3\"><Loading /></div>\r\n\t\t\t\t\t\t\t\t:\r\n\t\t\t\t\t\t\t\tthis.file && this.content && <div className=\"m-3\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"mb-3\">\r\n\t\t\t\t\t\t\t\t\t\t文件大小：{formatSize(this.fileSize)}\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<button className=\"btn btn-primary\" \r\n\t\t\t\t\t\t\t\t\t\tdisabled={!this.enableUploadButton}\r\n\t\t\t\t\t\t\t\t\t\tonClick={this.upload}>上传</button>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t}\r\n\t\t\t/>\r\n        </Page>;\r\n    }\r\n}\r\n","export * from './uqMan';\r\nexport * from './entity';\r\nexport * from './action';\r\nexport * from './query';\r\nexport * from './sheet';\r\nexport * from './tuid';\r\nexport * from './book';\r\nexport * from './map';\r\nexport * from './history';\r\nexport * from './pending';\r\nexport * from './uqsMan';\r\nexport * from './tag/tag';\r\n","import _ from 'lodash';\r\nimport { UqApi, UqData, UnitxApi, appInFrame } from '../net';\r\nimport { Tuid, TuidDiv, TuidImport, TuidInner, TuidBox, TuidsCache } from './tuid';\r\nimport { Action } from './action';\r\nimport { Sheet } from './sheet';\r\nimport { Query } from './query';\r\nimport { Book } from './book';\r\nimport { History } from './history';\r\nimport { Map } from './map';\r\nimport { Pending } from './pending';\r\nimport { CreateBoxId, BoxId } from './tuid';\r\nimport { LocalMap, LocalCache } from '../tool';\r\nimport { UQsMan } from './uqsMan';\r\nimport { ReactBoxId } from './tuid/reactBoxId';\r\nimport { Tag } from './tag/tag';\r\n\r\nexport type FieldType = 'id' | 'tinyint' | 'smallint' | 'int' | 'bigint' | 'dec' | 'char' | 'text'\r\n    | 'datetime' | 'date' | 'time' | 'timestamp';\r\n\r\nexport function fieldDefaultValue(type:FieldType) {\r\n    switch (type) {\r\n        case 'tinyint':\r\n        case 'smallint':\r\n        case 'int':\r\n        case 'bigint':\r\n        case 'dec':\r\n            return 0;\r\n        case 'char':\r\n        case 'text':\r\n            return '';\r\n        case 'datetime':\r\n        case 'date':\r\n            return '2000-1-1';\r\n        case 'time':\r\n            return '0:00';\r\n    }\r\n}\r\n\r\nexport interface Field {\r\n    name: string;\r\n    type: FieldType;\r\n    tuid?: string;\r\n    arr?: string;\r\n    null?: boolean;\r\n    size?: number;\r\n    owner?: string;\r\n    _tuid: TuidBox;\r\n}\r\nexport interface ArrFields {\r\n    name: string;\r\n    fields: Field[];\r\n    id?: string;\r\n    order?: string;\r\n}\r\nexport interface FieldMap {\r\n    [name:string]: Field;\r\n}\r\nexport interface SchemaFrom {\r\n    owner:string;\r\n    uq:string;\r\n}\r\nexport interface TuidModify {\r\n    max: number;\r\n    seconds: number;\r\n}\r\n\r\nexport class UqMan {\r\n    private readonly actions: {[name:string]: Action} = {};\r\n    private readonly sheets: {[name:string]: Sheet} = {};\r\n    private readonly queries: {[name:string]: Query} = {};\r\n    private readonly books: {[name:string]: Book} = {};\r\n    private readonly maps: {[name:string]: Map} = {};\r\n    private readonly histories: {[name:string]: History} = {};\r\n\tprivate readonly pendings: {[name:string]: Pending} = {};\r\n\tprivate readonly tags: {[name:string]: Tag} = {};\r\n    private readonly tuidsCache: TuidsCache;\r\n    private readonly localAccess: LocalCache;\r\n    private readonly tvs:{[entity:string]:(values:any)=>JSX.Element};\r\n    readonly localMap: LocalMap;\r\n    readonly localModifyMax: LocalCache;\r\n    readonly tuids: {[name:string]: Tuid} = {};\r\n    readonly createBoxId: CreateBoxId;\r\n    readonly newVersion: boolean;\r\n    readonly uqOwner: string;\r\n    readonly uqName: string;\r\n    readonly name: string;\r\n    readonly uqApi: UqApi;\r\n    readonly id: number;\r\n\r\n    uqVersion: number;\r\n\r\n    constructor(uqs:UQsMan, uqData: UqData, createBoxId:CreateBoxId, tvs:{[entity:string]:(values:any)=>JSX.Element}) {\r\n        this.createBoxId = createBoxId;\r\n        if (createBoxId === undefined) {\r\n            this.createBoxId = this.createBoxIdFromTVs;\r\n            this.tvs = tvs || {};\r\n        }\r\n        let {id, uqOwner, uqName, access, newVersion: clearTuids} = uqData;\r\n        this.newVersion = clearTuids;\r\n        this.uqOwner = uqOwner;\r\n        this.uqName = uqName;\r\n        this.id = id;\r\n        this.name = uqOwner + '/' + uqName;\r\n        this.uqVersion = 0;\r\n        this.localMap = uqs.localMap.map(this.name);\r\n        this.localModifyMax = this.localMap.child('$modifyMax');\r\n        this.localAccess = this.localMap.child('$access');\r\n        //let hash = document.location.hash;\r\n        let baseUrl = 'tv/';\r\n\r\n        let acc: string[];\r\n        if (access === null || access === undefined || access === '*') {\r\n            acc = [];\r\n        }\r\n        else {\r\n            acc = access.split(';').map(v => v.trim()).filter(v => v.length > 0);\r\n        }\r\n        if (this.name === '$$$/$unitx') {\r\n            // 这里假定，点击home link之后，已经设置unit了\r\n            // 调用 UnitxApi会自动搜索绑定 unitx service\r\n            this.uqApi = new UnitxApi(appInFrame.unit);\r\n        }\r\n        else {\r\n            let {appOwner, appName} = uqs;\r\n            this.uqApi = new UqApi(baseUrl, appOwner, appName, uqOwner, uqName, acc, true);\r\n        }\r\n        this.tuidsCache = new TuidsCache(this);\r\n    }\r\n\r\n    get entities() {\r\n        return _.merge({}, \r\n            this.actions, this.sheets, this.queries, this.books,\r\n\t\t\tthis.maps, this.histories, this.pendings, this.tuids,\r\n\t\t\tthis.tags,\r\n        );\r\n    }\r\n\r\n    private createBoxIdFromTVs:CreateBoxId = (tuid:Tuid, id:number):BoxId =>{\r\n        let {name} = tuid;\r\n        /*\r\n        let tuidUR = this.tuidURs[name];\r\n        if (tuidUR === undefined) {\r\n            let {ui, res} = this.getUI(tuid);\r\n            this.tuidURs[name] = tuidUR = new TuidWithUIRes(tuid, ui, res);\r\n        }\r\n        */\r\n        return new ReactBoxId(id, tuid, this.tvs[name]);\r\n    }\r\n\r\n    tuid(name:string):Tuid {return this.tuids[name.toLowerCase()]}\r\n    tuidDiv(name:string, div:string):TuidDiv {\r\n        let tuid = this.tuids[name.toLowerCase()]\r\n        return tuid && tuid.div(div.toLowerCase());\r\n    }\r\n    action(name:string):Action {return this.actions[name.toLowerCase()]}\r\n    sheet(name:string):Sheet {return this.sheets[name.toLowerCase()]}\r\n    query(name:string):Query {return this.queries[name.toLowerCase()]}\r\n    book(name:string):Book {return this.books[name.toLowerCase()]}\r\n    map(name:string):Map {return this.maps[name.toLowerCase()]}\r\n    history(name:string):History {return this.histories[name.toLowerCase()]}\r\n    pending(name:string):Pending {return this.pendings[name.toLowerCase()]}\r\n\r\n    sheetFromTypeId(typeId:number):Sheet {\r\n        for (let i in this.sheets) {\r\n            let sheet = this.sheets[i];\r\n            if (sheet.typeId === typeId) return sheet;\r\n        }\r\n    }\r\n\r\n    readonly tuidArr: Tuid[] = [];\r\n    readonly actionArr: Action[] = [];\r\n    readonly sheetArr: Sheet[] = [];\r\n    readonly queryArr: Query[] = [];\r\n    readonly bookArr: Book[] = [];\r\n    readonly mapArr: Map[] = [];\r\n    readonly historyArr: History[] = [];\r\n    readonly pendingArr: Pending[] = [];\r\n    readonly tagArr: Tag[] = [];\r\n\r\n    async init() {\r\n        await this.uqApi.init();\r\n    }\r\n\r\n    async loadEntities(): Promise<string> {\r\n        try {\r\n            let accesses = this.localAccess.get();\r\n            if (!accesses) {\r\n                accesses = await this.uqApi.loadAccess();\r\n            }\r\n            if (!accesses) return;\r\n            this.buildEntities(accesses);\r\n        }\r\n        catch (err) {\r\n            return err;\r\n        }\r\n    }\r\n\r\n\tbuildEntities(entities:any) {\r\n        if (entities === undefined) {\r\n            debugger;\r\n        }\r\n        this.localAccess.set(entities);\r\n        let {access, tuids, version} = entities;\r\n        this.uqVersion = version;\r\n        this.buildTuids(tuids);\r\n        this.buildAccess(access);\r\n\t}\r\n\t\r\n    private buildTuids(tuids:any) {\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let {typeId, from} = schema;\r\n            let tuid = this.newTuid(i, typeId, from);\r\n            tuid.sys = true;\r\n        }\r\n        for (let i in tuids) {\r\n            let schema = tuids[i];\r\n            let tuid = this.getTuid(i);\r\n            tuid.setSchema(schema);\r\n        }\r\n        for (let i in this.tuids) {\r\n            let tuid = this.tuids[i];\r\n            tuid.buildFieldsTuid();\r\n        }\r\n\t}\r\n\r\n    async loadEntitySchema(entityName: string): Promise<any> {\r\n        return await this.uqApi.schema(entityName);\r\n    }\r\n\r\n    getTuid(name:string): Tuid {\r\n        return this.tuids[name];\r\n    }\r\n\r\n    private buildAccess(access:any) {\r\n        for (let a in access) {\r\n            let v = access[a];\r\n            switch (typeof v) {\r\n                case 'string': this.fromType(a, v); break;\r\n                case 'object': this.fromObj(a, v); break;\r\n            }\r\n        }\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.tuidsCache.cacheTuids(defer);\r\n    }\r\n\r\n    newAction(name:string, id:number):Action {\r\n        let action = this.actions[name];\r\n        if (action !== undefined) return action;\r\n        action = this.actions[name] = new Action(this, name, id)\r\n        this.actionArr.push(action);\r\n        return action;\r\n    }\r\n    private newTuid(name:string, id:number, from:SchemaFrom):Tuid {\r\n        let tuid = this.tuids[name];\r\n        if (tuid !== undefined) return tuid;\r\n        if (from !== undefined)\r\n            tuid = new TuidImport(this, name, id, from);\r\n        else\r\n            tuid = new TuidInner(this, name, id);\r\n        this.tuids[name] = tuid;\r\n        this.tuidArr.push(tuid);\r\n        return tuid;\r\n    }\r\n    newQuery(name:string, id:number):Query {\r\n        let query = this.queries[name];\r\n        if (query !== undefined) return query;\r\n        query = this.queries[name] = new Query(this, name, id)\r\n        this.queryArr.push(query);\r\n        return query;\r\n    }\r\n    private newBook(name:string, id:number):Book {\r\n        let book = this.books[name];\r\n        if (book !== undefined) return book;\r\n        book = this.books[name] = new Book(this, name, id);\r\n        this.bookArr.push(book);\r\n        return book;\r\n    }\r\n    private newMap(name:string, id:number):Map {\r\n        let map = this.maps[name];\r\n        if (map !== undefined) return map;\r\n        map = this.maps[name] = new Map(this, name, id)\r\n        this.mapArr.push(map);\r\n        return map;\r\n    }\r\n    private newTag(name:string, id:number):Tag {\r\n        let tag = this.tags[name];\r\n        if (tag !== undefined) return tag;\r\n        tag = this.tags[name] = new Tag(this, name, id)\r\n        this.tagArr.push(tag);\r\n        return tag;\r\n    }\r\n    private newHistory(name:string, id:number):History {\r\n        let history = this.histories[name];\r\n        if (history !== undefined) return;\r\n        history = this.histories[name] = new History(this, name, id)\r\n        this.historyArr.push(history);\r\n        return history;\r\n    }\r\n    private newPending(name:string, id:number):Pending {\r\n        let pending = this.pendings[name];\r\n        if (pending !== undefined) return;\r\n        pending = this.pendings[name] = new Pending(this, name, id)\r\n        this.pendingArr.push(pending);\r\n        return pending;\r\n    }\r\n    newSheet(name:string, id:number):Sheet {\r\n        let sheet = this.sheets[name];\r\n        if (sheet !== undefined) return sheet;\r\n        sheet = this.sheets[name] = new Sheet(this, name, id);\r\n        this.sheetArr.push(sheet);\r\n        return sheet;\r\n    }\r\n    private fromType(name:string, type:string) {\r\n        let parts = type.split('|');\r\n        type = parts[0];\r\n        let id = Number(parts[1]);\r\n        switch (type) {\r\n            //case 'uq': this.id = id; break;\r\n            case 'tuid':\r\n                // Tuid should not be created here!;\r\n                //let tuid = this.newTuid(name, id);\r\n                //tuid.sys = false;\r\n                break;\r\n            case 'action': this.newAction(name, id); break;\r\n            case 'query': this.newQuery(name, id); break;\r\n            case 'book': this.newBook(name, id); break;\r\n            case 'map': this.newMap(name, id); break;\r\n            case 'history': this.newHistory(name, id); break;\r\n            case 'sheet':this.newSheet(name, id); break;\r\n\t\t\tcase 'pending': this.newPending(name, id); break;\r\n\t\t\tcase 'tag': this.newTag(name, id); break;\r\n        }\r\n    }\r\n    private fromObj(name:string, obj:any) {\r\n        switch (obj['$']) {\r\n            case 'sheet': this.buildSheet(name, obj); break;\r\n        }\r\n    }\r\n    private buildSheet(name:string, obj:any) {\r\n        let sheet = this.sheets[name];\r\n        if (sheet === undefined) sheet = this.newSheet(name, obj.id);\r\n        sheet.build(obj);\r\n    }\r\n    buildFieldTuid(fields:Field[], mainFields?:Field[]) {\r\n        if (fields === undefined) return;\r\n        for (let f of fields) {\r\n            let {tuid} = f;\r\n            if (tuid === undefined) continue;\r\n            let t = this.getTuid(tuid);\r\n            if (t === undefined) continue;\r\n            f._tuid = t.buildTuidBox();\r\n        }\r\n        for (let f of fields) {\r\n            let {owner} = f;\r\n            if (owner === undefined) continue;\r\n            let ownerField = fields.find(v => v.name === owner);\r\n            if (ownerField === undefined) {\r\n                if (mainFields !== undefined) {\r\n                    ownerField = mainFields.find(v => v.name === owner);\r\n                }\r\n                if (ownerField === undefined) {\r\n                    debugger;\r\n                    throw new Error(`owner field ${owner} is undefined`);\r\n                }\r\n            }\r\n            let {arr, tuid} = f;\r\n            let t = this.getTuid(ownerField._tuid.tuid.name);\r\n            if (t === undefined) continue;\r\n            let div = t.div(arr || tuid);\r\n            f._tuid = div && div.buildTuidDivBox(ownerField);\r\n            if (f._tuid === undefined) {\r\n                debugger;\r\n                throw new Error(`owner field ${owner} is not tuid`);\r\n            }\r\n        }\r\n    }\r\n    buildArrFieldsTuid(arrFields:ArrFields[], mainFields:Field[]) {\r\n        if (arrFields === undefined) return;\r\n        for (let af of arrFields) {\r\n            let {fields} = af;\r\n            if (fields === undefined) continue;\r\n            this.buildFieldTuid(fields, mainFields);\r\n        }\r\n    }\r\n\r\n    pullModify(modifyMax:number) {\r\n        this.tuidsCache.pullModify(modifyMax);\r\n    }\r\n}\r\n","import { Entity } from './entity';\r\nimport { PageItems } from '../tool/pageItems';\r\nimport { EntityCaller } from './caller';\r\n\r\nexport interface SheetState {\r\n    name: string;\r\n    actions: SheetAction[];\r\n}\r\n\r\nexport interface SheetAction {\r\n    name: string;\r\n}\r\n\r\nexport interface StateCount {\r\n    state: string;\r\n    count: number;\r\n}\r\n\r\nexport class Sheet extends Entity {\r\n    get typeName(): string { return 'sheet';}\r\n    states: SheetState[];\r\n\r\n    /*\r\n    setStates(states: SheetState[]) {\r\n        for (let state of states) {\r\n            this.setStateAccess(this.states.find(s=>s.name==state.name), state);\r\n        }\r\n    }*/\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.states = schema.states;\r\n    }\r\n    build(obj:any) {\r\n        this.states = [];\r\n        for (let op of obj.ops) {\r\n            this.states.push({name: op, actions:undefined});\r\n        }\r\n        /*\r\n        for (let p in obj) {\r\n            switch(p) {\r\n                case '#':\r\n                case '$': continue;\r\n                default: this.states.push(this.createSheetState(p, obj[p])); break;\r\n            }\r\n        }*/\r\n    }\r\n    private createSheetState(name:string, obj:object):SheetState {\r\n        let ret:SheetState = {name:name, actions:[]};\r\n        let actions = ret.actions;\r\n        for (let p in obj) {\r\n            let action:SheetAction = {name: p};\r\n            actions.push(action);\r\n        }\r\n        return ret;\r\n    }\r\n    /*\r\n    private setStateAccess(s:SheetState, s1:SheetState) {\r\n        if (s === undefined) return;\r\n        for (let action of s1.actions) {\r\n            let acn = action.name;\r\n            let ac = s.actions.find(a=>a.name === acn);\r\n            if (ac === undefined) continue;\r\n            s.actions.push(action);\r\n        }\r\n    }*/\r\n    async save(discription:string, data:any):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let {id} = this.uq;\r\n        let text = this.pack(data);\r\n\r\n        let ret = await this.uqApi.sheetSave(this.name, );\r\n        return ret;\r\n        */\r\n        let {id} = this.uq;\r\n        //let text = this.pack(data);\r\n        let params = {app: id, discription: discription, data:data};\r\n        return await new SaveCaller(this, params).request();\r\n        /*\r\n        let {id, state} = ret;\r\n        if (id > 0) this.changeStateCount(state, 1);\r\n        return ret;\r\n        */\r\n    }\r\n    async action(id:number, flow:number, state:string, action:string) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.uqApi.sheetAction(this.name, {id:id, flow:flow, state:state, action:action});\r\n        */\r\n        return await new ActionCaller(this, {id:id, flow:flow, state:state, action:action}).request();\r\n    }\r\n    private unpack(data:any):any {\r\n        //if (this.schema === undefined) await this.loadSchema();\r\n        let ret = data[0];\r\n        let brief = ret[0];\r\n        let sheetData = this.unpackSheet(brief.data);\r\n        let flows = data[1];\r\n        return {\r\n            brief: brief,\r\n            data: sheetData,\r\n            flows: flows,\r\n        }\r\n    }\r\n    async getSheet(id:number):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.getSheet(this.name, id);\r\n        */\r\n        let ret = await new GetSheetCaller(this, id).request();\r\n        if (ret[0].length === 0) return await this.getArchive(id);\r\n        return this.unpack(ret);\r\n    }\r\n    async getArchive(id:number):Promise<any> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchive(this.name, id)\r\n        return this.unpack(ret);\r\n        */\r\n        let ret = await new SheetArchiveCaller(this, id).request();\r\n        return this.unpack(ret);\r\n    }\r\n\r\n    async getArchives(pageStart:number, pageSize:number) {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.sheetArchives(this.name, {pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {pageStart:pageStart, pageSize:pageSize};\r\n        return await new SheetArchivesCaller(this, params).request();\r\n    }\r\n\r\n    async getStateSheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.stateSheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new StateSheetsCaller(this, params).request();\r\n    }\r\n    createPageStateItems<T>(): PageStateItems<T> {return new PageStateItems<T>(this);}\r\n\r\n    async stateSheetCount():Promise<StateCount[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret:StateCount[] = await this.uqApi.stateSheetCount(this.name);\r\n        return this.states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = ret.find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n        */\r\n        return await new StateSheetCountCaller(this, undefined).request();\r\n    }\r\n\r\n    async userSheets(state:string, user:number, pageStart:number, pageSize:number):Promise<any[]> {\r\n        let params = {state:state, user:user, pageStart:pageStart, pageSize:pageSize};\r\n        return await new UserSheetsCaller(this, params).request();\r\n    }\r\n\r\n    async mySheets(state:string, pageStart:number, pageSize:number):Promise<any[]> {\r\n        /*\r\n        await this.loadSchema();\r\n        let ret = await this.uqApi.mySheets(this.name, {state:state, pageStart:pageStart, pageSize:pageSize});\r\n        return ret;\r\n        */\r\n        let params = {state:state, pageStart:pageStart, pageSize:pageSize};\r\n        return await new MySheetsCaller(this, params).request();\r\n    }\r\n}\r\n\r\n\r\nabstract class SheetCaller<T> extends EntityCaller<T> {\r\n    protected get entity(): Sheet {return this._entity as Sheet;}\r\n    protected readonly suffix:string;\r\n    get path():string {return `sheet/${this.entity.name}/${this.suffix}`;}\r\n}\r\n\r\nclass SaveCaller extends SheetCaller<{app:number; discription:string; data:any}> {\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    buildParams() {\r\n        let {app, discription, data} = this.params;\r\n        return {\r\n            app: app,\r\n            discription: discription,\r\n            data: this.entity.pack(data)\r\n        };\r\n    }\r\n}\r\n\r\nclass ActionCaller extends SheetCaller<{id:number, flow:number, state:string, action:string}> {\r\n    method = 'PUT';\r\n    get path():string {return `sheet/${this.entity.name}`;}\r\n    //buildParams() {return this.entity.buildParams(this.params);}\r\n}\r\n\r\nclass GetSheetCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //private id:number;\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/get/${this.params}`;}\r\n}\r\n\r\nclass SheetArchiveCaller extends SheetCaller<number> {\r\n    //protected readonly params: number;  // id\r\n    method = 'GET';\r\n    //protected readonly suffix = 'archive';\r\n    buildParams() {}\r\n    get path():string {return `sheet/${this.entity.name}/archive/${this.params}`;}\r\n}\r\n\r\nclass SheetArchivesCaller extends SheetCaller<{pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'archives';\r\n}\r\n\r\nclass StateSheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'states';\r\n}\r\n\r\nclass StateSheetCountCaller extends SheetCaller<undefined> {\r\n    method = 'GET';\r\n    protected readonly suffix = 'statecount';\r\n    xresult(res:any):any {\r\n        let {states} = this.entity;\r\n        return states.map(s => {\r\n            let n = s.name, count = 0;\r\n            let r = (res as any[]).find(v => v.state === n);\r\n            if (r !== undefined) count = r.count;\r\n            return {state: n, count: count} \r\n        });\r\n    }\r\n}\r\n\r\nclass UserSheetsCaller extends SheetCaller<{state:string, user:number, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'user-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nclass MySheetsCaller extends SheetCaller<{state:string, pageStart:number, pageSize:number}> {\r\n    protected readonly suffix = 'my-sheets';\r\n    xresult(res:any):any {\r\n        return res;\r\n    }\r\n}\r\n\r\nexport class PageStateItems<T> extends PageItems<T> {\r\n    private sheet: Sheet;\r\n    constructor(sheet: Sheet) {\r\n        super(true);\r\n        this.sheet = sheet;\r\n        this.pageSize = 10;\r\n\t}\r\n\tprotected async loadResults(param:any, pageStart:any, pageSize:number):Promise<{[name:string]:any[]}> {\r\n\t\tlet ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n\t\treturn {$page: ret};\r\n\t}\r\n\t/*\r\n    protected async load(param:any, pageStart:any, pageSize:number):Promise<any[]> {\r\n        let ret = await this.sheet.getStateSheets(param, pageStart, pageSize);\r\n        return ret;\r\n\t}\r\n\t*/\r\n\tprotected getPageId(item:T) {\r\n\t\treturn item === undefined? 0 : (item as any).id;\r\n\t}\r\n\t/*\r\n    protected setPageStart(item:any) {\r\n        this.pageStart = item === undefined? 0 : item.id;\r\n\t}\r\n\t*/\r\n}\r\n","import {Query} from './query';\r\nimport { QueryQueryCaller } from './caller';\r\n\r\nexport class Book extends Query {\r\n    get typeName(): string { return 'book';}\r\n    protected queryApiName = 'book';\r\n\r\n    protected queryCaller(params: any): QueryQueryCaller {\r\n        return new BookQueryCaller(this, params);\r\n    }\r\n}\r\n\r\nexport class BookQueryCaller extends QueryQueryCaller {\r\n    //protected get entity(): Query {return this._entity as Query};\r\n    get path():string {return `book/${this.entity.name}`;}\r\n    /*\r\n    xresult(res:any) {\r\n        let data = this.entity.unpackReturns(res);\r\n        return data;\r\n    }\r\n    buildParams() {return this.entity.buildParams(this.params);}\r\n    */\r\n}\r\n","import {Query} from './query';\r\n\r\nexport class History extends Query {\r\n    get typeName(): string { return 'history';}\r\n    protected queryApiName = 'history';\r\n}\r\n","import { Entity } from './entity';\r\nimport { Action, ActionSubmitCaller } from './action';\r\nimport { Query } from './query';\r\nimport { Field } from './uqMan';\r\nimport { EntityCaller, QueryPageCaller, QueryQueryCaller } from './caller';\r\n\r\ninterface MapActions {\r\n    add: Action;\r\n    del: Action;\r\n}\r\ninterface MapQueries {\r\n    all: Query;\r\n    page: Query;\r\n    query: Query;\r\n}\r\n\r\nexport class Map extends Entity {\r\n    get typeName(): string { return 'map';}\r\n    keys: Field[];\r\n    actions: MapActions = {} as any;\r\n    queries: MapQueries = {} as any;\r\n    schemaFrom: {owner:string; uq:string};\r\n\r\n    setSchema(schema:any) {\r\n        super.setSchema(schema);\r\n        this.schemaFrom = this.schema.from;\r\n        let {actions, queries, keys} = schema;\r\n        this.uq.buildFieldTuid(this.keys = keys);\r\n        //let t = this.schemaStringify();\r\n        for (let i in actions) {\r\n            let actionSchema = actions[i];\r\n            let {name} = actionSchema;\r\n            let action = this.uq.newAction(name, undefined);\r\n            action.setSchema(actionSchema);\r\n            action.buildFieldsTuid();\r\n            (this.actions as any)[i] = action;\r\n        }\r\n        for (let i in queries) {\r\n            let querySchema = queries[i];\r\n            let {name} = querySchema;\r\n            let query = this.uq.newQuery(name, undefined);\r\n            query.setSchema(querySchema);\r\n            query.buildFieldsTuid();\r\n            (this.queries as any)[i] = query;\r\n        }\r\n    }\r\n\r\n    async add(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.actions.add.submit(param);\r\n        */\r\n        let ret = await new AddCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async del(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.actions.del.submit(param);\r\n        */\r\n        let ret = await new DelCaller(this, param).request();\r\n        return ret;\r\n    }\r\n\r\n    async all() {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.all.query({});\r\n        */\r\n        let ret = await new AllCaller(this, undefined).request();\r\n        return ret;\r\n    }\r\n\r\n    async page(param:any, pageStart:any, pageSize: number) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.page.page(param, pageStart, pageSize);\r\n        */\r\n        let ret = await new PageCaller(this, {pageStart:pageStart, pageSize:pageSize, param:param}).request();\r\n        return ret;\r\n    }\r\n\r\n    async query(param:any) {\r\n        /*\r\n        await this.loadSchema();\r\n        return await this.queries.query.query(param);\r\n        */\r\n       let qc = new QueryCaller(this, param);\r\n       let ret = await qc.request();\r\n       return ret;\r\n   }\r\n    async table(params:any): Promise<any[]> {\r\n        let ret = await this.query(params);\r\n        for (let i in ret) {\r\n            return ret[i];\r\n        }\r\n    }\r\n    async obj(params:any):Promise<any> {\r\n        let ret = await this.table(params);\r\n        if (ret.length > 0) return ret[0];\r\n    }\r\n    async scalar(params:any):Promise<any> {\r\n        let ret = await this.obj(params);\r\n        for (let i in ret) return ret[i];\r\n    }\r\n}\r\n\r\nabstract class MapCaller extends EntityCaller<any> {\r\n    protected get entity(): Map {return this._entity as Map;}\r\n    get path():string {return undefined;}\r\n\r\n    protected abstract getCaller(param: any):EntityCaller<any>;\r\n\r\n    protected async innerCall(): Promise<any> {\r\n        let caller = this.getCaller(this.params);\r\n        let res = await this.entity.uqApi.xcall(caller);\r\n        let ret = caller.xresult(res.res);\r\n        return {res: ret};\r\n    }\r\n\r\n    buildParams() {\r\n        let p = super.buildParams();\r\n        return p;\r\n    }\r\n}\r\n\r\nclass AddCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAddCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass DelCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapDelCaller(this.entity, this.entity.actions.add, param);\r\n    }\r\n}\r\n\r\nclass AllCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapAllCaller(this.entity, this.entity.queries.all, param);\r\n    }\r\n}\r\n\r\nclass PageCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapPageCaller(this.entity, this.entity.queries.page, param);\r\n    }\r\n}\r\n\r\nclass QueryCaller extends MapCaller {\r\n    protected getCaller(param:any):EntityCaller<any> {\r\n        return new MapQueryCaller(this.entity, this.entity.queries.query, param);\r\n    }\r\n}\r\n\r\nclass MapAddCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/add`}\r\n    get headers(): {[header:string]: string} {return undefined;}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapDelCaller extends ActionSubmitCaller {\r\n    private map: Map;\r\n    constructor(map:Map, action:Action, params:any) {\r\n        super(action, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/del`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapAllCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/all`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\n\r\nclass MapPageCaller extends QueryPageCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/page`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}\r\n\r\nclass MapQueryCaller extends QueryQueryCaller {\r\n    private map: Map;\r\n    constructor(map:Map, query:Query, params:any) {\r\n        super(query, params);\r\n        this.map = map;\r\n    }\r\n\r\n    get path():string {return `map/${this.map.name}/query`}\r\n    get headers(): {[header:string]: string} {return undefined}\r\n    /*\r\n        let {ver, uq} = this.map;\r\n        let {uqVersion} = uq;\r\n        return {\r\n            uq: `${uqVersion}`,\r\n            en: `${ver}`,\r\n        }\r\n    }*/\r\n}","import {Query} from './query';\r\n\r\nexport class Pending extends Query {\r\n    get typeName(): string { return 'pending';}\r\n    protected queryApiName = 'pending';\r\n}\r\n","import * as React from 'react';\r\nimport { IValuesView, IValuesViewRenderOptions } from '../../components';\r\nimport { Tag, TagValue } from './tag';\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class TagView implements IValuesView {\r\n\tprivate tag: Tag;\r\n\tconstructor(tag: Tag) {\r\n\t\tthis.tag = tag;\r\n\t}\r\n\trender(values: number|string):JSX.Element {\r\n\t\tlet names:string[];\r\n\t\tif (typeof values === 'number') {\r\n\t\t\tnames = [this.tag.nameFromId(values)];\r\n\t\t}\r\n\t\telse {\r\n\t\t\tnames = this.tag.namesFromIds(values);\r\n\t\t}\r\n\t\treturn <div className=\"d-flex flex-wrap \">{names.map((name, index)=>{\r\n\t\t\treturn <div key={index} className=\"mx-2 border border-muted rounded px-3 bg-light\">{name}</div>\r\n\t\t})}</div>;\r\n\t}\r\n\trenderRadios(value: number, options: IValuesViewRenderOptions): JSX.Element {\r\n        let content = this.tag.values.map((item,index) => {\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderRadio(item, value, options)}</div>;\r\n        });\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\trenderChecks(values: string, options: IValuesViewRenderOptions): JSX.Element {\r\n\t\tlet arr = values===undefined? undefined : values.split('|').map(v => Number(v));\r\n\t\tlet content = this.tag.values.map((item,index) => {\r\n\t\t\tlet checked: boolean = arr===undefined? undefined : arr.indexOf(item.id)>=0;\r\n\t\t\treturn <div className=\"col\" key={index}>{this.renderCheck(item, checked, options)}</div>\r\n\t\t});\r\n\t\treturn this.renderView(options, content);\r\n\t}\r\n\tprivate renderView(options: IValuesViewRenderOptions, content:any) {\r\n\t\tlet {className, wrapClassName} = options;\r\n\t\twrapClassName = wrapClassName?\r\n\t\t\t'row ' + wrapClassName\r\n\t\t\t:\r\n\t\t\t'row row-cols-2 row-cols-sm-3 row-cols-md-4';\r\n\t\treturn <div className={className} style={radioStyle}>\r\n\t\t\t<div className={wrapClassName}>\r\n                {content}\r\n\t\t\t</div>\r\n        </div>;\r\n\t}\r\n\tprivate renderRadio(item:TagValue, value: number, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, inputName, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"radio\" name={inputName}\r\n\t\t\t\tvalue={id} defaultChecked={value===id}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n\r\n\tprivate renderCheck(item:TagValue, checked: boolean, options: IValuesViewRenderOptions):JSX.Element {\r\n\t\tlet {id, name} = item;\r\n\t\tlet {inputs, onInputChange} = options;\r\n\t\tlet ref = inputs && ((input:HTMLInputElement)=>inputs[id]=input);\r\n\t\treturn <label className=\"form-radio-inline\">\r\n\t\t\t<input ref={ref} type=\"checkbox\"\r\n\t\t\t\tvalue={id} defaultChecked={checked}\r\n\t\t\t\tonChange={onInputChange} />\r\n\t\t\t{name}\r\n\t\t</label>;\r\n\t}\r\n}\r\n","import { Entity } from \"../entity\";\r\nimport { TagView } from \"./tagView\";\r\n\r\nexport interface TagValue {\r\n\tid: number;\r\n\tname: string;\r\n\text: string;\r\n}\r\n\r\nexport class Tag extends Entity {\r\n    get typeName(): string { return 'tag';}\r\n\tvalues: TagValue[];\r\n\tprivate coll: {[id:number]: TagValue} = {};\r\n\r\n\tprivate _view: TagView;\r\n\tget view(): TagView { \r\n\t\tif (this._view !== undefined) return this._view; \r\n\t\treturn this._view = new TagView(this);\r\n\t}\r\n\r\n\tnameFromId(id:number) {\r\n\t\tlet c = this.coll[id]; \r\n\t\treturn c===undefined? undefined : c.name;\r\n\t}\r\n\r\n\tnamesFromIds(ids:string):string[] {\r\n\t\tlet ret:string[] = [];\r\n\t\tfor (let id of ids.split('|')) {\r\n\t\t\tlet c = this.coll[Number(id)];\r\n\t\t\tlet name = c===undefined? undefined : c.name;\r\n\t\t\tif (name !== undefined) ret.push(name);\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync loadValues():Promise<TagValue[]> {\r\n\t\tif (this.values !== undefined) return this.values;\r\n\t\tthis.values = [];\r\n\t\tlet ret = await this.uqApi.get('tag/values/' + this.name);\r\n\t\tif (ret === undefined) return;\r\n\t\tlet lines = (ret as string).split('\\n');\r\n\t\tfor (let line of lines) {\r\n\t\t\tif (line.length === 0) continue;\r\n\t\t\tlet parts = line.split('\\t');\r\n\t\t\tlet id = Number(parts[0]);\r\n\t\t\tlet val = {\r\n\t\t\t\tid: id,\r\n\t\t\t\tname: parts[1],\r\n\t\t\t\text: parts[2],\r\n\t\t\t};\r\n\t\t\tthis.values.push(val);\r\n\t\t\tthis.coll[id] = val;\r\n\t\t}\r\n\t\treturn this.values;\r\n\t}\r\n}\r\n","export * from './page';\r\nexport * from './tabs';\r\nexport * from './scrollView';\r\n","export * from './schema';\r\nexport * from './uiSchema';\r\nexport * from './toUiSelectItems';\r\nexport * from './IValuesView';","\r\nexport const mobileRegex = /^[0-9]*$/;\r\nexport const emailRegex = /\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*/;\r\n// /^([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\\_|\\.]?)*[a-zA-Z0-9]+\\.[a-zA-Z]{2,3}$/\r\n\r\nexport const EmailFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '电子邮件格式错误';\r\n}\r\n\r\nexport const MobileFieldRule = (value:any): string|string[] => {\r\n    if (emailRegex.test(value as string) === false) return '手机格式错误';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n\r\nexport interface DropdownAction {\r\n    icon?: string;\r\n    caption?: string;\r\n    action?: () => void;\r\n}\r\n\r\nexport interface DropdownActionsProps {\r\n    icon?: string;\r\n    actions: DropdownAction[];\r\n    isRight?: boolean;\r\n    className?: string;\r\n}\r\n\r\nexport interface DropdownActionsState {\r\n    dropdownOpen: boolean;\r\n}\r\n\r\nexport class DropdownActions extends React.Component<DropdownActionsProps, DropdownActionsState> {\r\n    private menu: HTMLDivElement;\r\n    private button: HTMLElement;\r\n    constructor(props:DropdownActionsProps) {\r\n        super(props);\r\n        this.state = {\r\n            dropdownOpen: false\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        document.addEventListener('click', this.handleDocumentClick);\r\n        document.addEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        document.removeEventListener('click', this.handleDocumentClick);\r\n        document.removeEventListener('touchstart', this.handleDocumentClick);\r\n    }\r\n\r\n    private handleDocumentClick = (evt:any) => {\r\n        if (this.state.dropdownOpen === false) return;\r\n        if (this.button && this.button.contains(evt.target)) return;\r\n        if (!this.menu) return;\r\n        //if (!this.menu.contains(evt.target)) \r\n        this.toggle();\r\n    }\r\n\r\n    private toggle = () => {\r\n        this.setState({\r\n            dropdownOpen: !this.state.dropdownOpen\r\n        });\r\n    }\r\n\r\n    render() {\r\n        let {icon, actions, isRight, className} = this.props;\r\n        if (isRight === undefined) isRight = true;\r\n        let hasIcon = actions.some(v => v.icon!==undefined);\r\n        let {dropdownOpen} = this.state;\r\n        //isOpen={this.state.dropdownOpen} toggle={this.toggle}\r\n        return <div className={classNames('dropdown', className)}>\r\n            <button ref={v=>this.button=v} className=\"cursor-pointer dropdown-toggle btn btn-sm\"\r\n                data-toggle=\"dropdown\"\r\n                aria-expanded={dropdownOpen}\r\n                onClick={this.toggle}>\r\n                <i className={classNames('fa', 'fa-'+(icon||'ellipsis-v'))} />\r\n            </button>\r\n            <div ref={v => this.menu=v} className={classNames({\"dropdown-menu\":true, \"dropdown-menu-right\":isRight, \"show\":dropdownOpen})}>\r\n                {\r\n                    actions.map((v,index) => {\r\n                        let {icon, caption, action} = v;\r\n                        if (icon === undefined && caption === undefined) \r\n                            return <div className=\"dropdown-divider\" />;\r\n                        let i:any;\r\n                        if (hasIcon === true) {\r\n                            if (icon !== undefined) icon = 'fa-' + icon;\r\n                            i = <><i className={classNames('fa', icon, 'fa-fw')} aria-hidden={true}></i>&nbsp; </>;\r\n                        }\r\n                        if (action === undefined) \r\n                            return <h6 className=\"dropdown-header\">{i} {caption}</h6>;\r\n                        let onMenuItemClick = (evt:React.MouseEvent<HTMLAnchorElement>)=>{\r\n                            evt.preventDefault();\r\n                            action();\r\n                        }\r\n                        let onTouchStart = (evt: React.TouchEvent<HTMLAnchorElement>) => {\r\n                            action();\r\n                        }\r\n                            // eslint-disable-next-line\r\n                        return <a className=\"dropdown-item\" key={index} href=\"#/\" \r\n                            onClick={onMenuItemClick} onTouchStart={onTouchStart}\r\n                            >{i} {caption}</a>\r\n                    })\r\n                }\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { setRes } from '../../components';\r\n\r\nexport interface EasyDateProps {\r\n    date: Date | number;\r\n}\r\n\r\n//type YMD = (year:number, month:number, date:number) => string;\r\n//type MD = (month:number, date:number) => string;\r\n\r\nconst timeRes:{[prop:string]:any} = {\r\n\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\tyesterday: 'Yday',\r\n\ttoday: 'Today',\r\n\ttomorrow: 'Tmw',\r\n\t$zh: {\r\n\t\tmd: (month:number, date:number) => `${month}月${date}日`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}年${month}月${date}日`,\r\n\t\tyesterday: '昨天',\r\n\t\ttoday: '今天',\r\n\t\ttomorrow: '明天',\r\n\t},\r\n\t$en: {\r\n\t\tmd: (month:number, date:number) => `${month}-${date}`,\r\n\t\tymd: (year:number, month:number, date:number) => `${year}-${month}-${date}`,\r\n\t\tyesterday: 'Yday',\r\n\t\ttoday: 'Today',\r\n\t\ttomorrow: 'Tmw',\r\n\t}\r\n}\r\n\r\nsetRes(timeRes, timeRes);\r\n\r\nfunction tt(str:string):any {\r\n\treturn timeRes[str];\r\n}\r\n\r\nfunction renderDate(vDate:Date|number, withTime:boolean) {\r\n    if (!vDate) return null;\r\n    let date: Date;\r\n    switch (typeof vDate) {\r\n        default: date = vDate as Date; break;\r\n        case 'string': date = new Date(vDate); break;\r\n        case 'number': date = new Date((vDate as number)*1000); break;\r\n    }\r\n\r\n    let now = new Date();\r\n    let tick:number, nDate:number, _date:number, month:number, year:number, hm:string, nowYear:number;\r\n    let d = date;\r\n    tick = now.getTime() - d.getTime();\r\n    let hour=d.getHours(), minute=d.getMinutes();\r\n    nDate=now.getDate();\r\n    _date=d.getDate();\r\n    month=d.getMonth()+1;\r\n    year=d.getFullYear();\r\n    nowYear = now.getFullYear();\r\n    hm = withTime === true? hour + ((minute<10?':0':':') + minute) : '';\r\n\r\n    if (tick < -24*3600*1000) {\r\n        if (year === nowYear)\r\n            return tt('md')(month, _date) + ' ' + hm;\r\n        else\r\n            return tt('ymd')(year, month, _date) + ' ' + hm;\r\n    }\r\n    if (tick < 24*3600*1000) {\r\n        return _date!==nDate? \r\n            tt(tick < 0? 'tomorrow' : 'yesterday') + ' ' + hm \r\n            : withTime===true? hm : tt('today');\r\n    }\r\n    if (year === nowYear) {\r\n        return tt('md')(month, _date);\r\n    }\r\n    return tt('ymd')(year, month, _date);\r\n}\r\n\r\n\r\nexport class EasyDate extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, false);\r\n    }\r\n}\r\n\r\nexport class EasyTime extends React.Component<EasyDateProps> {\r\n    render() {\r\n        return renderDate(this.props.date, true);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Image } from '.';\r\n\r\nexport interface MediaProps {\r\n    icon: string;\r\n    main: string|JSX.Element;\r\n    discription?: string | JSX.Element;\r\n    px?: number;\r\n    py?: number;\r\n}\r\n\r\nexport class Media extends React.Component<MediaProps> {\r\n    render() {\r\n        let {icon, main, discription, px, py} = this.props;\r\n        let disp:any;\r\n        if (typeof discription === 'string')\r\n            disp = <div>{discription}</div>;\r\n        else\r\n            disp = discription;\r\n        let cn = classNames(\r\n            'media', \r\n            px===undefined? 'px-0':'px-'+px, \r\n            py===undefined? 'py-2':'py-'+py);\r\n        return <div className={cn}>\r\n            <Image className=\"mr-3 w-4c h-4c\" src={icon} />\r\n            <div className=\"media-body\">\r\n                <h5 className=\"mt-0\">{main}</h5>\r\n                {disp}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\n\r\nexport interface SearchBoxProps {\r\n    className?: string;\r\n    label?: string;\r\n    initKey?: string;\r\n    placeholder?: string;\r\n    buttonText?: string;\r\n    maxLength?: number;\r\n    size?: 'sm' | 'md' | 'lg';\r\n    inputClassName?: string;\r\n    onSearch: (key:string)=>Promise<void>;\r\n    onFocus?: ()=>void;\r\n    allowEmptySearch?: boolean;\r\n}\r\n\r\n/*\r\nexport interface SearchBoxState {\r\n    disabled: boolean;\r\n}*/\r\n\r\nexport class SearchBox extends React.Component<SearchBoxProps> { //}, SearchBoxState> {\r\n    private input: HTMLInputElement;\r\n    private key: string = null;\r\n    @observable private disabled: boolean;\r\n\r\n    private onChange = (evt: React.ChangeEvent<any>) => {\r\n        this.key = evt.target.value;\r\n        if (this.key !== undefined) {\r\n            this.key = this.key.trim();\r\n            if (this.key === '') this.key = undefined;\r\n        }\r\n        if (this.props.allowEmptySearch !== true) {\r\n            this.disabled = !this.key;\r\n        }\r\n    }\r\n    private onSubmit = async (evt: React.FormEvent<any>) => {\r\n        evt.preventDefault();\r\n        if (this.key === null) this.key = this.props.initKey || '';\r\n        if (this.props.allowEmptySearch !== true) {\r\n            if (!this.key) return;\r\n            if (this.input) this.input.disabled = true;\r\n        }\r\n        await this.props.onSearch(this.key);\r\n        if (this.input) this.input.disabled = false;\r\n    }\r\n    clear() {\r\n        if (this.input) this.input.value = '';\r\n    }\r\n    render() {\r\n        let {className, inputClassName, onFocus,\r\n            label, placeholder, buttonText, maxLength, size} = this.props;\r\n        let inputSize:string;\r\n        switch (size) {\r\n            default:\r\n            case 'sm': inputSize = 'input-group-sm'; break;\r\n            case 'md': inputSize = 'input-group-md'; break;\r\n            case 'lg': inputSize = 'input-group-lg'; break;\r\n        }\r\n        return <form className={className} onSubmit={this.onSubmit} >\r\n            <div className={classNames(\"input-group\", inputSize)}>\r\n                {label && <div className=\"input-group-addon align-self-center mr-2\">{label}</div>}\r\n                <input ref={v=>this.input=v} onChange={this.onChange}\r\n                    type=\"text\"\r\n                    name=\"key\"\r\n                    onFocus={onFocus}\r\n                    className={classNames('form-control', inputClassName || 'border-primary')}\r\n                    placeholder={placeholder}\r\n                    defaultValue={this.props.initKey}\r\n                    maxLength={maxLength} />\r\n                <div className=\"input-group-append\">\r\n                    <button className=\"btn btn-primary\"\r\n                        type=\"submit\"\r\n                        disabled={this.disabled}>\r\n                        <i className='fa fa-search' />\r\n                        <i className=\"fa\"/>\r\n                        {buttonText}\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </form>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { nav } from './nav';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { userApi } from '../net';\r\nimport { User } from '../tool';\r\n\r\nexport type UserLoader = (userId:number)=>Promise<any>;\r\n\r\nexport class UserCache<T> {\r\n\tprivate loader: UserLoader;\r\n\tprivate map = observable(new Map<number, T|number>());\r\n\r\n\tconstructor(loader: UserLoader) {\r\n\t\tif (loader === undefined) loader = (userId:number)=>userApi.user(userId);\r\n\t\tthis.loader = loader;\r\n\t}\r\n\r\n\tuse(id:number|any) {\r\n\t\tif (!id) return;\r\n\t\tif (typeof id === 'object') id = id.id;\r\n\t\tif (!id) return;\r\n\t\tid = Number(id);\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (ret === undefined) {\r\n\t\t\tthis.map.set(id, id);\r\n\t\t}\r\n\t}\r\n\r\n\tgetValue(id:number|any):any {\r\n\t\tif (!id) return;\r\n\t\tswitch (typeof(id)) {\r\n\t\t\tcase 'object': \r\n\t\t\t\tid = id.id; \r\n\t\t\t\tif (!id) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tlet ret = this.map.get(id);\r\n\t\tif (!ret) return;\r\n\t\tswitch (typeof(ret)) {\r\n\t\tdefault:\r\n\t\t\treturn ret;\r\n\t\tcase 'number':\r\n\t\t\tif (ret < 0) return id;\r\n\t\t\tthis.map.set(id, -id);\r\n\t\t\tthis.loader(id).then(v => {\r\n\t\t\t\tif (!v) v = null;\r\n\t\t\t\tthis.map.set(id, v);\r\n\t\t\t}).catch(reason => {\r\n\t\t\t\tconsole.error(reason);\r\n\t\t\t});\r\n\t\t\treturn id;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nconst userCache = new UserCache(undefined);\r\n\r\nexport interface UserIconProps {\r\n    id: number;\r\n    className?: string;\r\n    style?: React.CSSProperties;\r\n    altImage?: string;\r\n    noneImage?: any;\r\n}\r\n\r\nexport const UserIcon = observer((props: UserIconProps):JSX.Element => {\r\n    let {className, style, id, altImage, noneImage} = props;\r\n    let user = userCache.getValue(id);\r\n    switch (typeof user) {\r\n\tcase 'undefined':\r\n\tcase 'number':\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            {noneImage || <i className=\"fa fa-file-o\" />}\r\n        </div>;\r\n    }\r\n    let {icon} = user;\r\n    if (!icon) {\r\n        return <div className={classNames(className, 'image-none')} style={style}>\r\n            <i className=\"fa fa-file-o\" />\r\n        </div>;\r\n    }\r\n    if (icon.startsWith(':') === true) {\r\n        icon = nav.resUrl + icon.substr(1);\r\n    }\r\n    return <img src={icon} className={className} alt=\"img\"\r\n        style={style}\r\n        onError={evt=>{\r\n            if (altImage) evt.currentTarget.src=altImage;\r\n            else evt.currentTarget.src = 'https://tv.jkchemical.com/imgs/0001.png';\r\n        }} />;\r\n});\r\n\r\nexport interface UserViewProps {\r\n\tid?: number;\r\n\tuser?: number|User;\r\n    render: (user:User) => JSX.Element;\r\n}\r\n\r\nexport const UserView = observer((props: UserViewProps):JSX.Element => {\r\n\tlet {id:idProp, user, render} = props;\r\n\tif (user === null) return <>null</>;\r\n\tswitch (typeof user) {\r\n\t\tcase 'undefined': \r\n\t\t\tuser = userCache.getValue(idProp);\r\n\t\t\tbreak;\r\n\t\tcase 'object': \r\n\t\t\tlet {/*obj, */id} = user as any;\r\n\t\t\t//if (typeof obj !== 'object') {\r\n\t\t\t\tuseUser(id);\r\n\t\t\t\tuser = userCache.getValue(id);\r\n\t\t\t//}\r\n\t\t\tbreak;\r\n\t\tcase 'number':\r\n\t\t\tuseUser(user as number);\r\n\t\t\tuser = userCache.getValue(user as number);\r\n\t\t\tbreak;\r\n\t\tcase 'string':\r\n\t\t\tuseUser(Number(user));\r\n\t\t\tuser = userCache.getValue(Number(user));\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tuser = undefined;\r\n\t\t\tbreak;\r\n\t}\r\n    switch (typeof user) {\r\n\t\tcase 'undefined':\r\n\t\tcase 'number':\r\n        \treturn <>{user}</>;\r\n    }\r\n    return render(user);\r\n});\r\n\r\nexport function useUser(id: number|object) {\r\n\tif (!id) return;\r\n\tif (typeof(id) === 'object') {\r\n\t\tid = (id as any).id;\r\n\t}\r\n\tuserCache.use(id);\r\n}\r\n","import { UqMan, TuidModify } from '../uqMan';\r\nimport { Tuid } from \"./tuid\";\r\nimport { env } from '../../tool';\r\n\r\ninterface Modify {\r\n    id: number;\r\n    entity: string;\r\n    key: string;\r\n}\r\n\r\nexport class TuidsCache {\r\n    private readonly uq: UqMan;\r\n    private modifyMax: TuidModify;\r\n    private cacheTimer: any;\r\n    constructor(uq: UqMan) {\r\n        this.uq = uq;\r\n    }\r\n\r\n    cacheTuids(defer:number) {\r\n        this.clearCacheTimer();\r\n        this.cacheTimer = env.setTimeout('TuidsCache.cacheTuids', this.loadIds, defer);\r\n    }\r\n    private clearCacheTimer() {\r\n        if (this.cacheTimer === undefined) return;\r\n        env.clearTimeout(this.cacheTimer);\r\n        this.cacheTimer = undefined;\r\n    }\r\n    private loadIds = () => {\r\n        this.clearCacheTimer();\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            let tuid = tuids[i];\r\n            tuid.cacheIds();\r\n        }\r\n    }\r\n    \r\n    pullModify(modifyMax:number) {\r\n        if (modifyMax === undefined) return;\r\n        let now = Math.floor(Date.now() / 1000);\r\n        if (this.modifyMax === undefined) {\r\n            this.modifyMax = this.uq.localModifyMax.get();\r\n            if (this.modifyMax === undefined) {\r\n                this.modifyMax = {\r\n                    max: modifyMax,\r\n                    seconds: now,\r\n                };\r\n                this.uq.localModifyMax.set(this.modifyMax);\r\n            }\r\n        }\r\n        let {max, seconds} = this.modifyMax;\r\n        let lockGap = 3600;\r\n        if (now - seconds < lockGap) return;\r\n        if (modifyMax <= max) return;\r\n        let tuidCached:string[] = [];\r\n        let {tuids} = this.uq;\r\n        for (let i in tuids) {\r\n            //if (tuids[i].cached === true) \r\n            tuidCached.push(i);\r\n        }\r\n        if (tuidCached.length === 0) return;\r\n        this.modifyMax.seconds = now;\r\n        this.innerPullModify(tuidCached.join('\\t'));\r\n    }\r\n\r\n    private async innerPullModify(tuidLists:string):Promise<void> {\r\n        let {uqApi, tuids} = this.uq;\r\n        let {max} = this.modifyMax;\r\n        let ret:{queue:Modify[], queueMax:number} = await uqApi.queueModify(max, 30, tuidLists);\r\n        let group:{[entity:string]: {tuid:Tuid; ids: string[]}} = {};\r\n        let modifyMax:number = 0;\r\n        for (let modify of ret.queue) {\r\n\t\t\tlet {id, entity, key} = modify;\r\n\t\t\tif (!key) continue;\r\n            let tuid = tuids[entity];\r\n            if (tuid === undefined) continue;\r\n            let item = group[entity];\r\n            if (item === undefined) {\r\n                item = group[entity] = {tuid: tuid, ids:[]};\r\n            }\r\n            item.ids.push(key);\r\n            if (id > modifyMax) modifyMax = id;\r\n        }\r\n        for (let i in group) {\r\n            let {tuid, ids} = group[i];\r\n            await tuid.modifyIds(ids);\r\n        }\r\n        let now = Math.floor(Date.now() / 1000);\r\n        this.modifyMax = {\r\n            max: modifyMax,\r\n            seconds: now,\r\n        }\r\n        this.uq.localModifyMax.set(this.modifyMax);\r\n    }\r\n}\r\n","import { LocalMap, LocalCache, env } from '../tool';\r\nimport { UqData } from '../net';\r\nimport { UqMan } from './uqMan';\r\nimport { TuidImport, TuidInner } from './tuid';\r\nimport { nav } from '../components';\r\n\r\nexport interface TVs {\r\n    [uqName:string]: {\r\n        [tuidName: string]: (values: any) => JSX.Element;\r\n    }\r\n}\r\n\r\nexport class UQsMan {\r\n    private collection: {[uqName: string]: UqMan};\r\n    private readonly tvs: TVs;\r\n\r\n    readonly name: string;\r\n    readonly appOwner: string;\r\n    readonly appName: string;\r\n    readonly localMap: LocalMap;\r\n    readonly localData: LocalCache;\r\n    id: number;\r\n\r\n    constructor(tonvaAppName:string, tvs:TVs) {\r\n        this.tvs = tvs || {};\r\n        this.buildTVs();\r\n        this.collection = {};\r\n        let parts = tonvaAppName.split('/');\r\n        if (parts.length !== 2) {\r\n            throw new Error('tonvaApp name must be / separated, owner/app');\r\n        }\r\n        this.appOwner = parts[0];\r\n        this.appName = parts[1];\r\n        this.localMap = env.localDb.map(tonvaAppName);\r\n        this.localData = this.localMap.child('uqData');\r\n    }\r\n\r\n    // to be removed in the future\r\n    addUq(uq: UqMan) {\r\n        this.collection[uq.name] = uq;\r\n    }\r\n\r\n    private buildTVs() {\r\n        for (let i in this.tvs) {\r\n            let uqTVs = this.tvs[i];\r\n            if (uqTVs === undefined) continue;\r\n            let l = i.toLowerCase();\r\n            if (l === i) continue;\r\n            this.tvs[l] = uqTVs;\r\n            for (let j in uqTVs) {\r\n                let en = uqTVs[j];\r\n                if (en === undefined) continue;\r\n                let lj = j.toLowerCase();\r\n                if (lj === j) continue;\r\n                uqTVs[lj] = en;\r\n            }\r\n        }\r\n    }\r\n\r\n    async init(uqsData:UqData[]):Promise<void> {\r\n        let promiseInits: PromiseLike<void>[] = [];\r\n        for (let uqData of uqsData) {\r\n            let {uqOwner, uqName} = uqData;\r\n            let uqFullName = uqOwner + '/' + uqName;\r\n            //let uqUI = this.ui.uqs[uqFullName] as UqUI || {};\r\n            //let cUq = this.newCUq(uqData, uqUI);\r\n            //this.cUqCollection[uqFullName] = cUq;\r\n            //this.uqs.addUq(cUq.uq);\r\n            let uq = new UqMan(this, uqData, undefined, this.tvs[uqFullName] || this.tvs[uqName]);\r\n            this.collection[uqFullName] = uq;\r\n            let lower = uqFullName.toLowerCase();\r\n            if (lower !== uqFullName) {\r\n                this.collection[lower] = uq;\r\n            }\r\n            promiseInits.push(uq.init());\r\n        }\r\n        await Promise.all(promiseInits);\r\n    }\r\n\r\n    async load(): Promise<string[]> {\r\n        let retErrors:string[] = [];\r\n        let promises: PromiseLike<string>[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            promises.push(uq.loadEntities());\r\n\t\t}\t\t\r\n        let results = await Promise.all(promises);\r\n        for (let result of results)\r\n        {\r\n            let retError = result; // await cUq.loadSchema();\r\n            if (retError !== undefined) {\r\n                retErrors.push(retError);\r\n                continue;\r\n            }\r\n\t\t}\r\n        return retErrors;\r\n    }\r\n\r\n    buildUQs(): any {\r\n        let that = this;\r\n        let uqs:any = {};\r\n        for (let i in this.collection) {\r\n            let uqMan = this.collection[i];\r\n            //let n = uqMan.name;\r\n            let uqName = uqMan.uqName;\r\n            let l = uqName.toLowerCase();\r\n            let entities = uqMan.entities;\r\n            let keys = Object.keys(entities);\r\n            for (let key of keys) {\r\n                let entity = entities[key];\r\n                let {name} = entity;\r\n                //if (name !== sName) \r\n                //entities[sName] = entity;\r\n                entities[name.toLowerCase()] = entity;\r\n            }\r\n            //uqs[i] = entities;\r\n            //uqs[uqName] = entities;\r\n            //if (l !== uqName) \r\n            uqs[l] = new Proxy(entities, {\r\n                get: function(target, key, receiver) {\r\n                    let lk = (key as string).toLowerCase();\r\n                    let ret = target[lk];\r\n                    if (ret !== undefined) return ret;\r\n\t\t\t\t\tdebugger;\r\n\t\t\t\t\tlet err = `entity ${uqName}.${String(key)} not defined`;\r\n                    console.error(err);\r\n                    that.showReload('UQ错误：' + err);\r\n                    return undefined;\r\n                }\r\n            });\r\n        }\r\n        //let uqs = this.collection;\r\n        return new Proxy(uqs, {\r\n            get: function (target, key, receiver) {\r\n                let lk = (key as string).toLowerCase();\r\n                let ret = target[lk];\r\n                if (ret !== undefined) return ret;\r\n                /*\r\n                for (let i in uqs) {\r\n                    if (i.toLowerCase() === lk) {\r\n                        return uqs[i];\r\n                    }\r\n                }*/\r\n                debugger;\r\n                console.error('error in uqs');\r\n                that.showReload(`代码错误：新增 uq ${String(key)}`);\r\n                return undefined;\r\n            },\r\n        });\r\n    }\r\n\r\n    private showReload(msg: string) {\r\n        this.localMap.removeAll();\r\n        nav.showReloadPage(msg);\r\n    }\r\n\r\n    setTuidImportsLocal():string[] {\r\n        let ret:string[] = [];\r\n        for (let i in this.collection) {\r\n            let uq = this.collection[i];\r\n            for (let tuid of uq.tuidArr) {\r\n                if (tuid.isImport === true) {\r\n                    let error = this.setInner(tuid as TuidImport);\r\n                    if (error) ret.push(error);\r\n                }\r\n            }\r\n        }\r\n        return ret;\r\n    }\r\n\r\n    private setInner(tuidImport: TuidImport):string {\r\n        let {from} = tuidImport;\r\n        let fromName = from.owner + '/' + from.uq;\r\n        let uq = this.collection[fromName];\r\n        if (uq === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} is not loaded`;\r\n        }\r\n        let iName = tuidImport.name\r\n        let tuid = uq.tuid(iName);\r\n        if (tuid === undefined) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} has no Tuid ${iName}`;\r\n        }\r\n        if (tuid.isImport === true) {\r\n            //debugger;\r\n            return `setInner(tuidImport: TuidImport): uq ${fromName} Tuid ${iName} is import`;\r\n        }\r\n        tuidImport.setFrom(tuid as TuidInner);\r\n    }\r\n}\r\n","import _ from 'lodash';\r\nimport { Context } from '../context';\r\nimport { FormRes } from '../../../res/formRes';\r\n\r\nexport abstract class Rule {\r\n    abstract check(defy:string[], value:any):void;\r\n}\r\n\r\nexport type ContextRule = (context:Context)=>{[target:string]:string[]|string} | string[] | string;\r\nexport type FieldRule = (value:any) => string[] | string;\r\n\r\nexport class RuleCustom extends Rule {\r\n    private func: FieldRule;\r\n    constructor(func: FieldRule) {\r\n        super();\r\n        this.func = func;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        let ret = this.func(value);\r\n        if (ret === undefined) return;\r\n        switch (typeof ret) {\r\n            case 'undefined': return;\r\n            case 'string': defy.push(ret as string); return;\r\n            default: defy.push(...ret); return;\r\n        }        \r\n    }\r\n}\r\n\r\nexport abstract class RulePredefined extends Rule {\r\n    protected res: FormRes;\r\n    constructor(res: FormRes) {\r\n        super();\r\n        this.res = res;\r\n    }\r\n}\r\n\r\nexport class RuleRequired extends RulePredefined {\r\n    check(defy:string[], value:any) {\r\n        switch (typeof value) {\r\n            default:\r\n            case 'boolean': return;\r\n            case 'object':\r\n                if (value !== null) return;\r\n                break;\r\n            case 'string':\r\n                if ((value as string).trim().length > 0) return;\r\n                break;\r\n            case 'number':\r\n                if (isNaN(value as number) === false) return;\r\n                break;\r\n            case 'undefined':\r\n                break;\r\n        }\r\n        defy.push(this.res.required);\r\n    }\r\n}\r\n\r\nexport class RuleNum extends RulePredefined {\r\n    private minMsg: _.TemplateExecutor;\r\n    private maxMsg: _.TemplateExecutor;\r\n    protected min: number;\r\n    protected max: number\r\n    constructor(res: FormRes, min?: number, max?: number) {\r\n        super(res);\r\n        this.minMsg = _.template(res.min);\r\n        this.maxMsg = _.template(res.max);\r\n        this.min = min;\r\n        this.max = max;\r\n    }\r\n    check(defy:string[], value:any) {\r\n        if (value === undefined || value === null) return;\r\n        let n = Number(value);\r\n        if (isNaN(n) === true) {\r\n            defy.push(this.res.number);\r\n        }\r\n        else {\r\n            this.checkMore(defy, n);\r\n        }\r\n    }\r\n\r\n    protected checkMore(defy:string[], value: number) {\r\n        if (this.min !== undefined && Number(value) < this.min) {\r\n            defy.push(this.minMsg({min:this.min}));\r\n        }\r\n        if (this.max !== undefined && Number(value) > this.max) {\r\n            defy.push(this.maxMsg({max:this.max}));\r\n        }\r\n    }\r\n}\r\n\r\nexport class RuleInt extends RuleNum {\r\n    protected checkMore(defy:string[], n: number) {\r\n        super.checkMore(defy, n);\r\n        if (Number.isInteger(n) === false) {\r\n            defy.push(this.res.integer);\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiItem, ChangingHandler, ChangedHandler } from '../../schema';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { ItemSchema } from '../../schema';\r\nimport { Rule, RuleRequired, RuleCustom, FieldRule } from '../rules';\r\nimport { computed, observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Widget {\r\n    name: string;\r\n    protected context: Context;\r\n    protected fieldProps:FieldProps;\r\n    protected children: React.ReactNode;\r\n    protected _itemSchema: ItemSchema;\r\n    protected _ui: UiItem;\r\n    protected defaultValue: any;\r\n    protected value: any;\r\n    protected rules: Rule[];\r\n    @observable errors: string[] = [];\r\n    @observable protected contextErrors: string[] = [];\r\n    @computed protected get hasError():boolean {return (this.errors.length + this.contextErrors.length)>0}\r\n    protected readOnly:boolean;\r\n    protected disabled:boolean;\r\n    @observable visible:boolean;\r\n\r\n    constructor(context:Context, itemSchema:ItemSchema, fieldProps:FieldProps, children: React.ReactNode) {\r\n        this.context = context;\r\n        let {name} = itemSchema;\r\n        this.name = name;\r\n        this._itemSchema = itemSchema;\r\n        this.fieldProps = fieldProps;\r\n        this.children = children;\r\n        this._ui = context.getUiItem(name);\r\n        if (this.ui === undefined) {\r\n            this.readOnly = false;\r\n            this.disabled = false;\r\n            this.visible = true;\r\n        }\r\n        else {\r\n            let {readOnly, disabled, visible} = this.ui;\r\n            this.readOnly = (readOnly === true);\r\n            this.disabled = (disabled === true);\r\n            this.visible = !(visible === false);            \r\n        }\r\n        this.value = this.defaultValue =  context.getValue(name); //defaultValue;\r\n        // this.init();\r\n    }\r\n\r\n    protected get itemSchema(): ItemSchema {return this._itemSchema};\r\n    protected get ui(): UiItem {return this._ui};\r\n\r\n    init() {\r\n        this.rules = [];\r\n        if (this.itemSchema.required === true) {\r\n            this.rules.push(new RuleRequired(this.context.form.res));\r\n        }\r\n        this.buildRules();\r\n        if (this.ui === undefined) return;\r\n        let {rules} = this.ui;\r\n        if (rules === undefined) return;\r\n        if (Array.isArray(rules) === false) {\r\n            this.rules.push(new RuleCustom(rules as FieldRule));\r\n            return;\r\n        }\r\n        for (let rule of rules as FieldRule[]) {\r\n            this.rules.push(new RuleCustom(rule));\r\n        }\r\n    }\r\n\r\n    protected buildRules() {\r\n    }\r\n\r\n    checkRules() {\r\n        let defy:string[] = [];\r\n        for (let r of this.rules) r.check(defy, this.value);\r\n        if (defy.length === 0) {\r\n            this.context.removeErrorWidget(this);\r\n        }\r\n        else {\r\n            this.context.addErrorWidget(this);\r\n            this.errors.push(...defy);\r\n        }\r\n    }\r\n\r\n    @computed get isOk() {\r\n        return this.errors.length ===0;\r\n    }\r\n\r\n    setError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.errors.push(err);\r\n        else this.errors.push(...err);\r\n    }\r\n\r\n    setContextError(err:string | string[]) {\r\n        if (err === undefined) return;\r\n        if (typeof err === 'string') this.contextErrors.push(err);\r\n        else this.contextErrors.push(...err);\r\n    }\r\n\r\n    clearError() {\r\n        this.errors.splice(0);\r\n    }\r\n\r\n    clearContextError() {\r\n        this.contextErrors.splice(0);\r\n    }\r\n\r\n    protected parse(value:any):any {return value}\r\n\r\n    protected setElementValue(value:any) {}\r\n    protected setDataValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        this.context.initData[this.name] = this.value = this.parse(value);\r\n    }\r\n\r\n    setValue(value:any) {\r\n        if (this.isChanging === true) return;\r\n        //this.setDataValue(value);\r\n        //this.setElementValue(value);\r\n        this.changeValue(value, false);\r\n    }\r\n\r\n    getValue() {\r\n        return this.context.getValue(this.name);\r\n    }\r\n\r\n    getReadOnly():boolean {return this.readOnly}\r\n    getDisabled():boolean {return this.disabled}\r\n    getVisible():boolean {return this.visible}\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}\r\n    setVisible(value:boolean) {this.visible = value}\r\n\r\n    private isChanging: boolean;\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n\r\n    protected changeValue(newValue: any, fromElement: boolean) {\r\n        let prev = this.value;\r\n        let onChanging: ChangingHandler;\r\n        let onChanged: ChangedHandler;\r\n        if (this.ui !== undefined) {\r\n            onChanging = this.ui.onChanging;\r\n            onChanged = this.ui.onChanged;\r\n        }\r\n        let allowChange = true;\r\n        if (onChanging !== undefined) {\r\n            this.isChanging = true;\r\n            allowChange = onChanging(this.context, this.value, prev);\r\n            this.isChanging = false;\r\n        }\r\n        if (allowChange === true) {\r\n            this.setDataValue(newValue);\r\n            if (fromElement !== true) this.setElementValue(newValue);\r\n            if (onChanged !== undefined) {\r\n                this.isChanging = true;\r\n                onChanged(this.context, this.value, prev);\r\n                this.isChanging = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    protected get className():string {\r\n        let fieldClass:string;\r\n        if (this.context.inNode === false) fieldClass = 'form-control';\r\n        return classNames(fieldClass, this.context.form.FieldClass, this.ui && this.ui.className);\r\n    }\r\n\r\n    protected abstract render():JSX.Element;\r\n\r\n    protected renderBody():JSX.Element {\r\n        let elDiscription;\r\n        if (this.hasError === false && this.ui) {\r\n            let {discription, discriptionClassName} = this.ui;\r\n            if (discriptionClassName === undefined) discriptionClassName = 'small text-muted';\r\n            elDiscription = <span className={discriptionClassName}>\r\n                {discription}\r\n            </span>;\r\n        }\r\n        return <>\r\n            {this.render()}\r\n            {elDiscription}\r\n        </>;\r\n    }\r\n\r\n    container = observer(():JSX.Element => {\r\n        if (this.visible === false) return null;\r\n        let {form, inNode} = this.context;\r\n        if (inNode === true) return this.render();\r\n        let label:any = this.label;\r\n        if (this.itemSchema.required === true && form.props.requiredFlag !== false) {\r\n            if (label !== null) label = <>{label}&nbsp;<span className=\"text-danger\">*</span></>;\r\n        }\r\n        return form.FieldContainer(label, this.renderBody());\r\n    })\r\n\r\n    protected get label():string {\r\n        let label:any;\r\n        if (this.ui === undefined) {\r\n            label = this.name;\r\n        }\r\n        else {\r\n            let uiLabel = this.ui.label;\r\n            if (uiLabel === null) label = null;\r\n            else label = uiLabel || this.name;\r\n        }\r\n        return label;\r\n    }\r\n\r\n    protected renderTemplet():JSX.Element | undefined {\r\n        if (this.children !== undefined) {\r\n            return <>{this.children}</>;\r\n        }\r\n        if (this.ui === undefined) return undefined;\r\n        let {Templet} = this.ui;\r\n        if (typeof Templet === 'function') return Templet(this.value);\r\n        return Templet;\r\n    }\r\n\r\n    protected renderErrors() {\r\n        let errorList:string[] = [...this.errors, ...this.contextErrors];\r\n        if (errorList.length === 0) return null;\r\n        let {inNode} = this.context;\r\n        let tag = inNode === true? 'span' : 'div';\r\n        return errorList.map(err => React.createElement(tag, \r\n            {\r\n                key: err, \r\n                className: 'text-danger d-inline-block my-2 ml-3'\r\n            },\r\n            <><i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}</>\r\n        ));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextItem, StringSchema } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class TextWidget extends Widget {\r\n    protected inputType = 'text';\r\n    protected get ui(): UiTextItem {return this._ui as UiTextItem};\r\n    protected input: HTMLInputElement;\r\n    @observable protected hasFocus: boolean;\r\n\r\n    protected setElementValue(value:any) {\r\n        if (this.input === null) return;\r\n        this.input.value = value;\r\n    }\r\n    protected get placeholder() {return (this.ui && this.ui.placeholder) || this.name}\r\n    protected onKeyDown = async (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n        this.internalOnKeyDown(evt);\r\n        if (evt.keyCode !== 13) return;\r\n        let {onEnter} = this.context.form.props;\r\n        if (onEnter === undefined) return;\r\n\r\n        this.changeValue(evt.currentTarget.value, true);\r\n\r\n        //this.checkRules();\r\n        //this.context.checkContextRules();\r\n        this.input.blur();\r\n\r\n        let ret = await onEnter(this.name, this.context);\r\n        if (ret !== undefined) {\r\n            this.context.setError(this.name, ret);\r\n        }\r\n    }\r\n\r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n    }\r\n\r\n    protected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n\t\tthis.context.checkContextRules();\r\n\t\tthis.hasFocus = false;\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n\t\tthis.hasFocus = true;\r\n    }\r\n    protected onChange(evt: React.ChangeEvent<any>) {\r\n    }\r\n\r\n    setReadOnly(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.readOnly = this.readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        if (this.input === null) return;\r\n        this.input.disabled = this.disabled = value;\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {\r\n            //'form-control': true,\r\n        };\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, cn)}\r\n            type={this.inputType}\r\n            defaultValue={this.value}\r\n            onChange={(evt: React.ChangeEvent<any>) => this.onChange(evt)}\r\n            placeholder={this.placeholder}\r\n            readOnly={this.readOnly}\r\n            disabled={this.disabled}\r\n            onKeyDown = {this.onKeyDown}\r\n            onFocus = {this.onFocus}\r\n            onBlur={this.onBlur}\r\n            maxLength={(this.itemSchema as StringSchema).maxLength} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTextAreaItem } from '../../schema';\r\nimport { StringSchema } from '../../schema';\r\n\r\nexport class TextAreaWidget extends Widget {\r\n    protected get itemSchema(): StringSchema {return this._itemSchema as StringSchema};\r\n    protected input: HTMLTextAreaElement;\r\n    protected get ui(): UiTextAreaItem {return this._ui as UiTextAreaItem};\r\n\r\n    protected setElementValue(value:any) {this.input.value = value}\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLTextAreaElement>) => {\r\n        this.setValue(evt.currentTarget.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n\tprotected onBlur = (evt: React.FocusEvent<any>) => {\r\n        this.onInputChange(evt);\r\n        this.checkRules();\r\n        this.context.checkContextRules();\r\n    }\r\n    protected onFocus = (evt: React.FocusEvent<any>) => {\r\n        this.clearError();\r\n        this.context.removeErrorWidget(this);\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let renderTemplet = this.renderTemplet();\r\n        if (renderTemplet !== undefined) return renderTemplet;\r\n        let cn:any = {};\r\n        if (this.hasError === true) {\r\n            cn['is-invalid'] = true;\r\n        }\r\n        else {\r\n            cn['required-item'] = this.itemSchema.required === true;\r\n        }\r\n        return <>\r\n\t\t\t<textarea ref={(input) => this.input=input}\r\n\t\t\t\tonBlur={this.onBlur} \r\n\t\t\t\tonFocus={this.onFocus}\r\n                className={classNames(this.className, cn)}\r\n                rows={this.ui && this.ui.rows}\r\n                maxLength={this.itemSchema.maxLength}\r\n                defaultValue={this.defaultValue} onChange={this.onInputChange} />\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class PasswordWidget extends TextWidget {\r\n    protected inputType = 'password';\r\n}\r\n\r\nexport class UrlWidget extends TextWidget {\r\n    protected inputType = 'url';\r\n}\r\n\r\nexport class EmailWidget extends TextWidget {\r\n    protected inputType = 'email';\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\nimport { RuleNum, RuleInt } from '../rules';\r\nimport { NumBaseSchema } from '../../schema';\r\n\r\nexport class NumberWidget extends TextWidget {\r\n    protected inputType = 'number';\r\n    protected get itemSchema(): NumBaseSchema {return this._itemSchema as NumBaseSchema};\r\n\r\n    protected buildRules() {\r\n        super.buildRules();\r\n        let res = this.context.form.res;\r\n        let {min, max} = this.itemSchema;\r\n        this.rules.push(\r\n            this.itemSchema.type === 'integer'?\r\n                new RuleNum(res, min, max) :\r\n                new RuleInt(res, min, max)\r\n        );\r\n        /*\r\n        if (this.itemSchema.type === 'integer') {\r\n            this.rules.push(new RuleInt);\r\n        }\r\n        let {min, max} = this.itemSchema;\r\n        if (min !== undefined) this.rules.push(new RuleMin(min));\r\n        if (max !== undefined) this.rules.push(new RuleMax(max));\r\n        */\r\n    }\r\n\r\n    protected parse(value:any):any {\r\n        if (value === undefined || value === null) return;\r\n        return Number(value);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { NumberWidget } from './numberWidget';\r\n\r\nexport class UpdownWidget extends NumberWidget {\r\n    protected inputType = 'number';\r\n\r\n    protected isValidKey(key:number):boolean {\r\n        return key===46 || key===8 || key===37 || key===39\r\n            || (key>=48 && key<=57)\r\n            || (key>=96 && key<=105)\r\n            || key===109 || key===189;\r\n    }\r\n    \r\n    protected internalOnKeyDown(evt:React.KeyboardEvent<HTMLInputElement>) {\r\n        let key = evt.keyCode;\r\n        window.event.returnValue = this.isValidKey(key);\r\n    }\r\n}\r\n","//import * as React from 'react';\r\nimport { TextWidget } from './textWidget';\r\n\r\nexport class DateWidget extends TextWidget {\r\n    protected inputType = 'date';\r\n}\r\n\r\nexport class DateTimeWidget extends TextWidget {\r\n    protected inputType = 'datetime';\r\n}\r\n\r\nexport class TimeWidget extends TextWidget {\r\n    protected inputType = 'time';\r\n}\r\n\r\nexport class MonthWidget extends TextWidget {\r\n    protected inputType = 'month';\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiCheckItem } from '../../schema';\r\n\r\nexport class CheckBoxWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiCheckItem {return this._ui as UiCheckItem};\r\n    protected trueValue: any;\r\n    protected falseValue: any;\r\n\r\n    init() {\r\n        super.init();\r\n        if (this.ui !== undefined) {\r\n            let {trueValue, falseValue} = this.ui;\r\n            if (trueValue === undefined) this.trueValue = true;\r\n            else this.trueValue = trueValue;\r\n            if (falseValue === undefined) this.falseValue = false;\r\n            else this.falseValue = falseValue;\r\n        }\r\n        else {\r\n            this.trueValue = true;\r\n            this.falseValue = false;\r\n        }\r\n    }\r\n    protected setElementValue(value:any) {\r\n        this.input.checked = value === this.trueValue;\r\n    }\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        let v = evt.target.checked === true? this.trueValue : this.falseValue;\r\n        this.setDataValue(v);\r\n    }\r\n\r\n    protected onClick = () => {\r\n        this.context.clearErrors();\r\n    }\r\n\r\n    render() {\r\n        let cn = classNames(this.className, 'form-check-inline p-0');\r\n        let input = <input\r\n            ref={(input)=>this.input = input}\r\n            className={'align-self-center'}\r\n            type=\"checkbox\"\r\n            defaultChecked={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            onClick={this.onClick} />;\r\n        if (this.context.inNode === true) {\r\n            return <label className={cn}>\r\n                {input} {(this.ui&&this.ui.label) || this.name}\r\n            </label>\r\n        }\r\n        else {\r\n            return <div className={cn}>\r\n                <label className=\"w-100 h-100 mb-0 d-flex justify-content-center\">{input}</label>\r\n            </div>;\r\n        }\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observable } from 'mobx';\r\nimport { Widget } from './widget';\r\nimport { UiSelect } from '../../schema';\r\n\r\nexport class SelectWidget extends Widget {\r\n    protected select: HTMLSelectElement;\r\n    protected get ui(): UiSelect {return this._ui as UiSelect};\r\n    @observable protected readOnly: boolean;\r\n\r\n    protected setElementValue(value:any) {this.select.value = value}\r\n    protected onInputChange = (evt:React.ChangeEvent<HTMLSelectElement>) => {\r\n        this.setDataValue(evt.target.value);\r\n    }\r\n\r\n    setReadOnly(value:boolean) {this.select.disabled = this.readOnly = !value}\r\n    setDisabled(value:boolean) {this.select.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        if (this.readOnly === true) {\r\n            let option = this.ui.list.find(v => v.value === this.value);\r\n            let title = (option === undefined)? '(???)' : option.title;\r\n            return <span className=\"form-control w-min-6c\">{title}</span>;\r\n        }\r\n        return <select\r\n            ref={(select)=>this.select = select}\r\n            className={classNames(this.className, 'form-control')}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}>\r\n            {this.ui.list.map((v,index) => {\r\n                let {title, value} = v;\r\n                let cn:string;\r\n                //if (value === undefined || value === null) cn = 'text-light small';\r\n                //else cn = 'text-danger';\r\n                return <option className={cn} key={index} value={value}>{title || value}</option>\r\n            })}\r\n        </select>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\n//import { TextWidget } from './textWidget';\r\nimport { Widget } from './widget';\r\nimport { UiRadio } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\n\r\nconst radioStyle:React.CSSProperties = {height: 'auto'};\r\n\r\nexport class RadioWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiRadio {return this._ui as UiRadio};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n    }\r\n\r\n    /*\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n        this.changeValue(evt.target.value, true);\r\n    }\r\n    */\r\n\r\n    render() {\r\n        let {defaultValue, list} = this.ui;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n        return <span className={cn} style={radioStyle}>\r\n                {list.map((v,index) => {\r\n                    let {value, title} = v;\r\n                    let name = this.name;\r\n                    if (rowKey !== undefined) name += '-' + rowKey;\r\n                    return <label key={index} className=\"form-radio-inline\">\r\n                        <input ref={input=>this.inputs[index]=input} type=\"radio\" name={name}\r\n                            value={value} defaultChecked={(this.defaultValue || defaultValue)===value}\r\n                            onChange={this.onInputChange} />\r\n                        {title || value}\r\n                    </label>;\r\n                    //</span>\r\n                })}\r\n            </span>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { UiRange } from '../../schema';\r\nimport { Widget } from './widget';\r\n\r\nexport class RangeWidget extends Widget {\r\n    protected inputType = 'range';\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiRange {return this._ui as UiRange};\r\n\r\n    setReadOnly(value:boolean) {this.input.readOnly = this.readOnly = value}\r\n    setDisabled(value:boolean) {this.input.disabled = this.disabled = value}\r\n\r\n    render() {\r\n        let {min, max, step} = this.ui;\r\n        return <><input ref={input=>this.input = input}\r\n            className={classNames(this.className, 'form-control', 'w-min-6c')}\r\n            type={this.inputType}\r\n            defaultValue={this.defaultValue} \r\n            onChange={this.onInputChange}\r\n            max={max}\r\n            min={min}\r\n            step={step}\r\n            />\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiIdItem, TempletType } from '../../schema';\r\nimport { observable } from 'mobx';\r\n\r\nexport class IdWidget extends Widget {\r\n    protected get ui(): UiIdItem {return this._ui as UiIdItem};\r\n    @observable protected value:number;\r\n    setReadOnly(value:boolean) {this.readOnly = value}\r\n    setDisabled(value:boolean) {this.disabled = value}    \r\n\r\n    protected onClick = async () => {\r\n        let pickId = this.ui && this.ui.pickId;\r\n        if (pickId === undefined) {\r\n            alert('no pickId defined!');\r\n            return;\r\n        }\r\n        let id = await pickId(this.context, this.name, this.value);        \r\n        this.setDataValue(id);\r\n        this.clearError();\r\n        this.clearContextError();\r\n        this.checkRules();\r\n    }\r\n\r\n    render() {\r\n        let placeholder:string|JSX.Element, Templet: TempletType;\r\n        if (this.ui !== undefined) {\r\n            placeholder = this.ui.placeholder;\r\n            Templet = this.ui.Templet;\r\n        }\r\n        let cn:any = {\r\n            'form-control': true,\r\n            'required-item': this.itemSchema.required === true,\r\n            'cursor-pointer': true,\r\n            'is-invalid': this.hasError,\r\n        };\r\n        let content;\r\n        if (this.value === undefined || this.value === null) {\r\n            content = placeholder || <small className=\"text-muted\">[无]</small>;\r\n            cn['text-muted'] = true;\r\n        }\r\n        else if (Templet === undefined) {\r\n            let c: any;\r\n            if (this.value === null) {\r\n                c = 'null';\r\n            }\r\n            else {\r\n                switch (typeof this.value) {\r\n                    case 'undefined': c = <small className=\"text-muted\">[无]</small>; break;\r\n                    case 'object': c = (this.value as any).id; break;\r\n                    default: c = this.value; break;\r\n                }\r\n            }\r\n            content = <>{c}</>;\r\n        }\r\n        else if (typeof Templet === 'function') {\r\n            content = Templet(this.value);\r\n        }\r\n        else {\r\n            content = Templet;\r\n        }\r\n        return <>\r\n            <div className={classNames(cn)} onClick={this.onClick}>{content}</div>\r\n            {this.renderErrors()}\r\n        </>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { DataType } from '../../schema';\r\nimport { UiType } from '../../schema';\r\n\r\nexport const Unknown = (dataType:DataType, uiType:UiType, dataTypes:DataType[]) => {\r\n    return <span className=\"text-danger\">!!data type {dataType} only support {(dataTypes || []).join(', ')}, can't use ui {uiType}!!</span>;\r\n};\r\n","import * as React from 'react';\r\nimport { UiButton, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { Widget } from './widget';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class ButtonWidget extends Widget {\r\n    protected get ui(): UiButton {return this._ui as UiButton};\r\n\r\n    protected onClick = async () => {\r\n        this.clearError();\r\n        this.clearContextError();\r\n        let {name, type} = this.itemSchema;\r\n        if (type === 'submit') {\r\n            await this.context.submit(name);\r\n        }\r\n        /*\r\n        let {onButtonClick} = this.context.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${name} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(name, this.context);\r\n        if (ret === undefined) return;\r\n        this.context.setError(name, ret);\r\n        */\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let {name, type} = this.itemSchema;\r\n        let Templet:TempletType, cn:string, caption:string;\r\n        if (this.ui !== undefined) {\r\n            let {widget:widgetType} = this.ui;\r\n            if (widgetType !== 'button') return Unknown(type, widgetType, ['button']);\r\n            Templet = this.ui.Templet;\r\n            cn = this.ui.className;\r\n            caption = this.ui.label;\r\n        }\r\n        let {form, hasError} = this.context;\r\n        let context = this.context;\r\n        let disabled = type==='submit' && hasError;\r\n        let content:any;\r\n        if (this.children !== undefined) content = this.children;\r\n        else if (typeof Templet === 'function') content = Templet();\r\n        else if (Templet !== undefined) content = Templet;\r\n        else content = caption; \r\n        let button = <button \r\n            className={cn} \r\n            type=\"button\"\r\n            disabled={disabled}\r\n            onClick={this.onClick}>\r\n            {content || name}\r\n        </button>;\r\n        if (context.inNode === true) return <>{button}{this.renderErrors()}</>;\r\n        return <div className={form.ButtonClass}>\r\n            <div>{this.renderErrors()}</div>\r\n            {button}\r\n        </div>;\r\n    });\r\n    \r\n    protected get label():string {return null}\r\n\r\n    render() {\r\n        return <this.observerRender />\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { Form } from './form';\r\nimport { UiSchema, UiArr, UiItem } from '../schema';\r\nimport { ArrSchema, ItemSchema } from '../schema';\r\nimport { Widget } from './widgets/widget';\r\n//import { ArrRow } from './arrRow';\r\nimport { observable, computed } from 'mobx';\r\nimport { ContextRule } from './rules';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport abstract class Context {\r\n    private subContexts:{[name:string]:{[rowKey:string]:Context}};\r\n    readonly form: Form;\r\n    readonly uiSchema: UiSchema;\r\n    readonly initData: any;\r\n    readonly inNode: boolean;           // true: 在</> 流中定义Field\r\n    readonly widgets: {[name:string]: Widget} = {};\r\n    readonly rules: ContextRule[];\r\n    readonly isRow: boolean;\r\n    @observable errors: string[] = [];\r\n    @observable errorWidgets:Widget[] = [];\r\n\r\n    constructor(form: Form, uiSchema: UiSchema, data: any, inNode: boolean, isRow: boolean) {\r\n        this.form = form;\r\n        this.uiSchema = uiSchema;\r\n        this.initData = data;\r\n        this.inNode = inNode;\r\n        this.isRow = isRow;\r\n        if (uiSchema !== undefined) {\r\n            let {rules} = uiSchema;\r\n            if (rules !== undefined) {\r\n                this.rules = [];\r\n                if (Array.isArray(rules) === false)\r\n                    this.rules.push(rules as ContextRule);\r\n                else\r\n                    this.rules.push(...rules as ContextRule[]);\r\n            }\r\n        }\r\n    }\r\n\r\n    getArrRowContexts(arrName: string) {\r\n        if (this.subContexts === undefined) this.subContexts = {};\r\n        let arrRowContexts = this.subContexts[arrName];\r\n        if (arrRowContexts === undefined) this.subContexts[arrName] = arrRowContexts = {};\r\n        return arrRowContexts;\r\n    }\r\n\r\n    abstract get data():any;\r\n    abstract getItemSchema(itemName:string):ItemSchema;\r\n    abstract getUiItem(itemName:string):UiItem;\r\n    get arrName():string {return undefined}\r\n    getValue(itemName:string):any {return this.initData[itemName]}\r\n    setValue(itemName:string, value:any) {\r\n        this.initData[itemName] = value;\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setValue(value);\r\n    }\r\n    getDisabled(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) return widget.getDisabled();\r\n        return undefined;\r\n    }\r\n    setDisabled(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setDisabled(value);\r\n    }\r\n    getReadOnly(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getReadOnly();\r\n        return undefined;\r\n    }\r\n    setReadOnly(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setReadOnly(value);\r\n    }\r\n    getVisible(itemName:string):boolean {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.getVisible();\r\n        return undefined;\r\n    }\r\n    setVisible(itemName:string, value:boolean) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget !== undefined) widget.setVisible(value);\r\n    }\r\n\r\n    async submit(buttonName: string) {\r\n        this.checkRules()\r\n        if (this.hasError === true) {\r\n            let err = '';\r\n            for (let ew of this.errorWidgets) {\r\n                err += ew.name + ':\\n' + ew.errors.join('\\n');\r\n            }\r\n            console.error(err);\r\n            return;\r\n        }\r\n        let {onButtonClick} = this.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`button ${buttonName} clicked. you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this);\r\n        if (ret === undefined) return;\r\n        this.setError(buttonName, ret);\r\n\r\n    }\r\n\r\n    checkFieldRules() {\r\n        for (let i in this.widgets) {\r\n            this.widgets[i].checkRules();\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                arrRowContexts[j].checkFieldRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    checkContextRules() {\r\n        this.clearErrors();\r\n        if (this.rules === undefined) return;\r\n        for (let rule of this.rules) {\r\n            let ret = rule(this);\r\n            if (ret === undefined) continue;\r\n            if (Array.isArray(ret) === true) {\r\n                this.errors.push(...ret as string[]);\r\n            }\r\n            else if (typeof ret === 'string') {\r\n                this.errors.push(ret as string);\r\n            }\r\n            else {\r\n                for (let i in ret as object) this.setError(i, (ret as any)[i]);\r\n            }\r\n        }\r\n        if (this.subContexts === undefined) return;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                let rowContext = arrRowContexts[j];\r\n                rowContext.clearErrors();\r\n                rowContext.checkContextRules();\r\n            }\r\n        }\r\n    }\r\n\r\n    setError(itemName:string, error:string) {\r\n        let widget = this.widgets[itemName];\r\n        if (widget === undefined) return;\r\n        widget.setContextError(error);\r\n        this.addErrorWidget(widget);\r\n    }\r\n\r\n    clearContextErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearContextError();\r\n        }\r\n    }\r\n\r\n    clearWidgetsErrors() {\r\n        for (let i in this.widgets) {\r\n            let widget = this.widgets[i];\r\n            if (widget === undefined) continue;\r\n            widget.clearError();\r\n        }\r\n    }\r\n\r\n    checkRules() {\r\n        this.clearErrors();\r\n        this.clearWidgetsErrors();\r\n        this.checkFieldRules();\r\n        if (this.hasError === true) return;\r\n        this.checkContextRules();\r\n    }\r\n\r\n    addErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos < 0) this.errorWidgets.push(widget);\r\n    }\r\n    removeErrorWidget(widget:Widget) {\r\n        let pos = this.errorWidgets.findIndex(v => v === widget);\r\n        if (pos >= 0) this.errorWidgets.splice(pos, 1);\r\n    }\r\n\r\n    protected checkHasError():boolean {\r\n        let ret = (this.errorWidgets.length + this.errors.length) > 0;\r\n        if (ret === true) return true;\r\n        if (this.subContexts === undefined) return false;\r\n        for (let i in this.subContexts) {\r\n            let arrRowContexts = this.subContexts[i];\r\n            for (let j in arrRowContexts) {\r\n                if (arrRowContexts[j].hasError === true) return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n\r\n    @computed get hasError():boolean {\r\n        return this.checkHasError();\r\n    };\r\n\r\n    clearErrors() {\r\n        this.errors.splice(0);\r\n        this.errorWidgets.splice(0);\r\n        this.clearContextErrors();\r\n    }\r\n\r\n    renderErrors = observer((): JSX.Element => {\r\n        let {errors} = this;\r\n        if (errors.length === 0) return null;\r\n        return <>\r\n            {errors.map(err => <span key={err} className=\"text-danger inline-block my-1 ml-3\">\r\n                <i className=\"fa fa-exclamation-circle\" /> &nbsp;{err}\r\n            </span>)}\r\n        </>\r\n    });\r\n}\r\n\r\nlet rowKeySeed:number = 1;\r\nexport class RowContext extends Context {\r\n    readonly parentContext: Context;\r\n    readonly arrSchema: ArrSchema;\r\n    readonly rowKey: number;\r\n\treadonly data: any;\r\n    //readonly uiSchema: UiArr;\r\n\t\r\n    constructor(parentContext:Context, arrSchema: ArrSchema, data: any, inNode: boolean) {\r\n        let uiArr:UiArr;\r\n        let {uiSchema} = parentContext;\r\n        if (uiSchema !== undefined) {\r\n            let {items} = uiSchema;\r\n            if (items !== undefined) uiArr = items[arrSchema.name] as UiArr;\r\n        }\r\n        super(parentContext.form, uiArr, data, inNode, true);\r\n        this.parentContext = parentContext;\r\n        this.arrSchema = arrSchema;\r\n        this.rowKey = rowKeySeed++;\r\n        this.data = data;\r\n    }\r\n    getItemSchema(itemName:string):ItemSchema {return this.arrSchema.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        if (this.uiSchema === undefined) return undefined;\r\n        let {items} = this.uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName]\r\n    }\r\n    get arrName():string {return this.arrSchema.name}\r\n    clearErrors() {\r\n        super.clearErrors();\r\n        this.parentContext.clearErrors();\r\n    }\r\n\r\n    get parentData():any {return this.parentContext.data;}\r\n}\r\n\r\nexport class FormContext extends Context {\r\n    constructor(form:Form, inNode:boolean) {\r\n        super(form, form.uiSchema, form.data, inNode, false);\r\n    }\r\n    get data():any {return this.form.data}\r\n    getItemSchema(itemName:string):ItemSchema {return this.form.itemSchemas[itemName]}\r\n    getUiItem(itemName:string):UiItem {\r\n        let {uiSchema} = this.form;\r\n        if (uiSchema === undefined) return undefined;\r\n        let {items} = uiSchema;\r\n        if (items === undefined) return undefined;\r\n        return items[itemName];\r\n    }\r\n}\r\n\r\nexport const ContextContainer = React.createContext<Context>({} as any);\r\n","import * as React from 'react';\r\nimport {observer} from 'mobx-react';\r\nimport classNames from 'classnames';\r\n//import { ArrRow } from '../arrRow';\r\nimport { Context, RowContext, ContextContainer } from '../context';\r\nimport { ArrSchema } from '../../schema';\r\nimport { UiArr, TempletType } from '../../schema';\r\nimport { Unknown } from './unknown';\r\nimport { factory } from './factory';\r\n\r\nexport const ArrComponent = observer((\r\n    {parentContext, arrSchema, children}:{parentContext: Context, arrSchema: ArrSchema, children: React.ReactNode}) => \r\n{\r\n    let {name, arr} = arrSchema;\r\n    let data = parentContext.initData[name] as any[];\r\n    let {form} = parentContext;\r\n    let arrRowContexts = parentContext.getArrRowContexts(name);\r\n    let ui = parentContext.getUiItem(name) as UiArr;\r\n    let arrLabel = name;\r\n    let Templet:TempletType;\r\n    let selectable:boolean, deletable:boolean, restorable:boolean;\r\n    let {ArrContainer, RowContainer, RowSeperator, uiSchema} = form;\r\n    if (uiSchema !== undefined) {\r\n        let {selectable:formSelectable, deletable:formDeletable, restorable:formRestorable} = uiSchema;\r\n        if (selectable !== true) selectable = formSelectable;\r\n        if (deletable !== true) deletable = formDeletable;\r\n        if (restorable !== true) restorable = formRestorable;\r\n    }\r\n    if (ui !== undefined) {\r\n        let {widget:widgetType, label, \r\n            selectable:arrSelectable, deletable:arrDeletable, restorable:arrRestorable,\r\n            ArrContainer:ac, RowContainer:rc, RowSeperator:rs\r\n        } = ui;\r\n        if (arrSelectable !== undefined) selectable = arrSelectable;\r\n        if (arrDeletable !== undefined) deletable = arrDeletable;\r\n        if (arrRestorable !== undefined) restorable = arrRestorable;\r\n        if (ac !== undefined) ArrContainer = ac;\r\n        if (rc !== undefined) RowContainer = rc;\r\n        if (rs !== undefined) RowSeperator = rs;\r\n        Templet = ui.Templet;\r\n        if (widgetType !== 'arr') return Unknown(arrSchema.type, widgetType, ['arr']);\r\n        arrLabel = label || arrLabel;\r\n    }\r\n    let first = true;\r\n    return ArrContainer(arrLabel, <>\r\n        {data.map((row:any, index) => {\r\n            let rowContext: RowContext;\r\n            let rowContent: JSX.Element;\r\n            let sep = undefined;\r\n            if (first === false) sep = RowSeperator;\r\n            else first = false;\r\n            if (children !== undefined) {\r\n                rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                rowContent = <>{children}</>;\r\n            }\r\n            else {\r\n                let typeofTemplet = typeof Templet;\r\n                if (typeofTemplet === 'function') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = React.createElement(observer(Templet as React.StatelessComponent), row);\r\n                }\r\n                else if (typeofTemplet === 'object') {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, true);\r\n                    rowContent = Templet as JSX.Element;\r\n                }\r\n                else {\r\n                    rowContext = new RowContext(parentContext, arrSchema, row, false);\r\n                    rowContent = <>{\r\n                        arr.map((v, index) => {\r\n                            return <React.Fragment key={v.name}>\r\n                                {factory(rowContext, v, undefined)}\r\n                            </React.Fragment>\r\n                        })}\r\n                    </>;\r\n                }\r\n            }\r\n            let {rowKey} = rowContext;\r\n            arrRowContexts[rowKey] = rowContext;\r\n\r\n            let selectCheck:JSX.Element, deleteIcon:JSX.Element;\r\n            if (selectable === true) {\r\n                let onClick = (evt: React.MouseEvent<HTMLInputElement>)=>{\r\n                    let {checked} = (evt.target as HTMLInputElement);\r\n                    row.$isSelected = checked;\r\n                    let {$source} = row;\r\n                    if ($source !== undefined) $source.$isSelected = checked;\r\n                    rowContext.clearErrors();\r\n                }\r\n                selectCheck = <div className=\"form-row-checkbox\">\r\n                    <input type=\"checkbox\" onClick={onClick} defaultChecked={row.$isSelected} />\r\n                </div>;\r\n            }\r\n            let isDeleted = !(row.$isDeleted===undefined || row.$isDeleted===false);\r\n            if (deletable === true) {\r\n                let icon = isDeleted? 'fa-undo' : 'fa-trash';\r\n                let onDelClick = () => {\r\n                    if (restorable === true) {\r\n                        row.$isDeleted = !isDeleted;\r\n                        let {$source} = row;\r\n                        if ($source !== undefined) $source.$isDeleted = !isDeleted;\r\n                    }\r\n                    else {\r\n                        let p = data.indexOf(row);\r\n                        if (p>=0) data.splice(p, 1);\r\n                    }\r\n                    rowContext.clearErrors();\r\n                }\r\n                deleteIcon = <div className=\"form-row-edit text-info\" onClick={onDelClick}>\r\n                    <i className={classNames('fa', icon, 'fa-fw')} />\r\n                </div>;\r\n            }\r\n            let editContainer = selectable===true || deletable===true?\r\n                (content:any) => <fieldset disabled={isDeleted}><div className={classNames('d-flex', {'deleted':isDeleted, 'row-selected':row.$isSelected})}>\r\n                    {selectCheck}\r\n                    <div className={selectable===true && deletable===true? \"form-row-content\":\"form-row-content-1\"}>{content}</div>\r\n                    {deleteIcon}\r\n                </div></fieldset>\r\n                :\r\n                (content:any) => content;\r\n\r\n            return <ContextContainer.Provider key={rowKey} value={rowContext}>\r\n                {sep}\r\n                {RowContainer(editContainer(<><rowContext.renderErrors />{rowContent}</>))}\r\n            </ContextContainer.Provider>;\r\n        })}\r\n    </>);\r\n});\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiImageItem } from '../../schema';\r\nimport { Image } from '../../image';\r\nimport { ImageItemEdit } from '../../edit/imageItemEdit';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\n\r\nexport class ImageWidget extends Widget {\r\n    protected input: HTMLInputElement;\r\n    protected get ui(): UiImageItem {return this._ui as UiImageItem};\r\n    @observable private imageSrc: string;\r\n\r\n    init() {\r\n        super.init();\r\n        this.imageSrc = this.value;\r\n    }\r\n\r\n    protected onClick = async () => {\r\n        let edit = new ImageItemEdit(this.itemSchema, this.ui, this.ui.label, this.value);\r\n        let ret = await edit.start();\r\n        if (ret !== null) {\r\n            this.setValue(ret);\r\n            this.imageSrc = ret;\r\n        }\r\n        await edit.end();\r\n    }\r\n\r\n    render() {\r\n        return <this.observerRender />;\r\n    }\r\n\r\n    private observerRender = observer(() => {\r\n        let cn = [\r\n            'bg-white p-1 d-flex justify-content-center',\r\n        ];\r\n        let onClick: any;\r\n        if (!this.readOnly && !this.disabled) {\r\n            cn.push('cursor-pointer');\r\n            onClick = this.onClick;\r\n        }\r\n        return <div className={classNames(cn)} onClick={onClick}>\r\n            <Image src={this.imageSrc} className=\"w-4c h-4c\"/>\r\n        </div>;\r\n    });\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { Widget } from './widget';\r\nimport { UiTag, IValuesViewRenderOptions } from '../../schema';\r\nimport { RowContext } from '../context';\r\n\r\nabstract class TagWidget extends Widget {\r\n    protected inputs: {[index:number]: HTMLInputElement} = {};\r\n    protected get ui(): UiTag {return this._ui as UiTag};\r\n\r\n    protected setElementValue(value:any) {\r\n        for (let i in this.inputs) {\r\n            let input = this.inputs[i];\r\n            input.checked = value === input.value;\r\n        }\r\n    }\r\n    setReadOnly(value:boolean) {\r\n        this.readOnly = value;\r\n        for (let i in this.inputs) this.inputs[i].readOnly = value;\r\n    }\r\n    setDisabled(value:boolean) {\r\n        this.disabled = value;\r\n        for (let i in this.inputs) this.inputs[i].disabled = value\r\n\t}\r\n\t\r\n\tabstract render():JSX.Element;\r\n}\r\n\r\nexport class TagSingleWidget extends TagWidget {\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let {isRow} = this.context;\r\n        let rowKey:number;\r\n        if (isRow === true) {\r\n            rowKey = (this.context as RowContext).rowKey;\r\n        }\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet name = this.name;\r\n\t\tif (rowKey !== undefined) name += '-' + rowKey;\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputName: name,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderRadios(this.defaultValue, options);\r\n    }\r\n}\r\n\r\nexport class TagMultiWidget extends TagWidget {\r\n\tprivate defaultArr:number[];\r\n\tinit() {\r\n\t\tsuper.init();\r\n\t\tlet def = this.defaultValue;\r\n\t\tswitch (typeof def) {\r\n\t\t\tdefault:\r\n\t\t\t\tthis.defaultArr = [];\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'string':\r\n\t\t\t\tthis.defaultArr = def.split('|').map(v => Number(v));\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n    protected onInputChange = (evt: React.ChangeEvent<any>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.changeValue(values.join('|'), true);\r\n\t}\r\n\trender() {\r\n\t\tlet {valuesView, wrapClassName} = this.ui;\r\n\t\tif (valuesView === undefined) return <>valuesView must be defined</>;\r\n        let cn = classNames(this.className, 'py-0');\r\n\t\tlet options:IValuesViewRenderOptions = {\r\n\t\t\tclassName: cn,\r\n\t\t\tinputs: this.inputs,\r\n\t\t\twrapClassName,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t}\r\n\t\treturn valuesView.renderChecks(this.defaultValue, options);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { ArrSchema, DataType, ItemSchema } from '../../schema';\r\nimport { TypeWidget, UiCustom } from '../../schema';\r\nimport { TextWidget } from './textWidget';\r\nimport { TextAreaWidget } from './textareaWidget';\r\nimport { PasswordWidget, UrlWidget, EmailWidget } from './passwordWidget';\r\nimport { UpdownWidget } from './updownWidget';\r\nimport { NumberWidget } from './numberWidget';\r\nimport { DateWidget, DateTimeWidget, TimeWidget, MonthWidget } from './dateWidget';\r\nimport { CheckBoxWidget } from './checkBoxWidget';\r\nimport { FieldProps } from '../field';\r\nimport { Context } from '../context';\r\nimport { SelectWidget } from './selectWidget';\r\nimport { RadioWidget } from './radioWidget';\r\nimport { RangeWidget } from './rangeWidget';\r\nimport { IdWidget } from './idWidget';\r\nimport { ButtonWidget } from './buttonWidget';\r\nimport { ArrComponent } from './arrComponent';\r\nimport { ImageWidget } from './imageWidget';\r\nimport { TagSingleWidget, TagMultiWidget } from './tagWidget';\r\n\r\nconst widgetsFactory: {[type: string]: {widget?: TypeWidget, dataTypes?: DataType[]}} = {\r\n    id: {\r\n        dataTypes: ['id'],\r\n        widget: IdWidget,\r\n    },\r\n    text: {\r\n        dataTypes: ['integer', 'number', 'string'],\r\n        widget: TextWidget\r\n    },\r\n    textarea: {\r\n        dataTypes: ['string'],\r\n        widget: TextAreaWidget\r\n    },\r\n    password: {\r\n        dataTypes: ['string'],\r\n        widget: PasswordWidget\r\n    },\r\n    date: {\r\n        dataTypes: ['date'],\r\n        widget: DateWidget\r\n    },\r\n    datetime: {\r\n        dataTypes: ['date'],\r\n        widget: DateTimeWidget\r\n    },\r\n    time: {\r\n        dataTypes: ['date'],\r\n        widget: TimeWidget\r\n    },\r\n    month: {\r\n        dataTypes: ['date'],\r\n        widget: MonthWidget\r\n    },\r\n    select: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: SelectWidget\r\n    },\r\n    url: {\r\n        dataTypes: ['string'],\r\n        widget: UrlWidget\r\n    },\r\n    email: {\r\n        dataTypes: ['string'],\r\n        widget: EmailWidget\r\n    },\r\n    number: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: NumberWidget\r\n    },\r\n    updown: {\r\n        dataTypes: ['integer', 'number'],\r\n        widget: UpdownWidget\r\n    },\r\n    color: {\r\n\r\n    },\r\n    checkbox: {\r\n        dataTypes: ['boolean', 'integer', 'number'],\r\n        widget: CheckBoxWidget\r\n    },\r\n    image: {\r\n        dataTypes: ['string'],\r\n        widget: ImageWidget,\r\n    },\r\n    checkboxes: {\r\n\r\n    },\r\n    radio: {\r\n        dataTypes: ['integer', 'number', 'string', 'date', 'boolean'],\r\n        widget: RadioWidget\r\n\t},\r\n\ttagSingle: {\r\n\t\tdataTypes: ['integer'],\r\n\t\twidget: TagSingleWidget\r\n\t},\r\n\ttagMulti: {\r\n\t\tdataTypes: ['string'],\r\n\t\twidget: TagMultiWidget\r\n\t},\r\n    range: {\r\n        dataTypes: ['integer'],\r\n        widget: RangeWidget,\r\n    },\r\n    button: {\r\n        dataTypes: ['button', 'submit'],\r\n        widget: ButtonWidget,\r\n    }\r\n}\r\n\r\nexport function factory(context: Context, itemSchema: ItemSchema, children:React.ReactNode, fieldProps?: FieldProps):JSX.Element {\r\n    if (context === undefined) {\r\n        debugger;\r\n        return null;\r\n    }\r\n    if (itemSchema === undefined) return undefined;\r\n    let {name, type} = itemSchema;\r\n    switch (type) {\r\n    case 'arr':\r\n        let arrSchema = context.getItemSchema(name) as ArrSchema;\r\n        return <ArrComponent parentContext={context} arrSchema={arrSchema} children={children} />;\r\n    default:\r\n        break;\r\n    }\r\n\r\n    let typeWidget: TypeWidget;\r\n    let ui = context.getUiItem(name);\r\n    function getTypeWidget(t:DataType): TypeWidget {\r\n        switch(t) {\r\n        default: return TextWidget; \r\n        case 'id': return IdWidget;\r\n        case 'integer': return UpdownWidget;\r\n        case 'number': return NumberWidget; \r\n        case 'string': return TextWidget; \r\n        case 'date': return DateWidget; \r\n        case 'boolean': return CheckBoxWidget; \r\n        case 'button':\r\n        case 'submit': return ButtonWidget;\r\n        }\r\n    }\r\n    if (ui === undefined) { \r\n        typeWidget = getTypeWidget(type);\r\n    }\r\n    else {\r\n        let {widget:widgetType} = ui;\r\n        switch (widgetType) {\r\n        default:\r\n            if (widgetType !== undefined) {\r\n                let widgetFactory = widgetsFactory[widgetType];\r\n                typeWidget = widgetFactory.widget;\r\n            }\r\n            if (typeWidget === undefined) typeWidget = getTypeWidget(type);\r\n            break;\r\n        case 'custom':\r\n            typeWidget = (ui as UiCustom).WidgetClass;\r\n            break;\r\n        case 'group':\r\n            return <span>impletment group</span>;\r\n        }\r\n        //label = uiLabel || name;\r\n    }\r\n    \r\n    let {widgets} = context;\r\n    let widget = new typeWidget(context, itemSchema, fieldProps, children);\r\n    widget.init();\r\n    widgets[name] = widget;\r\n\r\n    return <widget.container />;\r\n    /*\r\n    if (isRow === false) {\r\n        let WidgetElement = observer(() => widget.container());\r\n        return <WidgetElement />;\r\n    }\r\n    else {\r\n        let widgetElement = widget.container();\r\n        return widgetElement;\r\n    }\r\n    */\r\n}\r\n\r\n","import * as React from 'react';\r\nimport {observable, IReactionDisposer, autorun} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport { Schema, ItemSchema, ArrSchema } from '../schema';\r\nimport { UiSchema, TempletType } from '../schema';\r\nimport { factory } from './widgets';\r\nimport 'font-awesome/css/font-awesome.min.css';\r\nimport { ContextContainer, FormContext, Context } from './context';\r\nimport { FormRes, formRes } from '../../res';\r\nimport { resLang } from '../../res/res';\r\n\r\nexport type FormButtonClick = (name:string, context: Context) => Promise<any>;\r\nexport type InputEnter = (name:string, context: Context) => Promise<any>;\r\n\r\nexport interface FormProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    uiSchema?: UiSchema;\r\n    formData?: any;\r\n    onButtonClick?: FormButtonClick;\r\n    onEnter?: InputEnter;\r\n    fieldLabelSize?: number;            // col-sm-2 for label\r\n    requiredFlag?: boolean;             // default=true\r\n    beforeShow?: (formContext:FormContext) => void;\r\n    res?: FormRes;\r\n\r\n    Container?: (content:JSX.Element) => JSX.Element;\r\n    FieldContainer?: (label:string|JSX.Element, content:JSX.Element) => JSX.Element;\r\n    FieldClass?: string;\r\n    ButtonClass?: string;\r\n}\r\n\r\nexport class Form extends React.Component<FormProps> {\r\n    readonly schema: Schema;\r\n    readonly itemSchemas: {[name:string]: ItemSchema};\r\n    readonly uiSchema: UiSchema;\r\n    readonly res?: FormRes;\r\n    protected formContext: FormContext;\r\n    private disposer: IReactionDisposer;\r\n    readonly data:any;\r\n\r\n    readonly Container: (content:JSX.Element) => JSX.Element;\r\n    readonly FieldContainer: (label:any, content:JSX.Element) => JSX.Element;\r\n    readonly FieldClass: string;\r\n    readonly ButtonClass: string;\r\n    \r\n    constructor(props:FormProps) {\r\n        super(props);\r\n        let {schema, uiSchema, \r\n            Container, FieldContainer, FieldClass, \r\n            ButtonClass, res,\r\n        } = props;\r\n        this.Container = Container || this.DefaultContainer;\r\n        this.FieldContainer = FieldContainer || this.DefaultFieldContainer;\r\n        this.FieldClass = FieldClass!==undefined && FieldClass!==''&&FieldClass!==null? FieldClass : this.DefaultFieldClass;\r\n        this.res = res || this.DefaultRes;\r\n        this.ButtonClass = ButtonClass || this.DefaultButtonClass;\r\n\r\n        this.schema = schema;\r\n        this.itemSchemas = {};\r\n        for (let itemSchema of this.schema) {\r\n            this.itemSchemas[itemSchema.name] = itemSchema;\r\n        }\r\n        this.uiSchema = uiSchema;\r\n\r\n        this.disposer = autorun(this.watch);\r\n        this.data = {};\r\n    }\r\n\r\n    private renderContent():any {\r\n        this.initData(this.props.formData);\r\n        let {children} = this.props;\r\n        if (children !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return <>{children}</>;\r\n        }\r\n\r\n        let Templet: TempletType;\r\n        if (this.uiSchema !== undefined) {\r\n            Templet = this.uiSchema.Templet;\r\n        }\r\n        if (Templet !== undefined) {\r\n            this.formContext = new FormContext(this, true);\r\n            return typeof(Templet) === 'function'? Templet(this.data) : Templet;\r\n        }\r\n\r\n        this.formContext = new FormContext(this, false);\r\n        return <>{this.schema.map((v, index) => {\r\n            return <React.Fragment key={index}>{factory(this.formContext, v, children)}</React.Fragment>\r\n        })}</>;\r\n    }\r\n\r\n    private initData(formData: any) {\r\n        if (formData === undefined) formData = {};\r\n        if (this.uiSchema !== undefined) {\r\n            let {items} = this.uiSchema;\r\n            if (items !== undefined) {\r\n                for (let i in items) {\r\n                    let ui = items[i];\r\n                    let dv = ui.defaultValue;\r\n                    if (dv !== undefined) {\r\n                        if (formData[i] === undefined) {\r\n                            formData[i] = dv;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n        for (let itemSchema of this.schema) {\r\n            this.initDataItem(itemSchema, this.data, formData);\r\n        }\r\n    }\r\n\r\n    private initDataItem(itemSchema: ItemSchema, data:any, formData: any):any {\r\n        let {name, type} = itemSchema;\r\n        if (type === 'button') return;\r\n        if (type !== 'arr') {\r\n            data[name] = formData[name];\r\n            return;\r\n        }\r\n\r\n        let arrItem:ArrSchema = itemSchema as ArrSchema;\r\n        let {arr:arrItems} = arrItem;\r\n        if (arrItems === undefined) return;\r\n        let arrDict:any = arrItem.itemSchemas = {};\r\n        for (let item of arrItems) {\r\n            arrDict[item.name] = item;\r\n        }\r\n        let val:any[] = formData[name];\r\n        if (val === undefined) val = [];\r\n        else if (Array.isArray(val) === false) val = [val];\r\n        let arr:any[] = [];\r\n        for (let row of val) {\r\n            let {$isSelected, $isDeleted} = row;\r\n            let r = {\r\n                $source: row,\r\n                $isSelected: $isSelected,\r\n                $isDeleted: $isDeleted,\r\n            };\r\n            for (let item of arrItems) {\r\n                this.initDataItem(item, r, row);\r\n            }\r\n            arr.push(r);\r\n        }\r\n        // 如果没有observable，行删除标志点击不管用\r\n        // 不知道这里为什么要去掉observable。有可能会有别的问题\r\n        data[name] = observable(arr);\r\n        //data[name] = arr;\r\n        return;\r\n    }\r\n\r\n    private watch = () => {\r\n        let {formData} = this.props;\r\n        if (formData === undefined) return;\r\n        //this.initData(formData);\r\n        this.calcSelectOrDelete();\r\n    }\r\n    private calcSelectOrDelete() {\r\n        for (let itemSchema of this.schema) {\r\n            this.arrItemOperated(itemSchema);\r\n        }\r\n    }\r\n\r\n    private arrItemOperated(itemSchema: ItemSchema) {\r\n        let {name, type} = itemSchema;\r\n        if (type !== 'arr') return;\r\n        if (this.data === undefined) return;\r\n        let formArrVal = this.data[name];\r\n        if (formArrVal === undefined) return;\r\n        let {arr: arrItems} = itemSchema as ArrSchema;\r\n        for (let row of formArrVal) {\r\n            let {$source} = row;\r\n            if ($source === undefined) continue;\r\n            let {$isSelected, $isDeleted} = $source;\r\n            row.$isSelected = $isSelected;\r\n            row.$isDeleted = $isDeleted;\r\n            //console.log($isSelected, $isDeleted);\r\n            for (let item of arrItems) {\r\n                this.arrItemOperated(item);\r\n            }\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        let {beforeShow} = this.props;\r\n        if (beforeShow !== undefined) beforeShow(this.formContext);\r\n    }\r\n\r\n    componentWillUnmount() {\r\n        if (this.disposer !== undefined) this.disposer();\r\n    }\r\n\r\n    render() {\r\n        let content = this.renderContent();\r\n        return <ContextContainer.Provider value={this.formContext}>\r\n            <this.formContext.renderErrors />\r\n            {this.Container(content)}\r\n        </ContextContainer.Provider>;\r\n    }\r\n\r\n    async buttonClick(buttonName:string) {\r\n        this.formContext.checkRules()\r\n        if (this.formContext.hasError === true) return;\r\n\r\n        let {onButtonClick} = this.formContext.form.props;\r\n        if (onButtonClick === undefined) {\r\n            alert(`you should define form onButtonClick`);\r\n            return;\r\n        }\r\n        let ret = await onButtonClick(buttonName, this.formContext);\r\n        if (ret === undefined) return;\r\n        this.formContext.setError(buttonName, ret);\r\n    }\r\n\r\n    protected DefaultContainer = (content:JSX.Element): JSX.Element => {\r\n        return <form className={classNames(this.props.className)} onSubmit={e=>e.preventDefault()}>\r\n            {content}\r\n        </form>;\r\n    }\r\n    protected DefaultFieldContainer = (label:string|JSX.Element, content:JSX.Element): JSX.Element => {\r\n        let {fieldLabelSize} = this.props;\r\n\r\n        if (fieldLabelSize > 0) {\r\n            let labelView:any;\r\n            if (label === null) {\r\n                fieldLabelSize = 0;\r\n            }\r\n            else {\r\n                labelView = <label className={classNames('col-sm-' + fieldLabelSize, 'col-form-label')}>{label}</label>\r\n            }\r\n            let fieldCol = 'col-sm-' + (12 - fieldLabelSize);\r\n            return <div className=\"form-group row\">\r\n                {labelView}\r\n                <div className={fieldCol}>{content}</div>\r\n            </div>;\r\n        }\r\n        return <div className=\"form-group\">\r\n            {label===null? null:<label className=\"col-form-label\">{label}</label>}\r\n            {content}\r\n        </div>;\r\n    }\r\n    protected DefaultFieldClass:string = undefined;\r\n    protected DefaultButtonClass = 'text-center py-2';\r\n    protected DefaultRes:FormRes = resLang<FormRes>(formRes);\r\n\r\n    ArrContainer = (label:any, content:JSX.Element): JSX.Element => {\r\n        return <div>\r\n            <div className={classNames('small text-muted text-center bg-light py-1 px-3 mt-4 mb-1')}>{label}</div>\r\n            {content}\r\n        </div>;\r\n    }\r\n    RowContainer = (content:JSX.Element): JSX.Element => {\r\n        let cn = classNames({\r\n            'py-3': true\r\n        });\r\n        return <div className={cn}>{content}</div>\r\n    }\r\n    RowSeperator = <div className=\"border border-gray border-top\" />;\r\n}\r\n","import * as React from 'react';\r\nimport { factory } from './widgets';\r\nimport { ContextContainer, Context } from './context';\r\n\r\nexport interface FieldProps {\r\n    name: string;\r\n}\r\n\r\nexport class FormField extends React.Component<FieldProps> {\r\n    static contextType = ContextContainer;\r\n    render() {\r\n        let {name, children } = this.props;\r\n        let context:Context = this.context;\r\n        if (context === undefined) return <span className=\"text-danger\">!only in Form!</span>;\r\n        let itemSchema = context.getItemSchema(name);\r\n        let content = factory(context, itemSchema, children, this.props);\r\n        if (content === undefined) {\r\n            return <span className=\"text-danger\">!!{name} is not defined!!</span>;\r\n        }\r\n        return content;\r\n    }\r\n}\r\n","export {Form} from './form';\r\nexport {FormField} from './field';\r\nexport {Context, RowContext} from './context';\r\nexport * from './widgets';\r\n","import * as React from 'react';\r\nimport { UiTextItem } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class StringItemEdit extends ItemEdit {\r\n    get uiItem(): UiTextItem {return this._uiItem as UiTextItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.newValue = evt.target.value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private onBlur = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n        this.verifyValue();\r\n    }\r\n\r\n    private onFocus = () => {\r\n        this.error = undefined;\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        return <Page header={this.label} right={right}>\r\n            <div className=\"m-3\">\r\n                <input type=\"text\" \r\n                    onChange={this.onChange}\r\n                    onBlur={this.onBlur}\r\n                    onFocus={this.onFocus}\r\n                    className=\"form-control\" \r\n                    defaultValue={this.value} />\r\n                {\r\n                    this.uiItem && <div className=\"small muted m-2\">{this.uiItem.placeholder}</div>\r\n                }\r\n                {this.error && <div className=\"text-danger\">{this.error}</div>}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiRadio } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class RadioItemEdit extends ItemEdit {\r\n    get uiItem(): UiRadio {return this._uiItem as UiRadio}\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value: any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {name} = this.itemSchema;\r\n        let {list} = this.uiItem;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n            }}>保存</button>;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input name={name} type=\"radio\" value={value} \r\n                        onClick={()=>this.onChange(value)} \r\n                        defaultChecked={value === this.value} /> {title || value} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label} right={right}>\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"row row-cols-2 row-cols-sm-3 row-cols-md-4\">{content}</div>\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiSelect } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class SelectItemEdit extends ItemEdit {\r\n    get uiItem(): UiSelect {return this._uiItem as UiSelect}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n    }\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiIdItem } from '../schema';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nexport class IdItemEdit extends ItemEdit {\r\n    get uiItem(): UiIdItem {return this._uiItem as UiIdItem}\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>(async (resolve, reject) => {\r\n            //let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            //nav.push(element,reject);\r\n\r\n            let {pickId} = this.uiItem;\r\n            if (pickId === undefined) {\r\n                alert('IdItemEdit.pickId = undefined');\r\n                return;\r\n            }\r\n            let boxId = await pickId(undefined, undefined, this.value);\r\n            //if (typeof id === 'object') {\r\n            //    id = (id as any).id;\r\n            //}\r\n            this.onChange(boxId.id);\r\n            resolve(boxId);\r\n            //this.newValue = id;\r\n        });\r\n    }\r\n\r\n    protected async internalEnd():Promise<void> {}\r\n\r\n    private onChange = (value:any) => {\r\n        this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n    }\r\n\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        /*\r\n        let {resolve, reject} = props;\r\n        let {list} = this.uiItem;\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {title, value} = v;\r\n                return <div key={index} className=\"px-3 py-2 cursor-pointer bg-white mb-1\" onClick={()=>{this.onChange(value); resolve(this.newValue)}}>\r\n                    {title || value}\r\n                </div>;\r\n            })\r\n            :\r\n            <>no list defined</>;\r\n        return <Page header={'更改' + this.label}>\r\n            <div className=\"my-3\">\r\n                {content}\r\n            </div>\r\n        </Page>;\r\n        */\r\n        return <Page header={'更改' + this.label}>\r\n            ddd\r\n        </Page>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport { UiTag } from '../schema';\r\nimport { nav } from '../nav';\r\nimport { Page } from '../page/page';\r\nimport { observer } from 'mobx-react';\r\nimport { ItemEdit } from './itemEdit';\r\n\r\nabstract class TagItemEdit extends ItemEdit {\r\n\tprotected inputs: {[index:number]: HTMLInputElement} = {};\r\n\tprotected inputType: 'checkbox' | 'radio';\r\n    get uiItem(): UiTag {return this._uiItem as UiTag};\r\n\r\n\tinit() {\r\n        if (this.value === undefined) {\r\n            this.value = this._uiItem===undefined? undefined : this._uiItem.defaultValue;\r\n        }\r\n\t}\r\n\r\n    protected async internalStart():Promise<any> {\r\n        return new Promise<any>((resolve, reject) => {\r\n            let element = React.createElement(this.page, {resolve:resolve, reject:reject});\r\n            nav.push(element,reject);\r\n        });\r\n\t}\r\n\t\r\n\trenderContent() {\r\n\t\tlet valuesView = this.uiItem.valuesView;\r\n\t\tif (valuesView === undefined) return super.renderContent();\r\n\t\treturn valuesView.render(this.value);\r\n\t}\r\n\r\n\tprotected abstract renderInputs():JSX.Element;\r\n    private page = observer((props:{resolve:(value:any)=>void, reject: (resean?:any)=>void}):JSX.Element => {\r\n        let {resolve} = props;\r\n        let right = <button\r\n            className=\"btn btn-sm btn-success align-self-center\"\r\n            disabled={!this.isChanged}\r\n            onClick={()=>{\r\n                this.verifyValue();\r\n                if (this.error === undefined) resolve(this.newValue);\r\n\t\t\t}}>保存</button>;\r\n\t\t/*\r\n        let content = list?\r\n            list.map((v, index:number) => {\r\n                let {name:itemName, id} = v;\r\n                return <div key={index} className=\"col\"><label className=\"px-3 py-2 cursor-pointer\">\r\n                    <input ref={input=>this.inputs[id] = input} name={name} type={this.inputType} value={id} \r\n\t\t\t\t\t\tonClick={(e)=>this.onChange(e.currentTarget.checked, id)}\r\n                        defaultChecked={this.defaultChecked(id)} /> {itemName} &nbsp;\r\n                </label></div>;\r\n            })\r\n            :\r\n\t\t\t<>no list defined</>;\r\n\t\t*/\r\n        return <Page header={'更改' + this.label} right={right}>\r\n\t\t\t<div className=\"p-3\">\r\n\t\t\t\t{this.renderInputs()}\r\n\t\t\t</div>\r\n        </Page>;\r\n    })\r\n}\r\n\r\nexport class TagSingleItemEdit extends TagItemEdit {\r\n\tprotected inputType:'radio'|'checkbox' = 'radio';\r\n    protected onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet {currentTarget} = evt;\r\n\t\tif (currentTarget.checked === false) return;\r\n        this.newValue = Number(currentTarget.value);\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\t\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange,\r\n\t\t};\r\n\t\treturn valuesView.renderRadios(this.value, options);\r\n\t}\r\n}\r\n\r\nexport class TagMultiItemEdit extends TagItemEdit {\r\n\t//private arr:number[];\r\n\tprotected inputType:'radio'|'checkbox' = 'checkbox';\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tlet values:string[] = [];\r\n\t\tfor (let i in this.inputs) {\r\n\t\t\tlet input = this.inputs[i];\r\n\t\t\tif (input.checked === true) values.push(input.value);\r\n\t\t}\r\n        this.newValue = values.join('|');\r\n        //this.newValue = value;\r\n        let preValue = this.value;\r\n        this.isChanged = (this.newValue !== preValue);\r\n\t}\r\n\tprotected renderInputs():JSX.Element {\r\n\t\tlet {valuesView} = this.uiItem;\r\n\t\tlet options = {\r\n\t\t\tinputs: this.inputs,\r\n\t\t\tonInputChange: this.onInputChange\r\n\t\t};\r\n\t\treturn valuesView.renderChecks(this.value, options);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\n//import _ from 'lodash';\r\nimport { observer } from 'mobx-react';\r\nimport { Schema, UiSchema, ItemSchema, UiItem, UiRadio, UiTagSingle, UiTagMulti } from '../schema';\r\nimport { ItemEdit } from './itemEdit';\r\nimport { StringItemEdit } from './stringItemEdit';\r\nimport { ImageItemEdit } from './imageItemEdit';\r\nimport { RadioItemEdit } from './radioItemEdit';\r\nimport { SelectItemEdit } from './selectItemEdit';\r\nimport { IdItemEdit } from './idItemEdit';\r\nimport { TagSingleItemEdit, TagMultiItemEdit } from './tagItemEdit';\r\n\r\nexport interface EditProps {\r\n    className?: string;\r\n    schema: Schema;\r\n    data: any;\r\n    onItemClick?: (itemSchema: ItemSchema, uiItem: UiItem, value: any) => Promise<void>;\r\n    onItemChanged?: (itemSchema: ItemSchema, newValue:any, preValue:any) => Promise<void>;\r\n    stopEdit?: boolean;\r\n    uiSchema?: UiSchema;\r\n    sepClassName?: string;\r\n    topBorderClassName?: string;\r\n    bottomBorderClassName?: string;\r\n    rowContainerClassName?: string;\r\n}\r\n\r\n@observer\r\nexport class Edit extends React.Component<EditProps> {\r\n    private defaultSepClassName = 'border-top edit-sep-light-gray';\r\n    private defaultRowContainerClassName = 'd-flex px-3 py-2 bg-white align-items-center';\r\n    private topBorder:JSX.Element;\r\n    private bottomBorder:JSX.Element;\r\n    private rowContainerClassName?: string;\r\n    private sep:JSX.Element;\r\n\tprivate uiSchema: {[name:string]: UiItem};\r\n\r\n    constructor(props: EditProps) {\r\n        super(props);\r\n        let {topBorderClassName, bottomBorderClassName, sepClassName, rowContainerClassName, uiSchema, stopEdit} = props;\r\n        this.topBorder = <div className={topBorderClassName || this.defaultSepClassName} />;\r\n        this.bottomBorder = <div className={bottomBorderClassName || this.defaultSepClassName} />;\r\n        this.rowContainerClassName = rowContainerClassName || this.defaultRowContainerClassName;\r\n        if (stopEdit !== true) this.rowContainerClassName += ' cursor-pointer';\r\n        this.sep = <div className={sepClassName || this.defaultSepClassName} />;\r\n\t\tthis.uiSchema = (uiSchema && uiSchema.items) || {};\r\n    }\r\n\r\n    render() {\r\n        let {schema} = this.props;\r\n\t\tlet sep:any;\r\n        return <div>\r\n\t\t\t{this.topBorder}\r\n            {schema.map((itemSchema, index) => {\r\n\t\t\t\tlet {name} = itemSchema;\r\n\t\t\t\tlet uiItem = this.uiSchema===undefined? undefined : this.uiSchema[name];\r\n\t\t\t\tlet label:string, labelHide:any;\r\n\t\t\t\tif (uiItem !== undefined) {\r\n\t\t\t\t\tlabel = uiItem.label || name;\r\n\t\t\t\t\tlabelHide = uiItem.labelHide;\r\n\t\t\t\t};\r\n\t\t\t\tlet value = this.props.data[name];\r\n\t\t\t\tlet itemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n\r\n\t\t\t\tlet {required} = itemSchema;\r\n\t\t\t\tlet requireFlag = required===true && <span className=\"text-danger\">*</span>;\r\n\t\t\t\tlet divLabel:any, cn:string = 'flex-fill d-flex ';\r\n\t\t\t\tif (labelHide === true) {\r\n\t\t\t\t\tdivLabel = undefined;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdivLabel = <div>{label} {requireFlag}</div>;\r\n\t\t\t\t\tcn += 'justify-content-end';\r\n\t\t\t\t}\r\n\t\t\t\tlet ret = <React.Fragment key={index}>\r\n\t\t\t\t\t{sep}\r\n\t\t\t\t\t<div className={'d-flex align-items-center' + this.rowContainerClassName} \r\n\t\t\t\t\t\tonClick={async ()=>await this.rowClick(itemEdit)}>\r\n\t\t\t\t\t\t{divLabel}\r\n\t\t\t\t\t\t<div className={cn}>{\r\n\t\t\t\t\t\t\titemEdit===undefined? undefined: itemEdit.renderContent()\r\n\t\t\t\t\t\t}</div>\r\n\t\t\t\t\t\t{this.props.stopEdit!==true && <div className=\"w-2c text-right\"><i className=\"fa fa-angle-right\" /></div>}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t\tsep = this.sep;\r\n\t\t\t\treturn ret;\r\n\t\t\t})}\r\n\t\t\t{this.bottomBorder}\r\n\t\t</div>;\r\n    }\r\n\r\n\tprivate rowClick = async (itemEdit:ItemEdit/*, itemSchema: ItemSchema, uiItem: UiItem, label:string, value: any*/) => {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\talert('item has no edit');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {itemSchema, uiItem, value} = itemEdit;\r\n        let {onItemChanged, onItemClick, stopEdit} = this.props;\r\n        if (stopEdit === true) return;\r\n        let changeValue:any;\r\n        if (onItemClick !== undefined) {\r\n            await onItemClick(itemSchema, uiItem, value);\r\n            return;\r\n        }\r\n        //let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);\r\n        if (itemEdit === undefined) {\r\n            alert('undefined: let itemEdit:ItemEdit = createItemEdit(itemSchema, uiItem, label, value);');\r\n            return;\r\n        }\r\n        try {\r\n            changeValue = await itemEdit.start();\r\n            if (changeValue !== value) {\r\n\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以移到这里来\r\n\t\t\t\tthis.props.data[itemSchema.name] = changeValue;\r\n                if (onItemChanged === undefined) {\r\n                    alert(`${itemSchema.name} value changed, new: ${changeValue}, pre: ${value}`);\r\n\t\t\t\t\t// 2020-04-15：改值之后，应该赋值吧。所以这一句移到前面去\r\n                    //this.props.data[itemSchema.name] = changeValue;\r\n                }\r\n                else {\r\n                    await onItemChanged(itemSchema, changeValue, value);\r\n                }\r\n            }\r\n            await itemEdit.end();\r\n        }\r\n        catch (err) {\r\n            // 如果直接back，会触发reject，就到这里了\r\n\t\t\tconsole.log('no value changed');\r\n\t\t\tconsole.error(err);\r\n        }\r\n    }\r\n}\r\n\r\ntype NewItemEdit = new (itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any) => ItemEdit;\r\n\r\nfunction createItemEdit(itemSchema: ItemSchema, uiItem:UiItem, label:string, value: any):ItemEdit {\r\n\tlet ie: ItemEdit;\r\n    let itemEdit: NewItemEdit;\r\n    if (uiItem !== undefined) {\r\n        switch (uiItem.widget) {\r\n            default: break;\r\n            case 'id': itemEdit = IdItemEdit; break;\r\n            case 'text': itemEdit = StringItemEdit; break;\r\n            case 'image': itemEdit = ImageItemEdit; break;\r\n            case 'select': itemEdit = SelectItemEdit; break;\r\n            case 'radio': \r\n\t\t\t\tie = new RadioItemEdit(itemSchema, uiItem as UiRadio, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagSingle':\r\n\t\t\t\tie = new TagSingleItemEdit(itemSchema, uiItem as UiTagSingle, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'tagMulti':\r\n\t\t\t\tie = new TagMultiItemEdit(itemSchema, uiItem as UiTagMulti, label, value);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t}\r\n\tif (ie === undefined) {\r\n\t\tif (itemEdit === undefined) {\r\n\t\t\tswitch (itemSchema.type) {\r\n\t\t\t\tcase 'string': itemEdit = StringItemEdit; break;\r\n\t\t\t\tcase 'image': itemEdit = ImageItemEdit; break;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (itemEdit === undefined) return;\r\n\t\tie = new itemEdit(itemSchema, uiItem, label, value);\r\n\t}\r\n\tie.init();\r\n\treturn ie;\r\n}\r\n","export * from './edit';\r\n","import {CenterApiBase} from '../net';\r\n\r\nexport class CenterApi extends CenterApiBase {\r\n    async userAppUnits(app:number):Promise<any[]> {\r\n        return await this.get('tie/user-app-units', {app:app});\r\n    };\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await this.get('user/user-name-nick-icon-from-id', {userId:userId});\r\n    }\r\n}\r\n\r\nexport const centerApi = new CenterApi('tv/', undefined);\r\n","import * as React from 'react';\r\nimport { Page, FA, nav, LMR, List } from \"../components\";\r\nimport { VPage } from '../vm';\r\nimport { appInFrame } from '../net';\r\nimport { CAppBase } from \"./CAppBase\";\r\n\r\n/*\r\nexport class VAppMain extends VPage<CMainBase> {\r\n    async open(param?:any) {\r\n        this.openPage(this.appPage);\r\n    }\r\n\r\n    render(param?:any) {\r\n        return this.appContent();\r\n    }\r\n\r\n    protected appPage = () => {\r\n        let {caption} = this.controller;\r\n        return <Page header={caption} logout={async()=>{appInFrame.unit = undefined}}>\r\n            {this.appContent()}\r\n        </Page>;\r\n    }\r\n\r\n    protected appContent = () => {\r\n        let {cUqArr} = this.controller;\r\n        let content:any;\r\n        if (cUqArr.length === 0) {\r\n            content = <div className=\"text-danger\">\r\n                <FA name=\"\" /> 此APP没有绑定任何的UQ\r\n            </div>;\r\n        }\r\n        else {\r\n            content = cUqArr.map((v,i) => <div key={i}>{v.render()}</div>);\r\n        }\r\n        return <>{content}</>;\r\n    };\r\n}\r\n*/\r\nexport class VUnsupportedUnit extends VPage<CAppBase> {\r\n    async open(predefinedUnit: number) {\r\n        this.openPage(this.page, {predefinedUnit:predefinedUnit});\r\n    }\r\n\r\n    private page = ({predefinedUnit}:{predefinedUnit: number}) => {\r\n        let {user} = nav;\r\n        let userName:string = user? user.name : '[未登录]';\r\n        let {appOwner, appName} = this.controller.uqsMan;\r\n        return <Page header=\"APP无法运行\" logout={true}>\r\n            <div className=\"m-3 text-danger container\">\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">登录用户</div>\r\n                    <div className=\"col-sm text-body\">{userName}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">App</div>\r\n                    <div className=\"col-sm text-body\">{`${appOwner}/${appName}`}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">预设小号</div>\r\n                    <div className=\"col-sm text-body\">{predefinedUnit || <small className=\"\">[无预设小号]</small>}</div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">\r\n                        可能原因<FA name=\"exclamation-triangle\" />\r\n                    </div>\r\n                    <div className=\"col-sm text-body\">\r\n                        <ul className=\"p-0\">\r\n                            <li>没有小号运行 {appName}</li>\r\n                            <li>用户 <b>{userName}</b> 没有加入任何一个运行{appName}的小号</li>\r\n                            {\r\n                                predefinedUnit && \r\n                                <li>预设小号 <b>{predefinedUnit}</b> 没有运行App {appName}</li>\r\n                            }\r\n                        </ul>\r\n                    </div>\r\n                </div>\r\n                <div className=\"form-group row\">\r\n                    <div className=\"col-sm-3 font-weight-bold\">小号{predefinedUnit}</div>\r\n                    <div className=\"col-sm text-body\">\r\n                        预设小号定义在 public/unit.json 文件中。\r\n                        定义了这个文件的程序，只能由url直接启动。\r\n                        用户第一次访问app之后，会缓存在localStorage里。<br/>\r\n                        如果要删去缓存的预定义Unit，logout然后再login。\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VUnitSelect extends VPage<CAppBase> {\r\n    async open() {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private renderRow = (item: any, index: number):JSX.Element => {\r\n        let {id, nick, name} = item;\r\n        return <LMR className=\"px-3 py-2\" right={'id: ' + id}>\r\n            <div>{nick || name}</div>\r\n        </LMR>;\r\n    }\r\n    private onRowClick = async (item: any) => {\r\n        appInFrame.unit = item.id; // 25;\r\n        await this.controller.start();\r\n    }\r\n\r\n    private page = () => {\r\n        return <Page header=\"选择小号\" logout={true}>\r\n            <List items={this.controller.appUnits} item={{render: this.renderRow, onClick: this.onRowClick}}/>\r\n        </Page>\r\n    }\r\n}\r\n\r\nexport class VErrorsPage extends VPage<CAppBase> {\r\n    async open(errors:string[]) {\r\n        this.openPage(this.page, {errors:errors});\r\n    }\r\n\r\n    private page = (errors:{errors:string[]}) => {\r\n        return <Page header=\"ERROR\">\r\n            <div className=\"m-3\">\r\n\t\t\t\t<div className=\"p-3 d-flex justify-content-center align-items-center\">\r\n\t\t\t\t\t<button className=\"btn btn-danger\" onClick={nav.resetAll}>重启网页</button>\r\n\t\t\t\t</div>\r\n\r\n                <div>Load Uqs 发生错误：</div>\r\n                {errors.errors.map((r, i) => <div key={i}>{r}</div>)}\r\n            </div>\r\n        </Page>;\r\n    }\r\n}\r\n\r\nexport class VStartError extends VPage<CAppBase> {\r\n    async open(error:any) {\r\n        this.openPage(this.page, {error:error});\r\n    }\r\n\r\n    private page = ({error}:{error:any}) => {\r\n        return <Page header=\"App start error!\">\r\n            <pre>\r\n                {typeof error === 'string'? error : error.message}\r\n            </pre>\r\n        </Page>;\r\n    }\r\n}","//import _ from 'lodash';\r\nimport { nav, t, setGlobalRes } from \"../components\";\r\nimport { Controller } from '../vm';\r\nimport { UQsMan, TVs } from \"../uq\";\r\nimport { appInFrame, loadAppUqs, UqAppData } from \"../net\";\r\nimport { centerApi } from \"./centerApi\";\r\nimport { VUnitSelect, VErrorsPage, VStartError, VUnsupportedUnit } from \"./vMain\";\r\n\r\n//type EntityType = Tuid | Action | Sheet | Query | Map;\r\n\r\nexport interface IConstructor<T> {\r\n    new (...args: any[]): T;\r\n\r\n    // Or enforce default constructor\r\n    // new (): T;\r\n}\r\n\r\nexport interface AppConfig {\r\n    appName: string;        // 格式: owner/appName\r\n    version: string;        // 版本变化，缓存的uqs才会重载\r\n    tvs: TVs;\r\n    uqNameMap?: {[uqName:string]: string};      // uqName='owner/uq' 映射到内存简单名字：uq, 可以注明映射，也可以自动。有可能重\r\n    loginTop?: JSX.Element;\r\n    oem?: string;               // 用户注册发送验证码的oem厂家，默认同花\r\n    privacy?: string;\r\n}\r\n\r\nexport interface Elements {\r\n\t[id:string]: (element: HTMLElement)=>void,\r\n}\r\n\r\nexport abstract class CAppBase extends Controller {\r\n    protected _uqs: any;\r\n\r\n    protected readonly name: string;\r\n    protected readonly version: string;\r\n\r\n    readonly uqsMan: UQsMan;\r\n    appUnits:any[];\r\n\r\n    // appName: owner/name\r\n    constructor(config: AppConfig) {\r\n        super(undefined);\r\n        let {appName, version, tvs} = config;\r\n        this.name = appName;\r\n        if (appName === undefined) {\r\n            throw new Error('appName like \"owner/app\" must be defined in MainConfig');\r\n        }\r\n        this.version = version;\r\n        this.uqsMan = new UQsMan(this.name, tvs);\r\n    }\r\n\r\n    get uqs(): any {return this._uqs;}\r\n\r\n\tinternalT(str:string):any {\r\n\t\treturn t(str);\r\n\t}\r\n\t\r\n\tprotected setRes(res:any) {\r\n\t\tsetGlobalRes(res);\r\n\t}\r\n\t\r\n\tprotected hookElements(elements: Elements) {\r\n\t\tif (elements === undefined) return;\r\n\t\t//nav.setSettings(appConfig);\r\n\t\t//let cApp:CApp = (await start(CApp, appConfig)) as CApp;\r\n\t\tfor (let i in elements) {\r\n\t\t\tlet el = document.getElementById(i);\r\n\t\t\tif (el) {\r\n\t\t\t\telements[i](el);\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\t\r\n    protected async beforeStart():Promise<boolean> {\r\n        try {\r\n            let retErrors = await this.load();\r\n            //let app = await loadAppUqs(this.appOwner, this.appName);\r\n            // if (isDevelopment === true) {\r\n            // 这段代码原本打算只是在程序员调试方式下使用，实际上，也可以开放给普通用户，production方式下\r\n            let {predefinedUnit} = appInFrame;\r\n            //let {id} = app;\r\n            //this.id = id;\r\n            let {user} = nav;\r\n            if (user !== undefined && user.id > 0) {\r\n                this.appUnits = await centerApi.userAppUnits(this.uqsMan.id);\r\n                switch (this.appUnits.length) {\r\n                    case 0:\r\n                        this.showUnsupport(predefinedUnit);\r\n                        return false;\r\n                    case 1:\r\n                        let appUnit = this.appUnits[0].id;\r\n                        if (appUnit === undefined || appUnit < 0 || \r\n                            (predefinedUnit !== undefined && appUnit !== predefinedUnit))\r\n                        {\r\n                            this.showUnsupport(predefinedUnit);\r\n                            return false;\r\n                        }\r\n                        appInFrame.unit = appUnit;\r\n                        break;\r\n                    default:\r\n                        if (predefinedUnit>0 && this.appUnits.find(v => v.id===predefinedUnit) !== undefined) {\r\n                            appInFrame.unit = predefinedUnit;\r\n                            break;\r\n                        }\r\n                        //nav.push(<this.selectUnitPage />)\r\n                        this.openVPage(VUnitSelect);\r\n                        return false;\r\n                }\r\n            }\r\n            if (retErrors !== undefined) {\r\n                this.openVPage(VErrorsPage, retErrors);\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        catch (err) {\r\n            this.openVPage(VStartError, err);\r\n            return false;\r\n        }\r\n    }\r\n\r\n    async userFromId(userId:number):Promise<any> {\r\n        return await centerApi.userFromId(userId);\r\n    }\r\n\r\n    private async load(): Promise<string[]> {\r\n        let {appOwner, appName} = this.uqsMan;\r\n        let {localData} = this.uqsMan;\r\n        let uqAppData:UqAppData = localData.get();\r\n        if (!uqAppData || uqAppData.version !== this.version) {\r\n            uqAppData = await loadAppUqs(appOwner, appName);\r\n            uqAppData.version = this.version;\r\n            localData.set(uqAppData);\r\n            // \r\n            for (let uq of uqAppData.uqs) uq.newVersion = true;\r\n        }\r\n        let {id, uqs} = uqAppData;\r\n        this.uqsMan.id = id;\r\n        await this.uqsMan.init(uqs);\r\n        let retErrors = await this.uqsMan.load();\r\n        if (retErrors.length === 0) {\r\n            retErrors.push(...this.uqsMan.setTuidImportsLocal());\r\n            if (retErrors.length === 0) {\r\n                this._uqs = this.uqsMan.buildUQs();\r\n                /*\r\n                _.merge(this.uqs, this.uqsMan.uqsColl);\r\n                for (let i in this.uqs) {\r\n                    let p = i.indexOf('/');\r\n                    if (p < 0) continue;\r\n                    let uq = this.uqs[i];\r\n                    \r\n                    let n = i.substr(p+1);\r\n                    let l = n.toLowerCase();\r\n                    this.uqs[n] = uq;\r\n                    if (l !== n) this.uqs[l] = uq;\r\n                }\r\n                */\r\n                return;\r\n            }\r\n        }\r\n        return retErrors;\r\n    }\r\n\r\n    private showUnsupport(predefinedUnit: number) {\r\n        nav.clear();\r\n        this.openVPage(VUnsupportedUnit, predefinedUnit);\r\n    }\r\n}\r\n","import { AppConfig, CAppBase } from './CAppBase';\r\n\r\nexport async function start(CApp: new (config: AppConfig) => CAppBase, appConfig: AppConfig) {\r\n    let html = document.getElementsByTagName('html');\r\n    let version = html[0].getAttribute('data-version');\r\n    if (version) appConfig.version = version;\r\n    let cApp = new CApp(appConfig);\r\n    await cApp.start();\r\n}\r\n","import { Controller } from \"../vm\";\r\nimport { IConstructor } from \"./CAppBase\";\r\n\r\nexport abstract class CBase extends Controller {\r\n    protected readonly _uqs: any;\r\n    protected readonly _cApp: any;\r\n\r\n    constructor(cApp: any) {\r\n        super(undefined);\r\n        this._cApp = cApp;\r\n        this._uqs = cApp && cApp.uqs;\r\n\t}\r\n\r\n    protected get uqs(): any {return this._uqs}\r\n\tget cApp(): any {return this._cApp}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._cApp.internalT(str);\r\n\t}\r\n\r\n    protected newC<T extends CBase>(type: IConstructor<T>):T {\r\n        return new type(this.cApp);\r\n    }\r\n\r\n    protected newSub<T extends CSub>(type: IConstructor<T>):T {\r\n        return new type(this);\r\n    }\r\n}\r\n\r\nexport abstract class CSub extends CBase {\r\n    protected _owner: CBase;\r\n\r\n    constructor(owner: CBase) {\r\n        super(owner.cApp);\r\n        this._owner = owner;\r\n\t}\r\n\r\n\tinternalT(str:string):any {\r\n\t\tlet r = super.internalT(str);\r\n\t\tif (r!==undefined) return r;\r\n\t\treturn this._owner.internalT(str);\r\n\t}\r\n\r\n    protected get owner(): CBase {return this._owner}\r\n}\r\n","export * from './CAppBase';\r\nexport * from './start';\r\nexport * from './CBase';\r\n","import * as React from 'react';\r\nimport { IObservableArray, computed } from 'mobx';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport {List} from './index';\r\n\r\nexport abstract class ListBase {\r\n    protected list: List;\r\n    constructor(list: List) {\r\n        this.list = list;\r\n    }\r\n    get isPaged():boolean {\r\n        let items = this.list.props.items;\r\n        return (items !== null && items !== undefined && Array.isArray(items) === false);\r\n    }\r\n    get items():any[]|IObservableArray<any> {\r\n        let items = this.list.props.items;\r\n        if (items === null) return null;\r\n        if (items === undefined) return undefined;\r\n        if (Array.isArray(items) === true)\r\n            return items as IObservableArray<any>;\r\n        else\r\n            return (items as PageItems<any>).items;\r\n    }\r\n    @computed get loading():boolean {\r\n        let items = this.list.props.items;\r\n        if (items === null) return false;\r\n        if (items === undefined) return true;\r\n        let pageItems = items as PageItems<any>;\r\n        if (pageItems.items === undefined) return false;\r\n        return pageItems.loading;\r\n    }\r\n    get selectedItems():any[] { return undefined; }\r\n    //updateProps(nextProps:any) {}\r\n    dispose() {};\r\n    abstract render: (item:any, index:number) => JSX.Element;\r\n    protected renderContent(item:any, index:number) {\r\n        let {render} = this.list.props.item;\r\n        if (render === undefined) return <div className=\"px-3 py-2\">{JSON.stringify(item)}</div>;\r\n        return render(item, index);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\n\r\nexport class Clickable extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key, onClick} = this.list.props.item;\r\n        return <li key={key===undefined?index:key(item)} className={classNames('va-row-clickable', className)} onClick={()=>onClick && onClick(item)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { ListBase } from './base';\r\nimport { uid } from '../../tool/uid';\r\n\r\nexport class Static extends ListBase {\r\n    render = (item:any, index:number):JSX.Element => {\r\n        let {className, key} = this.list.props.item;\r\n        if (typeof item === 'string') {\r\n            let cn = classNames('va-list-gap', 'px-3', 'pt-1');\r\n            return <li key={uid()} className={cn}>{item}</li>;\r\n        }\r\n        return <li key={key===undefined?index:key(item)} className={classNames(className)}>\r\n            {this.renderContent(item, index)}\r\n        </li>\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport {observable, IObservableArray, isObservableArray, observe} from 'mobx';\r\nimport classNames from 'classnames';\r\nimport {ListBase} from './base';\r\nimport {uid} from '../../tool/uid';\r\nimport { PageItems } from '../../tool/pageItems';\r\nimport { List } from './index';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport interface SelectableItem {\r\n    selected: boolean;\r\n    item: any;\r\n    labelId: string;\r\n}\r\n\r\nexport class Selectable extends ListBase {\r\n    @observable private _items: SelectableItem[];\r\n    private inputItems:{[uid:string]: HTMLInputElement} = {};\r\n\r\n    constructor(list: List) {\r\n        super(list);\r\n        this.buildItems();\r\n        this.listenArraySplice();\r\n    }    \r\n\r\n    private listenArraySplice() {\r\n        let {items} = this.list.props;\r\n        if (items === undefined) return;\r\n        if (items === null) return;\r\n        let itemsArray:any;\r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        if (isObservableArray(items) === true) {\r\n            observe(itemsArray as IObservableArray<any>, (change) => {                \r\n                if (change.type === 'splice') {\r\n                    let {index, removedCount, added} = change;\r\n                    let _added = added && added.map(v => {\r\n                        return {\r\n                            selected: false, \r\n                            item: v, \r\n                            labelId:uid()\r\n                        }\r\n                    });\r\n                    this._items.splice(index, removedCount, ..._added);\r\n                    this.buildItems();\r\n                }\r\n            }, true);\r\n        }\r\n    }\r\n\r\n    private buildItems = () => {\r\n        let {items, selectedItems, compare} = this.list.props;\r\n        let itemsArray:any[] | IObservableArray<any>;\r\n        if (items === undefined) {\r\n            this._items = undefined;\r\n            return;\r\n        }\r\n        if (items === null) {\r\n            this._items = null;\r\n            return;\r\n        }\r\n        \r\n        if (Array.isArray(items) === true) {\r\n            itemsArray = items as any;\r\n        }\r\n        else {\r\n            itemsArray = (items as PageItems<any>).items;\r\n        }\r\n        //let items = this.items;\r\n        //this._selectedItems = selectedItems;\r\n\r\n        let comp: ((item:any, selectItem:any)=>boolean);\r\n        if (compare === undefined) {\r\n            comp = (item:any, selectItem:any) => item === selectItem;\r\n        }\r\n        else {\r\n            comp = compare;\r\n        }\r\n        let retItems = itemsArray.map(v => {\r\n            //let isObserved = isObservable(v);\r\n            //let obj = isObserved === true? toJS(v) : v;\r\n            //let obj = v;\r\n            let selected = selectedItems === undefined?\r\n                false\r\n                : selectedItems.find(si => comp(v, si)) !== undefined;\r\n            return {\r\n                selected: selected, \r\n                item: v, \r\n                labelId:uid()\r\n            };\r\n        });\r\n        this._items = retItems;\r\n    }\r\n\r\n    get items() {\r\n        //if (this._items === undefined) \r\n        //this.buildItems();\r\n        return this._items;\r\n    }\r\n    private checkAll(on: boolean) {\r\n        for (let i in this.inputItems) this.inputItems[i].checked = on;\r\n        for (let item of this._items) item.selected = on;\r\n    }\r\n    selectAll() {\r\n        //if (this._items) this._items.forEach(v => v.selected = true);\r\n        this.checkAll(true);\r\n        this.list.props.item.onSelect(undefined, true, this.anySelected);\r\n    }\r\n    unselectAll() {\r\n        // if (this._items) this._items.forEach(v => v.selected = false);\r\n        this.checkAll(false);\r\n        this.list.props.item.onSelect(undefined, false, this.anySelected);\r\n    }\r\n    /*\r\n    updateProps(nextProps:any) {\r\n        if (nextProps.selectedItems === this._selectedItems) return;\r\n        this.buildItems();\r\n    }\r\n    */\r\n    private get anySelected():boolean {return this._items.some(v => v.selected)}\r\n    private onSelect(item:SelectableItem, selected:boolean) {\r\n        item.selected = selected;\r\n        this.list.props.item.onSelect(item.item, selected, this.anySelected);\r\n    }\r\n    \r\n    get selectedItems():any[] {\r\n        return this._items.filter(v => v.selected === true).map(v => v.item);\r\n    }\r\n    /*\r\n    set selectedItems(value: any[]) {\r\n        if (value === undefined) return;\r\n        if (this._items === undefined) return;\r\n        let sLen = this._items.length;\r\n        let list = value.slice();\r\n        for (let n=0; n<sLen; n++) {\r\n            let sItem = this._items[n];\r\n            let len = list.length;\r\n            if (len === 0) break;\r\n            let item = sItem.item;\r\n            for (let i=0; i<len; i++) {\r\n                let v = list[i];\r\n                if (item === v) {\r\n                    sItem.selected = true;\r\n                    value.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n        };\r\n    }\r\n    */\r\n    //w-100 mb-0 pl-3\r\n    //m-0 w-100\r\n    render = (item:SelectableItem, index:number):JSX.Element => {\r\n        let {key} = this.list.props.item;\r\n        return <this.row item={item} index={index} key={key===undefined?index:key(item)} />;\r\n    }\r\n\r\n    private row = observer((props: {item:SelectableItem, index:number}):JSX.Element => {\r\n        let {item, index} = props;\r\n        let {className} = this.list.props.item;\r\n        let {labelId, selected, item:obItem} = item;\r\n        return <li className={classNames(className)}>\r\n            <div className=\"d-flex align-items-center px-3\">\r\n                <input ref={input=>{if (input) this.inputItems[labelId] = input;}}\r\n                    className=\"\" type=\"checkbox\" value=\"\" id={labelId}\r\n                    defaultChecked={selected}\r\n                    onChange={(e)=>{\r\n                        this.onSelect(item, e.target.checked)} \r\n                    }/>\r\n                <label className=\"\" style={{flex:1, marginBottom:0}} htmlFor={labelId}>\r\n                    {this.renderContent(obItem, index)}\r\n                </label>\r\n            </div>\r\n        </li>\r\n    })\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {PageItems} from '../../tool/pageItems';\r\nimport {ListBase} from './base';\r\nimport {Clickable} from './clickable';\r\nimport {Static} from './static';\r\nimport {Selectable} from './selectable';\r\nimport '../../css/va-list.css';\r\nimport { IObservableArray } from 'mobx';\r\nimport { resLang } from '../../res/res';\r\nimport { ListRes, listRes } from '../../res';\r\n\r\ntype StaticRow = string|JSX.Element|(()=>string|JSX.Element);\r\n\r\nexport interface ListProps {\r\n    className?: string|string[];\r\n    items: any[] | IObservableArray<any> | PageItems<any>;\r\n    item: {\r\n        className?: string|string[];\r\n        render?: (item:any, index:number) => JSX.Element;\r\n        onSelect?: (item:any, isSelected:boolean, anySelected:boolean)=>void;\r\n        onClick?: (item:any)=>void;\r\n        key?: (item:any)=>string|number;\r\n    };\r\n    compare?:(item:any, selectItem:any)=>boolean;\r\n    selectedItems?:any[];\r\n    header?: StaticRow;\r\n    footer?: StaticRow;\r\n    before?: StaticRow;\r\n    loading?: StaticRow;\r\n\tnone?: StaticRow;\r\n\tonFocus?: (evt: React.FocusEvent<HTMLUListElement>)=>void;\r\n}\r\n\r\n@observer\r\nexport class List extends React.Component<ListProps> {\r\n\tprivate static res:ListRes = resLang<ListRes>(listRes);\r\n\r\n    private listBase: ListBase;\r\n\tprivate selectable: Selectable;\r\n    constructor(props:ListProps) {\r\n\t\tsuper(props);\r\n        this.buildBase();\r\n    }\r\n    _$scroll = (direct: 'top'|'bottom') => {\r\n        console.log('############### items scroll to ' + direct);\r\n    }\r\n    private buildBase() {\r\n        let {item} = this.props;\r\n        let {onClick, onSelect} = item;\r\n        if (onSelect !== undefined)\r\n            this.selectable = this.listBase = new Selectable(this);\r\n        else if (onClick !== undefined)\r\n            this.listBase = new Clickable(this);\r\n        else\r\n            this.listBase = new Static(this);\r\n    }\r\n    /*\r\n    componentWillUpdate(nextProps:ListProps, nextState, nextContext) {\r\n        //this.listBase.updateProps(nextProps);\r\n    }\r\n    */\r\n    componentWillUnmount() {\r\n        this.listBase.dispose();\r\n    }\r\n    selectAll() {\r\n        if (this.selectable) this.selectable.selectAll();\r\n    }\r\n    unselectAll() {\r\n        if (this.selectable) this.selectable.unselectAll();\r\n    }\r\n    get selectedItems():any[] {\r\n        return this.listBase.selectedItems;\r\n    }\r\n    render() {\r\n        let {className, header, footer, before, loading, none, onFocus} = this.props;\r\n        if (before === undefined) before = '-';\r\n        if (loading === undefined) loading = () => <i className=\"fa fa-spinner fa-spin fa-2x fa-fw text-info\" />;\r\n        if (none === undefined) none = List.res.none;\r\n        //this.listBase.selectedItems = selectedItems;\r\n        let {items, loading:isLoading} = this.listBase;\r\n        function staticRow(row:StaticRow, type:string) {\r\n            if (!row) return;\r\n            switch (typeof row) {\r\n                default:\r\n                case 'string': return <li className={\"va-list-\"+type}>{row}</li>;\r\n                case 'function': return <li className={\"va-list-\"+type}>{(row as ()=>string|JSX.Element)()}</li>;\r\n                case 'object': return <li>{row}</li>\r\n            } \r\n        }\r\n        let content:any, waitingMore:any;\r\n        if (items === null)\r\n            content = staticRow(before, 'before');\r\n        else if (items === undefined)\r\n            content = staticRow(loading, 'loading');\r\n        else if (items.length === 0)\r\n            content = staticRow(none, 'none');\r\n        else {\r\n            content = items.map((item, index) => {\r\n                return this.listBase.render(item, index);\r\n            });\r\n        }\r\n        if (isLoading === true && items) {\r\n            waitingMore = staticRow(loading, 'loading');\r\n\t\t}\r\n\t\tlet tabIndex:number;\r\n\t\tif (onFocus !== undefined) tabIndex = -1;\r\n        return <ul className={classNames('va-list', className)} onFocus={onFocus} tabIndex={tabIndex}>\r\n            {staticRow(header, 'header')}\r\n            {content}\r\n            {waitingMore}\r\n            {staticRow(footer, 'footer')}\r\n        </ul>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport className from 'classnames';\r\nimport {PropGridProps} from './PropGrid';\r\nimport {LabeledProp, StringProp, NumberProp, ListProp, ComponentProp} from './propView';\r\n\r\nexport abstract class PropRow {\r\n    setValues(values: any) {}\r\n    abstract render(key:string): any;\r\n}\r\n\r\nexport class PropBorder extends PropRow {\r\n    render(key:string): JSX.Element {\r\n        return <div key={'_b_' + key} className=\"\">\r\n            <div className=\"w-100\">\r\n                <div style={{borderTop: '1px solid #f0f0f0'}} />\r\n            </div>\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class PropGap extends PropRow {\r\n    private param: string;\r\n    constructor(param?: string) {\r\n        super();\r\n        this.param = param;\r\n    }\r\n    render(key:string): JSX.Element {\r\n        let w: string;\r\n        switch (this.param) {\r\n            default: w = 'py-2'; break;\r\n            case '=': w = 'py-1'; break;\r\n            case '-': w = 'pb-1'; break;\r\n        }\r\n        let cn = className(w);\r\n        return <div key={'_g_' + key} className={cn} />;\r\n    }\r\n}\r\n\r\nconst valueAlignStart = 'justify-content-start';\r\nconst valueAlignCenter = 'justify-content-center';\r\nconst valueAlignEnd = 'justify-content-end';\r\nexport abstract class LabeledPropRow extends PropRow {\r\n    protected gridProps: PropGridProps;\r\n    protected _prop: LabeledProp;\r\n    protected get prop():LabeledProp {return this._prop}\r\n    protected content: any;\r\n    protected col: string;\r\n    //protected values: any;\r\n    constructor(gridProps:PropGridProps, prop: LabeledProp) {\r\n        super();\r\n        this.gridProps = gridProps;\r\n        this._prop = prop;\r\n        this.col = gridProps.labelFixLeft === true? 'col' : 'col-sm';\r\n        //this.values = values;\r\n    }\r\n    render(key:string):any {\r\n        let {onClick, bk} = this.prop;\r\n        let cn = className({\r\n            \"cursor-pointer\": onClick !== undefined,\r\n            \"bg-white\": bk === undefined, \r\n            \"row\": true\r\n        });\r\n        return <div key={key} className={cn} onClick={onClick}>\r\n            {this.renderLabel()}\r\n            {this.renderProp()}\r\n        </div>;\r\n    }\r\n    protected renderLabel():any {\r\n        let {label} = this.prop;\r\n        if (label === undefined) return null;\r\n        return <label className={this.col + '-3 col-form-label'}>\r\n            {label}\r\n        </label>;\r\n    }\r\n    protected renderProp():any {\r\n        let {label} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string = this.col + (label===undefined? '-12':'-9');\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n    protected renderPropBody():any {\r\n        return <div className=\"form-control-plaintext\">\r\n            {this.renderPropContent()}\r\n        </div>;\r\n    }\r\n    protected renderPropContent():any {\r\n        return this.content;\r\n    }\r\n}\r\n\r\nexport class StringPropRow extends LabeledPropRow {\r\n    protected get prop(): StringProp {return this._prop as StringProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class NumberPropRow extends LabeledPropRow {\r\n    protected get prop(): NumberProp {return this._prop as NumberProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else this.content = values[this.prop.name];\r\n    }\r\n}\r\n\r\nexport class ListPropRow extends LabeledPropRow {\r\n    protected get prop(): ListProp {return this._prop as ListProp;}\r\n    setValues(values:any) {\r\n        if (values === undefined) this.content = undefined;\r\n        else {\r\n            let list = this.prop.list;\r\n            if (typeof list === 'string') this.content = values[list];\r\n            else this.content = undefined;\r\n        }\r\n    }\r\n    protected renderPropBody() {\r\n        let {list, row} = this.prop;\r\n        let items:any[] = typeof list === 'string'? this.content : list;\r\n        if (items === undefined) return <div/>;\r\n        // new row(item)\r\n        return <div className=\"w-100\">\r\n            {\r\n                items.map((item, index) => <React.Fragment key={index}>\r\n                    {index===0? null: <div style={{width:'100%', borderBottom:'1px solid #f0f0f0'}} />}\r\n                    {React.createElement(row, item)}\r\n                </React.Fragment>)\r\n            }\r\n        </div>;\r\n    }\r\n}\r\n\r\nexport class ComponentPropRow extends LabeledPropRow {\r\n    protected get prop(): ComponentProp {return this._prop as ComponentProp;}\r\n    protected renderPropBody() {\r\n        let {component} = this.prop;\r\n        return component;\r\n    }\r\n    protected renderProp():any {\r\n        let {label, full} = this.prop;\r\n        let align, vAlign;\r\n        switch (this.gridProps.alignValue) {\r\n            case 'left': align = valueAlignStart; break;\r\n            case 'center': align = valueAlignCenter; break;\r\n            case 'right': align = valueAlignEnd; break;\r\n        }\r\n        switch (this.prop.vAlign) {\r\n            case 'top': vAlign = 'align-items-start'; break;\r\n            default:\r\n            case 'center': vAlign = 'align-items-center'; break;\r\n            case 'bottom': vAlign = 'align-items-end'; break;\r\n            case 'stretch': vAlign = 'align-items-stretch'; break;\r\n        }\r\n        let col:string;\r\n        if (full !== true)\r\n            col = this.col + (label===undefined? '-12':'-9');\r\n        else\r\n            col = 'w-100';\r\n        let cn = className(align, vAlign, col, 'd-flex');\r\n        return <div className={cn}>\r\n            {this.renderPropBody()}\r\n        </div>;\r\n    }\r\n}\r\n","import { PropGridProps } from './PropGrid';\r\nimport {\r\n    PropRow, PropBorder, PropGap, \r\n    StringPropRow, NumberPropRow, ListPropRow, ComponentPropRow\r\n} from './row';\r\n\r\nexport interface Format {\r\n\r\n}\r\n\r\nexport interface PropBase {\r\n    onClick?: () => void;\r\n}\r\n\r\nexport interface LabeledProp extends PropBase {\r\n    label?: string;\r\n    bk?: string;\r\n    vAlign?: 'top' | 'bottom' | 'center' | 'stretch';\r\n}\r\n\r\nexport interface StringProp extends LabeledProp {\r\n    type: 'string';\r\n    name: string;\r\n}\r\n\r\nexport interface NumberProp extends LabeledProp {\r\n    type: 'number';\r\n    name: string;\r\n}\r\n\r\nexport interface FormatProp extends LabeledProp {\r\n    type: 'format';\r\n    format: Format;\r\n}\r\n\r\nexport interface ListProp extends LabeledProp {\r\n    type: 'list';\r\n    list: string | any[];  // string 表示名字，否则就是值\r\n    row: new (props: any) => React.Component;\r\n}\r\n\r\nexport interface ComponentProp extends LabeledProp {\r\n    type: 'component';\r\n    full?: boolean;\r\n    component: any; //JSX.Element;\r\n}\r\n\r\nexport type Prop = StringProp | NumberProp | FormatProp | ListProp | ComponentProp | string;\r\n\r\nexport class PropView {\r\n    private gridProps: PropGridProps\r\n    private props: Prop[];\r\n    //private values:any;\r\n    private rows: PropRow[];\r\n\r\n    constructor(gridProps: PropGridProps, props: Prop[]) {\r\n        this.gridProps = gridProps;\r\n        this.props = props;\r\n        //this.values = values;\r\n        this.buildRows();\r\n    }\r\n\r\n    private buildRows() {\r\n        this.rows = [];\r\n        let isGap: boolean = true;\r\n        for (let prop of this.props) {\r\n            if (typeof prop === 'string') {\r\n                this.rows.push(new PropGap(prop));\r\n                isGap = true;\r\n            }\r\n            else {\r\n                if (!isGap) this.rows.push(new PropBorder());\r\n                let row;\r\n                switch (prop.type) {\r\n                    default: continue;\r\n                    case 'string': row = new StringPropRow(this.gridProps, prop); break;\r\n                    case 'number': row = new NumberPropRow(this.gridProps, prop); break;\r\n                    case 'list': row = new ListPropRow(this.gridProps, prop); break;\r\n                    case 'component': row = new ComponentPropRow(this.gridProps, prop); break;\r\n                }\r\n                this.rows.push(row);\r\n                isGap = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    setValues(values: any) {\r\n        for (let r of this.rows) r.setValues(values);\r\n    }\r\n\r\n    render() {\r\n        return this.rows.map((row, index) => row.render(String(index)));\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport {observer} from 'mobx-react';\r\nimport {Prop, PropView} from './propView';\r\n\r\nexport interface PropGridProps {\r\n    className?: string;\r\n    rows: Prop[];\r\n    values: any;\r\n    alignValue?: 'left'|'center'|'right';\r\n    labelFixLeft?: boolean;\r\n}\r\n\r\n@observer\r\nexport class PropGrid extends React.Component<PropGridProps> {\r\n    render() {\r\n        let {className, rows, values} = this.props;\r\n        let propView = new PropView(this.props, rows);\r\n        propView.setValues(values);\r\n        let cn = classNames('container-fluid', className);\r\n        return <div className={cn}>\r\n            {propView.render()}\r\n        </div>;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { observable } from 'mobx';\r\nimport { Page, ItemSchema, UiSchema, StringSchema, UiTextItem, Edit, ImageSchema, nav, UiImageItem } from '../components';\r\nimport { userApi } from '../net';\r\n\r\nexport class EditMeInfo extends React.Component {\r\n    private schema:ItemSchema[] = [\r\n        {name:'nick', type:'string'} as StringSchema,\r\n        {name:'icon', type:'image'} as ImageSchema\r\n    ];\r\n    private uiSchema:UiSchema = {\r\n        items: {\r\n            nick: {widget:'text', label:'别名', placeholder:'好的别名更方便记忆'} as UiTextItem,\r\n            icon: {widget:'image', label:'头像'} as UiImageItem,\r\n        }\r\n    }\r\n    @observable private data:any;\r\n\r\n    constructor(props:any) {\r\n        super(props);\r\n        let {nick, icon} = nav.user;\r\n        this.data = {\r\n            nick: nick,\r\n            icon: icon,\r\n        }\r\n    }\r\n\r\n    private onItemChanged = async (itemSchema:ItemSchema, newValue:any, preValue:any) => {\r\n        let {name} = itemSchema;        \r\n        await userApi.userSetProp(name, newValue);\r\n        this.data[name] = newValue;\r\n        let user:any = nav.user;\r\n        user[name] = newValue;\r\n        nav.saveLocalUser();\r\n    }\r\n\r\n    render() {\r\n        return <Page header=\"个人信息\">\r\n            <Edit schema={this.schema} uiSchema={this.uiSchema}\r\n                data={this.data}\r\n                onItemChanged={this.onItemChanged} />\r\n        </Page>;\r\n    }\r\n}\r\n","// eslint-disable-next-line\r\nimport { Tuid, Map, Query, Action, Sheet, Tag } from \"tonva\";\r\n\r\nexport enum EnumNoteType {Text=0, Assign=10, Task=20};\r\nexport enum EnumTaskState {\r\n\tstart=0, \r\n\ttodo=20, doing=21, done=22, \r\n\tpass=40, fail=41,\r\n\trated=60, \r\n\tarchive=-20,\r\n\tcancel=-40\r\n};\r\nexport enum EnumTaskStep {todo=20, done=22, check=40, rate=60};\r\n\r\nexport function stateText(state:EnumTaskState):{text:string; act:string} {\r\n\tlet text:string, act:string;\r\n\tswitch (state) {\r\n\t\tdefault:\r\n\t\t\ttext = '未知'; act = '未知'; break;\r\n\t\tcase EnumTaskState.todo:\r\n\t\t\ttext = '待办'; act = '领办'; break;\r\n\t\tcase EnumTaskState.done:\r\n\t\t\ttext = '待查验'; act = '完成'; break;\r\n\t\tcase EnumTaskState.pass:\r\n\t\t\ttext = '待评分'; act = '认可'; break;\r\n\t\tcase EnumTaskState.fail:\r\n\t\t\ttext = '待办'; act = '检查'; break;\r\n\t\tcase EnumTaskState.rated:\r\n\t\t\ttext = '已评分'; act = '评分'; break;\r\n\t\tcase EnumTaskState.archive:\r\n\t\t\ttext = '已归档'; act = '归档'; break;\r\n\t\t}\r\n\treturn {text, act};\r\n}\r\n\r\nexport interface Performance {\r\n\tGroup: Tuid;\r\n\tAddGroupMember: Action;\r\n\tRemoveGroupMember: Action;\r\n\tGetMyGroups: Query;\r\n\tSaveGroup: Action;\r\n\tSaveGroupProp: Action;\r\n\tGetGroupNotes: Query;\r\n\tGetGroupMembers: Query;\r\n\r\n\tTodo: Tuid;\r\n\tTask: Tuid;\r\n\tAssign: Tuid;\r\n\tAssignItem: Tuid;\r\n\t\r\n\tNewAssign: Action;\r\n\tTakeAssign: Action;\r\n\tTaskDone: Action;\r\n\tTaskPass: Action;\r\n\tTaskFail: Action;\r\n\tTaskRate: Action;\r\n\tPushNote: Action;\r\n\tSaveTodo: Action;\r\n\tTaskTodo: Action;\r\n\tTaskAct: Action;\r\n\tRemoveTask: Action;\r\n\tPublishAssign: Action;\r\n\tTestText: Action;\r\n\r\n\t$Poked: Query;\r\n\tGetMyAssigns: Query;\r\n\tGetAssign: Query;\r\n\tGetTodo: Query;\r\n\tGetMyArchiveTodos: Query;\r\n\tGetUserTodos: Query;\r\n\tGetTask: Query;\r\n\tGetMyTasks: Query;\r\n\tGetMyTaskArchive: Query;\r\n\tGetMyMembers: Query;\r\n\r\n\tTestExpression: Action;\r\n\ttest1: Tag;\r\n\ttest2: Tag;\r\n}\r\n\r\nexport interface UQs {\r\n    performance: Performance\r\n}\r\n","import { AppConfig } from \"tonva\";\r\n\r\nexport const appConfig: AppConfig = {\r\n    appName: 'BizDev/performance',\r\n    version: '1.0.0',\r\n    tvs: {},\r\n    oem: '百灵威'\r\n};\r\n","import { CSub, CBase, CAppBase, IConstructor } from 'tonva';\r\nimport { UQs } from './uqs';\r\nimport { CApp } from './CApp';\r\n\r\nexport abstract class CUqBase extends CBase {\r\n    get cApp(): CApp { return this._cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n}\r\n\r\nexport abstract class CUqSub extends CSub {\r\n    get cApp(): CApp { return this.cApp; }\r\n    protected get uqs(): UQs { return this._uqs as UQs };\r\n    protected get owner(): CUqBase { return this._owner as CUqBase }\r\n}\r\n\r\nexport abstract class CUqApp extends CAppBase {\r\n    get uqs(): UQs { return this._uqs };\r\n\r\n    protected newC<T extends CUqBase>(type: IConstructor<T>): T {\r\n\t\tlet c = new type(this);\r\n\t\tc.init();\r\n\t\treturn c;\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, TabCaptionComponent, Page } from 'tonva';\r\nimport { CApp } from './CApp';\r\n\r\nconst color = (selected: boolean) => selected === true ? 'text-primary' : 'text-muted';\r\n\r\nexport class VMain extends VPage<CApp> {\r\n    async open(param?: any) {\r\n        this.openPage(this.render);\r\n    }\r\n\r\n    render = (param?: any): JSX.Element => {\r\n        let { cGroup, cJob, cHome, cMe } = this.controller;\r\n        let faceTabs = [\r\n\t\t\t{ name: 'note', label: '首页', icon: 'home', content: cGroup.tab},\r\n\t\t\t{ name: 'job', label: '工作', icon: 'list', content: cJob.tab, onShown: cJob.load, className: 'job-tab' },\r\n            { name: 'home', label: '绩效', icon: 'tasks', content: cHome.tab, },\r\n            { name: 'me', label: '我的', icon: 'user', content: cMe.tab }\r\n        ].map(v => {\r\n            let { name, label, icon, content, onShown, className } = v;\r\n            return {\r\n                name: name,\r\n                caption: (selected: boolean) => TabCaptionComponent(label, icon, color(selected)),\r\n                content: content,\r\n\t\t\t\tonShown: onShown,\r\n\t\t\t\tclassName: className\r\n            }\r\n\t\t});\r\n\t\treturn <Page tabsProps={{tabs:faceTabs}} />;\r\n\t\t/*\r\n        return <Page header={false} headerClassName={\"bg-info\"} >\r\n            <Tabs tabs={faceTabs} />\r\n        </Page>;\r\n\t\t//\r\n\t\t*/\r\n    }\r\n}\r\n","\r\nexport enum Token {\r\n    NONE = -1,\r\n    _FINISHED = 0,\r\n    ADD = 1, \r\n    SUB = 2,\r\n    MUL = 3,\r\n    DIV = 4,\r\n    MOD = 5,\r\n    XOR = 6,\r\n    BITWISEAND = 7,\r\n    BITWISEOR = 8,\r\n    OR = 9,\r\n    AND = 10,\r\n    NOT = 11,\r\n    GT = 12,\r\n    GE = 13,\r\n    LT = 14,\r\n    LE = 15,\r\n    NE = 16,\r\n    EQU = 17, \r\n    DOT =18,\r\n    COMMA =19,\r\n    COLON = 20,\r\n    SEMICOLON = 21,\r\n    AT = 22,\r\n    DOLLAR = 23,\r\n    LPARENTHESE = 24,\r\n    RPARENTHESE = 25,\r\n    LBRACE = 26,\r\n    RBRACE = 27, \r\n    NUM = 28,\r\n    VAR = 29,\r\n    HEX = 30,\r\n    REM = 31,\r\n    STRING = 32,\r\n    ADDEQU = 33,\r\n    SUBEQU = 34,\r\n    LBRACKET = 35,\r\n    RBRACKET = 36,\r\n    SHARP = 37,\r\n    CODE = 38,\r\n    DOLLARVAR = 39,\r\n}\r\n\r\n// QM_GT = 18, QM_GE, QM_LT, QM_LE, QM_EQU, QM_LIKE, QM_BETWEEN,\r\n// LBBRACE, RBBRACE,","import React from 'react';\r\nimport { VPage, UserView, User } from 'tonva';\r\nimport { CMe } from './CMe';\r\n\r\nexport class VMe extends VPage<CMe> {\r\n\tinit(param?:any) {\r\n\t\t// useUser(10);\r\n\t}\r\n\tlogout(): boolean | (()=>Promise<void>) {return true;}\r\n\trender(param?:any):JSX.Element {\r\n\t\tthis.init(param);\r\n\t\treturn this.renderPage();\r\n\t}\r\n\r\n\theader() {return  '我的'}\r\n\tcontent() {\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\treturn <>{user.name}</>;\r\n\t\t}\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t<UserView user={10} render={renderUser} />\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { CUqBase } from '../tapp';\r\nimport { VMe } from './VMe';\r\n\r\nexport class CMe extends CUqBase {\r\n    protected async internalStart() {\r\n\r\n    }\r\n    tab = () => this.renderView(VMe);\r\n}","import * as React from 'react';\r\nimport { VPage, Page, Form, ItemSchema, Schema, UiSchema, UiTagMulti, UiTagSingle, Context, Edit, List } from 'tonva';\r\nimport { CHome } from './CHome';\r\nimport { observable } from 'mobx';\r\n\r\nconst itemBlock = \"p-3 border border-info mr-1 mb-1 w-10c cursor-pointer bg-white rounded\";\r\nconst itemStyle = {maxWidth: '45%'};\r\n\r\nexport class VMain extends VPage<CHome> {\r\n\tprivate schema:Schema = [\r\n\t\t{name: 'a', type: 'string'},\r\n\t\t{name: 'b', type: 'string'},\r\n\t\t{name: 'c', type: 'string'},\r\n\t\t{name: 'submit', type: 'submit'}\r\n\t];\r\n\tprivate uiSchema: UiSchema;\r\n\r\n\t@observable private data:any = {\r\n\t\tb:3, \r\n\t\tc:'2|4'\r\n\t}\r\n\r\n    async open(param?: any) {\r\n\t}\r\n\r\n\tprivate submit = async (name:string, context:Context ):Promise<void> => {\r\n\t\talert(name + ': ' + JSON.stringify(context.data));\r\n\t}\r\n\r\n\tprivate onEditItemChanged = async (itemSchema: ItemSchema, newValue:any, preValue:any): Promise<void> => {\r\n\t\tthis.data[itemSchema.name] = newValue;\r\n\t}\r\n\r\n    render() {\r\n\t\tthis.uiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tb: { \r\n\t\t\t\t\tlabel: '单选Radio',\r\n\t\t\t\t\twidget: 'tagSingle', \r\n\t\t\t\t\tvaluesView: this.controller.tagTest1.view,\r\n\t\t\t\t\t\r\n\t\t\t\t} as UiTagSingle,\r\n\t\t\t\tc: {\r\n\t\t\t\t\tlabel: '多选CheckBox',\r\n\t\t\t\t\twidget: 'tagMulti', \r\n\t\t\t\t\tvaluesView: this.controller.tagTest2.view,\r\n\t\t\t\t\twrapClassName: 'row-cols-sm-2'\r\n\t\t\t\t} as UiTagMulti,\r\n\t\t\t\tsubmit: {\r\n\t\t\t\t\tlabel: '提交',\r\n\t\t\t\t\twidget: 'button',\r\n\t\t\t\t\tclassName: 'btn btn-primary'\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n        let arr = [\r\n            'adfas1fd', 'asdfddddsadf', 'adsfasf', 'sdafsdf dsf a',\r\n            'adfasfd', 'asdfsadf', 'adsfasf', 'sdafsdf dsf a',\r\n            'adfasfd', 'asdfsadf', 'adsfasf', 'sdafsdf dsf a',\r\n        ]\r\n        return <Page header=\"绩效\" headerClassName=\"bg-info\">\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<button className=\"mr-3 btn btn-outline-primary\" onClick={this.controller.test}>Test</button>\r\n\t\t\t\t<button className=\"mr-3 btn btn-outline-primary\" onClick={this.controller.testParser}>测试表达式</button>\r\n\t\t\t\t<button className=\"mr-3 btn btn-outline-primary\" onClick={this.controller.actionTestExpression}>actionTestExpression</button>\r\n\t\t\t</div>\r\n\t\t\t<List items={[]} item={{render:this.renderListItem}} none={<div className=\"p-3 text-success\">ok ok ok</div>} />\r\n            <div className=\"d-flex flex-wrap m-3 justify-content-start\">\r\n                {arr.map((v, index) => <div key={index} className={itemBlock} style={itemStyle} onClick={()=>alert(v)}>{v}</div>)}\r\n            </div>\r\n\t\t\t<Form className=\"p-3\" \r\n\t\t\t\tschema={this.schema} \r\n\t\t\t\tuiSchema={this.uiSchema}\r\n\t\t\t\tformData={this.data}\r\n\t\t\t\tfieldLabelSize={2}\r\n\t\t\t\tonButtonClick={this.submit} />\r\n\t\t\t<Edit className=\"p-3\" \r\n\t\t\t\tschema={this.schema}\r\n\t\t\t\tuiSchema={this.uiSchema}\r\n\t\t\t\tdata={this.data}\r\n\t\t\t\tonItemChanged={this.onEditItemChanged}\r\n\t\t\t />\r\n        </Page>;\r\n\t}\r\n\t\r\n\tprivate renderListItem = (item:any, index:number) => {\r\n\t\treturn <div>1</div>;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { Page, VPage, Form, ItemSchema, UiSchema, UiTextItem, UiButton, NumSchema, UiTextAreaItem } from 'tonva';\r\nimport { CHome } from './CHome';\r\n\r\nexport class VTest extends VPage<CHome> {\r\n    async open(param?: any) {\r\n        this.openPage(this.page);\r\n    }\r\n\r\n    private page = () => {\r\n        let items:ItemSchema[] = [\r\n            {name: 'name1', type: 'string', required: true},\r\n            {name: 'name2', type: 'string'},\r\n            {name: 'num', type: 'number', min: 10, max: 50} as NumSchema,\r\n            {name:'submit', type:'button'}\r\n        ];\r\n        let uis: UiSchema = {\r\n            items: {\r\n                name1: {widget: 'text', label: '姓名', placeholder: '请输入姓名'} as UiTextItem,\r\n                name2: {widget: 'textarea', label: '姓名2', placeholder: '请输入姓名2'} as UiTextAreaItem,\r\n                submit: {widget: \"button\", label: '提交', className: 'btn btn-success'} as UiButton\r\n            }\r\n        }\r\n \r\n        return <Page header=\"试验\">\r\n            <Form className=\"m-3\"\r\n                schema={items}\r\n                uiSchema={uis} fieldLabelSize={3} />\r\n        </Page>\r\n        //return <ImageUploader size=\"lg\" />\r\n    }\r\n}\r\n","\r\nlet chars = '+-*\\\\/%(){}[].,;:^=<>&|\\'\"_?09$@#';\r\nlet lowercase = 'abcdefghijklmnopqrstuvwxyz';\r\nlet uppercase = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';\r\n\r\nexport class Char {\r\n    static NULL         = 0;\r\n    static TAB          = 9;\r\n    static _R           = 10;\r\n    static ENTER        = 13;\r\n    static SPACE        = 32;\r\n    \r\n    static PLUS         = chars.charCodeAt(0);\r\n    static MINUS        = chars.charCodeAt(1);\r\n    static STAR         = chars.charCodeAt(2);\r\n    static BACKSLASH    = chars.charCodeAt(3);\r\n    static SLASH        = chars.charCodeAt(4);\r\n    static PERCENT      = chars.charCodeAt(5);\r\n    static LParenthese  = chars.charCodeAt(6);\r\n    static RParenthese  = chars.charCodeAt(7);\r\n    static LBrace       = chars.charCodeAt(8);\r\n    static RBrace       = chars.charCodeAt(9);\r\n    static LBracket     = chars.charCodeAt(10);\r\n    static RBracket     = chars.charCodeAt(11);\r\n    static DOT          = chars.charCodeAt(12);\r\n    static COMMA        = chars.charCodeAt(13);\r\n    static SEMICOLON    = chars.charCodeAt(14);\r\n    static COLON        = chars.charCodeAt(15);\r\n    static TOPANGLE     = chars.charCodeAt(16);\r\n    static EQU          = chars.charCodeAt(17);\r\n    static LS           = chars.charCodeAt(18);\r\n    static GT           = chars.charCodeAt(19);\r\n    static AND          = chars.charCodeAt(20);\r\n    static OR           = chars.charCodeAt(21);\r\n    static Apostrophe   = chars.charCodeAt(22);     // '\r\n    static QUOT         = chars.charCodeAt(23);     // \"\r\n    static UNDERLINE    = chars.charCodeAt(24);     // _\r\n    static QUESTION     = chars.charCodeAt(25);\r\n    static ZERO         = chars.charCodeAt(26);\r\n    static NINE         = chars.charCodeAt(27);\r\n    static DOLLAR       = chars.charCodeAt(28);\r\n    static AT           = chars.charCodeAt(29);\r\n    static SHARP        = chars.charCodeAt(30);\r\n    \r\n    static a            = lowercase.charCodeAt(0); \r\n    static b            = lowercase.charCodeAt(1); \r\n    static c            = lowercase.charCodeAt(2); \r\n    static d            = lowercase.charCodeAt(3); \r\n    static e            = lowercase.charCodeAt(4); \r\n    static f            = lowercase.charCodeAt(5); \r\n    static g            = lowercase.charCodeAt(6); \r\n    static h            = lowercase.charCodeAt(7); \r\n    static i            = lowercase.charCodeAt(8); \r\n    static j            = lowercase.charCodeAt(9); \r\n    static k            = lowercase.charCodeAt(10); \r\n    static l            = lowercase.charCodeAt(11); \r\n    static m            = lowercase.charCodeAt(12); \r\n    static n            = lowercase.charCodeAt(13); \r\n    static o            = lowercase.charCodeAt(14); \r\n    static p            = lowercase.charCodeAt(15); \r\n    static q            = lowercase.charCodeAt(16); \r\n    static r            = lowercase.charCodeAt(17); \r\n    static s            = lowercase.charCodeAt(18); \r\n    static t            = lowercase.charCodeAt(19); \r\n    static u            = lowercase.charCodeAt(20); \r\n    static v            = lowercase.charCodeAt(21); \r\n    static w            = lowercase.charCodeAt(22); \r\n    static x            = lowercase.charCodeAt(23); \r\n    static y            = lowercase.charCodeAt(24); \r\n    static z            = lowercase.charCodeAt(25); \r\n    \r\n    static A            = uppercase.charCodeAt(0); \r\n    static B            = uppercase.charCodeAt(1); \r\n    static C            = uppercase.charCodeAt(2); \r\n    static D            = uppercase.charCodeAt(3); \r\n    static E            = uppercase.charCodeAt(4); \r\n    static F            = uppercase.charCodeAt(5); \r\n    static G            = uppercase.charCodeAt(6); \r\n    static H            = uppercase.charCodeAt(7); \r\n    static I            = uppercase.charCodeAt(8); \r\n    static J            = uppercase.charCodeAt(9); \r\n    static K            = uppercase.charCodeAt(10); \r\n    static L            = uppercase.charCodeAt(11); \r\n    static M            = uppercase.charCodeAt(12); \r\n    static N            = uppercase.charCodeAt(13); \r\n    static O            = uppercase.charCodeAt(14); \r\n    static P            = uppercase.charCodeAt(15); \r\n    static Q            = uppercase.charCodeAt(16); \r\n    static R            = uppercase.charCodeAt(17); \r\n    static S            = uppercase.charCodeAt(18); \r\n    static T            = uppercase.charCodeAt(19); \r\n    static U            = uppercase.charCodeAt(20); \r\n    static V            = uppercase.charCodeAt(21); \r\n    static W            = uppercase.charCodeAt(22); \r\n    static X            = uppercase.charCodeAt(23); \r\n    static Y            = uppercase.charCodeAt(24); \r\n    static Z            = uppercase.charCodeAt(25); \r\n\r\n    static USPACE       = 0x3000;\r\n}","import {Token} from './token';\r\nimport {Char} from './char';\r\n\r\nexport type log = (log?: string) => boolean;\r\n\r\nexport class TokenStream {\r\n    private bracket: boolean;\r\n    private buffer: string;\r\n    private p: number;\r\n    private len: number;\r\n    private cur: number;                // 当前char code\r\n    \r\n    log: log;\r\n    dec: number;                // 数字值\r\n    isInteger: boolean;         // 表示解析出来的数字是整数\r\n    _var: string;\r\n    varBrace: boolean;                  // 带[]的字段名\r\n    lowerVar: string;\r\n    text: string; \r\n    token: Token;\r\n\r\n    LastP: number;                  // 上一个符号的开始位置\r\n    line: number;                // 当前行号\r\n    at: number;                 // 当前字符\r\n    prevLine: number;\r\n    prevAt: number;\r\n    startLine: number;\r\n    startAt: number;\r\n    PrevToken: Token;\r\n\r\n    file: string;\r\n\r\n    constructor(log:log, input: string, options?:{bracket:boolean})\r\n    {\r\n        if (options !== undefined) this.bracket = options.bracket;\r\n        this.log = log;\r\n        this.LastP = 1;\r\n        this.buffer = input;\r\n        this.len = input.length;\r\n        this.p = 0;\r\n        this.at = 0;\r\n        this.line = 0;\r\n        this.advance();\r\n    }\r\n\r\n    getSourceAt(pos:number):string {\r\n        return this.buffer.substring(pos, this.LastP-1);\r\n    }\r\n\r\n    getSourceNearby(sourceAt:number): string {\r\n        return ' ...' + this.buffer.substr(sourceAt, 50) + '... ';\r\n    }\r\n\r\n    private errorAt() {\r\n        let line = this.startLine+1;\r\n        let charAt = this.startAt + 1;\r\n        return this.file + ' 错误在'+line+'行'+charAt+'列: \\n' + this.getSourceNearby(this.p) + '\\n';\r\n    }\r\n\r\n    error(...msg:string[]) {\r\n        let err = this.errorAt()+msg.join('');\r\n        this.log(err);\r\n        throw err;\r\n    }\r\n\r\n    expectToken(...tokens:Token[]) {\r\n        let err = this.errorAt()+'应该是'+tokens.map(v => Token[v]).join('或');\r\n        this.log(err);\r\n        throw err;\r\n    }\r\n\r\n    expect(...msg:string[]) {\r\n        let err = this.errorAt() + '应该是'+msg.join('或');\r\n        this.log(err);\r\n        throw err;\r\n    }\r\n\r\n    assertToken(token: Token) {\r\n        if (this.token !== token) this.expectToken(token);\r\n    }\r\n\r\n    assertVar() {\r\n        if (this.token !== Token.VAR) this.expect('应该是变量名');\r\n    }\r\n\r\n    assertKey(key: string) {\r\n        if (this.lowerVar !== key || this.varBrace === true) this.expect(key);\r\n    }\r\n\r\n    private advance() {\r\n        this.cur = (this.p >= this.len) ? 0 : this.buffer.charCodeAt(this.p++);\r\n        if (this.cur === Char.ENTER)\r\n        {\r\n            this.line++;\r\n            this.at = 1;\r\n        }\r\n        else\r\n            this.at++;\r\n    }\r\n\r\n    isKeyword(key:string):boolean {\r\n        //if (this.token !== Token._VAR) return false;\r\n        //if (this.varBrace === true) return false;\r\n        return this.lowerVar === key && this.varBrace === false;\r\n    }\r\n\r\n    isKeywords(keys:string[]):boolean {\r\n        //if (this.token !== Token._VAR) return false;\r\n        //if (this.varBrace === true) return false;\r\n        if (this.varBrace === true) return false;\r\n        return keys.indexOf(this.lowerVar)>=0;\r\n    }\r\n\r\n    /*\r\n    // Mainly for xml parser using\r\n    ReadTo(to:number)\r\n    {\r\n        // There are 5 predefined entity references in XML:\r\n        // &lt; < less than \r\n        // &gt; > greater than \r\n        // &amp; & ampersand  \r\n        // &apos; ' apostrophe \r\n        // &quot; \" quotation mark \r\n\r\n        this.token = Token.LT;\r\n        if (this.cur == to)\r\n        {\r\n            this.text = null;\r\n            return;\r\n        }\r\n        let pos = this.p;\r\n        StringBuilder sb = new StringBuilder(32);\r\n        while (this.cur != to)\r\n        {\r\n            if (this.cur == '&')\r\n            {\r\n                int andPos = this.p;\r\n                this.Advance();\r\n                for (;;)\r\n                {\r\n                    if (this.cur == Char.NULL) this.ThrowException(\"& not end\");\r\n                    if (this.cur == ';')\r\n                    {\r\n                        if (this.AndCompare(andPos, \"lt\")) sb.Append('<');\r\n                        else if (this.AndCompare(andPos, \"gt\")) sb.Append('>');\r\n                        else if (this.AndCompare(andPos, \"amp\")) sb.Append('&');\r\n                        else if (this.AndCompare(andPos, \"apos\")) sb.Append('\\'');\r\n                        else if (this.AndCompare(andPos, \"quot\")) sb.Append('\"');\r\n                        else this.ThrowException(\"error &\");\r\n                        this.Advance();\r\n                        break;\r\n                    }\r\n                    this.Advance();\r\n                }\r\n            }\r\n            else if (this.cur == Char.NULL)\r\n            {\r\n                this.token = Token._FINISHED;\r\n                this.text = sb.ToString();\r\n                return;\r\n            }\r\n            else\r\n            {\r\n                sb.Append(this.cur);\r\n            }\r\n            this.Advance();\r\n        }\r\n        this.Advance();\r\n        this.text = sb.ToString();\r\n    }\r\n    AndCompare(andPos:number, andToken:string): boolean\r\n    {\r\n        let len = andToken.length;\r\n        return (string.Compare(this.buffer, andPos, andToken, 0, len, true) == 0 && this.p - andPos == len);\r\n    }\r\n    */\r\n    showToken() {\r\n        return Token[this.token];\r\n    }\r\n\r\n    PeekToken(): Token\r\n    {\r\n        let prevToken:Token = this.PrevToken;\r\n        let cur = this.cur;\r\n        let _var = this._var;\r\n        let lowerVar = this.lowerVar;\r\n        let lastP = this.LastP;\r\n        let lastLineNum = this.startLine;\r\n        let lastChatAt = this.startAt;\r\n        let token = this.token;\r\n        let p = this.p;\r\n        let lineNum = this.line;\r\n        let charAt = this.at;\r\n        this.readToken();\r\n        let ret = this.token;\r\n        this.PrevToken = prevToken;\r\n        this.LastP = lastP;\r\n        this.startLine = lastLineNum;\r\n        this.startAt = lastChatAt;\r\n        this.token = token;\r\n        this._var = _var;\r\n        this.lowerVar = lowerVar;\r\n        this.p = p;\r\n        this.line = lineNum;\r\n        this.at = charAt;\r\n        this.cur = cur;\r\n        return ret;\r\n    }\r\n\r\n    readToken()\r\n    {\r\n        this.PrevToken = this.token;\r\n        this.LastP = this.p;\r\n        this.prevLine = this.startLine;\r\n        this.prevAt = this.startAt;\r\n        this.startLine = this.line;\r\n        this.startAt = this.at;\r\n        //this.prevSpace = false;\r\n        this._var = undefined;\r\n        this.lowerVar = undefined;\r\n        for (; ; )\r\n        {\r\n            switch (this.cur)\r\n            {\r\n                case Char.NULL:\r\n                    this.token = Token._FINISHED;\r\n                    break;\r\n                case Char.TAB:\r\n                case Char.SPACE:\r\n                case Char.USPACE:       // 中文空格\r\n                case Char._R:\r\n                case Char.ENTER:\r\n                    this.advance();\r\n                    this.startLine = this.line;\r\n                    this.startAt = this.at;\r\n                    this.LastP = this.p;\r\n                    //this.prevSpace = true;\r\n                    continue;\r\n                case Char.PLUS: \r\n                    this.token = Token.ADD; this.advance(); \r\n                    if (this.cur === Char.EQU) {\r\n                        this.token = Token.ADDEQU;\r\n                        this.advance();\r\n                    }\r\n                    break;\r\n                case Char.MINUS:\r\n                    this.advance();\r\n                    switch (this.cur)\r\n                    {\r\n                        case Char.EQU:\r\n                            this.token = Token.SUBEQU;\r\n                            this.advance();\r\n                            break;\r\n                        case Char.MINUS: this.readLineRemark(); continue;\r\n                        default: this.token = Token.SUB; break;\r\n                    }\r\n                    break;\r\n                case Char.STAR: this.token = Token.MUL; this.advance(); break;\r\n                case Char.DOLLAR:\r\n                    //this.advance();\r\n                    this.readVar();\r\n                    if (this._var === '$')\r\n                        this.token = Token.DOLLAR;\r\n                    else\r\n                        this.token = Token.DOLLARVAR;\r\n                    break;\r\n                case Char.AT: this.token = Token.AT; this.advance(); break;\r\n                case Char.SLASH:\r\n                    this.advance();\r\n                    switch (this.cur)\r\n                    {\r\n                        case Char.SLASH: this.readLineRemark(); continue;\r\n                        case Char.STAR: this.readRemark(); continue;\r\n                        case Char.MINUS: this.readInlineCode(); break;\r\n                        default: this.token = Token.DIV; break;\r\n                    }\r\n                    break;\r\n                case Char.PERCENT: this.token = Token.MOD; this.advance(); break;\r\n                case Char.LParenthese: this.token = Token.LPARENTHESE; this.advance(); break;\r\n                case Char.RParenthese: this.token = Token.RPARENTHESE; this.advance(); break;\r\n                case Char.LBrace:\r\n                    this.advance();\r\n                    this.token = Token.LBRACE; break;\r\n                    //if (this.cur != Char.LBrace) { this.token = Token.LBRACE; break; }\r\n                    //this.advance(); this.ReadInline(); break;\r\n                case Char.RBrace: this.token = Token.RBRACE; this.advance(); break;\r\n                case Char.SHARP: this.token = Token.SHARP; this.advance(); break;\r\n                case Char.DOT: this.token = Token.DOT; this.advance(); break;\r\n                case Char.COMMA: this.token = Token.COMMA; this.advance(); break;\r\n                case Char.SEMICOLON: this.token = Token.SEMICOLON; this.advance(); break;\r\n                case Char.COLON: this.token = Token.COLON; this.advance(); break;\r\n                case Char.TOPANGLE: this.token = Token.XOR; this.advance(); break;\r\n                case Char.EQU:\r\n                    this.advance();\r\n                    switch (this.cur)\r\n                    {\r\n                        case Char.GT: this.token = Token.GE; this.advance(); break;\r\n                        case Char.LS: this.token = Token.LE; this.advance(); break;\r\n                        default: this.token = Token.EQU; break;\r\n                    }\r\n                    break;\r\n                case Char.GT:\r\n                    this.advance();\r\n                    switch (this.cur)\r\n                    {\r\n                        case Char.EQU: this.token = Token.GE; this.advance(); break;\r\n                        case Char.LS: this.token = Token.NE; this.advance(); break;\r\n                        default: this.token = Token.GT; break;\r\n                    }\r\n                    break;\r\n                case Char.LS:\r\n                    this.advance();\r\n                    switch (this.cur)\r\n                    {\r\n                        case Char.EQU: this.token = Token.LE; this.advance(); break;\r\n                        case Char.GT: this.token = Token.NE; this.advance(); break;\r\n                        default: this.token = Token.LT; break;\r\n                    }\r\n                    break;\r\n                case Char.AND:\r\n                    this.advance();\r\n                    this.token = Token.BITWISEAND;\r\n                    break;\r\n                case Char.OR:\r\n                    this.advance();\r\n                    this.token = Token.BITWISEOR;\r\n                    break;\r\n                case Char.LBracket:\r\n                    if (this.bracket === true) {\r\n                        this.token = Token.LBRACKET; this.advance(); break;\r\n                    }\r\n                    this.readSquareVar();\r\n                    break;\r\n                case Char.RBracket:\r\n                    if (this.bracket === true) {\r\n                        this.token = Token.RBRACKET; this.advance(); break;\r\n                    }\r\n                    this.error(\"unexpected ]\");\r\n                    break;\r\n                case Char.Apostrophe:   // '\r\n                    this.readString(Char.Apostrophe); // 字符串\r\n                    break;\r\n                case Char.QUOT:         // \"\r\n                    this.readString(Char.QUOT); // 字符串\r\n                    break;\r\n                case Char.UNDERLINE:    // _\r\n                    this.readVar();\r\n                    //this.FindToken(toFindKeyToken);\r\n                    break;\r\n                default:\r\n                    if (this.cur >= Char.ZERO && this.cur <= Char.NINE) \r\n                        this.readNumber(this.cur - Char.ZERO);\r\n                    else if ((this.cur>=Char.a && this.cur<=Char.z) ||\r\n                        (this.cur>=Char.A && this.cur<=Char.Z) ||\r\n                        this.cur>=0x100)\r\n                        this.readVar();\r\n                    else                        \r\n                        this.error(\"PARSE_UnexpectChar\");\r\n                    break;\r\n            }\r\n            return;\r\n        }\r\n    }\r\n\r\n    private readLineRemark()\r\n    {\r\n        while (true)\r\n        {\r\n            this.advance();\r\n            switch (this.cur)\r\n            {\r\n                case Char._R:\r\n                case Char.ENTER:\r\n                case Char.NULL: return;\r\n            }\r\n        }\r\n    }\r\n\r\n    private readInlineCode() {\r\n        this.token = Token.CODE;\r\n        let start = this.p;\r\n        while (true) {\r\n            this.advance();\r\n            if (this.cur === Char.NULL) break;\r\n            if (this.cur === Char.MINUS) {\r\n                this.advance();\r\n                if (this.cur === Char.SLASH) {\r\n                    this.advance();\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n        this.text = this.buffer.substring(start, this.p - 3);\r\n    }\r\n\r\n    private readRemark()\r\n    {\r\n        this.advance();\r\n        while (true)\r\n        {\r\n            if (this.cur === Char.NULL) break;\r\n            if (this.cur === Char.STAR)\r\n            {\r\n                this.advance();\r\n                if (this.cur === Char.SLASH)\r\n                {\r\n                    this.advance();\r\n                    break;\r\n                }\r\n            }\r\n            else {\r\n                this.advance();\r\n            }\r\n        }\r\n    }\r\n\r\n    private readSquareVar()\r\n    {\r\n        let start = this.p;\r\n        for (; ; )\r\n        {\r\n            this.advance();\r\n            switch (this.cur)\r\n            {\r\n                case Char.NULL:\r\n                case Char._R:\r\n                case Char.ENTER:\r\n                    this.error(\"PARSE_UnexpectEndVar\");\r\n                    return;\r\n                case Char.RBracket:\r\n                    this.token = Token.VAR;\r\n                    this.varBrace = true;\r\n                    this._var = this.buffer.substring(start, this.p - 1);\r\n                    this.lowerVar = this._var.toLowerCase();\r\n                    this.advance();\r\n                    return;\r\n            }\r\n        }\r\n    }\r\n\r\n    private readNumber(firstDigit:number)\r\n    {\r\n        this.dec = firstDigit;\r\n        this.isInteger = true;\r\n        this.advance();\r\n        if (firstDigit === 0 && ( this.cur === Char.x || this.cur === Char.X))\r\n        {\r\n            this.token = Token.HEX;\r\n            this.advance();\r\n            this.text = '';\r\n            for (; ; )\r\n            {\r\n                if ((this.cur >= Char.ZERO && this.cur <= Char.NINE) ||\r\n                    (this.cur >= Char.a && this.cur <= Char.f) ||\r\n                    (this.cur >= Char.A && this.cur <= Char.F))\r\n                    this.text += String.fromCharCode(this.cur);\r\n                else break;\r\n                this.advance();\r\n            }\r\n            return;\r\n        }\r\n        this.token = Token.NUM;\r\n        for (; ; )\r\n        {\r\n            if (this.cur >= Char.ZERO && this.cur <= Char.NINE)\r\n            {\r\n                this.dec = this.dec * 10 + (this.cur - Char.ZERO);\r\n            }\r\n            else if (this.cur === Char.DOT)\r\n            {\r\n                this.isInteger = false;\r\n                let rate = 0.1;\r\n                for (; ; )\r\n                {\r\n                    this.advance();\r\n                    if (this.cur >= Char.ZERO && this.cur <= Char.NINE)\r\n                    {\r\n                        this.dec = this.dec + (this.cur - Char.ZERO) * rate;\r\n                        rate /= 10;\r\n                    }\r\n                    else return;\r\n                }\r\n            }\r\n            else break;\r\n            this.advance();\r\n        }\r\n    }\r\n\r\n    private readString(quote:number)\r\n    {\r\n        this.token = Token.STRING;\r\n        let start = this.p;\r\n        //StringBuilder sb = new StringBuilder(100);\r\n        this.advance();\r\n        while (true)\r\n        {\r\n            if (this.cur === Char.NULL) return;\r\n            if (this.cur === quote)\r\n            {\r\n                this.text = this.buffer.substring(start, this.p-1);\r\n                this.advance();\r\n                return;\r\n            }\r\n            if (this.cur === Char.BACKSLASH)\r\n            {\r\n                this.advance();\r\n                if (this.cur === quote) { this.advance(); break; }\r\n                /*\r\n                switch (this.cur)\r\n                {\r\n                    case Char.BACKSLASH: sb.Append(Char.BACKSLASH); this.Advance(); break;\r\n                    case Char.T: sb.Append(Char.TAB); this.Advance(); break;\r\n                    case Char.R: sb.Append(Char._R); this.Advance(); break;\r\n                    case Char.N: sb.Append(Char.ENTER); this.Advance(); break;\r\n                    default: this.ThrowException(\"PARSE_UnknownEscape\"); break;\r\n                }*/\r\n                continue;\r\n            }\r\n            this.advance();\r\n        }\r\n    }\r\n\r\n    private readVar()\r\n    {\r\n        let start = this.p - 1;\r\n        let loop = true;\r\n        while (loop)\r\n        {\r\n            this.advance();\r\n            if (this.cur === Char.NULL)\r\n            {\r\n                this._var = this.buffer.substring(start, this.p-1);\r\n                this.lowerVar = this._var.toLowerCase();\r\n                this.varBrace = false;\r\n                return;\r\n            }\r\n            switch (this.cur)\r\n            {\r\n                case Char.UNDERLINE:\r\n                    break;\r\n                default:\r\n                    if ((this.cur>=Char.ZERO && this.cur<=Char.NINE) ||\r\n                        (this.cur>=Char.a && this.cur<=Char.z) ||\r\n                        (this.cur>=Char.A && this.cur<=Char.Z) ||\r\n                        this.cur>=0x100)\r\n                        continue;\r\n                    loop = false;\r\n                    break;\r\n            }\r\n        }\r\n        this.token = Token.VAR;\r\n        this._var = this.buffer.substring(start, this.p-1);\r\n        this.lowerVar = this._var.toLowerCase();\r\n        this.varBrace = false;\r\n    }\r\n}\r\n","export interface Stack {\r\n    or():void;\r\n    and():void;\r\n    not():void;\r\n    le():void;\r\n    lt():void;\r\n    eq():void;\r\n    ne():void;\r\n    gt():void;\r\n    ge():void;\r\n    neg():void;\r\n    add():void;\r\n    sub():void;\r\n    mul():void;\r\n    div():void;\r\n    mod():void;\r\n    bitAnd():void;\r\n    bitOr():void;\r\n    str(val:string):void;\r\n    num(val:number):void;\r\n    star():void;\r\n    hex(val:string):void;\r\n    datePart(part:string):void;\r\n    isNull():void;\r\n    isNotNull():void;\r\n    exists():void;\r\n    in(params:number):void;\r\n    like():void;\r\n    searchCase(whenCount:number, hasElse:boolean):void;\r\n    simpleCase(whenCount:number, hasElse:boolean):void;\r\n    func(func:string, n:number):void;\r\n\r\n    var(name:string):void;\r\n    field(name:string, tbl?:string):void;\r\n    dollarVar(name:string):void;\r\n}\r\n\r\nexport class RunStack implements Stack {\r\n    private stack:string[] = [];\r\n    private queue:string[] = [];\r\n\r\n    getResult():string {return this.stack[0]}\r\n\r\n    or():void {}\r\n    and():void {}\r\n    not():void {}\r\n    le():void {}\r\n    lt():void {}\r\n    eq():void {}\r\n    ne():void {}\r\n    gt():void {}\r\n    ge():void {}\r\n    neg():void {}\r\n    add():void {}\r\n    sub():void {}\r\n    mul():void {}\r\n    div():void {}\r\n    mod():void {}\r\n    bitAnd():void {}\r\n    bitOr():void {}\r\n    str(val:string):void {}\r\n    num(val:number):void {this.stack.push('#'+val);}\r\n    star():void {}\r\n    hex(val:string):void {}\r\n    datePart(part:string):void {}\r\n    isNull():void {}\r\n    isNotNull():void {}\r\n    exists():void {}\r\n    in(params:number):void {}\r\n    like():void {}\r\n    searchCase(whenCount:number, hasElse:boolean):void {}\r\n    simpleCase(whenCount:number, hasElse:boolean):void {}\r\n    func(func:string, n:number):void {}\r\n\r\n    var(name:string):void {}\r\n    field(name:string, tbl?:string):void {}\r\n    dollarVar(name:string):void {}\r\n}\r\n\r\nexport abstract class Atom {\r\n    abstract to(stack: Stack):void;\r\n    abstract str():string;\r\n}\r\n\r\nexport class OpOr extends Atom {\r\n    to(stack: Stack) {stack.or();}\r\n    str():string {return '||'}\r\n}\r\nexport class OpAnd extends Atom {\r\n    to(stack: Stack) {stack.and();}\r\n    str():string {return '&&'}\r\n}\r\nexport class OpNot extends Atom {\r\n    to(stack: Stack) {stack.not();}\r\n    str():string {return '!'}\r\n}\r\nexport class OpLE extends Atom {\r\n    to(stack: Stack) {stack.le();}\r\n    str():string {return '<='}\r\n}\r\nexport class OpLT extends Atom {\r\n    to(stack: Stack) {stack.lt();}\r\n    str():string {return '<'}\r\n}\r\nexport class OpEQ extends Atom {\r\n    to(stack: Stack) {stack.eq();}\r\n    str():string {return '='}\r\n}\r\nexport class OpNE extends Atom {\r\n    to(stack: Stack) {stack.ne();}\r\n    str():string {return '<>'}\r\n}\r\nexport class OpGT extends Atom {\r\n    to(stack: Stack) {stack.gt();}\r\n    str():string {return '>'}\r\n}\r\nexport class OpGE extends Atom {\r\n    to(stack: Stack) {stack.ge();}\r\n    str():string {return '>='}\r\n}\r\nexport class OpAdd extends Atom {\r\n    to(stack: Stack) {stack.add();}\r\n    str():string {return '+'}\r\n}\r\nexport class OpSub extends Atom {\r\n    to(stack: Stack) {stack.sub();}\r\n    str():string {return '-'}\r\n}\r\nexport class OpMul extends Atom {\r\n    to(stack: Stack) {stack.mul();}\r\n    str():string {return '*'}\r\n}\r\nexport class OpDiv extends Atom {\r\n    to(stack: Stack) {stack.div();}\r\n    str():string {return '/'}\r\n}\r\nexport class OpMod extends Atom {\r\n    to(stack: Stack) {stack.mod();}\r\n    str():string {return '%'}\r\n}\r\nexport class OpBitwiseAnd extends Atom {\r\n    to(stack: Stack) {stack.bitAnd();}\r\n    str():string {return '&'}\r\n}\r\nexport class OpBitwiseOr extends Atom {\r\n    to(stack: Stack) {stack.bitOr();}\r\n    str():string {return '|'}\r\n}\r\nexport class OpNeg extends Atom {\r\n    to(stack: Stack) {stack.neg();}\r\n    str():string {return '-'}\r\n}\r\nexport class OpBrace extends Atom {\r\n    to(stack: Stack) {}\r\n    str():string {return '()'}\r\n}\r\nexport class TextOperand extends Atom {\r\n    text:string;\r\n    constructor(text:string) {\r\n        super();\r\n        this.text = text;\r\n    }\r\n    to(stack: Stack) {stack.str(this.text);}\r\n    str():string {return '\\'' + this.text + '\\''}\r\n}\r\nexport class NumberOperand extends Atom {\r\n    num:number;\r\n    constructor(num:number) {\r\n        super();\r\n        this.num = num;\r\n    }\r\n    to(stack: Stack) {stack.num(this.num);}\r\n    str():string {return String(this.num)}\r\n}\r\nexport class HexOperand extends Atom {\r\n    text:string;\r\n    constructor(text:string) {\r\n        super();\r\n        this.text = text;\r\n    }\r\n    to(stack: Stack) {stack.hex(this.text);}\r\n    str():string {return '#h'}\r\n}\r\nexport class NullOperand extends Atom {\r\n    to(stack: Stack) { stack.hex('null'); }\r\n    str():string {return 'null'}\r\n}\r\nexport class VarOperand extends Atom {\r\n    get type():string {return 'var';}\r\n    dotFirst: boolean = false;\r\n    _var: string[] = [];\r\n    to(stack: Stack) {}\r\n    str():string {return this._var.join('.')}\r\n}\r\nexport class OpSearchCase extends Atom {\r\n    whenCount: number;\r\n    hasElse: boolean;\r\n    constructor(whenCount: number, hasElse: boolean) {\r\n        super();\r\n        this.whenCount = whenCount;\r\n        this.hasElse = hasElse;\r\n    }\r\n    to(stack: Stack) { stack.searchCase(this.whenCount, this.hasElse); }\r\n    str():string {return 'case'}\r\n}\r\nexport class OpSimpleCase extends Atom {\r\n    whenCount: number;\r\n    hasElse: boolean;\r\n    constructor(whenCount: number, hasElse: boolean) {\r\n        super();\r\n        this.whenCount = whenCount;\r\n        this.hasElse = hasElse;\r\n    }\r\n    to(stack: Stack) { stack.simpleCase(this.whenCount, this.hasElse); }\r\n    str():string {return 'case'}\r\n}\r\nexport class OpFunction extends Atom {\r\n    func: string;\r\n    paramCount: number;\r\n    constructor(func: string, paramCount: number) {\r\n        super();\r\n        this.func = func;\r\n        this.paramCount = paramCount;\r\n    }\r\n    to(stack: Stack) {stack.func(this.func, this.paramCount)}\r\n    str():string {return this.func}\r\n}\r\nexport class StarOperand extends Atom {\r\n    to(stack: Stack) {stack.star();}\r\n    str():string {return '*'}\r\n}\r\nexport class DatePartOperand extends Atom {\r\n    datePart: string;\r\n    constructor(datePart: string) {\r\n        super();\r\n        this.datePart = datePart;\r\n    }\r\n    to(stack: Stack) {stack.datePart(this.datePart)}\r\n    str():string {return this.datePart}\r\n}\r\nexport class ExistsSubOperand extends Atom {\r\n    to(stack: Stack) {stack.exists();}\r\n    str():string {return 'exists'}\r\n}\r\nexport class OpIsNull extends Atom {\r\n    to(stack: Stack) {stack.isNull()}\r\n    str():string {return 'is null'}\r\n}\r\nexport class OpIsNotNull extends Atom {\r\n    to(stack: Stack) {stack.isNotNull()}\r\n    str():string {return 'is not null'}\r\n}\r\nexport class OpIn extends Atom {\r\n    private params:number;\r\n    constructor(params:number) {\r\n        super();\r\n        this.params = params;\r\n    }\r\n    to(stack: Stack) {stack.in(this.params)}\r\n    str():string {return 'in'}\r\n}\r\nexport class OpLike extends Atom {\r\n    to(stack: Stack) {stack.like()}\r\n    str():string {return 'like'}\r\n}\r\nexport class OpBetween extends Atom {\r\n    to(stack: Stack) {}\r\n    str():string {return 'between'}\r\n}\r\nexport class OpNotBetween extends Atom {\r\n    to(stack: Stack) {}\r\n    str():string {return 'not between'}\r\n}\r\nconst dollarVars = ['unit', 'user', \r\n    'pagestart', 'pagesize',\r\n    'date', 'id', 'state', 'row', 'sheet_date', 'sheet_no', 'sheet_discription'];\r\nexport class OpDollarVar extends Atom {\r\n    static isValid(name:string):boolean { return dollarVars.find(v=>v===name) !== undefined }\r\n    _var: string;\r\n    constructor(_var:string) {super(); this._var = _var;}\r\n    to(stack: Stack) {stack.dollarVar(this._var)}\r\n    str():string {return '$' + this._var}\r\n}\r\n","import { Token } from \"./token\";\r\nimport { TokenStream } from './tokenStream';\r\nimport { Atom, \r\n    OpAdd, OpSub, OpBitwiseOr, OpAnd, OpBitwiseAnd, \r\n    OpBrace, OpDiv, OpDollarVar, OpEQ, OpFunction, OpGE, OpGT, \r\n    OpLE, OpLT, OpMod, OpMul, OpNE, OpNeg, OpNot, OpOr,\r\n    TextOperand, NumberOperand, HexOperand, VarOperand\r\n} from './atom';\r\n\r\nexport abstract class Expression\r\n{\r\n    protected ts: TokenStream;\r\n    protected at: number;\r\n    protected line: number;\r\n    protected sourceStart: number;\r\n    private atoms: Atom[] = [];\r\n\r\n    constructor(ts: TokenStream) {\r\n        this.ts = ts;\r\n    }\r\n    run():string {\r\n        let result:string = '';\r\n        for (let atom of this.atoms) {\r\n            result += atom.str() + ' ';\r\n        }\r\n        return result;\r\n    }\r\n\r\n    protected savePos() {\r\n        this.at = this.ts.prevAt;\r\n        this.line = this.ts.prevLine;\r\n        this.sourceStart = this.ts.LastP - 1;\r\n    }\r\n\r\n    protected getSource() {\r\n        return this.ts.getSourceAt(this.sourceStart);\r\n    }\r\n\r\n    private errorAt() {\r\n        let line = this.ts.startLine+1;\r\n        let at = this.ts.startAt + 1;\r\n        return this.ts.file + ' 错误在'+line+'行'+at+'列: \\n' + this.ts.getSourceNearby(this.sourceStart) + '\\n';\r\n    }\r\n\r\n    log(...msg:string[]) {\r\n        let err:string;\r\n        if (this.line === undefined)\r\n            err = msg.join('');\r\n        else {\r\n            let line = this.line + 1;\r\n            let at = this.at + 1;\r\n            err = this.ts.file + ' 错误在'+line+'行'+at+'列: \\n'\r\n                + this.ts.getSourceNearby(this.sourceStart) + '\\n'\r\n                + msg.join('\\n');\r\n        }\r\n        this.ts.log(err);\r\n    }\r\n\r\n    msg(...msg:string[]) {\r\n        let err:string;\r\n        if (this.line === undefined)\r\n            err = msg.join('');\r\n        else {\r\n            let line = this.line + 1;\r\n            let at = this.at + 1;\r\n            err = this.ts.file + ' 提醒在'+line+'行'+at+'列: '+msg.join('');\r\n        }\r\n        this.ts.log(err);\r\n    }\r\n\r\n    error(...msg:string[]) {\r\n        let err = this.errorAt()+msg.join('');\r\n        this.ts.log(err);\r\n        throw err;\r\n    }\r\n\r\n    expectToken(...tokens:Token[]) {\r\n        let err = this.errorAt()+'应该是'+tokens.map(v => Token[v]).join('或');\r\n        this.ts.log(err);\r\n        throw err;\r\n    }\r\n\r\n    expect(...msg:string[]) {\r\n        let err = this.errorAt() + '应该是'+msg.join('或');\r\n        this.ts.log(err);\r\n        throw err;\r\n    }\r\n\r\n    private add(atom: Atom) {\r\n        this.atoms.push(atom);\r\n    }\r\n\r\n    protected abstract entry():void;\r\n\r\n    parse() {\r\n        this._parse();\r\n    }\r\n\r\n    protected _parse() {\r\n        this.entry();\r\n    }\r\n\r\n    protected expCompare()\r\n    {\r\n        this.B();\r\n        for (; ; )\r\n        {\r\n            if (this.ts.token === Token.OR || this.ts.isKeyword('or') === true) {\r\n                this.ts.readToken();\r\n                this.B();\r\n                this.add(new OpOr());\r\n            }\r\n            else break;\r\n        }\r\n    }\r\n\r\n    private B()\r\n    {\r\n        this.C();\r\n        for (; ; )\r\n        {\r\n            if (this.ts.token === Token.AND || this.ts.isKeyword('and') === true) {\r\n                this.ts.readToken();\r\n                this.C();\r\n                this.add(new OpAnd());\r\n            }\r\n            else break;\r\n        }\r\n    }\r\n\r\n    private C()\r\n    {\r\n        if (this.ts.token === Token.NOT ||\r\n            this.ts.isKeyword('not'))\r\n        {\r\n            this.ts.readToken();\r\n            this.C();\r\n            this.add(new OpNot());\r\n            return;\r\n        }\r\n        this.expValue();\r\n        switch (this.ts.token)\r\n        {\r\n            default:\r\n                break;\r\n            case Token.LE:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpLE());\r\n                break;\r\n            case Token.LT:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpLT());\r\n                break;\r\n            case Token.EQU:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpEQ());\r\n                break;\r\n            case Token.NE:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpNE());\r\n                break;\r\n            case Token.GT:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpGT());\r\n                break;\r\n            case Token.GE:\r\n                this.ts.readToken();\r\n                this.expValue();\r\n                this.add(new OpGE());\r\n                break;\r\n        }\r\n    }\r\n\r\n    protected expValue()\r\n    {\r\n        this.t();\r\n        for (; ; )\r\n        {\r\n            switch (this.ts.token)\r\n            {\r\n                default:\r\n                    return;\r\n                case Token.ADD:\r\n                    this.ts.readToken();\r\n                    this.t();\r\n                    this.add(new OpAdd());\r\n                    break;\r\n                case Token.SUB:\r\n                    this.ts.readToken();\r\n                    this.t();\r\n                    this.add(new OpSub());\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private t()\r\n    {\r\n        this.bitWise();\r\n        for (; ; )\r\n        {\r\n            switch (this.ts.token)\r\n            {\r\n                default:\r\n                    return;\r\n                case Token.MUL:\r\n                    this.ts.readToken();\r\n                    this.bitWise();\r\n                    this.add(new OpMul());\r\n                    break;\r\n                case Token.DIV:\r\n                    this.ts.readToken();\r\n                    this.bitWise();\r\n                    this.add(new OpDiv());\r\n                    break;\r\n                case Token.MOD:\r\n                    this.ts.readToken();\r\n                    this.bitWise();\r\n                    this.add(new OpMod());\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private bitWise()\r\n    {\r\n        this.f();\r\n        for (; ; )\r\n        {\r\n            switch (this.ts.token)\r\n            {\r\n                default: return;\r\n                case Token.BITWISEAND:\r\n                    this.ts.readToken();\r\n                    this.f();\r\n                    this.add(new OpBitwiseAnd());\r\n                    break;\r\n                case Token.BITWISEOR:\r\n                    this.ts.readToken();\r\n                    this.f();\r\n                    this.add(new OpBitwiseOr());\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n\r\n    private f()\r\n    {\r\n        let lowerVar:string;\r\n        switch (this.ts.token) {\r\n            case Token.SUB:\r\n                this.ts.readToken();\r\n                this.f();\r\n                this.add(new OpNeg());\r\n                return;\r\n            case Token.LPARENTHESE:\r\n                this.ts.readToken();\r\n                this.entry();\r\n                if (this.ts.token === Token.RPARENTHESE as any)\r\n                {\r\n                    let op = new OpBrace();\r\n                    this.add(op);\r\n                    this.ts.readToken();\r\n                    return;\r\n                }\r\n                this.expectToken(Token.RPARENTHESE);\r\n                return;\r\n            case Token.STRING:\r\n                this.add(new TextOperand(this.ts.text));\r\n                this.ts.readToken();\r\n                return;\r\n            case Token.NUM:\r\n                this.add(new NumberOperand(this.ts.dec));\r\n                this.ts.readToken();\r\n                return;\r\n            case Token.HEX:\r\n                this.add(new HexOperand(this.ts.text));\r\n                this.ts.readToken();\r\n                return;\r\n            case Token.DOLLARVAR:\r\n                //this.ts.readToken();\r\n                //if (this.ts.token !== Token.VAR as any) this.expect('变量名');\r\n                lowerVar = this.ts.lowerVar.substr(1);\r\n                if (OpDollarVar.isValid(lowerVar) === false) {\r\n                    this.error(lowerVar + '不是系统变量');\r\n                }\r\n                this.add(new OpDollarVar(lowerVar));\r\n                this.ts.readToken();\r\n                return;\r\n            case Token.VAR:\r\n                lowerVar = this.ts.lowerVar;\r\n                this.ts.readToken();\r\n                switch (this.ts.token as any) {\r\n                    default:\r\n                        let op = new VarOperand();\r\n                        op._var.push(lowerVar);\r\n                        this.add(op);\r\n                        return;\r\n                    case Token.LPARENTHESE:\r\n                        this.func(lowerVar);\r\n                        return;\r\n                }\r\n            default:\r\n                this.error('语法错误', this.ts._var);\r\n                return;\r\n        }\r\n    }\r\n\r\n    static funcs:{[name:string]:number|number[]} = {\r\n        concat: -1,\r\n        concat_ws: -1,\r\n        now: 0,\r\n        substr: [2,3],\r\n        unix_timestamp: [0,1],\r\n    };\r\n    private func(func:string) {\r\n        this.ts.readToken();\r\n        if (this.predefinedFunc(func) === true) return;\r\n        \r\n        let v = Expression.funcs[func];\r\n        if (v === undefined) {\r\n            this.error('未知的函数 ' + func);\r\n        }\r\n        let paramCount = this.readFuncParameters();\r\n        this.add(new OpFunction(func, paramCount));\r\n        if (Array.isArray(v)) {\r\n            let min = v[0], max = v[1];\r\n            if (paramCount < min) {\r\n                this.error('函数 ' + func + ' 至少 ' + min + '个参数');\r\n            }\r\n            else if (paramCount > max) {\r\n                this.error('函数 ' + func + ' 最多 ' + max + '个参数');\r\n            }\r\n        }\r\n        else if (v >= 0 && v !== paramCount) {\r\n            this.error('函数 ' + func + ' 只能是 ' + v + '个参数');\r\n        }\r\n    }\r\n    private predefinedFunc(func:string):boolean\r\n    {\r\n        //let paramCount = 0;\r\n        switch (func)\r\n        {\r\n            default:\r\n                return false;\r\n            case 'year':\r\n            case 'month':\r\n            case 'day':\r\n            case 'len':\r\n            case 'ltrim':\r\n            case 'rtrim':\r\n            case 'from_unixtime':\r\n                this.ReadFixCountFunc(func, 1);\r\n                break;\r\n            case 'rand':\r\n                this.ReadFixCountFunc(func, 0);\r\n                break;\r\n            case 'left':\r\n            case 'right':\r\n            case 'ifnull':\r\n            case 'round':\r\n                this.ReadFixCountFunc(func, 2);\r\n                break;\r\n            case 'replace':\r\n            case 'substring':\r\n                this.ReadFixCountFunc(func, 3);\r\n                break;\r\n            case 'charindex':\r\n                this.ReadVariableParameters(func, 2, 3);\r\n                break;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    ReadFixCountFunc(func:string, count:number)\r\n    {\r\n        let paramCount = this.readFuncParameters();\r\n        if (count !== paramCount) this.error('函数'+func+'需要'+count+'个参数');\r\n        this.add(new OpFunction(func, count));\r\n    }\r\n\r\n    ReadVariableParameters(func:string, min:number, max:number)\r\n    {\r\n        let paramCount = this.readFuncParameters();\r\n        if (paramCount < min) this.error('函数'+func+'至少需要'+min+'个参数');\r\n        if (paramCount > max) this.error('函数'+func+'最多需要'+max+'个参数');\r\n        this.add(new OpFunction(func, paramCount));\r\n    }\r\n\r\n    private readFuncParameters():number\r\n    {\r\n        if (this.ts.token === Token.RPARENTHESE)\r\n        {\r\n            this.ts.readToken();\r\n            return 0;\r\n        }\r\n        let n = 0;\r\n        for (; ; )\r\n        {\r\n            this.expValue();\r\n            n++;\r\n            if (this.ts.token === Token.COMMA)\r\n            {\r\n                this.ts.readToken();\r\n                continue;\r\n            }\r\n            if (this.ts.token as any === Token.RPARENTHESE)\r\n            {\r\n                this.ts.readToken();\r\n                break;\r\n            }\r\n            this.expectToken(Token.COMMA, Token.RPARENTHESE);\r\n        }\r\n        return n;\r\n    }\r\n\r\n    static OperationExpression()\r\n    {\r\n        // Array.Sort<string>(DATEPARTS, StringComparer.CurrentCultureIgnoreCase);\r\n    }\r\n}\r\n\r\nexport class ValueExpression extends Expression {\r\n    entry() {\r\n        this.expValue();\r\n    }\r\n}\r\n\r\nexport class CompareExpression extends Expression {\r\n    entry() {\r\n        this.expCompare();\r\n    }\r\n}\r\n","import { TokenStream } from \"./tokenStream\";\r\nimport { ValueExpression } from \"./expression\";\r\n\r\nexport function test():string {\r\n    try {\r\n        let log = (text?:string) => {\r\n            return false;\r\n        };\r\n        let ts = new TokenStream(log, 'a + 2 * [b] * 3');\r\n        ts.readToken();\r\n        let exp = new ValueExpression(ts);\r\n        exp.parse();\r\n        return exp.run();\r\n    }\r\n    catch (err) {\r\n        return 'error: ' + err;\r\n    }\r\n}\r\n","import { CUqBase } from \"../tapp\";\r\nimport { VMain } from \"./VMain\";\r\nimport { VTest } from \"./VTest\";\r\nimport { test } from \"parser/test\";\r\n\r\nexport class CHome extends CUqBase {\r\n    protected async internalStart() {\r\n\t\t// eslint-disable-next-line\r\n\t\tlet values1 = this.uqs.performance.test1.values;\r\n\t\t// eslint-disable-next-line\r\n\t\tlet values2 = this.uqs.performance.test2.values;\r\n\t}\r\n\t\r\n\tget tagTest1() {\r\n\t\treturn this.uqs.performance.test1;\r\n\t}\r\n\r\n\tget tagTest2() {\r\n\t\treturn this.uqs.performance.test2;\r\n\t}\r\n\r\n    tab = () => this.renderView(VMain);\r\n\r\n    test = () => {\r\n        this.openVPage(VTest);\r\n    }\r\n\r\n    testParser = () => {\r\n        alert(test());\r\n    }\r\n\r\n    actionTestExpression = async () => {\r\n        let rev = test();\r\n\r\n        let data = {\r\n            name: 'subject3',\r\n            a: rev,\r\n        };\r\n        await this.uqs.performance.TestExpression.submitConvert(data);\r\n    }\r\n}\r\n","import * as React from 'react';\r\nimport { FA } from 'tonva';\r\n\r\nexport enum stateDefs {\r\n\tstart = 0,\r\n\ttodo = 10,\r\n\tdoing = 20,\r\n\tdone = 30,\r\n\tverified = 40,\r\n\tcanceled = 50,\r\n};\r\n\r\nconst stateNames:{[state:number]:string} = {\r\n\t\"0\": \"发布\",\r\n\t\"10\": \"待办\",\r\n\t\"20\": \"在办\",\r\n\t\"30\": \"已办\",\r\n\t\"40\": \"完成\",\r\n\t\"50\": \"取消\",\r\n};\r\n\r\nconst stateIcons:{[state:number]:JSX.Element} = {\r\n\t\"0\": <FA name=\"bullhorn\" />,\r\n\t\"10\": <FA name=\"ellipsis-h\" />,\r\n\t\"20\": <FA name=\"circle-o-notch\" className=\"text-primary\" />,\r\n\t\"30\": <FA name=\"flag\" className=\"text-success\" />,\r\n\t\"40\": <FA name=\"check-circle-o\" className=\"text-waning\" />,\r\n\t\"50\": <FA name=\"times\" className=\"text-danger\" />,\r\n};\r\n\r\nexport function stateName(state: number):string {\r\n\tif (!state) state = 0;\r\n\treturn stateNames[state];\r\n}\r\n\r\nexport function stateIcon(state: number):JSX.Element {\r\n\tif (!state) state = 0;\r\n\treturn stateIcons[state];\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, FA, LMR, Page, Form, ItemSchema, Context, List, tv, EasyTime, UiSchema, UiTextItem } from 'tonva';\r\nimport { CGroup } from './CGroup';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VMain extends VPage<CGroup> {\r\n    async open(param?: any) {\r\n\t}\r\n\r\n\tprivate renderGroup = (item: any, index: number):JSX.Element => {\r\n\t\tlet {group, time, unread} = item;\r\n\t\treturn <div className=\"px-3 py-2\">{tv(group, v => {\r\n\t\t\tlet {name, count} = v;\r\n\t\t\t// <FA className=\"\" name=\"building-o\" />\r\n\t\t\t// {count && <Muted>({count}成员)</Muted>}\r\n\t\t\tlet vCount:any, bg:string;\r\n\t\t\tif (count < 10) {\r\n\t\t\t\tvCount = <b style={{fontSize:'1.5rem'}} >{count}</b>;\r\n\t\t\t\tbg = 'bg-warning';\r\n\t\t\t}\r\n\t\t\telse if (count < 100) {\r\n\t\t\t\tvCount = <span style={{fontSize:'1.2rem'}} >{count}</span>;\r\n\t\t\t\tbg = 'bg-success';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tvCount = <span className=\"position-relative\" style={{fontSize:'1.2rem'}}>99<small className=\"position-absolute\" style={{bottom:'-0.1rem', right:'-0.55rem'}}>+</small></span>;\r\n\t\t\t\tbg = 'bg-primary';\r\n\t\t\t}\r\n\t\t\tlet left = <div className={'red-dot num mr-3 d-flex w-2-5c h-2-5c rounded align-items-center justify-content-center position-relative text-white ' + bg}>\r\n\t\t\t\t{vCount}\r\n\t\t\t\t{unread>0 && \r\n\t\t\t\t<u className=\"\">{unread >= 100? <>99<small>+</small></>:unread}</u>}\r\n\t\t\t</div>;\r\n\t\t\tlet right = <small className=\"text-muted\"><EasyTime date={time} /></small>;\r\n\t\t\treturn <LMR className=\"w-100 align-items-center\" left={left} right={right}>\r\n\t\t\t\t{name}\r\n\t\t\t</LMR>;\r\n\t\t})}</div>;\r\n\t}\r\n\r\n\tprivate onClickGroup = (item: any) => {\r\n\t\tthis.controller.showGroup(item);\r\n\t}\r\n\r\n\tprivate onClickSend = () => {\r\n\t\tthis.form.buttonClick('send');\r\n\t}\r\n\r\n\tprivate onFormSubmit = async (buttonName:string, context: Context) => {\r\n\t\tlet {name, discription} = context.data;\r\n\t\tawait this.controller.saveGroup(0, name, discription);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate form: Form;\r\n\tprivate onClickAdd = () => {\r\n\t\tlet schema:ItemSchema[] = [\r\n\t\t\t{name: 'name', type: 'string'},\r\n\t\t];\r\n\t\tlet uiSchema:UiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tname: {\r\n\t\t\t\t\tlabel: '名称',\r\n\t\t\t\t\tplaceholder: '输入工作群组名称'\r\n\t\t\t\t} as UiTextItem\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet right = <button onClick={this.onClickSend}\r\n\t\t\tclassName=\"btn btn-sm btn-success align-self-center mr-2\">\r\n\t\t\t<FA name=\"paper-plane-o\" />\r\n\t\t</button>;\r\n\t\tthis.openPageElement(<Page header=\"新建群\" right={right}>\r\n\t\t\t<div className=\"m-3\">\r\n\t\t\t\t<Form ref={f => this.form = f} schema={schema} uiSchema={uiSchema}\r\n\t\t\t\t\tonButtonClick={this.onFormSubmit} />\r\n\t\t\t</div>\r\n\t\t</Page>);\r\n\t}\r\n\r\n\tprivate keyGroup = (item:any) => {\r\n\t\tlet {group} = item;\r\n\t\tif (typeof group === 'object') return group.id;\r\n\t\treturn group;\r\n\t}\r\n\r\n\trender() {\r\n\t\tlet page = observer(() => {\r\n\t\t\tlet {groupsPager} = this.controller;\r\n\t\t\tlet {items} = groupsPager;\r\n\t\t\tlet right = <button onClick={this.onClickAdd}\r\n\t\t\t\tclassName=\"btn btn-sm btn-primary align-self-center mr-2\">\r\n\t\t\t\t<FA name=\"plus\" />\r\n\t\t\t</button>;\r\n\t\t\treturn <Page header=\"首页\" headerClassName=\"bg-info\" right={right}>\r\n\t\t\t\t<div className=\"py-2 d-flex bg-white align-items-center border-bottom cursor-pointer mb-2\" \r\n\t\t\t\t\tonClick={this.controller.cApp.cMember.showList}>\r\n\t\t\t\t\t<div className={'d-flex w-2-5c h-2-5c text-center mx-3 rounded text-white align-items-center justify-content-center bg-info'}>\r\n\t\t\t\t\t\t<FA name=\"user-o\" fixWidth={true} size=\"lg\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div>同事</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<List items={items} \r\n\t\t\t\t\titem={{render:this.renderGroup, onClick: this.onClickGroup, key: this.keyGroup}}\r\n\t\t\t\t\tnone={()=><>[无]</>} />\r\n\t\t\t</Page>;\r\n\t\t});\r\n\t\treturn React.createElement(page);\r\n\t}\r\n\t\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { VPage, tv, List, FA, Tuid, EasyTime, Scroller, UserView, User, Image } from 'tonva';\r\nimport { CGroup } from './CGroup';\r\nimport { NoteItem } from './NoteItem';\r\n\r\nexport class VGroup extends VPage<CGroup> {\r\n\t@observable private inputed: boolean = false;\r\n\r\n\tinit() {\r\n\t\tthis.scrollToBottom();\r\n\t}\r\n\tprivate scrollToBottom() {\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.divBottom?.scrollIntoView();\r\n\t\t}, 100);\r\n\t}\r\n\r\n\tprivate renderTime(noteItem:NoteItem, index:number):JSX.Element {\r\n\t\tlet {$create} = noteItem;\r\n\t\tif (index > 0) {\r\n\t\t\tlet lastNoteItem:NoteItem;\r\n\t\t\tlastNoteItem = this.controller.groupNotesPager.items[index-1];\r\n\t\t\tif ($create.getTime() - lastNoteItem.$create.getTime() < 2 * 60 * 1000) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn <div className=\"pt-3 text-muted small text-center\"><EasyTime date={$create} /></div>\r\n\t}\r\n\r\n\tprivate renderNote = (noteItem:NoteItem, index:number):JSX.Element => {\r\n\t\tlet {owner} = noteItem;\r\n\t\tlet isMe = (Tuid.equ(owner, this.controller.user.id));\r\n\t\tlet vNote: any;\r\n\t\tif (isMe === true) {\r\n\t\t\tvNote = <div className=\"d-flex flex-column align-items-end my-2\">\r\n\t\t\t\t{noteItem.renderAsNote()}\r\n\t\t\t</div>\r\n\t\t}\r\n\t\telse {\r\n\t\t\tvNote = <UserView user={owner} render={(values:User)=> {\r\n\t\t\t\tlet {icon, nick, name} = values;\r\n\t\t\t\treturn <div className=\"d-flex align-items-start my-2\">\r\n\t\t\t\t\t<Image src={icon} className=\"w-2c h-2c mr-3\" />\r\n\t\t\t\t\t<div className=\"flex-fill d-flex flex-column align-items-start\">\r\n\t\t\t\t\t\t<div className=\"small text-muted mb-1\">{nick || name}</div>\r\n\t\t\t\t\t\t{noteItem.renderAsNote()}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t}} />;\r\n\t\t}\r\n\t\treturn <div className=\"d-block\">\r\n\t\t\t{this.renderTime(noteItem, index)}\r\n\t\t\t{vNote}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate inputRef = (input:any) => {\r\n\t\tif (!input) return;\r\n\t\tif (window.getComputedStyle(input).visibility === 'hidden') return;\r\n\t\tthis.input = input;\r\n\t}\r\n\r\n\tprivate addTextNote = async () => {\r\n\t\tif (!this.input) return;\r\n\t\tlet content:string = this.input.value;\r\n\t\tthis.input.value = '';\r\n\t\tthis.inputed = false;\r\n\t\tawait this.controller.addTextNote(content);\r\n\t\tthis.scrollToBottom();\r\n\t}\r\n\r\n\t\r\n\tprivate divBottom: HTMLElement;\r\n\tprivate refDivBottom = (divButtom:HTMLElement) => {\r\n\t\tthis.divBottom = divButtom;\r\n\t};\r\n\r\n\tprivate input: HTMLInputElement;\r\n\tprivate onKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) {\r\n\t\t\tthis.addTextNote();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onInputChange = (evt: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tthis.inputed = evt.target.value.trim().length > 0;\r\n\t}\r\n\r\n\tprivate showCommands = () => {\r\n\t\tthis.controller.commandsShown = !this.controller.commandsShown;\r\n\t\tif (this.controller.commandsShown) {\r\n\t\t\tthis.scrollToBottom();\r\n\t\t}\r\n\t}\r\n\r\n\tprivate taskTodo = async () => {\r\n\t\tthis.input.value = '';\r\n\t\tthis.inputed = false;\r\n\t\tlet ret = await this.controller.showNewTask();\r\n\t\tif (ret === true) this.scrollToBottom();\r\n\t}\r\n\r\n\tprivate onListFocus = (evt: React.FocusEvent<HTMLUListElement>) => {\r\n\t\tthis.controller.commandsShown = false;\r\n\t}\r\n\r\n\tprivate onDetail = () => {\r\n\t\tthis.controller.showGroupDetail();\r\n\t}\r\n\r\n\theader() {\r\n\t\tlet Header = observer(() => {\r\n\t\t\tlet {currentGroup} = this.controller;\r\n\t\t\treturn tv(currentGroup, v => {\r\n\t\t\t\tlet {name, count} = v;\r\n\t\t\t\treturn <>{name} &nbsp; {count && <small>({count}成员)</small>}</>\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn <Header />;\r\n\t}\r\n\tfooter() {\r\n\t\tlet Footer = observer(() => {\r\n\t\t\tlet {commandsShown} = this.controller;\r\n\t\t\tlet cnFooter = classNames('w-100 d-flex flex-column justify-content-center', {\r\n\t\t\t});\r\n\t\t\tlet cnInputRow = classNames(\"d-flex px-2 align-items-center py-1 border-top\", \r\n\t\t\t\t{\r\n\t\t\t\t\t'align-items-start':  commandsShown,\r\n\t\t\t\t});\r\n\t\t\treturn <div className={cnFooter}>\r\n\t\t\t\t<div className={cnInputRow}>\r\n\t\t\t\t\t<input className=\"flex-fill form-control mr-2 mb-0\" \r\n\t\t\t\t\t\ttype=\"text\" ref={this.inputRef} \r\n\t\t\t\t\t\tonKeyDown={this.onKeyDown} onChange={this.onInputChange} />\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tthis.inputed === true?\r\n\t\t\t\t\t\t<button onClick={this.addTextNote}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-sm btn-success text-nowrap\">\r\n\t\t\t\t\t\t\t发送\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t:\r\n\t\t\t\t\t\t<button onClick={this.showCommands}\r\n\t\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-dark\">\r\n\t\t\t\t\t\t\t<FA name=\"plus\" />\r\n\t\t\t\t\t\t</button>\r\n\t\t\t\t\t}\r\n\t\t\t\t</div>\r\n\t\t\t\t{\r\n\t\t\t\t\tcommandsShown === true && <div className=\"d-flex flex-wrap px-3 py-4\">\r\n\t\t\t\t\t\t<div className=\"cursor-pointer\" onClick={this.taskTodo}>\r\n\t\t\t\t\t\t\t<div className=\"p-2 bg-white\" style={{borderRadius:'0.6em'}}>\r\n\t\t\t\t\t\t\t\t<FA name=\"tasks\" size=\"lg\" fixWidth={true} />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div className=\"text-center mt-1 small text-muted\"><small>任务</small></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t}\r\n\t\t\t</div>\r\n\t\t});\r\n\t\treturn <Footer />;\r\n\t}\r\n\tright() {\r\n\t\treturn <div className=\"d-flex px-3 align-items-center cursor-pointer\"\r\n\t\t\tonClick={this.onDetail}>\r\n\t\t\t<FA name=\"ellipsis-h\" />\r\n\t\t</div>;\r\n\t}\r\n\tcontent() {\r\n\t\tlet {groupNotesPager} = this.controller;\t\t\r\n\t\tlet bottomMark = observer(() => {\r\n\t\t\treturn <div id={groupNotesPager.bottomDiv} \r\n\t\t\t\tref={this.refDivBottom} \r\n\t\t\t\tclassName=\"h-1c\" />\r\n\t\t});\r\n\t\treturn <>\r\n\t\t\t<List className=\"px-3 flex-fill bg-transparent\" \r\n\t\t\t\titems={groupNotesPager.items} \r\n\t\t\t\titem={{render: this.renderNote}}\r\n\t\t\t\tonFocus={this.onListFocus} />\r\n\t\t\t{React.createElement(bottomMark)}\r\n\t\t</>;\r\n\t}\r\n\tprotected async onPageScrollTop(scroller: Scroller): Promise<boolean> {\r\n\t\tlet ret = await this.controller.groupNotesPager.more();\r\n\t\treturn ret;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { CGroup } from \"./CGroup\";\r\nimport { VPage, Page, Edit, Schema, UiSchema, StringSchema, UiTextItem, UiTextAreaItem, ItemSchema, FA, QueryPager, UserView, UserIcon, Loading, Form, ButtonSchema, UiButton, Context, userApi, useUser, Tuid, List } from \"tonva\";\r\nimport { observable } from 'mobx';\r\nimport { observer } from 'mobx-react';\r\n\r\nexport class VGroupDetail extends VPage<CGroup> {\r\n\tprivate groupMembersPager: QueryPager<any>;\r\n\r\n    async open(groupMembersPager: QueryPager<any>) {\r\n\t\tthis.groupMembersPager = groupMembersPager;\r\n\t\tthis.openPage(this.page);\r\n\t}\r\n\r\n\tprivate onItemChanged = async (item:ItemSchema, value:any, prev:any) => {\r\n\t\tlet {currentGroup} = this.controller;\r\n\t\tlet props:any = {\r\n\t\t\tid: currentGroup.id,\r\n\t\t};\r\n\t\tswitch (item.name) {\r\n\t\t\tcase 'name':\r\n\t\t\t\tcurrentGroup.name = props.name = value;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 'discription':\r\n\t\t\t\tcurrentGroup.discription = props.discription = value;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t\tawait this.controller.saveGroupProp(props);\r\n\t}\r\n\r\n\tprivate onMember = (memberId:number) => {\r\n\t\tthis.controller.cApp.showMemberDetail(memberId);\r\n\t}\r\n\r\n\tprivate renderMember = (member:any) => {\r\n\t\tlet id:number = (typeof member === 'object')? member.id : member;\r\n\t\treturn <div key={id} className=\"m-2 cursor-pointer\"\r\n\t\t\tonClick={()=>this.onMember(id)}>\r\n\t\t\t<UserView id={id} render={user => {\r\n\t\t\t\tlet {name, nick} = user;\r\n\t\t\t\treturn \t<>\r\n\t\t\t\t<div className=\"w-3c h-3c rounded border \">\r\n\t\t\t\t\t<UserIcon id={id} className=\"w-100 h-100 rounded\" />\r\n\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"w-3c d-inline-block text-truncate small text-muted text-center\">\r\n\t\t\t\t\t\t<small>{nick || name}</small>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</>\r\n\t\t\t}} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onSubmitAddMember = async (name:string, context: Context) => {\r\n\t\tlet user = await userApi.fromKey(context.data.user);\r\n\t\tif (!user) {\r\n\t\t\tcontext.setError('user', '账号不存在或者不接受邀请');\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tawait this.controller.groupAddMember(user);\r\n\t\tthis.controller.setGroup();\r\n\t\tuseUser(user.id);\r\n\t\tthis.groupMembersPager.items.push({member: user.id});\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tprivate onAddMember = () => {\r\n\t\tlet schema:Schema = [\r\n\t\t\t{name: 'user', type: 'string', maxLength: 100, required: true} as StringSchema,\r\n\t\t\t{name: 'submit', type: 'submit'} as ButtonSchema,\r\n\t\t];\r\n\t\tlet uiSchema: UiSchema = {\r\n\t\t\titems: {\r\n\t\t\t\tuser: {widget:'text', label:'成员', placeholder: '请输入成员账号'} as UiTextItem,\r\n\t\t\t\tsubmit: {widget:'button', label:'提交', className: 'btn btn-primary'} as UiButton,\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.openPageElement(<Page header=\"添加成员\">\r\n\t\t\t<Form onButtonClick={this.onSubmitAddMember}\r\n\t\t\t\tonEnter={this.onSubmitAddMember}\r\n\t\t\t\tclassName=\"m-5 px-5 py-3 bg-white\" \r\n\t\t\t\tschema={schema} uiSchema={uiSchema} />\r\n\t\t</Page>);\r\n\t}\r\n\r\n\t@observable disabled:boolean = true;\r\n\tprivate listRemoveMember:List;\r\n\tprivate renderRemoveButton = observer(()=> {\r\n\t\treturn <button onClick={this.onRemoveMemberList}\r\n\t\t\tclassName=\"btn btn-sm btn-success mr-2 align-self-center\"\r\n\t\t\tdisabled={this.disabled}>删除</button>;\r\n\t});\r\n\tprivate renderRemoveMemberItem = (item:any, index:number):JSX.Element => {\r\n\t\tlet {member} = item;\r\n\t\tlet id:number = (typeof member === 'object')? member.id : member;\r\n\t\t//return <div key={index} className=\"p-3\">{tv(item.member)}</div>;\r\n\t\treturn <UserView id={id} render={user => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn \t<div className=\"d-flex align-items-center py-2\">\r\n\t\t\t\t<div className=\"w-3c h-3c rounded border mx-3\">\r\n\t\t\t\t\t<UserIcon id={id} className=\"w-100 h-100 rounded\" />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"\">{nick || name}</div>\r\n\t\t\t</div>;\r\n\t\t}} />\r\n\t}\r\n\tprivate onRemoveMemberList = async () => {\r\n\t\tlet members = this.listRemoveMember.selectedItems;\r\n\t\tawait this.controller.groupRemoveMembers(members);\r\n\t\tlet {items} = this.groupMembersPager;\r\n\t\tfor (let m of members) {\r\n\t\t\tlet index = items.findIndex(v => v.member === m.member);\r\n\t\t\tif (index>=0) items.splice(index, 1);\r\n\t\t}\r\n\t\tthis.controller.setGroup();\r\n\t\tthis.closePage();\r\n\t}\r\n\tprivate onSelectRemoveMember = (item:any, isSelected:boolean, anySelected:boolean) => {\r\n\t\tthis.disabled = anySelected===false;\r\n\t}\r\n\tprivate onRemoveMember = () => {\r\n\t\tthis.openPageElement(<Page header=\"成员\" right={<this.renderRemoveButton />}>\r\n\t\t\t<List ref={list=>this.listRemoveMember=list} items={this.groupMembersPager.items} item={{\r\n\t\t\t\trender: this.renderRemoveMemberItem, \r\n\t\t\t\tonSelect: this.onSelectRemoveMember}} />\r\n\t\t</Page>);\r\n\t}\r\n\r\n\tprivate renderMemberAction = (icon:string, action:()=>void) => {\r\n\t\tlet {currentGroup, user} = this.controller;\r\n\t\tif (Tuid.equ(currentGroup.owner, user.id) === false) return;\r\n\t\treturn <div onClick={action}\r\n\t\t\tclassName=\"d-flex m-2 w-3c h-3c rounded border text-muted justify-content-center align-items-center cursor-pointer\">\r\n\t\t\t<FA name={icon} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderMembers = () => {\r\n\t\tlet {items} = this.groupMembersPager;\r\n\t\tif (items === undefined) {\r\n\t\t\treturn <Loading />;\r\n\t\t}\r\n\t\tlet divMembers = [];\r\n\t\tfor (let item of items) {\r\n\t\t\tdivMembers.push(this.renderMember(item.member));\r\n\t\t}\r\n\t\treturn <div className=\"mb-3 bg-white d-flex flex-wrap p-2\">\r\n\t\t\t{divMembers}\r\n\t\t\t{this.renderMemberAction('plus', this.onAddMember)}\r\n\t\t\t{this.renderMemberAction('minus', this.onRemoveMember)}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate schema: Schema = [\r\n\t\t{name: 'name', type: 'string', maxLength: 100 } as StringSchema,\r\n\t\t{name: 'discription', type: 'string', maxLength: 1000} as StringSchema\r\n\t];\r\n\tprivate uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tname: {\r\n\t\t\t\tlabel: '组名称',\r\n\t\t\t\twidget: 'text',\r\n\t\t\t} as UiTextItem,\r\n\t\t\tdiscription: {\r\n\t\t\t\tlabel: '组公告',\r\n\t\t\t\twidget: 'textarea',\r\n\t\t\t} as UiTextAreaItem\r\n\t\t}\r\n\t};\r\n\t//@observable private detail: any;\r\n\tprivate page = observer(():JSX.Element => {\r\n\t\tlet {currentGroup} = this.controller;\r\n\t\treturn <Page header=\"详情\">\r\n\t\t\t{this.renderMembers()}\r\n\t\t\t<Edit schema={this.schema} uiSchema={this.uiSchema} data={currentGroup}\r\n\t\t\t\tonItemChanged={this.onItemChanged} />\r\n\t\t</Page>;\r\n\t});\r\n}\r\n","import { CGroup } from \"group/CGroup\";\r\n\r\nexport abstract class NoteItem {\r\n\tid: number;\r\n\towner: number;\r\n\t$create: Date;\r\n\tprotected readonly cGroup: CGroup\r\n\tconstructor(cGroup: CGroup) {\r\n\t\tthis.cGroup = cGroup;\r\n\t}\r\n\tabstract renderAsNote():JSX.Element;\r\n\tabstract renderInView():JSX.Element;\r\n}\r\n","import React from 'react';\r\nimport classNames from 'classnames';\r\nimport { NoteItem } from \"./NoteItem\";\r\nimport { Tuid } from 'tonva';\r\n\r\nexport class NoteText extends NoteItem {\r\n\tcontent: string;\r\n\trenderAsNote():JSX.Element {\r\n\t\tlet isMe = (Tuid.equ(this.owner, this.cGroup.user.id));\r\n\t\tlet cnDiv = classNames('p-3 rounded', {\"bg-white\": !isMe});\r\n\t\tlet bgStyle:{[prop:string]:string} = {maxWidth:'75%'};\r\n\t\tif (isMe === true) bgStyle['backgroundColor'] = '#8f8';\r\n\t\treturn <div className={cnDiv} style={bgStyle}>{this.content}</div>;\r\n\t}\r\n\r\n\trenderInView():JSX.Element {\r\n\t\treturn this.renderAsNote();\r\n\t}\r\n}\r\n","export function parseTodo(text:string) {\r\n\tlet content:string, hour:number;\r\n\tcontent = text.trim();\r\n\tlet pArr = [];\r\n\tlet len = content.length;\r\n\tfor (let i=0; i<len; i++) {\r\n\t\tif (isSepChar(content, i) === true) {\r\n\t\t\tpArr.push(i);\r\n\t\t}\r\n\t}\r\n\tlet plen = pArr.length;\r\n\tif (plen === 0) return {content, hour};\r\n\tlet pSep = pArr[0];\r\n\thour = parseHour(content.substring(0, pSep));\r\n\tif (hour !== undefined) return {content:content.substr(pSep).trim(), hour};\r\n\tpSep = pArr[plen-1];\r\n\thour = parseHour(content.substring(pSep+1, len));\r\n\tif (hour === undefined) return {content, hour};\r\n\treturn {content:content.substring(0, pSep).trim(), hour};\r\n}\r\n\r\nconst seps = [0x20, 9, 10, 13, 0x3000, 0xa0];\r\nfunction isSepChar(text:string, p:number):boolean {\r\n\tlet ch = text.charCodeAt(p);\r\n\treturn seps.indexOf(ch) >= 0;\r\n}\r\n\r\nfunction parseHour(text:string) {\r\n\tlet p = 0;\r\n\tlet len = text.length;\r\n\tlet h = parseNum();\r\n\tif (h === undefined) return;\r\n\tif (p >= len) return h*60;\r\n\r\n\tlet isDot = false, isColon = false;\r\n\tlet sep = text.charCodeAt(p);\r\n\r\n\t// .。．\r\n\tif (sep === 46 || sep === 12290 || sep === 65294) {\r\n\t\tisDot = true;\r\n\t}\r\n\t//:：\r\n\telse if (sep === 58 || sep === 65306) {\r\n\t\tisColon = true;\r\n\t}\r\n\telse {\r\n\t\t// 不是点，也不是colon，肯定错误\r\n\t\treturn;\r\n\t}\r\n\t++p;\r\n\tlet m = parseNum();\r\n\tif (m === undefined) return;\r\n\tif (p<len) return;\r\n\r\n\tif (isDot === true) return Math.floor(Number(h + '.' + m) *60);\r\n\tif (isColon === true) return h*60 + m;\r\n\treturn;\r\n\r\n\tfunction parseNum() {\r\n\t\tlet num = 0;\r\n\t\tlet hasNum = false;\r\n\t\tfor (; p<len; p++) {\r\n\t\t\tlet ch = text.charCodeAt(p);\r\n\t\t\tif (ch>=48 && ch<=57) {\r\n\t\t\t\tnum = num*10 + ch - 48;\r\n\t\t\t\thasNum = true;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (hasNum === true) return num;\r\n\t}\r\n}\r\n\r\n","import React from 'react';\r\nimport { NoteItem } from \"./NoteItem\";\r\nimport { stateIcon } from 'tools';\r\nimport { EasyTime } from 'tonva';\r\n\r\nexport class NoteAssign extends NoteItem {\r\n\tassignId: number;\r\n\tcaption: string;\r\n\tdiscription: string;\r\n\ttime: Date;\r\n\tx: number = 0;\r\n\r\n\trenderAsNote():JSX.Element {\r\n\t\tif (this.x === 1) {\r\n\t\t\t// removed\r\n\t\t\treturn <div className=\"w-100 d-flex justify-content-center\">\r\n\t\t\t\t<div className=\"bg-light py-1 px-3 small text-muted\">撤销了 <del>{this.discription}</del></div>\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\trenderInView():JSX.Element {\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\tprivate onClick = () => {\r\n\t\tthis.cGroup.showAssign(this);\r\n\t}\r\n\r\n\tprivate renderInternal():JSX.Element {\r\n\t\tlet cn = 'bg-info rounded border border-info w-75 cursor-pointer';\r\n\t\treturn <div className={cn}\r\n\t\t\tonClick={this.onClick}>\r\n\t\t\t<div className=\"d-flex align-items-center \">\r\n\t\t\t\t<div className=\"d-flex align-items-center justify-content-center text-danger w-3c h-3c \r\n\t\t\t\t\tbg-white border-info rounded-left\">\r\n\t\t\t\t\t{stateIcon(undefined)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"flex-fill px-3 py-2 text-white\">\r\n\t\t\t\t\t<div><b>{this.caption}</b></div>\r\n\t\t\t\t\t<div><span className=\"\">{this.discription}</span></div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"small px-3 py-1 text-light\">\r\n\t\t\t\t\t<EasyTime date={this.$create} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { NoteItem } from \"./NoteItem\";\r\nimport { EnumTaskStep, EnumTaskState } from 'tapp';\r\n\r\nexport class NoteTaskTodo extends NoteItem {\r\n\ttaskId: number;\r\n\tcaption: string;\r\n\tdiscription: string;\r\n\ttime: Date;\r\n\towner: number;\r\n\tx: number;\r\n\tstep: EnumTaskStep;\r\n\tstate: EnumTaskState;\r\n\r\n\trenderAsNote():JSX.Element {\r\n\t\tif (this.x === 1) {\r\n\t\t\t// removed\r\n\t\t\treturn <div className=\"w-100 d-flex justify-content-center\">\r\n\t\t\t\t<div className=\"bg-light py-1 px-3 small text-muted\">撤销了 <del>{this.discription}</del></div>\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\trenderInView():JSX.Element {\r\n\t\treturn this.renderInternal();\r\n\t}\r\n\r\n\tprivate onClick = () => {\r\n\t\tthis.cGroup.cApp.showTask(this.taskId);\r\n\t}\r\n\r\n\tprivate renderInternal():JSX.Element {\r\n\t\tlet text:string;\r\n\t\tswitch (this.step) {\r\n\t\t\tdefault: text = '未知 ' + this.step; break;\r\n\t\t\tcase EnumTaskStep.todo: text = '领办'; break;\r\n\t\t\tcase EnumTaskStep.done: text = '已办'; break;\r\n\t\t\tcase EnumTaskStep.check: text = '查验'; break;\r\n\t\t\tcase EnumTaskStep.rate: text = '评分'; break;\r\n\t\t}\r\n\t\treturn <div className=\"border rounded px-3 py-1 text-muted bg-light cursor-pointer\"\r\n\t\t\tonClick={this.onClick}>\r\n\t\t\t{text} <span className=\"text-dark\">{this.caption}</span>\r\n\t\t\t&nbsp;\r\n\t\t\t<small className=\"\">{this.discription}</small>\r\n\t\t</div>;\r\n\t}\r\n}\r\n","import { Note } from \"../../models\";\r\nimport { EnumNoteType, EnumTaskStep, EnumTaskState } from \"../../tapp\";\r\nimport { NoteText } from \"./NoteText\";\r\nimport { NoteAssign } from \"./NoteAssign\";\r\nimport { NoteTaskTodo } from \"./NoteTaskTodo\";\r\nimport { NoteItem } from \"./NoteItem\";\r\nimport { CGroup } from \"../CGroup\";\r\n\r\nexport * from \"./NoteItem\";\r\nexport * from './NoteAssign';\r\nexport * from './NoteTaskTodo';\r\n\r\nexport function dataToNoteItem(cGroup: CGroup, note:Note, queryResults:{[name:string]:any[]}):NoteItem {\r\n\tswitch (note.type) {\r\n\t\tdefault: \r\n\t\t\tdebugger;\r\n\t\t\tthrow new Error('unknow note type');\r\n\t\tcase EnumNoteType.Text:\r\n\t\t\treturn buildNoteText(cGroup, note, queryResults);\r\n\t\tcase EnumNoteType.Assign:\r\n\t\t\treturn buildNoteAssign(cGroup, note, queryResults);\r\n\t\tcase EnumNoteType.Task:\r\n\t\t\treturn buildNoteTaskTodo(cGroup, note, queryResults);\r\n\t}\r\n}\r\n\r\nexport function createNoteText(cGroup: CGroup, owner:any, content:string):NoteText {\r\n\tlet ret:NoteText = new NoteText(cGroup);\r\n\tret.owner = owner;\r\n\tret.content = content;\r\n\tret.$create = new Date();\r\n\treturn ret;\r\n}\r\n\r\nexport function createNoteAssign(cGroup: CGroup, owner:any, assignId:number):NoteAssign {\r\n\tlet noteAssign:NoteAssign = new NoteAssign(cGroup);\r\n\tnoteAssign.owner = owner;\r\n\tnoteAssign.$create = new Date();\r\n\tnoteAssign.assignId = assignId;\r\n\treturn noteAssign;\r\n}\r\n\r\nexport function createNoteTaskTodo(cGroup: CGroup):NoteTaskTodo {\r\n\tlet taskTodo:NoteTaskTodo = new NoteTaskTodo(cGroup);\r\n\treturn taskTodo;\r\n}\r\n\r\n\r\nfunction buildNoteText(cGroup: CGroup, note: Note, results:{[name:string]:any[]}):NoteItem {\r\n\tlet ret:NoteText = new NoteText(cGroup);\r\n\tlet {id, owner, content} = note;\r\n\tret.id = id;\r\n\tret.owner = owner;\r\n\tret.$create = note.$create;\r\n\tret.content = content;\r\n\treturn ret;\r\n}\r\n\r\nfunction buildNoteAssign(cGroup: CGroup, note:Note, results:{[name:string]:any[]}):NoteItem {\r\n\tlet noteAssign: NoteAssign = new NoteAssign(cGroup);\r\n\tlet {id, owner, $create, obj} = note;\r\n\tnoteAssign.id = id;\r\n\tnoteAssign.owner = owner;\r\n\tnoteAssign.$create = $create;\r\n\tlet {assigns} = results;\r\n\tlet assign = assigns.find(v => v.assignId === obj);\r\n\tif (assign !== undefined) {\r\n\t\tlet {assignId, caption, discription} = assign;\r\n\t\tnoteAssign.assignId = assignId;\r\n\t\tnoteAssign.caption = caption;\r\n\t\tnoteAssign.discription = discription;\r\n\t\tnoteAssign.x = note.x;\r\n\t}\r\n\treturn noteAssign;\r\n}\r\n\r\nfunction buildNoteTaskTodo(cGroup: CGroup, note:Note, results:{[name:string]:any[]}):NoteItem {\r\n\tlet ret:NoteTaskTodo = new NoteTaskTodo(cGroup);\r\n\tlet {id, owner, $create, content, obj} = note;\r\n\tret.id = id;\r\n\tret.owner = owner;\r\n\tret.$create = $create;\r\n\tif (content) {\r\n\t\tlet parts = content.split('|');\r\n\t\tret.step = Number(parts[0]) as EnumTaskStep;\r\n\t\tret.state = Number(parts[1]) as EnumTaskState;\r\n\t}\r\n\r\n\tlet {tasks} = results;\r\n\tlet annItem = tasks.find(v => v.taskId === obj);\r\n\tif (annItem !== undefined) {\r\n\t\tlet {taskId, caption, discription} = annItem;\r\n\t\tret.taskId = taskId;\r\n\t\tret.caption = caption;\r\n\t\tret.discription = discription;\r\n\t\t//ret.time = time;\r\n\t\tret.x = note.x;\r\n\t}\r\n\treturn ret;\r\n}\r\n","import { CUqBase } from \"../tapp\";\r\nimport { VMain } from \"./VMain\";\r\nimport { QueryPager, useUser, Tuid } from \"tonva\";\r\nimport { VGroup } from \"./VGroup\";\r\nimport { observable } from \"mobx\";\r\nimport { stateDefs } from \"tools\";\r\nimport { Task, Assign } from \"../models\";\r\nimport { VGroupDetail } from \"./VGroupDetail\";\r\nimport { Performance } from '../tapp'\r\nimport { NoteItem, NoteAssign, dataToNoteItem, createNoteAssign, createNoteText } from \"./NoteItem\";\r\n\r\nexport class CGroup extends CUqBase {\r\n\tprivate performance: Performance;\r\n\r\n\t@observable commandsShown: boolean = false;\r\n\t@observable currentGroup: any;\r\n\t@observable currentTask: Task;\r\n\r\n\tgroupsPager: GroupsPager;\r\n\tgroupNotesPager: QueryPager<NoteItem>;\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.performance = this.uqs.performance;\r\n\t\tthis.groupsPager = new GroupsPager(this.performance.GetMyGroups, 10, 500, true);\r\n\t\tthis.groupNotesPager = new QueryPager<NoteItem>(this.performance.GetGroupNotes, 10, 30, true);\r\n\t\tthis.groupNotesPager.setItemConverter(this.noteItemConverter);\r\n\t\tthis.groupNotesPager.setReverse();\r\n\t}\r\n\t\r\n\ttab = () => this.renderView(VMain);\r\n\t\r\n\tasync load() {\r\n\t\tawait this.groupsPager.first(undefined);\r\n\t}\r\n\r\n\tasync saveGroup(parent:number, name:string, discription:string) {\r\n\t\tlet data = {parent, name, discription};\r\n\t\tlet ret = await this.performance.SaveGroup.submit(data);\r\n\t\tlet retGroupId = ret?.group;\r\n\t\tlet groupBoxId = this.performance.Group.boxId(retGroupId);\r\n\t\tthis.groupsPager.items.unshift({group: groupBoxId, time: new Date()});\r\n\t}\r\n\r\n\tasync saveGroupProp(props: {id:number, name:string, discription:string}) {\r\n\t\tawait this.performance.SaveGroupProp.submit(props);\r\n\t\tthis.performance.Group.resetCache(props.id);\r\n\t}\r\n\r\n\tasync setGroup(groupId?:number) {\r\n\t\tif (!groupId) groupId = this.currentGroup?.id;\r\n\t\tif (!groupId) return;\r\n\t\tlet {Group} = this.performance;\r\n\t\tthis.currentGroup = await Group.assureBox(groupId);\r\n\t}\r\n\r\n\tprivate noteItemConverter = (item:any, queryResults:{[name:string]:any[]}):NoteItem => {\r\n\t\treturn dataToNoteItem(this, item, queryResults);\r\n\t}\r\n\tshowGroup = async (item: any) => {\r\n\t\tawait this.groupNotesPager.first({group: item.group});\r\n\t\titem.unread = 0;\r\n\t\tthis.openVPage(VGroup, undefined, ret => {\r\n\t\t\tthis.currentGroup = undefined;\r\n\t\t});\r\n\t\tthis.setGroup(item.group.id);\r\n\t\tthis.cApp.resetTick();\r\n\t}\r\n\r\n\tasync refresh() {\r\n\t\tlet arr:Promise<any>[] = [this.groupsPager.refresh()];\r\n\t\tif (this.currentGroup) {\r\n\t\t\tarr.push(this.groupNotesPager.attach());\r\n\t\t}\r\n\t\tawait Promise.all(arr);\r\n\t\tif (this.currentGroup) {\r\n\t\t\tlet groupId = this.currentGroup.id;\r\n\t\t\tlet item = this.groupsPager.items.find(v => Tuid.equ(v.group, groupId));\r\n\t\t\tif (item) {\r\n\t\t\t\titem.time = new Date();\r\n\t\t\t\titem.unread = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprivate afterAddNote() {\r\n\t\tthis.groupNotesPager.scrollToBottom();\r\n\t\tthis.commandsShown = false;\r\n\t}\r\n\r\n\taddTextNote = async (content: string) => {\r\n\t\tlet data = {\r\n\t\t\tgroup: this.currentGroup, \r\n\t\t\tcontent, \r\n\t\t};\r\n\t\tlet ret = await this.performance.PushNote.submit(data);\r\n\t\tlet retNoteId = ret?.note;\r\n\t\tlet nts:NoteItem = createNoteText(this, this.user.id, content);\r\n\t\tnts.id = retNoteId;\r\n\t\tthis.groupNotesPager.items.push(nts);\r\n\t\tthis.afterAddNote();\r\n\t}\r\n\tsaveTaskProp = async (prop:string, value:any) => {\r\n\t\tawait this.performance.Assign.saveProp(this.currentTask.id, prop, value);\r\n\t}\r\n\r\n\tpublishAssign = async (assign: Assign):Promise<void> => {\r\n\t\tlet ret:{note:number} = await this.performance.PublishAssign.submit({\r\n\t\t\tassignId: assign.id,\r\n\t\t\tgroupId: this.currentGroup.id\r\n\t\t});\r\n\t\tif (!ret) alert('publish assign error');\r\n\t\tlet nts = createNoteAssign(this, this.user.id, ret.note);\r\n\t\tnts.id = ret.note;\r\n\r\n\t\t// eslint-disable-next-line\r\n\t\tlet {id, caption, discription} = assign;\r\n\t\tnts.assignId = id;\r\n\t\tnts.caption = caption;\r\n\t\tnts.discription = discription;\r\n\t\tthis.groupNotesPager.items.push(nts);\r\n\t\tthis.afterAddNote();\r\n\t}\r\n\r\n\tshowNewTask = async ():Promise<boolean> => {\r\n\t\tlet ret = await this.cApp.showNewAssign();\r\n\t\treturn ret;\r\n\t}\r\n\tshowAssign = async (noteItem:NoteAssign) => {\r\n\t\tthis.cApp.showAssign(noteItem.assignId); \r\n\t}\r\n\r\n\tsaveTodo = async (todoContent: string):Promise<any> => {\r\n\t\tlet todo = {\r\n\t\t\tid: undefined as any,\r\n\t\t\ttask: this.currentTask.id,\r\n\t\t\tstate: 0,\r\n\t\t\tdiscription: todoContent,\r\n\t\t};\r\n\t\tlet ret = await this.performance.Todo.save(undefined, todo);\r\n\t\ttodo.id = ret.id;\r\n\t\treturn todo;\r\n\t}\r\n\r\n\t// state 10: 待办，state 20: 正办\r\n\ttaskAct = async (noteItem:NoteItem, toState:stateDefs.todo|stateDefs.doing) => {\r\n\t\t// eslint-disable-next-line\r\n\t\tlet ret = await this.performance.TaskAct.submit({task: undefined, toState});\r\n\t}\r\n\r\n\trevokeTask = async (noteItem:NoteItem) => {\r\n\t\tawait this.performance.RemoveTask.submit({noteItem, undefined});\r\n\t};\r\n\r\n\tasync showGroupDetail() {\r\n\t\tlet groupMembersPager = new QueryPager(this.performance.GetGroupMembers, 10, 30);\r\n\t\tgroupMembersPager.setEachPageItem(item => {\r\n\t\t\tuseUser(item.member);\r\n\t\t});\r\n\t\tgroupMembersPager.first({group: this.currentGroup});\r\n\t\tthis.openVPage(VGroupDetail, groupMembersPager);\r\n\t}\r\n\r\n\tasync groupAddMember(member:any) {\r\n\t\tawait this.performance.AddGroupMember.submit({group: this.currentGroup, member: member});\r\n\t}\r\n\r\n\tasync groupRemoveMembers(members:any[]) {\r\n\t\tawait this.performance.RemoveGroupMember.submit({\r\n\t\t\tgroup: this.currentGroup, \r\n\t\t\tmembers: members\r\n\t\t});\r\n\t}\r\n}\r\n\r\nclass GroupsPager extends QueryPager<any> {\r\n\tprotected getRefreshPageId(item:any) {\r\n\t\tif (item === undefined) return;\r\n\t\tlet pageId = item['group'];\r\n\t\tif (typeof pageId === 'object') {\r\n\t\t\treturn pageId.id;\r\n\t\t}\r\n\t\treturn pageId;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { VPage, List, FA, tv, UserView, User, Image, EasyTime, Muted } from \"tonva\";\r\nimport { CJob, Doing } from './CJob';\r\nimport { Assign } from 'models';\r\nimport { stateText } from 'tapp';\r\n\r\ninterface Cat {\r\n\ticon: string;\r\n\tbgIcon: string;\r\n\tcontent: any;\r\n\taction: () => void;\r\n}\r\n\r\nexport class VJob extends VPage<CJob> {\r\n    async open() {\r\n\t\t//this.openPage(this.page);\r\n\t}\r\n\r\n\theader() {return '工作'}\r\n\r\n\tcontent() {\r\n\t\tlet page = observer(() => {\r\n\t\t\treturn <>\r\n\t\t\t\t<div className=\"d-flex justify-content-around bg-white py-2\">\r\n\t\t\t\t\t{this.renderCat(this.catTasks)}\r\n\t\t\t\t\t{this.renderCat(this.catAssigns)}\r\n\t\t\t\t\t{this.renderCat(this.catProject)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<List className=\"my-2 bg-transparent\" items={this.controller.myDoingsPager}\r\n\t\t\t\t\titem={{render: this.renderDoing, onClick: this.onClickDoing, key: this.keyDoing, className:\"bg-transparent\"}}\r\n\t\t\t\t\t/>\r\n\t\t\t</>\r\n\t\t});\r\n\t\treturn React.createElement(page);\r\n\t\t/*<div className=\"px-3 pb-3\">\r\n\t\t\t<button className=\"btn btn-primary\" onClick={this.onTest}>test</button>\t\t\r\n\t\t</div>*/\r\n\t}\r\n\r\n\tprivate keyDoing = (doing: Doing) => {\r\n\t\treturn doing.task;\r\n\t}\r\n\r\n\tprivate onClickDoing = (doing: Doing) => {\r\n\t\tthis.controller.showTask(doing.task);\r\n\t}\r\n\r\n\tprivate renderState(doing:Doing):JSX.Element {\r\n\t\tlet {state, date} = doing;\r\n\t\tlet pointer = <FA className=\"text-danger mr-1\" name=\"chevron-circle-right\" />;\r\n\t\tlet {text, act} = stateText(state);\r\n\t\treturn <>{pointer} <small>{text}</small> &nbsp; <Muted>{act}于<EasyTime date={date} /></Muted></>;\r\n\t}\r\n\r\n\tprivate renderDoing = (doing:Doing, index: number) => {\r\n\t\tlet {assign, worker, $create} = doing;\r\n\t\tlet renderIcon = (user:User) => {\r\n\t\t\tlet {icon} = user;\r\n\t\t\treturn <Image className=\"w-2c h-2c mt-1\" src={icon} /> \r\n\t\t};\r\n\t\tlet renderNick = (user:User) => {\r\n\t\t\tlet {name, nick} = user;\r\n\t\t\treturn <small>{nick || name}</small>\r\n\t\t};\r\n\t\treturn tv(assign, (values: Assign) => {\r\n\t\t\tlet {caption, discription} = values;\r\n\t\t\treturn <div className=\"my-1 bg-white\">\r\n\t\t\t\t<div className=\"px-3 py-2\">\r\n\t\t\t\t\t<UserView user={worker} render={renderIcon} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"flex-fill\">\r\n\t\t\t\t\t<div className=\"d-flex pt-1 pb-2\">\r\n\t\t\t\t\t\t<div className=\"flex-fill pl-2\">\r\n\t\t\t\t\t\t\t<UserView user={worker} render={renderNick} />\r\n\t\t\t\t\t\t\t<div><b>{caption}</b> &nbsp; <Muted>{discription}</Muted></div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"pr-2\"><Muted><EasyTime date={$create} /></Muted></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"text-primary pl-2 py-1 border-top\">{this.renderState(doing)}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate showCatProject = () => {\r\n\t\talert('projects');\r\n\t}\r\n\r\n\tprivate catProject:Cat = {\r\n\t\ticon: 'sitemap',\r\n\t\tbgIcon: 'bg-primary',\r\n\t\tcontent: '项目', \r\n\t\taction: this.showCatProject,\r\n\t};\r\n\tprivate catAssigns:Cat = {\r\n\t\ticon: 'list-ol',\r\n\t\tbgIcon: 'bg-success',\r\n\t\tcontent: '作业', \r\n\t\taction: this.controller.showMyAssigns,\r\n\t}\r\n\tprivate catTasks:Cat = {\r\n\t\ticon: 'list-ol',\r\n\t\tbgIcon: 'bg-info',\r\n\t\tcontent: '任务', \r\n\t\taction: this.controller.showMyTasks,\r\n\t}\r\n\tprivate renderCat = (cat:Cat) => {\r\n\t\tlet {icon, bgIcon, content, action} =cat;\r\n\t\treturn <div className=\"py-2 px-3 d-flex bg-white align-items-center cursor-pointer\" \r\n\t\t\tonClick={action}>\r\n\t\t\t<div className={'d-flex w-2-5c h-2-5c text-center mx-3 rounded text-white align-items-center justify-content-center ' + bgIcon}>\r\n\t\t\t\t<FA name={icon} fixWidth={true} size=\"lg\" />\r\n\t\t\t</div>\r\n\t\t\t<div>{content}</div>\r\n\t\t</div>;\r\n\t}\r\n\tprivate onTest = () => {\r\n\t\tthis.controller.testText();\r\n\t}\r\n}\r\n","import { CUqBase, EnumTaskState } from \"../tapp\";\r\nimport { VJob } from \"./VJob\";\r\nimport { QueryPager } from \"tonva\";\r\n\r\nexport interface Doing {\r\n\ttask: number; // ID ASC,\r\n\tassign: any; // ID Assign,\r\n\tworker: number; // ID,\r\n\t$create: Date; // TIMESTAMP, \r\n\tstate: EnumTaskState; \r\n\tdate: Date;\t\t// task act time\r\n}\r\n\r\nexport class CJob extends CUqBase {\r\n\tprivate loaded:boolean;\r\n\tmyDoingsPager: QueryPager<Doing>;\r\n\tmyArchiveTodosPager: QueryPager<any>;\r\n\r\n    protected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.myDoingsPager = new QueryPager(this.uqs.performance.GetMyTasks, 10, 100);\r\n\t\tthis.loaded = false;\r\n\t}\r\n\r\n\ttab = () => this.renderView(VJob);\r\n\r\n\tload = async () => {\r\n\t\tif (this.loaded === true) return;\r\n\t\tthis.loaded = true;\r\n\t\tawait this.myDoingsPager.first({});\r\n\t}\r\n\r\n\trefresh = async() => {\r\n\t\tawait this.myDoingsPager.refresh();\r\n\t}\r\n\r\n\tshowTask = async (taskId: number) => {\r\n\t\tawait this.cApp.showTask(taskId);\r\n\t}\r\n\r\n\tshowMyAssigns = async () => {\r\n\t\tawait this.cApp.showMyAssigns();\r\n\t}\r\n\r\n\tshowMyTasks = async () => {\r\n\t\tawait this.cApp.showMyTasks();\r\n\t}\r\n\r\n\ttestText = async () => {\r\n\t\tlet t = 'a\\nb\\ncc';\r\n\t\tawait this.uqs.performance.TestText.submit({i: 1, tIn: t});\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport classNames from 'classnames';\r\nimport { CTask } from './CTask';\r\nimport { VPage, List, EasyTime, Muted, tv, TabProp, Tabs, FA } from 'tonva';\r\nimport { Assign, AssignTask } from 'models';\r\nimport { EnumTaskStep, stateText } from 'tapp';\r\n\r\nexport class VMyTasks extends VPage<CTask> {\r\n\theader() { return '任务'; }\r\n\r\n\tprivate renderTaskItem = (stepText:string, myTaskItem: AssignTask, index:number) => {\r\n\t\tlet {assign, $create, stepDate, stepComment, state} = myTaskItem;\r\n\t\t// eslint-disable-next-line\r\n\t\tlet {text, act} = stateText(state);\r\n\t\treturn tv(assign, (values:Assign) => {\r\n\t\t\tlet {caption, discription} = values;\r\n\t\t\treturn <div className=\"py-3 px-3\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div><b>{caption}</b> &nbsp; {discription}</div>\r\n\t\t\t\t\t<div className=\"small\">\r\n\t\t\t\t\t\t<FA className=\"text-danger mr-1\" name=\"chevron-circle-right\" />\r\n\t\t\t\t\t\t<span className=\"text-primary\">{text}</span> &nbsp;\r\n\t\t\t\t\t\t<EasyTime date={stepDate} />\r\n\t\t\t\t\t\t{stepText}\r\n\t\t\t\t\t\t<Muted>{stepComment}</Muted>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<Muted><EasyTime date={$create} /></Muted>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t});\r\n\t}\r\n\r\n\tprivate onTaskClick = (myTaskItem: AssignTask) => {\r\n\t\tthis.controller.showTask(myTaskItem.id);\r\n\t}\r\n\r\n\tprivate cnTabSelected = (selected:boolean) => classNames({\r\n\t\t\"bg-white border border-warning\":selected,\r\n\t\t\"border\":!selected,\r\n\t},  'cursor-pointer px-4 py-2 rounded');\r\n\tprivate tabs:TabProp[] = [\r\n\t\t{\r\n\t\t\tname: 'todo',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>领办</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myTasksPager} \r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: (item, index) => this.renderTaskItem('领办', item, index), \r\n\t\t\t\t\t\tonClick: this.onTaskClick\r\n\t\t\t\t\t}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadTaskArchive(EnumTaskStep.todo),\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'done',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>完成</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myTasksPager} \r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: (item, index) => this.renderTaskItem('完成', item, index), \r\n\t\t\t\t\t\tonClick: this.onTaskClick\r\n\t\t\t\t\t}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadTaskArchive(EnumTaskStep.done),\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'check',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>查验</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myTasksPager} \r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: (item, index) => this.renderTaskItem('查验', item, index), \r\n\t\t\t\t\t\tonClick: this.onTaskClick\r\n\t\t\t\t\t}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadTaskArchive(EnumTaskStep.check),\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'rate',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>评分</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myTasksPager} \r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: (item, index) => this.renderTaskItem('评分', item, index), \r\n\t\t\t\t\t\tonClick: this.onTaskClick\r\n\t\t\t\t\t}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadTaskArchive(EnumTaskStep.rate),\r\n\t\t},\r\n\t];\r\n\r\n\tcontent() {\r\n\t\treturn <Tabs tabs={this.tabs} tabPosition=\"top\" size=\"sm\" />;\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { View, FA, List } from \"tonva\";\r\nimport { CTask } from \"./CTask\";\r\nimport { AssignItem } from 'models';\r\n\r\ninterface AssignInputItem {\r\n\tkey: (ti: AssignInputItem) => any; // {return this.orderId};\r\n\titemIndex: number;\r\n\tassignItem: AssignItem;\r\n\tremoved: boolean;\r\n}\r\n\r\nfunction keyFunc(ti:AssignInputItem) {\r\n\treturn ti.itemIndex;\r\n}\r\n\r\nexport class VTodoList extends View<CTask> {\r\n\tprivate allowEdit: boolean = false;\r\n\t@observable private assignInputItems: AssignInputItem[] = [];\r\n\t/*\r\n\t@observable private assignInputItem: AssignInputItem;\r\n\t@observable private isInputing = false;\r\n\tprivate input: HTMLInputElement;\r\n\t*/\r\n\r\n\tinit(items: AssignItem[], allowEdit:boolean = true) {\r\n\t\tthis.allowEdit = allowEdit;\r\n\t\titems.forEach((v, index) => {\r\n\t\t\tthis.assignInputItems.push({\r\n\t\t\t\tkey: keyFunc,\r\n\t\t\t\titemIndex: index + 1,\r\n\t\t\t\tassignItem: v,\r\n\t\t\t\tremoved: false,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\trender():JSX.Element {\r\n\t\tlet r = observer(()=> {\r\n\t\tlet list:any;\r\n\t\tif (this.assignInputItems.length > 0) {\r\n\t\t\tlist = <>\r\n\t\t\t\t<div className=\"border-bottom\">\r\n\t\t\t\t\t<div className=\"mx-3 mb-1 small text-muted\">事项</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<List className=\"border-bottom\"\r\n\t\t\t\t\titems={this.assignInputItems}\r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: this.renderTodo, \r\n\t\t\t\t\t\tonClick:this.allowEdit===true ? this.onTodoClick : undefined\r\n\t\t\t\t}} />\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn list;\r\n\t});\r\n\treturn React.createElement(r);\r\n\t}\r\n\r\n\tprivate renderTodo = (assignInputItem:AssignInputItem, index:number) => {\r\n\t\treturn React.createElement(this.observableTodo, {assignInputItem});\r\n\t}\r\n\r\n\tprivate observableTodo = observer(({assignInputItem}: {assignInputItem:AssignInputItem}) => {\r\n\t\tlet {assignItem, removed} = assignInputItem;\r\n\t\tlet {discription} = assignItem;\r\n\t\tlet cn = 'd-flex py-2 align-items-center';\r\n\t\tlet style:React.CSSProperties;\r\n\t\tlet icon:string, cnIcon:string = 'mx-3 small ';\r\n\t\tif (removed === true) {\r\n\t\t\tcn += ' text-muted';\r\n\t\t\tstyle = {\r\n\t\t\t\ttextDecoration: 'line-through'\r\n\t\t\t}\r\n\t\t\ticon = 'times';\r\n\t\t\tcnIcon += 'text-muted';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ticon = 'circle';\r\n\t\t\tcnIcon += 'text-primary';\r\n\t\t}\r\n\t\treturn <div className={cn} style={style}>\r\n\t\t\t<small><small><FA name={icon} className={cnIcon} fixWidth={true} /></small></small>\r\n\t\t\t<div className=\"flex-fill\">{discription}</div>\r\n\t\t</div>;\r\n\t});\r\n\r\n\tprivate onTodoClick = (assignInputItem: AssignInputItem) => {\r\n\t\t//this.state.assignInputItem = assignInputItem;\r\n\t\t//this.setTimeout();\r\n\t}\r\n\r\n\r\n/*\r\n\tprivate onNewTodo = () => {\r\n\t\tthis.isInputing = true;\r\n\t}\r\n\r\n\tprivate state: {\r\n\t\tref: HTMLInputElement;\r\n\t\tblur: boolean;\r\n\t\tassignInputItem: AssignInputItem;\r\n\t\tremove: boolean;\r\n\t} = {\r\n\t\t\tref: undefined,\r\n\t\t\tblur: false,\r\n\t\t\tassignInputItem: undefined,\r\n\t\t\tremove: false,\r\n\t\t};\r\n\tprivate timeoutHandler: any;\r\n\tprivate setTimeout() {\r\n\t\tif (this.timeoutHandler) clearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(() => {\r\n\t\t\tlet isInputing:boolean;\r\n\t\t\tlet {ref, blur, remove, assignInputItem: todoItem} = this.state;\r\n\t\t\tif (remove === true) {\r\n\t\t\t\tisInputing = false;\r\n\t\t\t}\r\n\t\t\tif (blur === true) {\r\n\t\t\t\tisInputing = false\r\n\t\t\t\tthis.assignInputItem = undefined;\r\n\t\t\t}\r\n\t\t\tif (todoItem !== undefined) {\r\n\t\t\t\tthis.assignInputItem = todoItem;\r\n\t\t\t\tif (todoItem !== undefined) {\r\n\t\t\t\t\tif (this.input) this.input.value = todoItem.assignItem.discription;\r\n\t\t\t\t\tisInputing = true;\r\n\t\t\t\t\tif (this.isInputing === true) this.input.focus();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tisInputing = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ref !== undefined) {\r\n\t\t\t\tthis.input = ref;\r\n\t\t\t\tif (this.input) {\r\n\t\t\t\t\tif (this.assignInputItem) {\r\n\t\t\t\t\t\tthis.input.value = this.assignInputItem.assignItem.discription;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.input.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.state.ref = undefined;\r\n\t\t\tthis.state.blur = false;\r\n\t\t\tthis.state.remove = false;\r\n\t\t\tthis.state.assignInputItem = undefined;\r\n\t\t\tif (isInputing !== undefined) this.isInputing = isInputing;\r\n\t\t}, 200);\r\n\t}\r\n*/\r\n/*\r\n\tprivate refInput = (input:HTMLInputElement) => {\r\n\t\tif (!input) return;\r\n\t\tif (window.getComputedStyle(input).visibility === 'hidden') return;\r\n\t\tthis.input = input;\r\n\t\tthis.state.ref = input;\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onInputBlur = () => {\r\n\t\tthis.state.blur = true;\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onInput = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) this.onEnter();\r\n\t}\r\n\r\n\tprivate onRemove = () => {\r\n\t\tthis.state.remove = true;\r\n\t\tif (this.assignInputItem !== undefined) {\r\n\t\t\tthis.assignInputItem.removed = !this.assignInputItem.removed;\r\n\t\t\tthis.assignInputItem = undefined;\r\n\t\t}\r\n\t\tthis.setTimeout();\r\n\t}\r\n\t*/\r\n/*\r\n\tprivate onEnter = async () => {\r\n\t\tlet inputValue:string = this.input.value.trim();\r\n\t\tlet todo = await this.controller.saveAssignItem(inputValue);\r\n\t\tlet lowerValue = inputValue.toLowerCase();\r\n\t\tlet assignItem = this.assignInputItems.find(v => lowerValue === v.assignItem.discription.toLowerCase());\r\n\t\tif (assignItem !== undefined) {\r\n\t\t\tassignItem.removed = true;\r\n\t\t}\r\n\t\tif (inputValue.length > 0) {\r\n\t\t\tif (this.assignInputItem !== undefined) {\r\n\t\t\t\tthis.assignInputItem.assignItem.discription = this.input.value;\r\n\t\t\t\tthis.assignInputItem = undefined;\r\n\t\t\t\tthis.isInputing = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ti:AssignInputItem = {\r\n\t\t\t\t\tkey: keyFunc, \r\n\t\t\t\t\titemIndex: this.assignInputItems.length + 1,\r\n\t\t\t\t\tassignItem: todo,\r\n\t\t\t\t\tremoved: false,\r\n\t\t\t\t};\r\n\t\t\t\tthis.assignInputItems.push(ti);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.input.value = '';\r\n\t}\r\n*/\r\n/*\r\n\tfooter() {\r\n\t\tlet Footer = observer(() => {\r\n\t\t\treturn  <div className=\"d-flex align-items-center py-1 px-3\">\r\n\t\t\t{\r\n\t\t\t\tthis.isInputing === true?\r\n\t\t\t\t<>\r\n\t\t\t\t\t<input ref={this.refInput} className=\"flex-fill px-1\"\r\n\t\t\t\t\t\ttype=\"text\" \r\n\t\t\t\t\t\tplaceholder=\"事项内容\"\r\n\t\t\t\t\t\tonBlur={this.onInputBlur} \r\n\t\t\t\t\t\tonKeyDown={this.onInput}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={this.onEnter}>\r\n\t\t\t\t\t\t<FA name=\"plus\" />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{this.assignInputItem && <button \r\n\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-primary ml-2\"\r\n\t\t\t\t\t\tonClick={this.onRemove}>\r\n\t\t\t\t\t\t<FA name={this.assignInputItem.removed === true? 'undo' : 'trash'} />\r\n\t\t\t\t\t</button>}\r\n\t\t\t\t</>\r\n\t\t\t\t:\r\n\t\t\t\t<>\r\n\t\t\t\t\t<span className=\"flex-fill text-muted small\">\r\n\t\t\t\t\t\t任务细化为可执行事项\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={this.onNewTodo}>\r\n\t\t\t\t\t\t<FA name=\"plus\" /> 新增事项\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn React.createElement(Footer);\r\n\t}\r\n*/\r\n}\r\n","import React from 'react';\r\nimport { CTask } from \"./CTask\";\r\nimport { VPage, Muted, EasyTime, User, Image, UserView, List, FA } from \"tonva\";\r\nimport { Todo } from 'models';\r\nimport { observer } from 'mobx-react';\r\nimport { parseTodo } from 'tools';\r\nimport { observable } from 'mobx';\r\n\r\ninterface TodoItem {\r\n\ttodo: Todo;\r\n\tremoved: boolean;\r\n}\r\n\r\nexport class VTodoEdit extends VPage<CTask> {\r\n\t@observable private todoItems: TodoItem[];\r\n\r\n\tinit() {\r\n\t\tthis.todoItems = this.controller.task.todos.map(v => {\r\n\t\t\treturn {todo: v, removed: false};\r\n\t\t})\r\n\t}\r\n\theader() {return '增减事项'}\r\n\tcontent() {\r\n\t\tlet {caption, discription, $create, $update, owner} = this.controller.task;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2 bg-light\">\r\n\t\t\t\t<Image className=\"w-2c h-2c my-1\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3\">\r\n\t\t\t\t<div className=\"py-2\"><b>{caption}</b></div>\r\n\t\t\t\t{discription && <div className=\"\">{discription}</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t{this.renderTodoList()}\r\n\t\t\t<div ref={div => this.divBottom = div} />\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderTodoList() {\r\n\t\treturn <List items={this.todoItems} item={{render: this.renderTodo}} />;\r\n\t}\r\n\r\n\tprivate hourText(hour: number):string {\r\n\t\tif (!hour) return;\r\n\t\tlet h = Math.floor(hour / 60);\r\n\t\tlet m = Math.floor(hour % 60);\r\n\t\tlet ret:string; // h + ':' + String(m).substr(1);\r\n\t\tif (h > 0) {\r\n\t\t\tret = h + '时';\r\n\t\t\tif (m > 0) {\r\n\t\t\t\tret += m + '分';\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tret = m + '分钟';\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n\tprivate onTrashTodo = (item:TodoItem) => {\r\n\t\titem.removed = true;\r\n\t}\r\n\tprivate onUndoTodo = (item:TodoItem) => {\r\n\t\titem.removed = false;\r\n\t}\r\n\tprivate renderTodo = (item:TodoItem, index:number) => {\r\n\t\tlet render = observer(() => {\r\n\t\t\tlet {todo, removed} = item;\r\n\t\t\tlet {discription, hour, assignItem} = todo;\r\n\t\t\tlet textColor:string, dotColor:string, vDisp:any, dotIcon:string, actionIcon:string, onClick:()=>void;\r\n\r\n\t\t\tif (removed === false) {\r\n\t\t\t\ttextColor = '';\r\n\t\t\t\tif (assignItem) {\r\n\t\t\t\t\tdotIcon = 'circle';\r\n\t\t\t\t\tdotColor = 'text-primary';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tdotIcon = 'circle-o';\r\n\t\t\t\t\tdotColor = 'text-info';\r\n\t\t\t\t}\r\n\t\t\t\tvDisp = discription;\r\n\t\t\t\tonClick = ()=>this.onTrashTodo(item);\r\n\t\t\t\tactionIcon = 'trash';\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttextColor = 'text-muted';\r\n\t\t\t\tdotIcon = 'times-circle-o';\r\n\t\t\t\tdotColor = '';\r\n\t\t\t\tvDisp = <del>{discription}</del>;\r\n\t\t\t\tonClick = ()=>this.onUndoTodo(item);\r\n\t\t\t\tactionIcon = 'undo';\r\n\t\t\t}\r\n\t\t\treturn <div className={'py-2 d-flex ' + textColor}>\r\n\t\t\t\t<small className=\"align-self-center\"><small><FA name={dotIcon} className={'mx-3 ' + dotColor} fixWidth={true} /></small></small>\r\n\t\t\t\t<div className=\"flex-fill\">{vDisp}</div>\r\n\t\t\t\t{hour && <div className=\"mx-3\">{this.hourText(hour)}</div>}\r\n\t\t\t\t<div className=\"px-3 cursor-pointer\" onClick={onClick}>\r\n\t\t\t\t\t<FA name={actionIcon} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t});\r\n\t\treturn React.createElement(render);\r\n\t}\r\n\tprivate onKeyDown = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) this.onEnter();\r\n\t}\r\n\tprivate onEnter = async () => {\r\n\t\tlet input:HTMLInputElement = document.getElementById('$task-todo-input') as HTMLInputElement;\r\n\t\tif (!input) return;\r\n\t\tlet {task} = this.controller;\r\n\t\tlet {content, hour} = parseTodo(input.value);\r\n\t\tthis.todoItems.push({\r\n\t\t\ttodo: {\r\n\t\t\t\tid: 1,\r\n\t\t\t\ttask: task.id,\r\n\t\t\t\tassignItem: undefined,\r\n\t\t\t\tdiscription: content,\r\n\t\t\t\thour: hour,\r\n\t\t\t\tx: 0,\r\n\t\t\t\t$update: new Date()\r\n\t\t\t},\r\n\t\t\tremoved: false\r\n\t\t});\r\n\t\tinput.value = '';\r\n\t}\r\n\tfooter() {\r\n\t\tlet f = observer(() =><div className=\"bg-light border-top py-2 px-1 d-flex\">\r\n\t\t\t<input id='$task-todo-input' className=\"flex-fill form-control\"\r\n\t\t\t\ttype=\"text\" \r\n\t\t\t\tplaceholder=\"新增事项\"\r\n\t\t\t\tonKeyDown={this.onKeyDown}\r\n\t\t\t\t/>\r\n\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={this.onEnter}>\r\n\t\t\t\t<FA name=\"plus\" />\r\n\t\t\t</button>\r\n\t\t</div>);\r\n\t\treturn React.createElement(f);\r\n\t}\r\n\r\n\tprivate n:number = 1;\r\n\tprivate onSave = () => {\r\n\t\tlet todo: Todo = {\r\n\t\t\tid: 1,\r\n\t\t\ttask: this.controller.task.id,\r\n\t\t\tassignItem: null, \r\n\t\t\tdiscription: 'aaaa' + this.n++,\r\n\t\t\tx: 0,\r\n\t\t\t$update: new Date()\r\n\t\t};\r\n\t\t//this.ddd = true;\r\n\t\tthis.controller.task.todos.push(todo);\r\n\t\tthis.scrollToBottom();\r\n\t}\r\n\r\n\tprivate onDel = () => {\r\n\t\t//this.ddd = false;\r\n\t}\r\n\r\n\tprivate divBottom:HTMLDivElement;\r\n\tprivate scrollToBottom() {\r\n\t\tsetTimeout(() => {\r\n\t\t\tthis.divBottom?.scrollIntoView();\r\n\t\t}, 100);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Muted, EasyTime, UserView, User, useUser, Image, FA } from \"tonva\";\r\nimport { CTask } from \"./CTask\";\r\nimport { Task } from 'models';\r\nimport { EnumTaskState } from '../tapp';\r\nimport { VTodoList } from './VTodoList';\r\nimport { VTodoEdit } from './VTodoEdit';\r\n\r\ninterface Command {\r\n\t//visible: ()=>boolean; //: boolean | IComputedValue<boolean>;\r\n\taction: (cmd: Command) => void;\r\n\trender: (cmd: Command) => JSX.Element;\r\n}\r\n\r\nexport class VTask extends VPage<CTask> {\r\n\tprivate task: Task;\r\n\tprivate vTodoList: VTodoList;\r\n\r\n\tinit() {\r\n\t\tthis.task = this.controller.task;\r\n\t\tthis.vTodoList = new VTodoList(this.controller);\r\n\t\tthis.vTodoList.init(this.task.todos, false);\r\n\t\tuseUser(this.task.assign.owner);\r\n\t}\r\n\r\n\trefreshTodos() {\r\n\t\tthis.vTodoList.init(this.task.todos, false);\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '任务';\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet {caption, discription, $create, $update, owner} = this.task;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2 bg-light\">\r\n\t\t\t\t<Image className=\"w-2c h-2c my-1\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3\">\r\n\t\t\t\t<div className=\"py-2\"><b>{caption}</b></div>\r\n\t\t\t\t{discription && <div className=\"\">{discription}</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"pt-3\">\r\n\t\t\t\t{this.vTodoList.render()}\r\n\t\t\t</div>\r\n\r\n\t\t\t{/*this.renderState()*/}\r\n\t\t\t{this.renderCommands()}\r\n\t\t</div>;\r\n\t}\r\n\t\r\n\t//@observable private step:EnumTaskStep = EnumTaskStep.author;\r\n\t//@observable private state:EnumTaskState = EnumTaskState.todo;\r\n\r\n\t// 已领办\r\n\tprivate onCmdDone = (cmd:Command) => {\r\n\t\t//this.state = EnumTaskState.start;\r\n\t\tthis.controller.showTaskDone();\r\n\t}\r\n\tprivate cmdDone: Command = {\r\n\t\t//visible: () => {return this.state !== EnumTaskState.start},\r\n\t\taction: this.onCmdDone,\r\n\t\trender: cmd => {\r\n\t\t\tlet {action} = cmd;\r\n\t\t\treturn <button className=\"btn btn-primary\" onClick={()=>action(cmd)}>\r\n\t\t\t\t办理\r\n\t\t\t\t<FA className=\"ml-2\" name=\"angle-right\" />\r\n\t\t\t</button>;\r\n\t\t}\r\n\t};\r\n\r\n\t/*\r\n\tprivate cmdComment: Command = {\r\n\t\t//visible: () => true,\r\n\t\taction: this.onCmdComment,\r\n\t\trender: cmd => {\r\n\t\t\tlet {action} = cmd;\r\n\t\t\treturn <div onClick={()=>action(cmd)}><FA name=\"commenting-o\" /> 评论</div>\r\n\t\t}\r\n\t};\r\n\t*/\r\n\r\n\tprivate onCmdDo = () => {\r\n\t\tthis.controller.showTaskDone();\r\n\t}\r\n\tprivate renderCmdDone():JSX.Element {\r\n\t\tif (this.task.state === EnumTaskState.todo) {\r\n\t\t\treturn <button className=\"btn btn-primary\" onClick={this.onCmdDo}>\r\n\t\t\t\t办理\r\n\t\t\t\t<FA className=\"ml-2\" name=\"angle-right\" />\r\n\t\t\t</button>;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onCmdCheck = () => {\r\n\t\tthis.controller.showTaskCheck();\r\n\t}\r\n\tprivate renderCmdCheck():JSX.Element {\r\n\t\tif (this.task.state === EnumTaskState.done) {\r\n\t\t\treturn <button className=\"btn btn-primary\" onClick={this.onCmdCheck}>\r\n\t\t\t\t查验\r\n\t\t\t\t<FA className=\"ml-2\" name=\"angle-right\" />\r\n\t\t\t</button>;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onCmdRate = () => {\r\n\t\tthis.controller.showTaskRate();\r\n\t}\r\n\tprivate renderCmdRate():JSX.Element {\r\n\t\tif (this.task.state === EnumTaskState.pass) {\r\n\t\t\treturn <button className=\"btn btn-primary\" onClick={this.onCmdRate}>\r\n\t\t\t\t评分\r\n\t\t\t\t<FA className=\"ml-2\" name=\"angle-right\" />\r\n\t\t\t</button>;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tprivate onCmdEditTodos = () => {\r\n\t\t// this.controller.showTodoEdit();\r\n\t\tthis.openVPage(VTodoEdit, undefined, async () => {\r\n\t\t\tthis.refreshTodos();\r\n\t\t\treturn;\r\n\t\t});\r\n\r\n\t}\r\n\tprivate renderCmdEditTodos():JSX.Element {\r\n\t\tif (this.task.state === EnumTaskState.todo) {\r\n\t\t\treturn <div className=\"cursor-pointer\" onClick={this.onCmdEditTodos}>\r\n\t\t\t\t<FA name=\"pencil-square-o\" /> 增减事项\t\t\t\r\n\t\t\t</div>;\r\n\t\t}\r\n\t}\r\n\r\n\tprivate onCmdComment = () => {\r\n\t\talert('评论正在实现中...');\r\n\t}\r\n\tprivate renderCmdComment():JSX.Element {\r\n\t\treturn <div className=\"cursor-pointer\" onClick={this.onCmdComment}><FA name=\"commenting-o\" /> 评论</div>\r\n\t}\r\n\r\n\tprivate gap():JSX.Element {\r\n\t\treturn <div className=\"ml-3 border-left\" />;\r\n\t}\r\n\r\n\tprivate renderCommands():JSX.Element {\r\n\t\tlet divCmds:any[] = [\r\n\t\t\tthis.renderCmdDone(),\r\n\t\t\tthis.renderCmdCheck(),\r\n\t\t\tthis.renderCmdRate(),\r\n\t\t];\r\n\t\tlet first = true;\r\n\t\treturn <div className=\"px-3 py-2 d-flex align-items-end\">\r\n\t\t\t{divCmds.map((v, index) => {\r\n\t\t\t\tif (!v) return null;\r\n\t\t\t\tlet gap:any;\r\n\t\t\t\tif (first === false) {\r\n\t\t\t\t\tgap = this.gap();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tfirst = false;\r\n\t\t\t\t}\r\n\t\t\t\treturn <React.Fragment key={index}>\r\n\t\t\t\t\t{gap}{v}\r\n\t\t\t\t</React.Fragment>;\r\n\t\t\t})}\r\n\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t{this.renderCmdEditTodos()}\r\n\t\t\t{this.gap()}\r\n\t\t\t{this.renderCmdComment()}\r\n\t\t</div>;\r\n\t};\r\n\r\n\t/*\r\n\tprivate renderState() {\r\n\t\tlet {state} = this.task;\r\n\t\tlet divState:any;\r\n\t\tswitch (state) {\r\n\t\t\tcase EnumTaskState.start: divState = this.renderStart(); break;\r\n\t\t\tcase EnumTaskState.todo: divState = this.renderTodo(); break;\r\n\t\t\tcase EnumTaskState.pass: divState = this.renderPass(); break;\r\n\t\t\tcase EnumTaskState.fail: divState = this.renderFail(); break;\r\n\t\t}\r\n\t\tif (!divState) return;\r\n\t\treturn <div className=\"px-3\">\r\n\t\t\t{divState}\r\n\t\t</div>\r\n\t}\r\n\r\n\tprivate onRate = () => {\r\n\t\talert('评分');\r\n\t}\r\n\r\n\tprivate renderStart() {\r\n\t\treturn <button className=\"btn btn-success\" onClick={this.onTodo}>领办</button>\r\n\t}\r\n\r\n\tprivate renderTodo() {\r\n\t\treturn <>\r\n\t\t\t\r\n\t\t</>;\r\n\t}\r\n\r\n\tprivate renderPass() {\r\n\t\treturn <button className=\"btn btn-success\" onClick={this.onRate}>评分</button>;\r\n\t}\r\n\r\n\tprivate renderFail() {\r\n\t\treturn <button className=\"btn btn-success\" onClick={this.onTodo}>不知道怎么办</button>;\r\n\t}\r\n\t*/\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Muted, EasyTime, UserView, User, useUser, Image, FA } from \"tonva\";\r\nimport { CTask } from \"./CTask\";\r\nimport { Task } from 'models';\r\nimport { VTodoList } from './VTodoList';\r\n\r\nexport class VTaskDone extends VPage<CTask> {\r\n\tprivate task: Task;\r\n\tprivate vTodoList: VTodoList;\r\n\r\n\tinit() {\r\n\t\tthis.task = this.controller.task;\r\n\t\tthis.vTodoList = new VTodoList(this.controller);\r\n\t\tthis.vTodoList.init(this.task.todos, false);\r\n\t\tuseUser(this.task.assign.owner);\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '办理';\r\n\t}\r\n\r\n\tprivate onDone = async () => {\r\n\t\tawait this.controller.doneTask();\r\n\t\tthis.closePage(3);\r\n\t}\r\n\r\n\tprivate renderUser = (user: User) => {\r\n\t\tlet {icon, name, nick} = user;\r\n\t\treturn <><Image className=\"w-1-5c h-1-5c\" src={icon} /> &nbsp; {nick || name}</>;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet {caption, discription, $create, $update, owner} = this.task;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2 bg-light\">\r\n\t\t\t\t<Image className=\"w-2c h-2c\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3\">\r\n\t\t\t\t<div className=\"py-2\"><b>{caption}</b></div>\r\n\t\t\t\t{discription && <div className=\"\">{discription}</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"pt-3\">\r\n\t\t\t\t{this.vTodoList.render()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-flex align-items-center px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-success\" onClick={this.onDone}><FA name=\"paper-plane-o\" /> &nbsp; 完成</button>\r\n\t\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t\t<button className=\"btn btn-outline-warning\">不办</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\t\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Muted, EasyTime, UserView, User, useUser, Image, FA } from \"tonva\";\r\nimport { CTask } from \"./CTask\";\r\nimport { Task } from 'models';\r\nimport { VTodoList } from './VTodoList';\r\n\r\nexport class VTaskCheck extends VPage<CTask> {\r\n\tprivate task: Task;\r\n\tprivate vTodoList: VTodoList;\r\n\r\n\tinit() {\r\n\t\tthis.task = this.controller.task;\r\n\t\tthis.vTodoList = new VTodoList(this.controller);\r\n\t\tthis.vTodoList.init(this.task.todos, false);\r\n\t\tuseUser(this.task.assign.owner);\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '查验';\r\n\t}\r\n\r\n\tprivate onPass = async () => {\r\n\t\tawait this.controller.passTask();\r\n\t\tthis.closePage(2);\r\n\t}\r\n\r\n\tprivate onFail = async () => {\r\n\t\tawait this.controller.failTask();\r\n\t\tthis.closePage(3);\r\n\t}\r\n\r\n\tprivate renderUser = (user: User) => {\r\n\t\tlet {icon, name, nick} = user;\r\n\t\treturn <><Image className=\"w-1-5c h-1-5c\" src={icon} /> &nbsp; {nick || name}</>;\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet {caption, discription, $create, $update, owner} = this.task;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2 bg-light\">\r\n\t\t\t\t<Image className=\"w-2c h-2c\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3\">\r\n\t\t\t\t<div className=\"py-2\"><b>{caption}</b></div>\r\n\t\t\t\t{discription && <div className=\"\">{discription}</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"pt-3\">\r\n\t\t\t\t{this.vTodoList.render()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-flex align-items-center px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-success\" onClick={this.onPass}>\r\n\t\t\t\t\t<FA className=\"mr-2\" name=\"check-circle\" /> 通过\r\n\t\t\t\t</button>\r\n\t\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t\t<button className=\"btn btn-outline-danger\" onClick={this.onFail}>\r\n\t\t\t\t\t<FA className=\"mr-2\" name=\"times-circle\" /> 不过\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\t\r\n\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Muted, EasyTime, UserView, User, useUser, Image, FA } from \"tonva\";\r\nimport { CTask } from \"./CTask\";\r\nimport { Task } from 'models';\r\nimport { VTodoList } from './VTodoList';\r\n\r\nexport class VTaskRate extends VPage<CTask> {\r\n\tprivate task: Task;\r\n\tprivate vTodoList: VTodoList;\r\n\r\n\tinit() {\r\n\t\tthis.task = this.controller.task;\r\n\t\tthis.vTodoList = new VTodoList(this.controller);\r\n\t\tthis.vTodoList.init(this.task.todos, false);\r\n\t\tuseUser(this.task.assign.owner);\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '评价';\r\n\t}\r\n\r\n\tprivate onRate = async () => {\r\n\t\tawait this.controller.rateTask();\r\n\t\tthis.closePage(2);\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet {caption, discription, $create, $update, owner} = this.task;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2 bg-light\">\r\n\t\t\t\t<Image className=\"w-2c h-2c\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3\">\r\n\t\t\t\t<div className=\"py-2\"><b>{caption}</b></div>\r\n\t\t\t\t{discription && <div className=\"\">{discription}</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className=\"pt-3\">\r\n\t\t\t\t{this.vTodoList.render()}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"d-flex align-items-center px-3 py-2\">\r\n\t\t\t\t<button className=\"btn btn-success\" onClick={this.onRate}>\r\n\t\t\t\t\t<FA className=\"mr-2\" name=\"check-circle\" /> 评价\r\n\t\t\t\t</button>\r\n\t\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t\t/*<button className=\"btn btn-outline-danger\" onClick={this.onFail}>\r\n\t\t\t<FA className=\"mr-2\" name=\"times-circle\" /> 不过\r\n\t\t</button>*/\r\n}\r\n\t\r\n\r\n}\r\n","import _ from 'lodash';\r\nimport { observable } from 'mobx';\r\nimport { CUqBase } from \"../tapp\";\r\nimport { VMyTasks } from \"./VMyTasks\";\r\nimport { QueryPager } from \"tonva\";\r\nimport { VTask } from \"./VTask\";\r\nimport { Task, Assign, AssignTask } from \"../models\";\r\nimport { Performance, EnumTaskStep } from '../tapp'\r\nimport { VTaskDone } from './VTaskDone';\r\nimport { VTaskCheck } from './VTaskCheck';\r\nimport { VTaskRate } from './VTaskRate';\r\nimport { VTodoEdit } from './VTodoEdit';\r\n\r\nexport class CTask extends CUqBase {\r\n\tprivate performance: Performance;\r\n\r\n\tpublishAssignCallback:(assign:Assign)=>Promise<void>;\r\n\tmyTasksPager: QueryPager<AssignTask>;\r\n\t@observable task: Task;\r\n\t@observable assign: Assign;\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.performance = this.uqs.performance;\r\n\t\tthis.myTasksPager = new QueryPager(this.performance.GetMyTaskArchive, 10, 30, true);\r\n\t}\r\n\r\n\tasync loadTaskArchive(step: EnumTaskStep) {\r\n\t\tthis.myTasksPager.reset();\r\n\t\tawait this.myTasksPager.first({step});\r\n\t}\r\n\r\n\tasync showMyTasks() {\r\n\t\tawait this.myTasksPager.first({});\r\n\t\tthis.openVPage(VMyTasks);\r\n\t}\r\n\r\n\tasync showTask(taskId:number) {\r\n\t\tlet retTask = await this.performance.GetTask.query({taskId});\r\n\t\tlet task:Task = {} as any;\r\n\t\t_.mergeWith(task, retTask.task[0]);\r\n\t\ttask.todos = retTask.todos;\r\n\t\ttask.flow = retTask.flow;\r\n\t\ttask.meTask = retTask.meTask;\r\n\t\tthis.task = task;\r\n\t\tthis.openVPage(VTask);\r\n\t}\r\n\r\n\tasync showTaskDone() {\r\n\t\tthis.openVPage(VTaskDone);\r\n\t}\r\n\t\r\n\tasync doneTask() {\r\n\t\tlet ret = await this.performance.TaskDone.submit({taskId: this.task.id});\r\n\t\tthis.cApp.refreshJob();\r\n\t\tthis.cApp.pushTaskNote(ret);\r\n\t}\r\n\r\n\tasync showTaskCheck() {\r\n\t\tthis.openVPage(VTaskCheck);\r\n\t}\r\n\r\n\tasync passTask() {\r\n\t\tlet ret = await this.performance.TaskPass.submit({taskId: this.task.id});\r\n\t\tthis.cApp.refreshJob();\r\n\t\tthis.cApp.pushTaskNote(ret);\r\n\t}\r\n\r\n\tasync failTask() {\r\n\t\tlet ret = await this.performance.TaskFail.submit({taskId: this.task.id});\r\n\t\tthis.cApp.refreshJob();\r\n\t\tthis.cApp.pushTaskNote(ret);\r\n\t}\r\n\r\n\tasync showTaskRate() {\r\n\t\tthis.openVPage(VTaskRate);\r\n\t}\r\n\r\n\tasync rateTask() {\r\n\t\tlet ret = await this.performance.TaskRate.submit({taskId: this.task.id});\r\n\t\tthis.cApp.refreshJob();\r\n\t\tthis.cApp.pushTaskNote(ret);\r\n\t}\r\n\t/*\r\n\tsaveAssignItem = async (todoContent: string):Promise<any> => {\r\n\t\tlet assignItem = {\r\n\t\t\tid: undefined as any,\r\n\t\t\tassign: this.assign.id,\r\n\t\t\tstate: 0,\r\n\t\t\tdiscription: todoContent,\r\n\t\t};\r\n\t\tlet ret = await this.performance.AssignItem.save(undefined, assignItem);\r\n\t\tassignItem.id = ret.id;\r\n\t\treturn assignItem;\r\n\t}\r\n\r\n\tsaveAssignProp = async (prop:string, value:any) => {\r\n\t\tawait this.performance.Assign.saveProp(this.assign.id, prop, value);\r\n\t}\r\n\t*/\r\n\r\n\tshowTodoEdit = async () => {\r\n\t\tthis.openVPage(VTodoEdit, undefined, ret => {\r\n\t\t\t\r\n\t\t});\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { CAssign } from './CAssign';\r\nimport { VPage, List, EasyTime, Muted, UserView, User, FA, QueryPager } from 'tonva';\r\nimport { Assign, AssignTask } from 'models';\r\nimport { stateText } from 'tapp';\r\n\r\nexport class VMyAssigns extends VPage<CAssign> {\r\n\tprivate archived: 0|1;\r\n\tprivate myAssignsPager: QueryPager<Assign>;\r\n\r\n\tinit({myAssignsPager, archived}:{myAssignsPager: QueryPager<Assign>; archived:0|1;}) {\r\n\t\tthis.archived = archived;\r\n\t\tthis.myAssignsPager = myAssignsPager;\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn this.archived===1? '已归档作业':'作业';\r\n\t}\r\n\r\n\tright() {\r\n\t\tif (this.archived === 1) return;\r\n\t\treturn <button className=\"btn btn-sm btn-primary mr-2 align-self-center\" onClick={()=>this.controller.showMyAssignsArchived()}>已归档</button>;\r\n\t}\r\n\r\n\tprivate renderItem = (assign:Assign, index:number) => {\r\n\t\tlet {caption, discription, $update, tasks} = assign;\r\n\t\treturn <div className=\"py-3 px-3\">\r\n\t\t\t<div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<b>{caption}</b> \r\n\t\t\t\t\t&nbsp; {discription}\r\n\t\t\t\t</div>\r\n\t\t\t\t{this.renderAssignTasks(tasks)}\r\n\t\t\t</div>\r\n\t\t\t<div className=\"flex-fill\"></div>\r\n\t\t\t<div>\r\n\t\t\t\t<Muted><EasyTime date={$update} /></Muted>\r\n\t\t\t</div>\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderUser = (user: User) => {\r\n\t\tlet {name, nick} = user;\r\n\t\treturn <span className=\"text-info\">{nick || name}</span>;\r\n\t}\r\n\r\n\tprivate renderAssignTasks(tasks: AssignTask[]) {\r\n\t\tif (tasks === undefined || tasks.length === 0) return;\r\n\t\treturn <div>\r\n\t\t\t{tasks.map((v, index) => {\r\n\t\t\t\t// eslint-disable-next-line\r\n\t\t\t\tlet {assign, worker, state, date} = v;\r\n\t\t\t\tlet {text, act} = stateText(state);\r\n\t\t\t\treturn <div key={index} className=\"small\">\r\n\t\t\t\t\t<FA className=\"text-danger mr-1\" name=\"chevron-circle-right\" />\r\n\t\t\t\t\t<span className=\"text-primary\">{text}</span> &nbsp;\r\n\t\t\t\t\t<UserView user={worker} render={this.renderUser} /> &nbsp;\r\n\t\t\t\t\t{act} &nbsp; <EasyTime date={date} />\r\n\t\t\t\t</div>\r\n\t\t\t})}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate onAssignClick = (assign:Assign) => {\r\n\t\tthis.controller.showAssign(assign.id);\r\n\t}\r\n\r\n\t/*\r\n\tprivate cnTabSelected = (selected:boolean) => classNames({\r\n\t\t\"bg-white border border-success\":selected,\r\n\t\t\"border\":!selected,\r\n\t},  'cursor-pointer px-4 py-2 rounded');\r\n\tprivate tabs:TabProp[] = [\r\n\t\t{\r\n\t\t\tname: 'cur',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>未完</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myAssignsPager} \r\n\t\t\t\t\titem={{render: this.renderItem, onClick: this.onAssignClick}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadAssigns(0),\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: 'archive',\r\n\t\t\tcaption: (selected) => <div className={this.cnTabSelected(selected)}>归档</div>,\r\n\t\t\tcontent: () => <div>\r\n\t\t\t\t<List items={this.controller.myAssignsPager} \r\n\t\t\t\t\titem={{render: this.renderItem, onClick: this.onAssignClick}} />\r\n\t\t\t</div>,\r\n\t\t\tonShown: () => this.controller.loadAssigns(1),\r\n\t\t},\r\n\t];\r\n\t*/\r\n\r\n\tcontent() {\r\n\t\t// return <Tabs tabs={this.tabs} tabPosition=\"top\" size=\"sm\" /> \r\n\t\treturn <List items={this.myAssignsPager} \r\n\t\t\titem={{render: this.renderItem, onClick: this.onAssignClick}} />;\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { observer } from 'mobx-react';\r\nimport { observable } from 'mobx';\r\nimport { View, FA, List } from \"tonva\";\r\nimport { CAssign } from \"./CAssign\";\r\nimport { AssignItem } from 'models';\r\n\r\ninterface AssignInputItem {\r\n\tkey: (ti: AssignInputItem) => any; // {return this.orderId};\r\n\titemIndex: number;\r\n\tassignItem: AssignItem;\r\n\tremoved: boolean;\r\n}\r\n\r\nfunction keyFunc(ti:AssignInputItem) {\r\n\treturn ti.itemIndex;\r\n}\r\n\r\nexport class VAssignItems extends View<CAssign> {\r\n\tprivate allowEdit: boolean = false;\r\n\t@observable private assignInputItems: AssignInputItem[] = [];\r\n\t@observable private assignInputItem: AssignInputItem;\r\n\t@observable private isInputing = false;\r\n\tprivate input: HTMLInputElement;\r\n\r\n\tinit(items: AssignItem[], allowEdit:boolean = true) {\r\n\t\tthis.allowEdit = allowEdit;\r\n\t\titems.forEach((v, index) => {\r\n\t\t\tthis.assignInputItems.push({\r\n\t\t\t\tkey: keyFunc,\r\n\t\t\t\titemIndex: index + 1,\r\n\t\t\t\tassignItem: v,\r\n\t\t\t\tremoved: false,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\trender():JSX.Element {\r\n\t\tlet list:any;\r\n\t\tif (this.assignInputItems.length > 0) {\r\n\t\t\tlist = <>\r\n\t\t\t\t<div className=\"border-bottom\">\r\n\t\t\t\t\t<div className=\"mx-3 mb-1 small text-muted\">事项</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<List items={this.assignInputItems}\r\n\t\t\t\t\titem={{\r\n\t\t\t\t\t\trender: this.renderTodo, \r\n\t\t\t\t\t\tonClick:this.allowEdit===true ? this.onTodoClick : undefined\r\n\t\t\t\t}} />\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn list;\r\n}\r\n\r\n\tprivate renderTodo = (assignInputItem:AssignInputItem, index:number) => {\r\n\t\treturn React.createElement(this.observableTodo, {assignInputItem});\r\n\t}\r\n\r\n\tprivate observableTodo = observer(({assignInputItem}: {assignInputItem:AssignInputItem}) => {\r\n\t\tlet {assignItem, removed} = assignInputItem;\r\n\t\tlet {discription} = assignItem;\r\n\t\tlet cn = 'd-flex py-2 align-items-center';\r\n\t\tlet style:React.CSSProperties;\r\n\t\tlet icon:string, cnIcon:string = 'mx-3 small ';\r\n\t\tif (removed === true) {\r\n\t\t\tcn += ' text-muted';\r\n\t\t\tstyle = {\r\n\t\t\t\ttextDecoration: 'line-through'\r\n\t\t\t}\r\n\t\t\ticon = 'times';\r\n\t\t\tcnIcon += 'text-muted';\r\n\t\t}\r\n\t\telse {\r\n\t\t\ticon = 'circle';\r\n\t\t\tcnIcon += 'text-primary';\r\n\t\t}\r\n\t\treturn <div className={cn} style={style}>\r\n\t\t\t<small><small><FA name={icon} className={cnIcon} fixWidth={true} /></small></small>\r\n\t\t\t<div className=\"flex-fill\">{discription}</div>\r\n\t\t</div>;\r\n\t});\r\n\r\n\tprivate onTodoClick = (assignInputItem: AssignInputItem) => {\r\n\t\tthis.state.assignInputItem = assignInputItem;\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onNewTodo = () => {\r\n\t\tthis.isInputing = true;\r\n\t}\r\n\r\n\tprivate state: {\r\n\t\tref: HTMLInputElement;\r\n\t\tblur: boolean;\r\n\t\tassignInputItem: AssignInputItem;\r\n\t\tremove: boolean;\r\n\t} = {\r\n\t\t\tref: undefined,\r\n\t\t\tblur: false,\r\n\t\t\tassignInputItem: undefined,\r\n\t\t\tremove: false,\r\n\t\t};\r\n\tprivate timeoutHandler: any;\r\n\tprivate setTimeout() {\r\n\t\tif (this.timeoutHandler) clearTimeout(this.timeoutHandler);\r\n\t\tthis.timeoutHandler = setTimeout(() => {\r\n\t\t\tlet isInputing:boolean;\r\n\t\t\tlet {ref, blur, remove, assignInputItem: todoItem} = this.state;\r\n\t\t\tif (remove === true) {\r\n\t\t\t\tisInputing = false;\r\n\t\t\t}\r\n\t\t\tif (blur === true) {\r\n\t\t\t\tisInputing = false\r\n\t\t\t\tthis.assignInputItem = undefined;\r\n\t\t\t}\r\n\t\t\tif (todoItem !== undefined) {\r\n\t\t\t\tthis.assignInputItem = todoItem;\r\n\t\t\t\tif (todoItem !== undefined) {\r\n\t\t\t\t\tif (this.input) this.input.value = todoItem.assignItem.discription;\r\n\t\t\t\t\tisInputing = true;\r\n\t\t\t\t\tif (this.isInputing === true) this.input.focus();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tisInputing = false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (ref !== undefined) {\r\n\t\t\t\tthis.input = ref;\r\n\t\t\t\tif (this.input) {\r\n\t\t\t\t\tif (this.assignInputItem) {\r\n\t\t\t\t\t\tthis.input.value = this.assignInputItem.assignItem.discription;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.input.focus();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.state.ref = undefined;\r\n\t\t\tthis.state.blur = false;\r\n\t\t\tthis.state.remove = false;\r\n\t\t\tthis.state.assignInputItem = undefined;\r\n\t\t\tif (isInputing !== undefined) this.isInputing = isInputing;\r\n\t\t}, 200);\r\n\t}\r\n\r\n\tprivate refInput = (input:HTMLInputElement) => {\r\n\t\tif (!input) return;\r\n\t\tif (window.getComputedStyle(input).visibility === 'hidden') return;\r\n\t\tthis.input = input;\r\n\t\tthis.state.ref = input;\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onInputBlur = () => {\r\n\t\tthis.state.blur = true;\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onInput = (evt:React.KeyboardEvent<HTMLInputElement>) => {\r\n\t\tif (evt.keyCode === 13) this.onEnter();\r\n\t}\r\n\r\n\tprivate onRemove = () => {\r\n\t\tthis.state.remove = true;\r\n\t\tif (this.assignInputItem !== undefined) {\r\n\t\t\tthis.assignInputItem.removed = !this.assignInputItem.removed;\r\n\t\t\tthis.assignInputItem = undefined;\r\n\t\t}\r\n\t\tthis.setTimeout();\r\n\t}\r\n\r\n\tprivate onEnter = async () => {\r\n\t\tlet inputValue:string = this.input.value.trim();\r\n\t\tlet todo = await this.controller.saveAssignItem(inputValue);\r\n\t\tlet lowerValue = inputValue.toLowerCase();\r\n\t\tlet assignItem = this.assignInputItems.find(v => lowerValue === v.assignItem.discription.toLowerCase());\r\n\t\tif (assignItem !== undefined) {\r\n\t\t\tassignItem.removed = true;\r\n\t\t}\r\n\t\tif (inputValue.length > 0) {\r\n\t\t\tif (this.assignInputItem !== undefined) {\r\n\t\t\t\tthis.assignInputItem.assignItem.discription = this.input.value;\r\n\t\t\t\tthis.assignInputItem = undefined;\r\n\t\t\t\tthis.isInputing = false;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tlet ti:AssignInputItem = {\r\n\t\t\t\t\tkey: keyFunc, \r\n\t\t\t\t\titemIndex: this.assignInputItems.length + 1,\r\n\t\t\t\t\tassignItem: todo,\r\n\t\t\t\t\tremoved: false,\r\n\t\t\t\t};\r\n\t\t\t\tthis.assignInputItems.push(ti);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.input.value = '';\r\n\t}\r\n\r\n\tfooter() {\r\n\t\tlet Footer = observer(() => {\r\n\t\t\treturn  <div className=\"d-flex align-items-center py-1 px-3\">\r\n\t\t\t{\r\n\t\t\t\tthis.isInputing === true?\r\n\t\t\t\t<>\r\n\t\t\t\t\t<input ref={this.refInput} className=\"flex-fill px-1\"\r\n\t\t\t\t\t\ttype=\"text\" \r\n\t\t\t\t\t\tplaceholder=\"事项内容\"\r\n\t\t\t\t\t\tonBlur={this.onInputBlur} \r\n\t\t\t\t\t\tonKeyDown={this.onInput}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={this.onEnter}>\r\n\t\t\t\t\t\t<FA name=\"plus\" />\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t{this.assignInputItem && <button \r\n\t\t\t\t\t\tclassName=\"btn btn-sm btn-outline-primary ml-2\"\r\n\t\t\t\t\t\tonClick={this.onRemove}>\r\n\t\t\t\t\t\t<FA name={this.assignInputItem.removed === true? 'undo' : 'trash'} />\r\n\t\t\t\t\t</button>}\r\n\t\t\t\t</>\r\n\t\t\t\t:\r\n\t\t\t\t<>\r\n\t\t\t\t\t<span className=\"flex-fill text-muted small\">\r\n\t\t\t\t\t\t任务细化为可执行事项\r\n\t\t\t\t\t</span>\r\n\t\t\t\t\t<button className=\"btn btn-sm btn-outline-primary\" onClick={this.onNewTodo}>\r\n\t\t\t\t\t\t<FA name=\"plus\" /> 新增事项\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</>\r\n\t\t\t}\r\n\t\t\t</div>;\r\n\t\t});\r\n\t\treturn React.createElement(Footer);\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, ItemSchema, StringSchema, UiSchema, UiTextItem, UiTextAreaItem, Edit, Schema, Context } from \"tonva\";\r\nimport { CAssign } from \"./CAssign\";\r\nimport { observer } from 'mobx-react';\r\nimport { VAssignItems } from './VAssignItems';\r\n\r\nexport class VAssignEdit extends VPage<CAssign> {\r\n\tprivate vAssignItems: VAssignItems;\r\n\r\n\tinit()\r\n\t{\r\n\t\tthis.vAssignItems = new VAssignItems(this.controller);\r\n\t\tthis.vAssignItems.init(this.controller.assign.items);\r\n\t}\r\n\r\n\tprivate onDiscriptionChanged = (context:Context, value:any, prev:any):Promise<void> => {\r\n\t\treturn;\r\n\t}\r\n\tprivate onEditItemChanged = async (itemSchema: ItemSchema, value:any, prev:any):Promise<void> => {\r\n\t\tawait this.controller.saveAssignProp(itemSchema.name, value);\r\n\t\treturn;\r\n\t}\r\n\r\n\tprivate onPublishTask = async () => {\r\n\t\tawait this.controller.publishAssign();\r\n\t\tthis.closePage();\r\n\t}\r\n\tprivate schema:Schema = [\r\n\t\t{name:'caption', type:'string'} as StringSchema,\r\n\t\t{name:'discription', type:'string'} as StringSchema,\r\n\t];\r\n\tprivate uiSchema:UiSchema = {\r\n\t\titems: {\r\n\t\t\tcaption: {widget: 'text', label: '任务主题', labelHide: true} as UiTextItem,\r\n\t\t\tdiscription: {\r\n\t\t\t\twidget: 'textarea', \r\n\t\t\t\tlabel: '任务说明', labelHide: true,\r\n\t\t\t\tTemplet: (value:any) => <>{value}</>,\r\n\t\t\t\tonChanged: this.onDiscriptionChanged\r\n\t\t\t} as UiTextAreaItem,\r\n\t\t}\r\n\t};\r\n\theader() {\r\n\t\treturn '新任务';\r\n\t}\r\n\tright() {\r\n\t\treturn <button className=\"btn btn-sm btn-success mr-1\" onClick={this.onPublishTask}>发布</button>;\r\n\t}\r\n\tfooter() {\r\n\t\treturn this.vAssignItems.footer();\r\n\t}\r\n\r\n\tcontent() {\r\n\t\tlet Content = observer(() => {\r\n\t\t\tlet {assign} = this.controller;\r\n\t\t\treturn <>\r\n\t\t\t\t<div className=\"mb-3\"></div>\r\n\t\t\t\t<Edit schema={this.schema} uiSchema={this.uiSchema} data={assign} \r\n\t\t\t\t\tonItemChanged={this.onEditItemChanged} />\r\n\t\t\t\t{this.vAssignItems.render()}\r\n\t\t\t</>;\r\n\t\t});\r\n\t\treturn <Content />;\r\n\t}\r\n}\r\n","import * as React from 'react';\r\nimport { VPage, Form, ItemSchema, StringSchema, ButtonSchema, UiSchema, UiButton, Context, UiTextItem } from \"tonva\";\r\nimport { CAssign } from \"./CAssign\";\r\nimport { VAssignEdit } from './VAssignEdit';\r\n\r\nexport class VAssignNew extends VPage<CAssign> {\r\n\tprivate onNewAssign = async (button:string, context:Context) => {\r\n\t\tlet {caption} = context.data;\r\n\t\tawait this.controller.newAssign(caption);\r\n\t\tthis.closePage();\r\n\t\tthis.openVPage(VAssignEdit);\r\n\t}\r\n\r\n\tprivate schema:ItemSchema[] = [\r\n\t\t{name: 'caption', type: 'string', required: true} as StringSchema,\r\n\t\t{name: 'submit', type: 'submit'} as ButtonSchema,\r\n\t];\r\n\tprivate uiSchema: UiSchema = {\r\n\t\titems: {\r\n\t\t\tcaption: {\r\n\t\t\t\twidget: 'text',\r\n\t\t\t\tlabel: '主题',\r\n\t\t\t} as UiTextItem,\r\n\t\t\tsubmit: {\r\n\t\t\t\twidget: 'button',\r\n\t\t\t\tlabel: '下一步',\r\n\t\t\t\tclassName: 'btn btn-primary',\r\n\t\t\t} as UiButton,\r\n\t\t}\r\n\t}\r\n\theader() {\r\n\t\treturn '新任务';\r\n\t}\r\n\tcontent() {\r\n\t\treturn <Form className=\"p-3\" \r\n\t\t\tonButtonClick={this.onNewAssign}\r\n\t\t\tonEnter={this.onNewAssign}\r\n\t\t\tschema={this.schema}\r\n\t\t\tuiSchema={this.uiSchema}\r\n\t\t\tfieldLabelSize={2} />;\r\n\t}\r\n\tprotected get back():'close' | 'back' | 'none' {\r\n\t\treturn 'close';\r\n\t}\r\n\tprotected afterBack = () => {\r\n\t\tthis.returnCall(false);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VPage, UserView, User, Image, Muted, EasyTime, FA } from 'tonva';\r\nimport { CAssign } from './CAssign';\r\nimport { Assign } from 'models';\r\n\r\nexport class VAssign extends VPage<CAssign> {\r\n\tprivate assign:Assign;\r\n\r\n\tinit() {\r\n\t\tthis.assign = this.controller.assign;\r\n\t}\r\n\r\n\tprivate onTakeAssign = () => {\r\n\t\tthis.controller.takeAssign();\r\n\t}\r\n\r\n\theader() {\r\n\t\treturn '作业';\r\n\t}\r\n\r\n\tcontent():JSX.Element {\r\n\t\tlet {caption, discription, owner, $create, $update} = this.assign;\r\n\t\tlet spanUpdate:any;\r\n\t\tif ($update.getTime() - $create.getTime() > 6*3600*1000) {\r\n\t\t\tspanUpdate = <><Muted>更新:</Muted> <EasyTime date={$update} /></>;\r\n\t\t}\r\n\t\tlet renderTop = (user:User):JSX.Element => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-3 border-bottom\">\r\n\t\t\t\t<Image className=\"w-2c h-2c\" src={icon} /> \r\n\t\t\t\t<div className=\"ml-3\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t<div><Muted><EasyTime date={$create} /> {spanUpdate}</Muted></div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>;\r\n\t\t}\r\n\t\treturn <div className=\"m-3 rounded border bg-white\">\r\n\t\t\t<UserView user={owner} render={renderTop} />\r\n\t\t\t<div className=\"px-3 pt-2\"><b>{caption}</b></div>\r\n\t\t\t<div className=\"px-3 pt-2 pb-3\">{discription}</div>\r\n\t\t\t{this.renderItems()}\r\n\t\t\t{this.renderTasks()}\r\n\t\t\t{this.renderCommands()}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderItems():JSX.Element {\r\n\t\tlet {items} = this.assign;\r\n\t\tif (items.length === 0) return;\r\n\t\tlet icon = 'circle';\r\n\t\tlet cnIcon = 'text-primary';\r\n\t\treturn <div className=\"py-2 border-top\">{items.map((v, index) => {\r\n\t\t\tlet {discription} = v;\r\n\t\t\treturn <div key={index} className=\"px-3 py-2 d-flex align-items-center\">\r\n\t\t\t\t<small><small><FA name={icon} className={cnIcon} fixWidth={true} /></small></small>\r\n\t\t\t\t<div className=\"flex-fill ml-3\">{discription}</div>\r\n\t\t\t</div>;\r\n\t\t})}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate showTask = async (taskId: number) => {\r\n\t\tawait this.controller.showTask(taskId);\r\n\t}\r\n\r\n\tprivate renderTasks():JSX.Element {\r\n\t\tlet {tasks} = this.assign;\r\n\t\tif (tasks.length === 0) return;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {icon, name, nick} = user;\r\n\t\t\treturn <>\r\n\t\t\t\t<Image className=\"w-1c h-1c\" src={icon} /> \r\n\t\t\t\t<span className=\"ml-3\">{nick || name}</span>\r\n\t\t\t</>;\r\n\t\t}\r\n\t\treturn <div className=\"py-2\">\r\n\t\t\t<div className=\"border-top border-bottom px-3 bg-light\"><Muted>已领办为任务</Muted></div>\r\n\t\t\t{\r\n\t\t\t\ttasks.map((v, index) => {\r\n\t\t\t\t\tlet {worker, $create} = v;\r\n\t\t\t\t\treturn <div key={index}\r\n\t\t\t\t\t\tclassName=\"px-3 py-2 d-flex cursor-pointer\" \r\n\t\t\t\t\t\tonClick={()=>this.showTask(v.id)}>\r\n\t\t\t\t\t\t<FA name=\"hand-paper-o mr-3 mt-2\" className=\"text-info\" fixWidth={true} />\r\n\t\t\t\t\t\t<div className=\"\">\r\n\t\t\t\t\t\t\t<UserView user={worker} render={renderUser} />\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<EasyTime date={$create} />\r\n\t\t\t\t\t\t\t\t<span className=\"mx-3\">领办</span>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>;\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t</div>;\r\n\t}\r\n\r\n\tprivate renderCommands():JSX.Element {\r\n\t\tlet {open, tasks} = this.assign;\r\n\t\tswitch (open) {\r\n\t\t\tdefault:\r\n\t\t\tcase 0:\r\n\t\t\t\tbreak;\r\n\t\t\tcase 1:\r\n\t\t\t\tif (tasks.length > 0) return;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\t\tif (tasks.find(v => v.worker === this.controller.user.id)) return;\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\r\n\t\treturn <div className=\"px-3 py-2 border-top\">\r\n\t\t\t<button className=\"btn btn-primary\" onClick={this.onTakeAssign}>领办</button>\r\n\t\t</div>;\r\n\t}\r\n}","import { observable } from 'mobx';\r\nimport _ from 'lodash';\r\nimport { CUqBase } from \"../tapp\";\r\nimport { VMyAssigns } from \"./VMyAssigns\";\r\nimport { QueryPager } from \"tonva\";\r\nimport { Assign } from \"../models\";\r\nimport { Performance } from '../tapp'\r\nimport { VAssignNew } from './VAssignNew';\r\nimport { VAssign } from './VAssign';\r\n\r\nexport class CAssign extends CUqBase {\r\n\tprivate performance: Performance;\r\n\r\n\tpublishAssignCallback:(assign:Assign)=>Promise<void>;\r\n\tmyAssignsPager: QueryPager<Assign>;\r\n\t@observable assign: Assign;\r\n\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.performance = this.uqs.performance;\r\n\t\tthis.myAssignsPager = new QueryPager(this.performance.GetMyAssigns, 10, 30, true);\r\n\t\tthis.myAssignsPager.setItemConverter((item, results):Assign => {\r\n\t\t\tlet assign:Assign = item;\r\n\t\t\tassign.tasks = (results.tasks as any[]).filter(v => v.assign===assign.id);\r\n\t\t\treturn assign;\r\n\t\t});\r\n\t}\r\n\r\n\tasync loadAssigns(archived: 0|1) {\r\n\t\tthis.myAssignsPager.reset();\r\n\t\tawait this.myAssignsPager.first({archived});\r\n\t}\r\n\r\n\tprivate async showMyAssignsInternal(archived: 0|1) {\r\n\t\t//this.myAssignsPager.first(undefined); //.reset();\r\n\t\t//let archived: 0|1 = 0;\r\n\t\tlet myAssignsPager = new QueryPager(this.performance.GetMyAssigns, 10, 30, true);\r\n\t\tmyAssignsPager.setItemConverter((item, results):Assign => {\r\n\t\t\tlet assign:Assign = item;\r\n\t\t\tassign.tasks = (results.tasks as any[]).filter(v => v.assign===assign.id);\r\n\t\t\treturn assign;\r\n\t\t});\r\n\t\tmyAssignsPager.first({archived});\r\n\t\tthis.openVPage(VMyAssigns, {myAssignsPager, archived});\r\n\t}\r\n\r\n\tasync showMyAssigns() {\r\n\t\tawait this.showMyAssignsInternal(0);\r\n\t}\r\n\r\n\tasync showMyAssignsArchived() {\r\n\t\tawait this.showMyAssignsInternal(1);\r\n\t}\r\n\r\n\tasync showNewAssign(publishTaskCallback:(assign:Assign)=>Promise<void>):Promise<boolean> {\r\n\t\tthis.publishAssignCallback = publishTaskCallback;\r\n\t\treturn this.vCall(VAssignNew);\r\n\t}\r\n\r\n\tprivate async loadAssign(assignId:number) {\r\n\t\tlet retAssign = await this.performance.GetAssign.query({assignId});\r\n\t\tlet {assign, items, tasks} = retAssign;\r\n\t\tlet assignObj:Assign = {} as any;\r\n\t\t_.mergeWith(assignObj, assign[0]);\r\n\t\tassignObj.items = items;\r\n\t\tassignObj.tasks = tasks;\r\n\t\tthis.assign = assignObj;\r\n\t}\r\n\r\n\tasync showAssign(assignId:number) {\r\n\t\tawait this.loadAssign(assignId);\r\n\t\tthis.openVPage(VAssign, undefined, (ret:any) => {\r\n\t\t\t//if (!ret) return;\r\n\t\t\tlet item = this.myAssignsPager.findItem(assignId);\r\n\t\t\tif (!item) return;\r\n\t\t\tthis.myAssignsPager.refreshItems(item);\r\n\t\t});\r\n\t}\r\n\r\n\tasync publishAssign() {\r\n\t\tawait this.publishAssignCallback(this.assign);\r\n\t}\r\n\r\n\ttakeAssign = async () => {\r\n\t\tlet ret = await this.performance.TakeAssign.submit({assignId: this.assign.id});\r\n\t\tthis.cApp.refreshJob();\r\n\t\tthis.cApp.pushTaskNote(ret);\r\n\t\tthis.closePage();\r\n\t}\r\n\r\n\tshowTask = async (taskId:number) => {\r\n\t\tawait this.cApp.showTask(taskId);\r\n\t}\r\n\r\n\tnewAssign = async (caption:string) => {\r\n\t\tlet ret = await this.performance.NewAssign.submit({caption});\r\n\t\tthis.assign = {\r\n\t\t\tid: ret.id,\r\n\t\t\tcaption,\r\n\t\t\tdiscription: undefined,\r\n\t\t\towner: this.user.id,\r\n\t\t\topen: 1,\r\n\t\t\t$create: new Date(),\r\n\t\t\t$update: new Date(),\r\n\t\t\titems: [],\r\n\t\t};\r\n\t}\r\n\r\n\tsaveAssignItem = async (todoContent: string):Promise<any> => {\r\n\t\tlet assignItem = {\r\n\t\t\tid: undefined as any,\r\n\t\t\tassign: this.assign.id,\r\n\t\t\tstate: 0,\r\n\t\t\tdiscription: todoContent,\r\n\t\t};\r\n\t\tlet ret = await this.performance.AssignItem.save(undefined, assignItem);\r\n\t\tassignItem.id = ret.id;\r\n\t\treturn assignItem;\r\n\t}\r\n\r\n\tsaveAssignProp = async (prop:string, value:any) => {\r\n\t\tawait this.performance.Assign.saveProp(this.assign.id, prop, value);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VPage } from \"tonva\";\r\nimport { CMember } from \"./CMember\";\r\n\r\nexport class VMemberDetail extends VPage<CMember> {\r\n\theader() {\r\n\t\treturn '详情';\r\n\t}\r\n\tcontent() {\r\n\t\treturn <div className=\"p-3\">\r\n\t\t\t群中领办任务详情\r\n\t\t</div>\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport { VPage, List, UserView, User, Image, Muted } from \"tonva\";\r\nimport { CMember, MemberItem } from \"./CMember\";\r\n\r\nexport class VMemberList extends VPage<CMember> {\r\n\theader() {return '同事'}\r\n\tcontent() {\r\n\t\treturn <List className=\"my-3\" \r\n\t\t\titems={this.controller.myMembersPager}\r\n\t\t\titem={{render:this.renderMemberItem, onClick:this.onMemberItem}}\r\n\t\t\tnone=\"无\"\r\n\t\t/>;\r\n\t}\r\n\r\n\tprivate renderMemberItem = (memberItem:MemberItem, index:number) => {\r\n\t\tlet {member, count} = memberItem;\r\n\t\tlet renderUser = (user:User) => {\r\n\t\t\tlet {icon, nick, name} = user;\r\n\t\t\treturn <div className=\"d-flex px-3 py-2\">\r\n\t\t\t\t<Image className=\"w-2c h-2c mr-3\" src={icon} />\r\n\t\t\t\t<div className=\"flex-fill\">\r\n\t\t\t\t\t<div>{nick || name}</div>\r\n\t\t\t\t\t\r\n\t\t\t\t</div>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t{count>0 && <Muted>{count}群</Muted>}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t}\r\n\t\treturn <UserView user={member} render={renderUser} />\r\n\t}\r\n\r\n\tprivate onMemberItem = (userId:number) => {\r\n\t\talert('member: ' + userId);\r\n\t}\r\n\r\n\r\n}\r\n","import { VMemberDetail } from \"./VMemberDetail\";\r\nimport { VMemberList } from \"./VMemberList\";\r\nimport { CUqBase } from \"tapp\";\r\nimport { QueryPager } from \"tonva\";\r\nimport { Performance } from '../tapp'\r\n\r\nexport interface MemberItem {\r\n\tmember: number;\r\n\tcount: number;\r\n}\r\n\r\nexport class CMember extends CUqBase {\r\n\tprivate performance: Performance;\r\n\tmyMembersPager: QueryPager<MemberItem>;\r\n\t\r\n\tprotected async internalStart() {\r\n\t}\r\n\r\n\tinit() {\r\n\t\tthis.performance = this.uqs.performance;\r\n\t\tthis.myMembersPager = new QueryPager(this.performance.GetMyMembers, 10, 500, true);\r\n\t}\r\n\t\r\n\tshowDetail = async (memberId:number) => {\r\n\t\tthis.openVPage(VMemberDetail);\r\n\t}\r\n\r\n\tshowList = async () => {\r\n\t\tawait this.myMembersPager.first(undefined);\r\n\t\tthis.openVPage(VMemberList);\r\n\t}\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport 'bootstrap/dist/css/bootstrap.css';\r\nimport { Elements } from 'tonva';\r\nimport { CUqApp } from \".\";\r\nimport { VMain } from './main';\r\nimport { CMe } from \"me/CMe\";\r\nimport { CHome } from \"home/CHome\";\r\nimport { CGroup } from \"group/CGroup\";\r\nimport { CJob } from \"job/CJob\";\r\nimport { CTask } from 'task/CTask';\r\nimport { CAssign } from 'assign/CAssign';\r\nimport { EnumNoteType } from './uqs';\r\nimport { CMember } from 'member/CMember';\r\n\r\nconst gaps = [10, 3,3,3,3,3,5,5,5,5,5,5,5,5,10,10,10,10,15,15,15,30,30,60];\r\n\r\nexport class CApp extends CUqApp {\r\n\tcGroup: CGroup;\r\n\tcJob: CJob;\r\n    cHome: CHome;\r\n\tcMe: CMe;\r\n\tcAssign: CAssign;\r\n\tcTask: CTask;\r\n\tcMember: CMember;\r\n\r\n    protected async internalStart() {\r\n\t\t// eslint-disable-next-line \r\n\t\tlet a = undefined??0;\r\n\t\tlet {test1, test2} = this.uqs.performance;\r\n\t\t// eslint-disable-next-line\r\n\t\tlet [values1, values2] = await Promise.all([\r\n\t\t\ttest1.loadValues(),\r\n\t\t\ttest2.loadValues()\r\n\t\t]);\r\n \r\n\t\tthis.cGroup = this.newC(CGroup);\r\n\t\tthis.cGroup.load();\r\n\t\tthis.cJob = this.newC(CJob);\r\n\t\tthis.cJob.start();\r\n        this.cHome = this.newC(CHome);\r\n\t\tthis.cMe = this.newC(CMe);\r\n\t\tthis.cAssign = this.newC(CAssign);\r\n\t\tthis.cTask = this.newC(CTask);\r\n\t\tthis.cMember = this.newC(CMember);\r\n\t\tthis.showMain();\r\n\r\n\t\tsetInterval(this.callTick, 1000);\r\n\t}\r\n\r\n\tprivate tick = 0;\r\n\tprivate gapIndex = 0;\r\n\tprivate callTick = async () => {\r\n\t\ttry {\r\n\t\t\tif (!this.user) return;\r\n\t\t\t++this.tick;\r\n\t\t\tif (this.tick<gaps[this.gapIndex]) return;\r\n\t\t\tconsole.error('tick ', new Date());\r\n\t\t\tthis.tick = 0;\r\n\t\t\tif (this.gapIndex < gaps.length - 1) ++this.gapIndex;\r\n\t\t\tlet ret = await this.uqs.performance.$Poked.query(undefined, false);\r\n\t\t\tlet v = ret.ret[0];\r\n\t\t\tif (v === undefined) return;\r\n\t\t\tif (!v.poke) return;\r\n\t\t\tthis.gapIndex = 1;\r\n\t\t\tthis.cGroup.refresh();\r\n\t\t}\r\n\t\tcatch {\r\n\t\t}\r\n\t}\r\n\r\n    showMain(initTabName?: string) {\r\n        this.openVPage(VMain, initTabName);\r\n\t}\r\n\r\n\trefreshJob() {\r\n\t\tthis.cJob.refresh();\r\n\t}\r\n\t\r\n\tprotected afterStart():Promise<void> {\r\n\t\tlet elements:Elements = {\r\n\t\t\taId: aTest,\r\n\t\t\tbId: bTest,\r\n\t\t\tcId: cTest,\r\n\t\t};\r\n\r\n\t\tlet n = 1;\r\n\t\tlet hello = 'hello';\r\n\r\n\t\tfunction aTest(element: HTMLElement) {\r\n\t\t\telement.innerText = hello;\r\n\t\t};\r\n\r\n\t\tfunction bTest(element: HTMLElement) {\r\n\t\t\telement.innerText = hello + ', world!';\r\n\t\t};\r\n\r\n\t\tfunction cTest(element: HTMLElement) {\r\n\t\t\tReactDOM.render(<b className=\"text-success\">{hello}, great</b>, element);\r\n\t\t};\r\n\r\n\t\tthis.hookElements(elements);\r\n\r\n\t\twindow.onfocus = () => {\r\n\t\t\thello = hello + (++n);\r\n\t\t\tthis.hookElements(elements);\r\n\t\t}\r\n\t\treturn;\r\n\t}\r\n\r\n\t//====== App calls =======\r\n\tasync showTask(taskId:number):Promise<void> {\r\n\t\tawait this.cTask.showTask(taskId);\r\n\t}\r\n\r\n\tasync showMyTasks():Promise<void> {\r\n\t\tawait this.cTask.showMyTasks();\r\n\t}\r\n\r\n\tasync showAssign(assignId:number):Promise<void> {\r\n\t\tawait this.cAssign.showAssign(assignId);\r\n\t}\r\n\r\n\tasync showNewAssign():Promise<boolean> {\r\n\t\tlet ret = await this.cAssign.showNewAssign(this.cGroup.publishAssign);\r\n\t\treturn ret;\r\n\t}\r\n\r\n\tasync showMyAssigns():Promise<void> {\r\n\t\tawait this.cAssign.showMyAssigns();\r\n\t}\r\n\r\n\tasync showMemberDetail(memberId:number):Promise<void> {\r\n\t\tthis.cMember.showDetail(memberId);\r\n\t}\r\n\r\n\tasync pushTaskNote(retAfterTaskAction:any) {\r\n\t\tif (!retAfterTaskAction) {\r\n\t\t\tconsole.error('task action return undefined')\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tlet {task, step, state, group} = retAfterTaskAction;\r\n\t\tlet data = {\r\n\t\t\tgroup, \r\n\t\t\tcontent: step + '|' + state, \r\n\t\t\ttype:EnumNoteType.Task, \r\n\t\t\tobj:task\r\n\t\t};\r\n\t\tawait this.uqs.performance.PushNote.submit(data);\r\n\t\tthis.resetTick();\r\n\t\tthis.cGroup.refresh();\r\n\t}\r\n\r\n\tresetTick() {\r\n\t\tthis.tick = 0;\r\n\t\tthis.gapIndex = 1;\r\n\t}\r\n}\r\n","import React from 'react';\nimport { nav, NavView, start } from 'tonva';\n//import logo from './logo.svg';\nimport './App.css';\nimport { CApp } from './tapp/CApp';\nimport { appConfig } from './tapp';\n\nnav.setSettings(appConfig);\n\nconst App: React.FC = () => {\n    const onLogined = async () => {\n\t\tawait start(CApp, appConfig);\n    }\n    return <NavView onLogined={onLogined} />;\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport './index.css';\n\nlet elRoot = document.getElementById('root');\nif (!elRoot) {\n\telRoot = document.createElement('div');\n\telRoot.style.display = 'none';\n\tdocument.body.append(elRoot);\n}\nReactDOM.render(<App />, elRoot);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}